(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function i(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(a){if(a.ep)return;a.ep=!0;const u=i(a);fetch(a.href,u)}})();function jg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Gu={exports:{}},Ll={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bm;function Uy(){if(Bm)return Ll;Bm=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function i(s,a,u){var f=null;if(u!==void 0&&(f=""+u),a.key!==void 0&&(f=""+a.key),"key"in a){u={};for(var p in a)p!=="key"&&(u[p]=a[p])}else u=a;return a=u.ref,{$$typeof:t,type:s,key:f,ref:a!==void 0?a:null,props:u}}return Ll.Fragment=e,Ll.jsx=i,Ll.jsxs=i,Ll}var qm;function Hy(){return qm||(qm=1,Gu.exports=Uy()),Gu.exports}var l=Hy(),Vu={exports:{}},Qe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zm;function Oy(){if(zm)return Qe;zm=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),f=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.iterator;function C(I){return I===null||typeof I!="object"?null:(I=v&&I[v]||I["@@iterator"],typeof I=="function"?I:null)}var N={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},R=Object.assign,L={};function O(I,j,F){this.props=I,this.context=j,this.refs=L,this.updater=F||N}O.prototype.isReactComponent={},O.prototype.setState=function(I,j){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,j,"setState")},O.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function J(){}J.prototype=O.prototype;function P(I,j,F){this.props=I,this.context=j,this.refs=L,this.updater=F||N}var $=P.prototype=new J;$.constructor=P,R($,O.prototype),$.isPureReactComponent=!0;var ne=Array.isArray,z={H:null,A:null,T:null,S:null,V:null},ae=Object.prototype.hasOwnProperty;function de(I,j,F,Z,A,G){return F=G.ref,{$$typeof:t,type:I,key:j,ref:F!==void 0?F:null,props:G}}function re(I,j){return de(I.type,j,void 0,void 0,void 0,I.props)}function se(I){return typeof I=="object"&&I!==null&&I.$$typeof===t}function oe(I){var j={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(F){return j[F]})}var _=/\/+/g;function me(I,j){return typeof I=="object"&&I!==null&&I.key!=null?oe(""+I.key):j.toString(36)}function Y(){}function ue(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(Y,Y):(I.status="pending",I.then(function(j){I.status==="pending"&&(I.status="fulfilled",I.value=j)},function(j){I.status==="pending"&&(I.status="rejected",I.reason=j)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function H(I,j,F,Z,A){var G=typeof I;(G==="undefined"||G==="boolean")&&(I=null);var M=!1;if(I===null)M=!0;else switch(G){case"bigint":case"string":case"number":M=!0;break;case"object":switch(I.$$typeof){case t:case e:M=!0;break;case y:return M=I._init,H(M(I._payload),j,F,Z,A)}}if(M)return A=A(I),M=Z===""?"."+me(I,0):Z,ne(A)?(F="",M!=null&&(F=M.replace(_,"$&/")+"/"),H(A,j,F,"",function(X){return X})):A!=null&&(se(A)&&(A=re(A,F+(A.key==null||I&&I.key===A.key?"":(""+A.key).replace(_,"$&/")+"/")+M)),j.push(A)),1;M=0;var D=Z===""?".":Z+":";if(ne(I))for(var B=0;B<I.length;B++)Z=I[B],G=D+me(Z,B),M+=H(Z,j,F,G,A);else if(B=C(I),typeof B=="function")for(I=B.call(I),B=0;!(Z=I.next()).done;)Z=Z.value,G=D+me(Z,B++),M+=H(Z,j,F,G,A);else if(G==="object"){if(typeof I.then=="function")return H(ue(I),j,F,Z,A);throw j=String(I),Error("Objects are not valid as a React child (found: "+(j==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":j)+"). If you meant to render a collection of children, use an array instead.")}return M}function k(I,j,F){if(I==null)return I;var Z=[],A=0;return H(I,Z,"","",function(G){return j.call(F,G,A++)}),Z}function S(I){if(I._status===-1){var j=I._result;j=j(),j.then(function(F){(I._status===0||I._status===-1)&&(I._status=1,I._result=F)},function(F){(I._status===0||I._status===-1)&&(I._status=2,I._result=F)}),I._status===-1&&(I._status=0,I._result=j)}if(I._status===1)return I._result.default;throw I._result}var V=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var j=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(j))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)};function W(){}return Qe.Children={map:k,forEach:function(I,j,F){k(I,function(){j.apply(this,arguments)},F)},count:function(I){var j=0;return k(I,function(){j++}),j},toArray:function(I){return k(I,function(j){return j})||[]},only:function(I){if(!se(I))throw Error("React.Children.only expected to receive a single React element child.");return I}},Qe.Component=O,Qe.Fragment=i,Qe.Profiler=a,Qe.PureComponent=P,Qe.StrictMode=s,Qe.Suspense=g,Qe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=z,Qe.__COMPILER_RUNTIME={__proto__:null,c:function(I){return z.H.useMemoCache(I)}},Qe.cache=function(I){return function(){return I.apply(null,arguments)}},Qe.cloneElement=function(I,j,F){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var Z=R({},I.props),A=I.key,G=void 0;if(j!=null)for(M in j.ref!==void 0&&(G=void 0),j.key!==void 0&&(A=""+j.key),j)!ae.call(j,M)||M==="key"||M==="__self"||M==="__source"||M==="ref"&&j.ref===void 0||(Z[M]=j[M]);var M=arguments.length-2;if(M===1)Z.children=F;else if(1<M){for(var D=Array(M),B=0;B<M;B++)D[B]=arguments[B+2];Z.children=D}return de(I.type,A,void 0,void 0,G,Z)},Qe.createContext=function(I){return I={$$typeof:f,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:u,_context:I},I},Qe.createElement=function(I,j,F){var Z,A={},G=null;if(j!=null)for(Z in j.key!==void 0&&(G=""+j.key),j)ae.call(j,Z)&&Z!=="key"&&Z!=="__self"&&Z!=="__source"&&(A[Z]=j[Z]);var M=arguments.length-2;if(M===1)A.children=F;else if(1<M){for(var D=Array(M),B=0;B<M;B++)D[B]=arguments[B+2];A.children=D}if(I&&I.defaultProps)for(Z in M=I.defaultProps,M)A[Z]===void 0&&(A[Z]=M[Z]);return de(I,G,void 0,void 0,null,A)},Qe.createRef=function(){return{current:null}},Qe.forwardRef=function(I){return{$$typeof:p,render:I}},Qe.isValidElement=se,Qe.lazy=function(I){return{$$typeof:y,_payload:{_status:-1,_result:I},_init:S}},Qe.memo=function(I,j){return{$$typeof:m,type:I,compare:j===void 0?null:j}},Qe.startTransition=function(I){var j=z.T,F={};z.T=F;try{var Z=I(),A=z.S;A!==null&&A(F,Z),typeof Z=="object"&&Z!==null&&typeof Z.then=="function"&&Z.then(W,V)}catch(G){V(G)}finally{z.T=j}},Qe.unstable_useCacheRefresh=function(){return z.H.useCacheRefresh()},Qe.use=function(I){return z.H.use(I)},Qe.useActionState=function(I,j,F){return z.H.useActionState(I,j,F)},Qe.useCallback=function(I,j){return z.H.useCallback(I,j)},Qe.useContext=function(I){return z.H.useContext(I)},Qe.useDebugValue=function(){},Qe.useDeferredValue=function(I,j){return z.H.useDeferredValue(I,j)},Qe.useEffect=function(I,j,F){var Z=z.H;if(typeof F=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Z.useEffect(I,j)},Qe.useId=function(){return z.H.useId()},Qe.useImperativeHandle=function(I,j,F){return z.H.useImperativeHandle(I,j,F)},Qe.useInsertionEffect=function(I,j){return z.H.useInsertionEffect(I,j)},Qe.useLayoutEffect=function(I,j){return z.H.useLayoutEffect(I,j)},Qe.useMemo=function(I,j){return z.H.useMemo(I,j)},Qe.useOptimistic=function(I,j){return z.H.useOptimistic(I,j)},Qe.useReducer=function(I,j,F){return z.H.useReducer(I,j,F)},Qe.useRef=function(I){return z.H.useRef(I)},Qe.useState=function(I){return z.H.useState(I)},Qe.useSyncExternalStore=function(I,j,F){return z.H.useSyncExternalStore(I,j,F)},Qe.useTransition=function(){return z.H.useTransition()},Qe.version="19.1.0",Qe}var Fm;function cd(){return Fm||(Fm=1,Vu.exports=Oy()),Vu.exports}var E=cd();const Me=jg(E);var $u={exports:{}},jl={},Bu={exports:{}},qu={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Km;function Gy(){return Km||(Km=1,function(t){function e(k,S){var V=k.length;k.push(S);e:for(;0<V;){var W=V-1>>>1,I=k[W];if(0<a(I,S))k[W]=S,k[V]=I,V=W;else break e}}function i(k){return k.length===0?null:k[0]}function s(k){if(k.length===0)return null;var S=k[0],V=k.pop();if(V!==S){k[0]=V;e:for(var W=0,I=k.length,j=I>>>1;W<j;){var F=2*(W+1)-1,Z=k[F],A=F+1,G=k[A];if(0>a(Z,V))A<I&&0>a(G,Z)?(k[W]=G,k[A]=V,W=A):(k[W]=Z,k[F]=V,W=F);else if(A<I&&0>a(G,V))k[W]=G,k[A]=V,W=A;else break e}}return S}function a(k,S){var V=k.sortIndex-S.sortIndex;return V!==0?V:k.id-S.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var f=Date,p=f.now();t.unstable_now=function(){return f.now()-p}}var g=[],m=[],y=1,v=null,C=3,N=!1,R=!1,L=!1,O=!1,J=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;function ne(k){for(var S=i(m);S!==null;){if(S.callback===null)s(m);else if(S.startTime<=k)s(m),S.sortIndex=S.expirationTime,e(g,S);else break;S=i(m)}}function z(k){if(L=!1,ne(k),!R)if(i(g)!==null)R=!0,ae||(ae=!0,me());else{var S=i(m);S!==null&&H(z,S.startTime-k)}}var ae=!1,de=-1,re=5,se=-1;function oe(){return O?!0:!(t.unstable_now()-se<re)}function _(){if(O=!1,ae){var k=t.unstable_now();se=k;var S=!0;try{e:{R=!1,L&&(L=!1,P(de),de=-1),N=!0;var V=C;try{t:{for(ne(k),v=i(g);v!==null&&!(v.expirationTime>k&&oe());){var W=v.callback;if(typeof W=="function"){v.callback=null,C=v.priorityLevel;var I=W(v.expirationTime<=k);if(k=t.unstable_now(),typeof I=="function"){v.callback=I,ne(k),S=!0;break t}v===i(g)&&s(g),ne(k)}else s(g);v=i(g)}if(v!==null)S=!0;else{var j=i(m);j!==null&&H(z,j.startTime-k),S=!1}}break e}finally{v=null,C=V,N=!1}S=void 0}}finally{S?me():ae=!1}}}var me;if(typeof $=="function")me=function(){$(_)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,ue=Y.port2;Y.port1.onmessage=_,me=function(){ue.postMessage(null)}}else me=function(){J(_,0)};function H(k,S){de=J(function(){k(t.unstable_now())},S)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(k){k.callback=null},t.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):re=0<k?Math.floor(1e3/k):5},t.unstable_getCurrentPriorityLevel=function(){return C},t.unstable_next=function(k){switch(C){case 1:case 2:case 3:var S=3;break;default:S=C}var V=C;C=S;try{return k()}finally{C=V}},t.unstable_requestPaint=function(){O=!0},t.unstable_runWithPriority=function(k,S){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var V=C;C=k;try{return S()}finally{C=V}},t.unstable_scheduleCallback=function(k,S,V){var W=t.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?W+V:W):V=W,k){case 1:var I=-1;break;case 2:I=250;break;case 5:I=1073741823;break;case 4:I=1e4;break;default:I=5e3}return I=V+I,k={id:y++,callback:S,priorityLevel:k,startTime:V,expirationTime:I,sortIndex:-1},V>W?(k.sortIndex=V,e(m,k),i(g)===null&&k===i(m)&&(L?(P(de),de=-1):L=!0,H(z,V-W))):(k.sortIndex=I,e(g,k),R||N||(R=!0,ae||(ae=!0,me()))),k},t.unstable_shouldYield=oe,t.unstable_wrapCallback=function(k){var S=C;return function(){var V=C;C=S;try{return k.apply(this,arguments)}finally{C=V}}}}(qu)),qu}var Ym;function Vy(){return Ym||(Ym=1,Bu.exports=Gy()),Bu.exports}var zu={exports:{}},Wt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jm;function $y(){if(Jm)return Wt;Jm=1;var t=cd();function e(g){var m="https://react.dev/errors/"+g;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+g+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var s={d:{f:i,r:function(){throw Error(e(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},a=Symbol.for("react.portal");function u(g,m,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:v==null?null:""+v,children:g,containerInfo:m,implementation:y}}var f=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function p(g,m){if(g==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return Wt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Wt.createPortal=function(g,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return u(g,m,null,y)},Wt.flushSync=function(g){var m=f.T,y=s.p;try{if(f.T=null,s.p=2,g)return g()}finally{f.T=m,s.p=y,s.d.f()}},Wt.preconnect=function(g,m){typeof g=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,s.d.C(g,m))},Wt.prefetchDNS=function(g){typeof g=="string"&&s.d.D(g)},Wt.preinit=function(g,m){if(typeof g=="string"&&m&&typeof m.as=="string"){var y=m.as,v=p(y,m.crossOrigin),C=typeof m.integrity=="string"?m.integrity:void 0,N=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?s.d.S(g,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:C,fetchPriority:N}):y==="script"&&s.d.X(g,{crossOrigin:v,integrity:C,fetchPriority:N,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},Wt.preinitModule=function(g,m){if(typeof g=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=p(m.as,m.crossOrigin);s.d.M(g,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&s.d.M(g)},Wt.preload=function(g,m){if(typeof g=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,v=p(y,m.crossOrigin);s.d.L(g,y,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},Wt.preloadModule=function(g,m){if(typeof g=="string")if(m){var y=p(m.as,m.crossOrigin);s.d.m(g,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else s.d.m(g)},Wt.requestFormReset=function(g){s.d.r(g)},Wt.unstable_batchedUpdates=function(g,m){return g(m)},Wt.useFormState=function(g,m,y){return f.H.useFormState(g,m,y)},Wt.useFormStatus=function(){return f.H.useHostTransitionStatus()},Wt.version="19.1.0",Wt}var Qm;function Dg(){if(Qm)return zu.exports;Qm=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),zu.exports=$y(),zu.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xm;function By(){if(Xm)return jl;Xm=1;var t=Vy(),e=cd(),i=Dg();function s(n){var o="https://react.dev/errors/"+n;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)o+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+n+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function u(n){var o=n,r=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,(o.flags&4098)!==0&&(r=o.return),n=o.return;while(n)}return o.tag===3?r:null}function f(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function p(n){if(u(n)!==n)throw Error(s(188))}function g(n){var o=n.alternate;if(!o){if(o=u(n),o===null)throw Error(s(188));return o!==n?null:n}for(var r=n,h=o;;){var x=r.return;if(x===null)break;var b=x.alternate;if(b===null){if(h=x.return,h!==null){r=h;continue}break}if(x.child===b.child){for(b=x.child;b;){if(b===r)return p(x),n;if(b===h)return p(x),o;b=b.sibling}throw Error(s(188))}if(r.return!==h.return)r=x,h=b;else{for(var T=!1,w=x.child;w;){if(w===r){T=!0,r=x,h=b;break}if(w===h){T=!0,h=x,r=b;break}w=w.sibling}if(!T){for(w=b.child;w;){if(w===r){T=!0,r=b,h=x;break}if(w===h){T=!0,h=b,r=x;break}w=w.sibling}if(!T)throw Error(s(189))}}if(r.alternate!==h)throw Error(s(190))}if(r.tag!==3)throw Error(s(188));return r.stateNode.current===r?n:o}function m(n){var o=n.tag;if(o===5||o===26||o===27||o===6)return n;for(n=n.child;n!==null;){if(o=m(n),o!==null)return o;n=n.sibling}return null}var y=Object.assign,v=Symbol.for("react.element"),C=Symbol.for("react.transitional.element"),N=Symbol.for("react.portal"),R=Symbol.for("react.fragment"),L=Symbol.for("react.strict_mode"),O=Symbol.for("react.profiler"),J=Symbol.for("react.provider"),P=Symbol.for("react.consumer"),$=Symbol.for("react.context"),ne=Symbol.for("react.forward_ref"),z=Symbol.for("react.suspense"),ae=Symbol.for("react.suspense_list"),de=Symbol.for("react.memo"),re=Symbol.for("react.lazy"),se=Symbol.for("react.activity"),oe=Symbol.for("react.memo_cache_sentinel"),_=Symbol.iterator;function me(n){return n===null||typeof n!="object"?null:(n=_&&n[_]||n["@@iterator"],typeof n=="function"?n:null)}var Y=Symbol.for("react.client.reference");function ue(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===Y?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case R:return"Fragment";case O:return"Profiler";case L:return"StrictMode";case z:return"Suspense";case ae:return"SuspenseList";case se:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case N:return"Portal";case $:return(n.displayName||"Context")+".Provider";case P:return(n._context.displayName||"Context")+".Consumer";case ne:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case de:return o=n.displayName||null,o!==null?o:ue(n.type)||"Memo";case re:o=n._payload,n=n._init;try{return ue(n(o))}catch{}}return null}var H=Array.isArray,k=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,S=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V={pending:!1,data:null,method:null,action:null},W=[],I=-1;function j(n){return{current:n}}function F(n){0>I||(n.current=W[I],W[I]=null,I--)}function Z(n,o){I++,W[I]=n.current,n.current=o}var A=j(null),G=j(null),M=j(null),D=j(null);function B(n,o){switch(Z(M,o),Z(G,n),Z(A,null),o.nodeType){case 9:case 11:n=(n=o.documentElement)&&(n=n.namespaceURI)?xm(n):0;break;default:if(n=o.tagName,o=o.namespaceURI)o=xm(o),n=ym(o,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}F(A),Z(A,n)}function X(){F(A),F(G),F(M)}function xe(n){n.memoizedState!==null&&Z(D,n);var o=A.current,r=ym(o,n.type);o!==r&&(Z(G,n),Z(A,r))}function Ne(n){G.current===n&&(F(A),F(G)),D.current===n&&(F(D),Ml._currentValue=V)}var Te=Object.prototype.hasOwnProperty,Ee=t.unstable_scheduleCallback,Re=t.unstable_cancelCallback,ye=t.unstable_shouldYield,we=t.unstable_requestPaint,Se=t.unstable_now,Ce=t.unstable_getCurrentPriorityLevel,_e=t.unstable_ImmediatePriority,gt=t.unstable_UserBlockingPriority,Fe=t.unstable_NormalPriority,Q=t.unstable_LowPriority,ve=t.unstable_IdlePriority,be=t.log,Ae=t.unstable_setDisableYieldValue,De=null,qe=null;function ze(n){if(typeof be=="function"&&Ae(n),qe&&typeof qe.setStrictMode=="function")try{qe.setStrictMode(De,n)}catch{}}var Ke=Math.clz32?Math.clz32:Kt,Ye=Math.log,Et=Math.LN2;function Kt(n){return n>>>=0,n===0?32:31-(Ye(n)/Et|0)|0}var it=256,tn=4194304;function Ot(n){var o=n&42;if(o!==0)return o;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Ue(n,o,r){var h=n.pendingLanes;if(h===0)return 0;var x=0,b=n.suspendedLanes,T=n.pingedLanes;n=n.warmLanes;var w=h&134217727;return w!==0?(h=w&~b,h!==0?x=Ot(h):(T&=w,T!==0?x=Ot(T):r||(r=w&~n,r!==0&&(x=Ot(r))))):(w=h&~b,w!==0?x=Ot(w):T!==0?x=Ot(T):r||(r=h&~n,r!==0&&(x=Ot(r)))),x===0?0:o!==0&&o!==x&&(o&b)===0&&(b=x&-x,r=o&-o,b>=r||b===32&&(r&4194048)!==0)?o:x}function xn(n,o){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&o)===0}function wo(n,o){switch(n){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zl(){var n=it;return it<<=1,(it&4194048)===0&&(it=256),n}function Fl(){var n=tn;return tn<<=1,(tn&62914560)===0&&(tn=4194304),n}function Eo(n){for(var o=[],r=0;31>r;r++)o.push(n);return o}function Vi(n,o){n.pendingLanes|=o,o!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function Ur(n,o,r,h,x,b){var T=n.pendingLanes;n.pendingLanes=r,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=r,n.entangledLanes&=r,n.errorRecoveryDisabledLanes&=r,n.shellSuspendCounter=0;var w=n.entanglements,U=n.expirationTimes,te=n.hiddenUpdates;for(r=T&~r;0<r;){var he=31-Ke(r),ge=1<<he;w[he]=0,U[he]=-1;var ie=te[he];if(ie!==null)for(te[he]=null,he=0;he<ie.length;he++){var le=ie[he];le!==null&&(le.lane&=-536870913)}r&=~ge}h!==0&&Kl(n,h,0),b!==0&&x===0&&n.tag!==0&&(n.suspendedLanes|=b&~(T&~o))}function Kl(n,o,r){n.pendingLanes|=o,n.suspendedLanes&=~o;var h=31-Ke(o);n.entangledLanes|=o,n.entanglements[h]=n.entanglements[h]|1073741824|r&4194090}function Yl(n,o){var r=n.entangledLanes|=o;for(n=n.entanglements;r;){var h=31-Ke(r),x=1<<h;x&o|n[h]&o&&(n[h]|=o),r&=~x}}function Mo(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function Ao(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function Jl(){var n=S.p;return n!==0?n:(n=window.event,n===void 0?32:Um(n.type))}function Hr(n,o){var r=S.p;try{return S.p=n,o()}finally{S.p=r}}var Un=Math.random().toString(36).slice(2),Dt="__reactFiber$"+Un,Yt="__reactProps$"+Un,hi="__reactContainer$"+Un,Ro="__reactEvents$"+Un,Or="__reactListeners$"+Un,Gr="__reactHandles$"+Un,Ql="__reactResources$"+Un,$i="__reactMarker$"+Un;function Io(n){delete n[Dt],delete n[Yt],delete n[Ro],delete n[Or],delete n[Gr]}function fi(n){var o=n[Dt];if(o)return o;for(var r=n.parentNode;r;){if(o=r[hi]||r[Dt]){if(r=o.alternate,o.child!==null||r!==null&&r.child!==null)for(n=Tm(n);n!==null;){if(r=n[Dt])return r;n=Tm(n)}return o}n=r,r=n.parentNode}return null}function mi(n){if(n=n[Dt]||n[hi]){var o=n.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return n}return null}function Bi(n){var o=n.tag;if(o===5||o===26||o===27||o===6)return n.stateNode;throw Error(s(33))}function pi(n){var o=n[Ql];return o||(o=n[Ql]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Mt(n){n[$i]=!0}var Xl=new Set,_o={};function Rn(n,o){Fn(n,o),Fn(n+"Capture",o)}function Fn(n,o){for(_o[n]=o,n=0;n<o.length;n++)Xl.add(o[n])}var Lo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),jo={},Do={};function Wl(n){return Te.call(Do,n)?!0:Te.call(jo,n)?!1:Lo.test(n)?Do[n]=!0:(jo[n]=!0,!1)}function qi(n,o,r){if(Wl(o))if(r===null)n.removeAttribute(o);else{switch(typeof r){case"undefined":case"function":case"symbol":n.removeAttribute(o);return;case"boolean":var h=o.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){n.removeAttribute(o);return}}n.setAttribute(o,""+r)}}function zi(n,o,r){if(r===null)n.removeAttribute(o);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(o);return}n.setAttribute(o,""+r)}}function yn(n,o,r,h){if(h===null)n.removeAttribute(r);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(r);return}n.setAttributeNS(o,r,""+h)}}var Po,Ns;function Hn(n){if(Po===void 0)try{throw Error()}catch(r){var o=r.stack.trim().match(/\n( *(at )?)/);Po=o&&o[1]||"",Ns=-1<r.stack.indexOf(`
    at`)?" (<anonymous>)":-1<r.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Po+n+Ns}var ks=!1;function Ss(n,o){if(!n||ks)return"";ks=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(o){var ge=function(){throw Error()};if(Object.defineProperty(ge.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ge,[])}catch(le){var ie=le}Reflect.construct(n,[],ge)}else{try{ge.call()}catch(le){ie=le}n.call(ge.prototype)}}else{try{throw Error()}catch(le){ie=le}(ge=n())&&typeof ge.catch=="function"&&ge.catch(function(){})}}catch(le){if(le&&ie&&typeof le.stack=="string")return[le.stack,ie.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=h.DetermineComponentFrameRoot(),T=b[0],w=b[1];if(T&&w){var U=T.split(`
`),te=w.split(`
`);for(x=h=0;h<U.length&&!U[h].includes("DetermineComponentFrameRoot");)h++;for(;x<te.length&&!te[x].includes("DetermineComponentFrameRoot");)x++;if(h===U.length||x===te.length)for(h=U.length-1,x=te.length-1;1<=h&&0<=x&&U[h]!==te[x];)x--;for(;1<=h&&0<=x;h--,x--)if(U[h]!==te[x]){if(h!==1||x!==1)do if(h--,x--,0>x||U[h]!==te[x]){var he=`
`+U[h].replace(" at new "," at ");return n.displayName&&he.includes("<anonymous>")&&(he=he.replace("<anonymous>",n.displayName)),he}while(1<=h&&0<=x);break}}}finally{ks=!1,Error.prepareStackTrace=r}return(r=n?n.displayName||n.name:"")?Hn(r):""}function Uo(n){switch(n.tag){case 26:case 27:case 5:return Hn(n.type);case 16:return Hn("Lazy");case 13:return Hn("Suspense");case 19:return Hn("SuspenseList");case 0:case 15:return Ss(n.type,!1);case 11:return Ss(n.type.render,!1);case 1:return Ss(n.type,!0);case 31:return Hn("Activity");default:return""}}function ws(n){try{var o="";do o+=Uo(n),n=n.return;while(n);return o}catch(r){return`
Error generating stack: `+r.message+`
`+r.stack}}function Jt(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Es(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Ho(n){var o=Es(n)?"checked":"value",r=Object.getOwnPropertyDescriptor(n.constructor.prototype,o),h=""+n[o];if(!n.hasOwnProperty(o)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var x=r.get,b=r.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return x.call(this)},set:function(T){h=""+T,b.call(this,T)}}),Object.defineProperty(n,o,{enumerable:r.enumerable}),{getValue:function(){return h},setValue:function(T){h=""+T},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function Fi(n){n._valueTracker||(n._valueTracker=Ho(n))}function Oo(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var r=o.getValue(),h="";return n&&(h=Es(n)?n.checked?"true":"false":n.value),n=h,n!==r?(o.setValue(n),!0):!1}function Ki(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var Zl=/[\n"\\]/g;function Qt(n){return n.replace(Zl,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Yi(n,o,r,h,x,b,T,w){n.name="",T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?n.type=T:n.removeAttribute("type"),o!=null?T==="number"?(o===0&&n.value===""||n.value!=o)&&(n.value=""+Jt(o)):n.value!==""+Jt(o)&&(n.value=""+Jt(o)):T!=="submit"&&T!=="reset"||n.removeAttribute("value"),o!=null?Ji(n,T,Jt(o)):r!=null?Ji(n,T,Jt(r)):h!=null&&n.removeAttribute("value"),x==null&&b!=null&&(n.defaultChecked=!!b),x!=null&&(n.checked=x&&typeof x!="function"&&typeof x!="symbol"),w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"?n.name=""+Jt(w):n.removeAttribute("name")}function Ms(n,o,r,h,x,b,T,w){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(n.type=b),o!=null||r!=null){if(!(b!=="submit"&&b!=="reset"||o!=null))return;r=r!=null?""+Jt(r):"",o=o!=null?""+Jt(o):r,w||o===n.value||(n.value=o),n.defaultValue=o}h=h??x,h=typeof h!="function"&&typeof h!="symbol"&&!!h,n.checked=w?n.checked:!!h,n.defaultChecked=!!h,T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(n.name=T)}function Ji(n,o,r){o==="number"&&Ki(n.ownerDocument)===n||n.defaultValue===""+r||(n.defaultValue=""+r)}function On(n,o,r,h){if(n=n.options,o){o={};for(var x=0;x<r.length;x++)o["$"+r[x]]=!0;for(r=0;r<n.length;r++)x=o.hasOwnProperty("$"+n[r].value),n[r].selected!==x&&(n[r].selected=x),x&&h&&(n[r].defaultSelected=!0)}else{for(r=""+Jt(r),o=null,x=0;x<n.length;x++){if(n[x].value===r){n[x].selected=!0,h&&(n[x].defaultSelected=!0);return}o!==null||n[x].disabled||(o=n[x])}o!==null&&(o.selected=!0)}}function ea(n,o,r){if(o!=null&&(o=""+Jt(o),o!==n.value&&(n.value=o),r==null)){n.defaultValue!==o&&(n.defaultValue=o);return}n.defaultValue=r!=null?""+Jt(r):""}function ta(n,o,r,h){if(o==null){if(h!=null){if(r!=null)throw Error(s(92));if(H(h)){if(1<h.length)throw Error(s(93));h=h[0]}r=h}r==null&&(r=""),o=r}r=Jt(o),n.defaultValue=r,h=n.textContent,h===r&&h!==""&&h!==null&&(n.value=h)}function $e(n,o){if(o){var r=n.firstChild;if(r&&r===n.lastChild&&r.nodeType===3){r.nodeValue=o;return}}n.textContent=o}var Vr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function xt(n,o,r){var h=o.indexOf("--")===0;r==null||typeof r=="boolean"||r===""?h?n.setProperty(o,""):o==="float"?n.cssFloat="":n[o]="":h?n.setProperty(o,r):typeof r!="number"||r===0||Vr.has(o)?o==="float"?n.cssFloat=r:n[o]=(""+r).trim():n[o]=r+"px"}function na(n,o,r){if(o!=null&&typeof o!="object")throw Error(s(62));if(n=n.style,r!=null){for(var h in r)!r.hasOwnProperty(h)||o!=null&&o.hasOwnProperty(h)||(h.indexOf("--")===0?n.setProperty(h,""):h==="float"?n.cssFloat="":n[h]="");for(var x in o)h=o[x],o.hasOwnProperty(x)&&r[x]!==h&&xt(n,x,h)}else for(var b in o)o.hasOwnProperty(b)&&xt(n,b,o[b])}function Nt(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),lt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Qi(n){return lt.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}var As=null;function Xi(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var At=null,Kn=null;function on(n){var o=mi(n);if(o&&(n=o.stateNode)){var r=n[Yt]||null;e:switch(n=o.stateNode,o.type){case"input":if(Yi(n,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),o=r.name,r.type==="radio"&&o!=null){for(r=n;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+Qt(""+o)+'"][type="radio"]'),o=0;o<r.length;o++){var h=r[o];if(h!==n&&h.form===n.form){var x=h[Yt]||null;if(!x)throw Error(s(90));Yi(h,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(o=0;o<r.length;o++)h=r[o],h.form===n.form&&Oo(h)}break e;case"textarea":ea(n,r.value,r.defaultValue);break e;case"select":o=r.value,o!=null&&On(n,!!r.multiple,o,!1)}}}var Rs=!1;function In(n,o,r){if(Rs)return n(o,r);Rs=!0;try{var h=n(o);return h}finally{if(Rs=!1,(At!==null||Kn!==null)&&(Ka(),At&&(o=At,n=Kn,Kn=At=null,on(o),n)))for(o=0;o<n.length;o++)on(n[o])}}function Yn(n,o){var r=n.stateNode;if(r===null)return null;var h=r[Yt]||null;if(h===null)return null;r=h[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(n=n.type,h=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!h;break e;default:n=!1}if(n)return null;if(r&&typeof r!="function")throw Error(s(231,o,typeof r));return r}var vn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),gi=!1;if(vn)try{var xi={};Object.defineProperty(xi,"passive",{get:function(){gi=!0}}),window.addEventListener("test",xi,xi),window.removeEventListener("test",xi,xi)}catch{gi=!1}var Gt=null,Is=null,Vt=null;function _n(){if(Vt)return Vt;var n,o=Is,r=o.length,h,x="value"in Gt?Gt.value:Gt.textContent,b=x.length;for(n=0;n<r&&o[n]===x[n];n++);var T=r-n;for(h=1;h<=T&&o[r-h]===x[b-h];h++);return Vt=x.slice(n,1<h?1-h:void 0)}function Wi(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function Jn(){return!0}function Go(){return!1}function $t(n){function o(r,h,x,b,T){this._reactName=r,this._targetInst=x,this.type=h,this.nativeEvent=b,this.target=T,this.currentTarget=null;for(var w in n)n.hasOwnProperty(w)&&(r=n[w],this[w]=r?r(b):b[w]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Jn:Go,this.isPropagationStopped=Go,this}return y(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Jn)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Jn)},persist:function(){},isPersistent:Jn}),o}var Qn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_s=$t(Qn),Zi=y({},Qn,{view:0,detail:0}),$r=$t(Zi),Vo,$o,es,Ls=y({},Zi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:js,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==es&&(es&&n.type==="mousemove"?(Vo=n.screenX-es.screenX,$o=n.screenY-es.screenY):$o=Vo=0,es=n),Vo)},movementY:function(n){return"movementY"in n?n.movementY:$o}}),ia=$t(Ls),Br=y({},Ls,{dataTransfer:0}),qr=$t(Br),zr=y({},Zi,{relatedTarget:0}),Bo=$t(zr),sa=y({},Qn,{animationName:0,elapsedTime:0,pseudoElement:0}),oa=$t(sa),Fr=y({},Qn,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Kr=$t(Fr),Yr=y({},Qn,{data:0}),qo=$t(Yr),la={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},aa={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ra={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ca(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=ra[n])?!!o[n]:!1}function js(){return ca}var ua=y({},Zi,{key:function(n){if(n.key){var o=la[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=Wi(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?aa[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:js,charCode:function(n){return n.type==="keypress"?Wi(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Wi(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),da=$t(ua),ha=y({},Ls,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fa=$t(ha),Ds=y({},Zi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:js}),fe=$t(Ds),ce=y({},Qn,{propertyName:0,elapsedTime:0,pseudoElement:0}),ke=$t(ce),He=y({},Ls,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),tt=$t(He),Je=y({},Qn,{newState:0,oldState:0}),Oe=$t(Je),Ln=[9,13,27,32],Jr=vn&&"CompositionEvent"in window,zo=null;vn&&"documentMode"in document&&(zo=document.documentMode);var rx=vn&&"TextEvent"in window&&!zo,Sd=vn&&(!Jr||zo&&8<zo&&11>=zo),wd=" ",Ed=!1;function Md(n,o){switch(n){case"keyup":return Ln.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ad(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Ps=!1;function cx(n,o){switch(n){case"compositionend":return Ad(o);case"keypress":return o.which!==32?null:(Ed=!0,wd);case"textInput":return n=o.data,n===wd&&Ed?null:n;default:return null}}function ux(n,o){if(Ps)return n==="compositionend"||!Jr&&Md(n,o)?(n=_n(),Vt=Is=Gt=null,Ps=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Sd&&o.locale!=="ko"?null:o.data;default:return null}}var dx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Rd(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!dx[n.type]:o==="textarea"}function Id(n,o,r,h){At?Kn?Kn.push(h):Kn=[h]:At=h,o=Za(o,"onChange"),0<o.length&&(r=new _s("onChange","change",null,r,h),n.push({event:r,listeners:o}))}var Fo=null,Ko=null;function hx(n){hm(n,0)}function ma(n){var o=Bi(n);if(Oo(o))return n}function _d(n,o){if(n==="change")return o}var Ld=!1;if(vn){var Qr;if(vn){var Xr="oninput"in document;if(!Xr){var jd=document.createElement("div");jd.setAttribute("oninput","return;"),Xr=typeof jd.oninput=="function"}Qr=Xr}else Qr=!1;Ld=Qr&&(!document.documentMode||9<document.documentMode)}function Dd(){Fo&&(Fo.detachEvent("onpropertychange",Pd),Ko=Fo=null)}function Pd(n){if(n.propertyName==="value"&&ma(Ko)){var o=[];Id(o,Ko,n,Xi(n)),In(hx,o)}}function fx(n,o,r){n==="focusin"?(Dd(),Fo=o,Ko=r,Fo.attachEvent("onpropertychange",Pd)):n==="focusout"&&Dd()}function mx(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return ma(Ko)}function px(n,o){if(n==="click")return ma(o)}function gx(n,o){if(n==="input"||n==="change")return ma(o)}function xx(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var cn=typeof Object.is=="function"?Object.is:xx;function Yo(n,o){if(cn(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var r=Object.keys(n),h=Object.keys(o);if(r.length!==h.length)return!1;for(h=0;h<r.length;h++){var x=r[h];if(!Te.call(o,x)||!cn(n[x],o[x]))return!1}return!0}function Ud(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Hd(n,o){var r=Ud(n);n=0;for(var h;r;){if(r.nodeType===3){if(h=n+r.textContent.length,n<=o&&h>=o)return{node:r,offset:o-n};n=h}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Ud(r)}}function Od(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?Od(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function Gd(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var o=Ki(n.document);o instanceof n.HTMLIFrameElement;){try{var r=typeof o.contentWindow.location.href=="string"}catch{r=!1}if(r)n=o.contentWindow;else break;o=Ki(n.document)}return o}function Wr(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}var yx=vn&&"documentMode"in document&&11>=document.documentMode,Us=null,Zr=null,Jo=null,ec=!1;function Vd(n,o,r){var h=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;ec||Us==null||Us!==Ki(h)||(h=Us,"selectionStart"in h&&Wr(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Jo&&Yo(Jo,h)||(Jo=h,h=Za(Zr,"onSelect"),0<h.length&&(o=new _s("onSelect","select",null,o,r),n.push({event:o,listeners:h}),o.target=Us)))}function ts(n,o){var r={};return r[n.toLowerCase()]=o.toLowerCase(),r["Webkit"+n]="webkit"+o,r["Moz"+n]="moz"+o,r}var Hs={animationend:ts("Animation","AnimationEnd"),animationiteration:ts("Animation","AnimationIteration"),animationstart:ts("Animation","AnimationStart"),transitionrun:ts("Transition","TransitionRun"),transitionstart:ts("Transition","TransitionStart"),transitioncancel:ts("Transition","TransitionCancel"),transitionend:ts("Transition","TransitionEnd")},tc={},$d={};vn&&($d=document.createElement("div").style,"AnimationEvent"in window||(delete Hs.animationend.animation,delete Hs.animationiteration.animation,delete Hs.animationstart.animation),"TransitionEvent"in window||delete Hs.transitionend.transition);function ns(n){if(tc[n])return tc[n];if(!Hs[n])return n;var o=Hs[n],r;for(r in o)if(o.hasOwnProperty(r)&&r in $d)return tc[n]=o[r];return n}var Bd=ns("animationend"),qd=ns("animationiteration"),zd=ns("animationstart"),vx=ns("transitionrun"),bx=ns("transitionstart"),Cx=ns("transitioncancel"),Fd=ns("transitionend"),Kd=new Map,nc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");nc.push("scrollEnd");function jn(n,o){Kd.set(n,o),Rn(o,[n])}var Yd=new WeakMap;function bn(n,o){if(typeof n=="object"&&n!==null){var r=Yd.get(n);return r!==void 0?r:(o={value:n,source:o,stack:ws(o)},Yd.set(n,o),o)}return{value:n,source:o,stack:ws(o)}}var Cn=[],Os=0,ic=0;function pa(){for(var n=Os,o=ic=Os=0;o<n;){var r=Cn[o];Cn[o++]=null;var h=Cn[o];Cn[o++]=null;var x=Cn[o];Cn[o++]=null;var b=Cn[o];if(Cn[o++]=null,h!==null&&x!==null){var T=h.pending;T===null?x.next=x:(x.next=T.next,T.next=x),h.pending=x}b!==0&&Jd(r,x,b)}}function ga(n,o,r,h){Cn[Os++]=n,Cn[Os++]=o,Cn[Os++]=r,Cn[Os++]=h,ic|=h,n.lanes|=h,n=n.alternate,n!==null&&(n.lanes|=h)}function sc(n,o,r,h){return ga(n,o,r,h),xa(n)}function Gs(n,o){return ga(n,null,null,o),xa(n)}function Jd(n,o,r){n.lanes|=r;var h=n.alternate;h!==null&&(h.lanes|=r);for(var x=!1,b=n.return;b!==null;)b.childLanes|=r,h=b.alternate,h!==null&&(h.childLanes|=r),b.tag===22&&(n=b.stateNode,n===null||n._visibility&1||(x=!0)),n=b,b=b.return;return n.tag===3?(b=n.stateNode,x&&o!==null&&(x=31-Ke(r),n=b.hiddenUpdates,h=n[x],h===null?n[x]=[o]:h.push(o),o.lane=r|536870912),b):null}function xa(n){if(50<bl)throw bl=0,uu=null,Error(s(185));for(var o=n.return;o!==null;)n=o,o=n.return;return n.tag===3?n.stateNode:null}var Vs={};function Tx(n,o,r,h){this.tag=n,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function un(n,o,r,h){return new Tx(n,o,r,h)}function oc(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Xn(n,o){var r=n.alternate;return r===null?(r=un(n.tag,o,n.key,n.mode),r.elementType=n.elementType,r.type=n.type,r.stateNode=n.stateNode,r.alternate=n,n.alternate=r):(r.pendingProps=o,r.type=n.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=n.flags&65011712,r.childLanes=n.childLanes,r.lanes=n.lanes,r.child=n.child,r.memoizedProps=n.memoizedProps,r.memoizedState=n.memoizedState,r.updateQueue=n.updateQueue,o=n.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},r.sibling=n.sibling,r.index=n.index,r.ref=n.ref,r.refCleanup=n.refCleanup,r}function Qd(n,o){n.flags&=65011714;var r=n.alternate;return r===null?(n.childLanes=0,n.lanes=o,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=r.childLanes,n.lanes=r.lanes,n.child=r.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=r.memoizedProps,n.memoizedState=r.memoizedState,n.updateQueue=r.updateQueue,n.type=r.type,o=r.dependencies,n.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),n}function ya(n,o,r,h,x,b){var T=0;if(h=n,typeof n=="function")oc(n)&&(T=1);else if(typeof n=="string")T=ky(n,r,A.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case se:return n=un(31,r,o,x),n.elementType=se,n.lanes=b,n;case R:return is(r.children,x,b,o);case L:T=8,x|=24;break;case O:return n=un(12,r,o,x|2),n.elementType=O,n.lanes=b,n;case z:return n=un(13,r,o,x),n.elementType=z,n.lanes=b,n;case ae:return n=un(19,r,o,x),n.elementType=ae,n.lanes=b,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case J:case $:T=10;break e;case P:T=9;break e;case ne:T=11;break e;case de:T=14;break e;case re:T=16,h=null;break e}T=29,r=Error(s(130,n===null?"null":typeof n,"")),h=null}return o=un(T,r,o,x),o.elementType=n,o.type=h,o.lanes=b,o}function is(n,o,r,h){return n=un(7,n,h,o),n.lanes=r,n}function lc(n,o,r){return n=un(6,n,null,o),n.lanes=r,n}function ac(n,o,r){return o=un(4,n.children!==null?n.children:[],n.key,o),o.lanes=r,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}var $s=[],Bs=0,va=null,ba=0,Tn=[],Nn=0,ss=null,Wn=1,Zn="";function os(n,o){$s[Bs++]=ba,$s[Bs++]=va,va=n,ba=o}function Xd(n,o,r){Tn[Nn++]=Wn,Tn[Nn++]=Zn,Tn[Nn++]=ss,ss=n;var h=Wn;n=Zn;var x=32-Ke(h)-1;h&=~(1<<x),r+=1;var b=32-Ke(o)+x;if(30<b){var T=x-x%5;b=(h&(1<<T)-1).toString(32),h>>=T,x-=T,Wn=1<<32-Ke(o)+x|r<<x|h,Zn=b+n}else Wn=1<<b|r<<x|h,Zn=n}function rc(n){n.return!==null&&(os(n,1),Xd(n,1,0))}function cc(n){for(;n===va;)va=$s[--Bs],$s[Bs]=null,ba=$s[--Bs],$s[Bs]=null;for(;n===ss;)ss=Tn[--Nn],Tn[Nn]=null,Zn=Tn[--Nn],Tn[Nn]=null,Wn=Tn[--Nn],Tn[Nn]=null}var nn=null,Ct=null,ot=!1,ls=null,Gn=!1,uc=Error(s(519));function as(n){var o=Error(s(418,""));throw Wo(bn(o,n)),uc}function Wd(n){var o=n.stateNode,r=n.type,h=n.memoizedProps;switch(o[Dt]=n,o[Yt]=h,r){case"dialog":et("cancel",o),et("close",o);break;case"iframe":case"object":case"embed":et("load",o);break;case"video":case"audio":for(r=0;r<Tl.length;r++)et(Tl[r],o);break;case"source":et("error",o);break;case"img":case"image":case"link":et("error",o),et("load",o);break;case"details":et("toggle",o);break;case"input":et("invalid",o),Ms(o,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0),Fi(o);break;case"select":et("invalid",o);break;case"textarea":et("invalid",o),ta(o,h.value,h.defaultValue,h.children),Fi(o)}r=h.children,typeof r!="string"&&typeof r!="number"&&typeof r!="bigint"||o.textContent===""+r||h.suppressHydrationWarning===!0||gm(o.textContent,r)?(h.popover!=null&&(et("beforetoggle",o),et("toggle",o)),h.onScroll!=null&&et("scroll",o),h.onScrollEnd!=null&&et("scrollend",o),h.onClick!=null&&(o.onclick=er),o=!0):o=!1,o||as(n)}function Zd(n){for(nn=n.return;nn;)switch(nn.tag){case 5:case 13:Gn=!1;return;case 27:case 3:Gn=!0;return;default:nn=nn.return}}function Qo(n){if(n!==nn)return!1;if(!ot)return Zd(n),ot=!0,!1;var o=n.tag,r;if((r=o!==3&&o!==27)&&((r=o===5)&&(r=n.type,r=!(r!=="form"&&r!=="button")||wu(n.type,n.memoizedProps)),r=!r),r&&Ct&&as(n),Zd(n),o===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(s(317));e:{for(n=n.nextSibling,o=0;n;){if(n.nodeType===8)if(r=n.data,r==="/$"){if(o===0){Ct=Pn(n.nextSibling);break e}o--}else r!=="$"&&r!=="$!"&&r!=="$?"||o++;n=n.nextSibling}Ct=null}}else o===27?(o=Ct,Li(n.type)?(n=Ru,Ru=null,Ct=n):Ct=o):Ct=nn?Pn(n.stateNode.nextSibling):null;return!0}function Xo(){Ct=nn=null,ot=!1}function eh(){var n=ls;return n!==null&&(rn===null?rn=n:rn.push.apply(rn,n),ls=null),n}function Wo(n){ls===null?ls=[n]:ls.push(n)}var dc=j(null),rs=null,ei=null;function yi(n,o,r){Z(dc,o._currentValue),o._currentValue=r}function ti(n){n._currentValue=dc.current,F(dc)}function hc(n,o,r){for(;n!==null;){var h=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,h!==null&&(h.childLanes|=o)):h!==null&&(h.childLanes&o)!==o&&(h.childLanes|=o),n===r)break;n=n.return}}function fc(n,o,r,h){var x=n.child;for(x!==null&&(x.return=n);x!==null;){var b=x.dependencies;if(b!==null){var T=x.child;b=b.firstContext;e:for(;b!==null;){var w=b;b=x;for(var U=0;U<o.length;U++)if(w.context===o[U]){b.lanes|=r,w=b.alternate,w!==null&&(w.lanes|=r),hc(b.return,r,n),h||(T=null);break e}b=w.next}}else if(x.tag===18){if(T=x.return,T===null)throw Error(s(341));T.lanes|=r,b=T.alternate,b!==null&&(b.lanes|=r),hc(T,r,n),T=null}else T=x.child;if(T!==null)T.return=x;else for(T=x;T!==null;){if(T===n){T=null;break}if(x=T.sibling,x!==null){x.return=T.return,T=x;break}T=T.return}x=T}}function Zo(n,o,r,h){n=null;for(var x=o,b=!1;x!==null;){if(!b){if((x.flags&524288)!==0)b=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var T=x.alternate;if(T===null)throw Error(s(387));if(T=T.memoizedProps,T!==null){var w=x.type;cn(x.pendingProps.value,T.value)||(n!==null?n.push(w):n=[w])}}else if(x===D.current){if(T=x.alternate,T===null)throw Error(s(387));T.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(n!==null?n.push(Ml):n=[Ml])}x=x.return}n!==null&&fc(o,n,r,h),o.flags|=262144}function Ca(n){for(n=n.firstContext;n!==null;){if(!cn(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function cs(n){rs=n,ei=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Xt(n){return th(rs,n)}function Ta(n,o){return rs===null&&cs(n),th(n,o)}function th(n,o){var r=o._currentValue;if(o={context:o,memoizedValue:r,next:null},ei===null){if(n===null)throw Error(s(308));ei=o,n.dependencies={lanes:0,firstContext:o},n.flags|=524288}else ei=ei.next=o;return r}var Nx=typeof AbortController<"u"?AbortController:function(){var n=[],o=this.signal={aborted:!1,addEventListener:function(r,h){n.push(h)}};this.abort=function(){o.aborted=!0,n.forEach(function(r){return r()})}},kx=t.unstable_scheduleCallback,Sx=t.unstable_NormalPriority,Lt={$$typeof:$,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function mc(){return{controller:new Nx,data:new Map,refCount:0}}function el(n){n.refCount--,n.refCount===0&&kx(Sx,function(){n.controller.abort()})}var tl=null,pc=0,qs=0,zs=null;function wx(n,o){if(tl===null){var r=tl=[];pc=0,qs=xu(),zs={status:"pending",value:void 0,then:function(h){r.push(h)}}}return pc++,o.then(nh,nh),o}function nh(){if(--pc===0&&tl!==null){zs!==null&&(zs.status="fulfilled");var n=tl;tl=null,qs=0,zs=null;for(var o=0;o<n.length;o++)(0,n[o])()}}function Ex(n,o){var r=[],h={status:"pending",value:null,reason:null,then:function(x){r.push(x)}};return n.then(function(){h.status="fulfilled",h.value=o;for(var x=0;x<r.length;x++)(0,r[x])(o)},function(x){for(h.status="rejected",h.reason=x,x=0;x<r.length;x++)(0,r[x])(void 0)}),h}var ih=k.S;k.S=function(n,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&wx(n,o),ih!==null&&ih(n,o)};var us=j(null);function gc(){var n=us.current;return n!==null?n:pt.pooledCache}function Na(n,o){o===null?Z(us,us.current):Z(us,o.pool)}function sh(){var n=gc();return n===null?null:{parent:Lt._currentValue,pool:n}}var nl=Error(s(460)),oh=Error(s(474)),ka=Error(s(542)),xc={then:function(){}};function lh(n){return n=n.status,n==="fulfilled"||n==="rejected"}function Sa(){}function ah(n,o,r){switch(r=n[r],r===void 0?n.push(o):r!==o&&(o.then(Sa,Sa),o=r),o.status){case"fulfilled":return o.value;case"rejected":throw n=o.reason,ch(n),n;default:if(typeof o.status=="string")o.then(Sa,Sa);else{if(n=pt,n!==null&&100<n.shellSuspendCounter)throw Error(s(482));n=o,n.status="pending",n.then(function(h){if(o.status==="pending"){var x=o;x.status="fulfilled",x.value=h}},function(h){if(o.status==="pending"){var x=o;x.status="rejected",x.reason=h}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw n=o.reason,ch(n),n}throw il=o,nl}}var il=null;function rh(){if(il===null)throw Error(s(459));var n=il;return il=null,n}function ch(n){if(n===nl||n===ka)throw Error(s(483))}var vi=!1;function yc(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function vc(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function bi(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Ci(n,o,r){var h=n.updateQueue;if(h===null)return null;if(h=h.shared,(at&2)!==0){var x=h.pending;return x===null?o.next=o:(o.next=x.next,x.next=o),h.pending=o,o=xa(n),Jd(n,null,r),o}return ga(n,h,o,r),xa(n)}function sl(n,o,r){if(o=o.updateQueue,o!==null&&(o=o.shared,(r&4194048)!==0)){var h=o.lanes;h&=n.pendingLanes,r|=h,o.lanes=r,Yl(n,r)}}function bc(n,o){var r=n.updateQueue,h=n.alternate;if(h!==null&&(h=h.updateQueue,r===h)){var x=null,b=null;if(r=r.firstBaseUpdate,r!==null){do{var T={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};b===null?x=b=T:b=b.next=T,r=r.next}while(r!==null);b===null?x=b=o:b=b.next=o}else x=b=o;r={baseState:h.baseState,firstBaseUpdate:x,lastBaseUpdate:b,shared:h.shared,callbacks:h.callbacks},n.updateQueue=r;return}n=r.lastBaseUpdate,n===null?r.firstBaseUpdate=o:n.next=o,r.lastBaseUpdate=o}var Cc=!1;function ol(){if(Cc){var n=zs;if(n!==null)throw n}}function ll(n,o,r,h){Cc=!1;var x=n.updateQueue;vi=!1;var b=x.firstBaseUpdate,T=x.lastBaseUpdate,w=x.shared.pending;if(w!==null){x.shared.pending=null;var U=w,te=U.next;U.next=null,T===null?b=te:T.next=te,T=U;var he=n.alternate;he!==null&&(he=he.updateQueue,w=he.lastBaseUpdate,w!==T&&(w===null?he.firstBaseUpdate=te:w.next=te,he.lastBaseUpdate=U))}if(b!==null){var ge=x.baseState;T=0,he=te=U=null,w=b;do{var ie=w.lane&-536870913,le=ie!==w.lane;if(le?(nt&ie)===ie:(h&ie)===ie){ie!==0&&ie===qs&&(Cc=!0),he!==null&&(he=he.next={lane:0,tag:w.tag,payload:w.payload,callback:null,next:null});e:{var Be=n,Ge=w;ie=o;var ft=r;switch(Ge.tag){case 1:if(Be=Ge.payload,typeof Be=="function"){ge=Be.call(ft,ge,ie);break e}ge=Be;break e;case 3:Be.flags=Be.flags&-65537|128;case 0:if(Be=Ge.payload,ie=typeof Be=="function"?Be.call(ft,ge,ie):Be,ie==null)break e;ge=y({},ge,ie);break e;case 2:vi=!0}}ie=w.callback,ie!==null&&(n.flags|=64,le&&(n.flags|=8192),le=x.callbacks,le===null?x.callbacks=[ie]:le.push(ie))}else le={lane:ie,tag:w.tag,payload:w.payload,callback:w.callback,next:null},he===null?(te=he=le,U=ge):he=he.next=le,T|=ie;if(w=w.next,w===null){if(w=x.shared.pending,w===null)break;le=w,w=le.next,le.next=null,x.lastBaseUpdate=le,x.shared.pending=null}}while(!0);he===null&&(U=ge),x.baseState=U,x.firstBaseUpdate=te,x.lastBaseUpdate=he,b===null&&(x.shared.lanes=0),Ai|=T,n.lanes=T,n.memoizedState=ge}}function uh(n,o){if(typeof n!="function")throw Error(s(191,n));n.call(o)}function dh(n,o){var r=n.callbacks;if(r!==null)for(n.callbacks=null,n=0;n<r.length;n++)uh(r[n],o)}var Fs=j(null),wa=j(0);function hh(n,o){n=ri,Z(wa,n),Z(Fs,o),ri=n|o.baseLanes}function Tc(){Z(wa,ri),Z(Fs,Fs.current)}function Nc(){ri=wa.current,F(Fs),F(wa)}var Ti=0,Xe=null,dt=null,Rt=null,Ea=!1,Ks=!1,ds=!1,Ma=0,al=0,Ys=null,Mx=0;function St(){throw Error(s(321))}function kc(n,o){if(o===null)return!1;for(var r=0;r<o.length&&r<n.length;r++)if(!cn(n[r],o[r]))return!1;return!0}function Sc(n,o,r,h,x,b){return Ti=b,Xe=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,k.H=n===null||n.memoizedState===null?Jh:Qh,ds=!1,b=r(h,x),ds=!1,Ks&&(b=mh(o,r,h,x)),fh(n),b}function fh(n){k.H=ja;var o=dt!==null&&dt.next!==null;if(Ti=0,Rt=dt=Xe=null,Ea=!1,al=0,Ys=null,o)throw Error(s(300));n===null||Pt||(n=n.dependencies,n!==null&&Ca(n)&&(Pt=!0))}function mh(n,o,r,h){Xe=n;var x=0;do{if(Ks&&(Ys=null),al=0,Ks=!1,25<=x)throw Error(s(301));if(x+=1,Rt=dt=null,n.updateQueue!=null){var b=n.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}k.H=Dx,b=o(r,h)}while(Ks);return b}function Ax(){var n=k.H,o=n.useState()[0];return o=typeof o.then=="function"?rl(o):o,n=n.useState()[0],(dt!==null?dt.memoizedState:null)!==n&&(Xe.flags|=1024),o}function wc(){var n=Ma!==0;return Ma=0,n}function Ec(n,o,r){o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~r}function Mc(n){if(Ea){for(n=n.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}Ea=!1}Ti=0,Rt=dt=Xe=null,Ks=!1,al=Ma=0,Ys=null}function ln(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Rt===null?Xe.memoizedState=Rt=n:Rt=Rt.next=n,Rt}function It(){if(dt===null){var n=Xe.alternate;n=n!==null?n.memoizedState:null}else n=dt.next;var o=Rt===null?Xe.memoizedState:Rt.next;if(o!==null)Rt=o,dt=n;else{if(n===null)throw Xe.alternate===null?Error(s(467)):Error(s(310));dt=n,n={memoizedState:dt.memoizedState,baseState:dt.baseState,baseQueue:dt.baseQueue,queue:dt.queue,next:null},Rt===null?Xe.memoizedState=Rt=n:Rt=Rt.next=n}return Rt}function Ac(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function rl(n){var o=al;return al+=1,Ys===null&&(Ys=[]),n=ah(Ys,n,o),o=Xe,(Rt===null?o.memoizedState:Rt.next)===null&&(o=o.alternate,k.H=o===null||o.memoizedState===null?Jh:Qh),n}function Aa(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return rl(n);if(n.$$typeof===$)return Xt(n)}throw Error(s(438,String(n)))}function Rc(n){var o=null,r=Xe.updateQueue;if(r!==null&&(o=r.memoCache),o==null){var h=Xe.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(o={data:h.data.map(function(x){return x.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),r===null&&(r=Ac(),Xe.updateQueue=r),r.memoCache=o,r=o.data[o.index],r===void 0)for(r=o.data[o.index]=Array(n),h=0;h<n;h++)r[h]=oe;return o.index++,r}function ni(n,o){return typeof o=="function"?o(n):o}function Ra(n){var o=It();return Ic(o,dt,n)}function Ic(n,o,r){var h=n.queue;if(h===null)throw Error(s(311));h.lastRenderedReducer=r;var x=n.baseQueue,b=h.pending;if(b!==null){if(x!==null){var T=x.next;x.next=b.next,b.next=T}o.baseQueue=x=b,h.pending=null}if(b=n.baseState,x===null)n.memoizedState=b;else{o=x.next;var w=T=null,U=null,te=o,he=!1;do{var ge=te.lane&-536870913;if(ge!==te.lane?(nt&ge)===ge:(Ti&ge)===ge){var ie=te.revertLane;if(ie===0)U!==null&&(U=U.next={lane:0,revertLane:0,action:te.action,hasEagerState:te.hasEagerState,eagerState:te.eagerState,next:null}),ge===qs&&(he=!0);else if((Ti&ie)===ie){te=te.next,ie===qs&&(he=!0);continue}else ge={lane:0,revertLane:te.revertLane,action:te.action,hasEagerState:te.hasEagerState,eagerState:te.eagerState,next:null},U===null?(w=U=ge,T=b):U=U.next=ge,Xe.lanes|=ie,Ai|=ie;ge=te.action,ds&&r(b,ge),b=te.hasEagerState?te.eagerState:r(b,ge)}else ie={lane:ge,revertLane:te.revertLane,action:te.action,hasEagerState:te.hasEagerState,eagerState:te.eagerState,next:null},U===null?(w=U=ie,T=b):U=U.next=ie,Xe.lanes|=ge,Ai|=ge;te=te.next}while(te!==null&&te!==o);if(U===null?T=b:U.next=w,!cn(b,n.memoizedState)&&(Pt=!0,he&&(r=zs,r!==null)))throw r;n.memoizedState=b,n.baseState=T,n.baseQueue=U,h.lastRenderedState=b}return x===null&&(h.lanes=0),[n.memoizedState,h.dispatch]}function _c(n){var o=It(),r=o.queue;if(r===null)throw Error(s(311));r.lastRenderedReducer=n;var h=r.dispatch,x=r.pending,b=o.memoizedState;if(x!==null){r.pending=null;var T=x=x.next;do b=n(b,T.action),T=T.next;while(T!==x);cn(b,o.memoizedState)||(Pt=!0),o.memoizedState=b,o.baseQueue===null&&(o.baseState=b),r.lastRenderedState=b}return[b,h]}function ph(n,o,r){var h=Xe,x=It(),b=ot;if(b){if(r===void 0)throw Error(s(407));r=r()}else r=o();var T=!cn((dt||x).memoizedState,r);T&&(x.memoizedState=r,Pt=!0),x=x.queue;var w=yh.bind(null,h,x,n);if(cl(2048,8,w,[n]),x.getSnapshot!==o||T||Rt!==null&&Rt.memoizedState.tag&1){if(h.flags|=2048,Js(9,Ia(),xh.bind(null,h,x,r,o),null),pt===null)throw Error(s(349));b||(Ti&124)!==0||gh(h,o,r)}return r}function gh(n,o,r){n.flags|=16384,n={getSnapshot:o,value:r},o=Xe.updateQueue,o===null?(o=Ac(),Xe.updateQueue=o,o.stores=[n]):(r=o.stores,r===null?o.stores=[n]:r.push(n))}function xh(n,o,r,h){o.value=r,o.getSnapshot=h,vh(o)&&bh(n)}function yh(n,o,r){return r(function(){vh(o)&&bh(n)})}function vh(n){var o=n.getSnapshot;n=n.value;try{var r=o();return!cn(n,r)}catch{return!0}}function bh(n){var o=Gs(n,2);o!==null&&pn(o,n,2)}function Lc(n){var o=ln();if(typeof n=="function"){var r=n;if(n=r(),ds){ze(!0);try{r()}finally{ze(!1)}}}return o.memoizedState=o.baseState=n,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:n},o}function Ch(n,o,r,h){return n.baseState=r,Ic(n,dt,typeof h=="function"?h:ni)}function Rx(n,o,r,h,x){if(La(n))throw Error(s(485));if(n=o.action,n!==null){var b={payload:x,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(T){b.listeners.push(T)}};k.T!==null?r(!0):b.isTransition=!1,h(b),r=o.pending,r===null?(b.next=o.pending=b,Th(o,b)):(b.next=r.next,o.pending=r.next=b)}}function Th(n,o){var r=o.action,h=o.payload,x=n.state;if(o.isTransition){var b=k.T,T={};k.T=T;try{var w=r(x,h),U=k.S;U!==null&&U(T,w),Nh(n,o,w)}catch(te){jc(n,o,te)}finally{k.T=b}}else try{b=r(x,h),Nh(n,o,b)}catch(te){jc(n,o,te)}}function Nh(n,o,r){r!==null&&typeof r=="object"&&typeof r.then=="function"?r.then(function(h){kh(n,o,h)},function(h){return jc(n,o,h)}):kh(n,o,r)}function kh(n,o,r){o.status="fulfilled",o.value=r,Sh(o),n.state=r,o=n.pending,o!==null&&(r=o.next,r===o?n.pending=null:(r=r.next,o.next=r,Th(n,r)))}function jc(n,o,r){var h=n.pending;if(n.pending=null,h!==null){h=h.next;do o.status="rejected",o.reason=r,Sh(o),o=o.next;while(o!==h)}n.action=null}function Sh(n){n=n.listeners;for(var o=0;o<n.length;o++)(0,n[o])()}function wh(n,o){return o}function Eh(n,o){if(ot){var r=pt.formState;if(r!==null){e:{var h=Xe;if(ot){if(Ct){t:{for(var x=Ct,b=Gn;x.nodeType!==8;){if(!b){x=null;break t}if(x=Pn(x.nextSibling),x===null){x=null;break t}}b=x.data,x=b==="F!"||b==="F"?x:null}if(x){Ct=Pn(x.nextSibling),h=x.data==="F!";break e}}as(h)}h=!1}h&&(o=r[0])}}return r=ln(),r.memoizedState=r.baseState=o,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:wh,lastRenderedState:o},r.queue=h,r=Fh.bind(null,Xe,h),h.dispatch=r,h=Lc(!1),b=Oc.bind(null,Xe,!1,h.queue),h=ln(),x={state:o,dispatch:null,action:n,pending:null},h.queue=x,r=Rx.bind(null,Xe,x,b,r),x.dispatch=r,h.memoizedState=n,[o,r,!1]}function Mh(n){var o=It();return Ah(o,dt,n)}function Ah(n,o,r){if(o=Ic(n,o,wh)[0],n=Ra(ni)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var h=rl(o)}catch(T){throw T===nl?ka:T}else h=o;o=It();var x=o.queue,b=x.dispatch;return r!==o.memoizedState&&(Xe.flags|=2048,Js(9,Ia(),Ix.bind(null,x,r),null)),[h,b,n]}function Ix(n,o){n.action=o}function Rh(n){var o=It(),r=dt;if(r!==null)return Ah(o,r,n);It(),o=o.memoizedState,r=It();var h=r.queue.dispatch;return r.memoizedState=n,[o,h,!1]}function Js(n,o,r,h){return n={tag:n,create:r,deps:h,inst:o,next:null},o=Xe.updateQueue,o===null&&(o=Ac(),Xe.updateQueue=o),r=o.lastEffect,r===null?o.lastEffect=n.next=n:(h=r.next,r.next=n,n.next=h,o.lastEffect=n),n}function Ia(){return{destroy:void 0,resource:void 0}}function Ih(){return It().memoizedState}function _a(n,o,r,h){var x=ln();h=h===void 0?null:h,Xe.flags|=n,x.memoizedState=Js(1|o,Ia(),r,h)}function cl(n,o,r,h){var x=It();h=h===void 0?null:h;var b=x.memoizedState.inst;dt!==null&&h!==null&&kc(h,dt.memoizedState.deps)?x.memoizedState=Js(o,b,r,h):(Xe.flags|=n,x.memoizedState=Js(1|o,b,r,h))}function _h(n,o){_a(8390656,8,n,o)}function Lh(n,o){cl(2048,8,n,o)}function jh(n,o){return cl(4,2,n,o)}function Dh(n,o){return cl(4,4,n,o)}function Ph(n,o){if(typeof o=="function"){n=n();var r=o(n);return function(){typeof r=="function"?r():o(null)}}if(o!=null)return n=n(),o.current=n,function(){o.current=null}}function Uh(n,o,r){r=r!=null?r.concat([n]):null,cl(4,4,Ph.bind(null,o,n),r)}function Dc(){}function Hh(n,o){var r=It();o=o===void 0?null:o;var h=r.memoizedState;return o!==null&&kc(o,h[1])?h[0]:(r.memoizedState=[n,o],n)}function Oh(n,o){var r=It();o=o===void 0?null:o;var h=r.memoizedState;if(o!==null&&kc(o,h[1]))return h[0];if(h=n(),ds){ze(!0);try{n()}finally{ze(!1)}}return r.memoizedState=[h,o],h}function Pc(n,o,r){return r===void 0||(Ti&1073741824)!==0?n.memoizedState=o:(n.memoizedState=r,n=Bf(),Xe.lanes|=n,Ai|=n,r)}function Gh(n,o,r,h){return cn(r,o)?r:Fs.current!==null?(n=Pc(n,r,h),cn(n,o)||(Pt=!0),n):(Ti&42)===0?(Pt=!0,n.memoizedState=r):(n=Bf(),Xe.lanes|=n,Ai|=n,o)}function Vh(n,o,r,h,x){var b=S.p;S.p=b!==0&&8>b?b:8;var T=k.T,w={};k.T=w,Oc(n,!1,o,r);try{var U=x(),te=k.S;if(te!==null&&te(w,U),U!==null&&typeof U=="object"&&typeof U.then=="function"){var he=Ex(U,h);ul(n,o,he,mn(n))}else ul(n,o,h,mn(n))}catch(ge){ul(n,o,{then:function(){},status:"rejected",reason:ge},mn())}finally{S.p=b,k.T=T}}function _x(){}function Uc(n,o,r,h){if(n.tag!==5)throw Error(s(476));var x=$h(n).queue;Vh(n,x,o,V,r===null?_x:function(){return Bh(n),r(h)})}function $h(n){var o=n.memoizedState;if(o!==null)return o;o={memoizedState:V,baseState:V,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:V},next:null};var r={};return o.next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:r},next:null},n.memoizedState=o,n=n.alternate,n!==null&&(n.memoizedState=o),o}function Bh(n){var o=$h(n).next.queue;ul(n,o,{},mn())}function Hc(){return Xt(Ml)}function qh(){return It().memoizedState}function zh(){return It().memoizedState}function Lx(n){for(var o=n.return;o!==null;){switch(o.tag){case 24:case 3:var r=mn();n=bi(r);var h=Ci(o,n,r);h!==null&&(pn(h,o,r),sl(h,o,r)),o={cache:mc()},n.payload=o;return}o=o.return}}function jx(n,o,r){var h=mn();r={lane:h,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null},La(n)?Kh(o,r):(r=sc(n,o,r,h),r!==null&&(pn(r,n,h),Yh(r,o,h)))}function Fh(n,o,r){var h=mn();ul(n,o,r,h)}function ul(n,o,r,h){var x={lane:h,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null};if(La(n))Kh(o,x);else{var b=n.alternate;if(n.lanes===0&&(b===null||b.lanes===0)&&(b=o.lastRenderedReducer,b!==null))try{var T=o.lastRenderedState,w=b(T,r);if(x.hasEagerState=!0,x.eagerState=w,cn(w,T))return ga(n,o,x,0),pt===null&&pa(),!1}catch{}finally{}if(r=sc(n,o,x,h),r!==null)return pn(r,n,h),Yh(r,o,h),!0}return!1}function Oc(n,o,r,h){if(h={lane:2,revertLane:xu(),action:h,hasEagerState:!1,eagerState:null,next:null},La(n)){if(o)throw Error(s(479))}else o=sc(n,r,h,2),o!==null&&pn(o,n,2)}function La(n){var o=n.alternate;return n===Xe||o!==null&&o===Xe}function Kh(n,o){Ks=Ea=!0;var r=n.pending;r===null?o.next=o:(o.next=r.next,r.next=o),n.pending=o}function Yh(n,o,r){if((r&4194048)!==0){var h=o.lanes;h&=n.pendingLanes,r|=h,o.lanes=r,Yl(n,r)}}var ja={readContext:Xt,use:Aa,useCallback:St,useContext:St,useEffect:St,useImperativeHandle:St,useLayoutEffect:St,useInsertionEffect:St,useMemo:St,useReducer:St,useRef:St,useState:St,useDebugValue:St,useDeferredValue:St,useTransition:St,useSyncExternalStore:St,useId:St,useHostTransitionStatus:St,useFormState:St,useActionState:St,useOptimistic:St,useMemoCache:St,useCacheRefresh:St},Jh={readContext:Xt,use:Aa,useCallback:function(n,o){return ln().memoizedState=[n,o===void 0?null:o],n},useContext:Xt,useEffect:_h,useImperativeHandle:function(n,o,r){r=r!=null?r.concat([n]):null,_a(4194308,4,Ph.bind(null,o,n),r)},useLayoutEffect:function(n,o){return _a(4194308,4,n,o)},useInsertionEffect:function(n,o){_a(4,2,n,o)},useMemo:function(n,o){var r=ln();o=o===void 0?null:o;var h=n();if(ds){ze(!0);try{n()}finally{ze(!1)}}return r.memoizedState=[h,o],h},useReducer:function(n,o,r){var h=ln();if(r!==void 0){var x=r(o);if(ds){ze(!0);try{r(o)}finally{ze(!1)}}}else x=o;return h.memoizedState=h.baseState=x,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:x},h.queue=n,n=n.dispatch=jx.bind(null,Xe,n),[h.memoizedState,n]},useRef:function(n){var o=ln();return n={current:n},o.memoizedState=n},useState:function(n){n=Lc(n);var o=n.queue,r=Fh.bind(null,Xe,o);return o.dispatch=r,[n.memoizedState,r]},useDebugValue:Dc,useDeferredValue:function(n,o){var r=ln();return Pc(r,n,o)},useTransition:function(){var n=Lc(!1);return n=Vh.bind(null,Xe,n.queue,!0,!1),ln().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,o,r){var h=Xe,x=ln();if(ot){if(r===void 0)throw Error(s(407));r=r()}else{if(r=o(),pt===null)throw Error(s(349));(nt&124)!==0||gh(h,o,r)}x.memoizedState=r;var b={value:r,getSnapshot:o};return x.queue=b,_h(yh.bind(null,h,b,n),[n]),h.flags|=2048,Js(9,Ia(),xh.bind(null,h,b,r,o),null),r},useId:function(){var n=ln(),o=pt.identifierPrefix;if(ot){var r=Zn,h=Wn;r=(h&~(1<<32-Ke(h)-1)).toString(32)+r,o=""+o+"R"+r,r=Ma++,0<r&&(o+="H"+r.toString(32)),o+=""}else r=Mx++,o=""+o+"r"+r.toString(32)+"";return n.memoizedState=o},useHostTransitionStatus:Hc,useFormState:Eh,useActionState:Eh,useOptimistic:function(n){var o=ln();o.memoizedState=o.baseState=n;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=r,o=Oc.bind(null,Xe,!0,r),r.dispatch=o,[n,o]},useMemoCache:Rc,useCacheRefresh:function(){return ln().memoizedState=Lx.bind(null,Xe)}},Qh={readContext:Xt,use:Aa,useCallback:Hh,useContext:Xt,useEffect:Lh,useImperativeHandle:Uh,useInsertionEffect:jh,useLayoutEffect:Dh,useMemo:Oh,useReducer:Ra,useRef:Ih,useState:function(){return Ra(ni)},useDebugValue:Dc,useDeferredValue:function(n,o){var r=It();return Gh(r,dt.memoizedState,n,o)},useTransition:function(){var n=Ra(ni)[0],o=It().memoizedState;return[typeof n=="boolean"?n:rl(n),o]},useSyncExternalStore:ph,useId:qh,useHostTransitionStatus:Hc,useFormState:Mh,useActionState:Mh,useOptimistic:function(n,o){var r=It();return Ch(r,dt,n,o)},useMemoCache:Rc,useCacheRefresh:zh},Dx={readContext:Xt,use:Aa,useCallback:Hh,useContext:Xt,useEffect:Lh,useImperativeHandle:Uh,useInsertionEffect:jh,useLayoutEffect:Dh,useMemo:Oh,useReducer:_c,useRef:Ih,useState:function(){return _c(ni)},useDebugValue:Dc,useDeferredValue:function(n,o){var r=It();return dt===null?Pc(r,n,o):Gh(r,dt.memoizedState,n,o)},useTransition:function(){var n=_c(ni)[0],o=It().memoizedState;return[typeof n=="boolean"?n:rl(n),o]},useSyncExternalStore:ph,useId:qh,useHostTransitionStatus:Hc,useFormState:Rh,useActionState:Rh,useOptimistic:function(n,o){var r=It();return dt!==null?Ch(r,dt,n,o):(r.baseState=n,[n,r.queue.dispatch])},useMemoCache:Rc,useCacheRefresh:zh},Qs=null,dl=0;function Da(n){var o=dl;return dl+=1,Qs===null&&(Qs=[]),ah(Qs,n,o)}function hl(n,o){o=o.props.ref,n.ref=o!==void 0?o:null}function Pa(n,o){throw o.$$typeof===v?Error(s(525)):(n=Object.prototype.toString.call(o),Error(s(31,n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n)))}function Xh(n){var o=n._init;return o(n._payload)}function Wh(n){function o(K,q){if(n){var ee=K.deletions;ee===null?(K.deletions=[q],K.flags|=16):ee.push(q)}}function r(K,q){if(!n)return null;for(;q!==null;)o(K,q),q=q.sibling;return null}function h(K){for(var q=new Map;K!==null;)K.key!==null?q.set(K.key,K):q.set(K.index,K),K=K.sibling;return q}function x(K,q){return K=Xn(K,q),K.index=0,K.sibling=null,K}function b(K,q,ee){return K.index=ee,n?(ee=K.alternate,ee!==null?(ee=ee.index,ee<q?(K.flags|=67108866,q):ee):(K.flags|=67108866,q)):(K.flags|=1048576,q)}function T(K){return n&&K.alternate===null&&(K.flags|=67108866),K}function w(K,q,ee,pe){return q===null||q.tag!==6?(q=lc(ee,K.mode,pe),q.return=K,q):(q=x(q,ee),q.return=K,q)}function U(K,q,ee,pe){var Ie=ee.type;return Ie===R?he(K,q,ee.props.children,pe,ee.key):q!==null&&(q.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===re&&Xh(Ie)===q.type)?(q=x(q,ee.props),hl(q,ee),q.return=K,q):(q=ya(ee.type,ee.key,ee.props,null,K.mode,pe),hl(q,ee),q.return=K,q)}function te(K,q,ee,pe){return q===null||q.tag!==4||q.stateNode.containerInfo!==ee.containerInfo||q.stateNode.implementation!==ee.implementation?(q=ac(ee,K.mode,pe),q.return=K,q):(q=x(q,ee.children||[]),q.return=K,q)}function he(K,q,ee,pe,Ie){return q===null||q.tag!==7?(q=is(ee,K.mode,pe,Ie),q.return=K,q):(q=x(q,ee),q.return=K,q)}function ge(K,q,ee){if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return q=lc(""+q,K.mode,ee),q.return=K,q;if(typeof q=="object"&&q!==null){switch(q.$$typeof){case C:return ee=ya(q.type,q.key,q.props,null,K.mode,ee),hl(ee,q),ee.return=K,ee;case N:return q=ac(q,K.mode,ee),q.return=K,q;case re:var pe=q._init;return q=pe(q._payload),ge(K,q,ee)}if(H(q)||me(q))return q=is(q,K.mode,ee,null),q.return=K,q;if(typeof q.then=="function")return ge(K,Da(q),ee);if(q.$$typeof===$)return ge(K,Ta(K,q),ee);Pa(K,q)}return null}function ie(K,q,ee,pe){var Ie=q!==null?q.key:null;if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return Ie!==null?null:w(K,q,""+ee,pe);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case C:return ee.key===Ie?U(K,q,ee,pe):null;case N:return ee.key===Ie?te(K,q,ee,pe):null;case re:return Ie=ee._init,ee=Ie(ee._payload),ie(K,q,ee,pe)}if(H(ee)||me(ee))return Ie!==null?null:he(K,q,ee,pe,null);if(typeof ee.then=="function")return ie(K,q,Da(ee),pe);if(ee.$$typeof===$)return ie(K,q,Ta(K,ee),pe);Pa(K,ee)}return null}function le(K,q,ee,pe,Ie){if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return K=K.get(ee)||null,w(q,K,""+pe,Ie);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case C:return K=K.get(pe.key===null?ee:pe.key)||null,U(q,K,pe,Ie);case N:return K=K.get(pe.key===null?ee:pe.key)||null,te(q,K,pe,Ie);case re:var We=pe._init;return pe=We(pe._payload),le(K,q,ee,pe,Ie)}if(H(pe)||me(pe))return K=K.get(ee)||null,he(q,K,pe,Ie,null);if(typeof pe.then=="function")return le(K,q,ee,Da(pe),Ie);if(pe.$$typeof===$)return le(K,q,ee,Ta(q,pe),Ie);Pa(q,pe)}return null}function Be(K,q,ee,pe){for(var Ie=null,We=null,je=q,Ve=q=0,Ht=null;je!==null&&Ve<ee.length;Ve++){je.index>Ve?(Ht=je,je=null):Ht=je.sibling;var st=ie(K,je,ee[Ve],pe);if(st===null){je===null&&(je=Ht);break}n&&je&&st.alternate===null&&o(K,je),q=b(st,q,Ve),We===null?Ie=st:We.sibling=st,We=st,je=Ht}if(Ve===ee.length)return r(K,je),ot&&os(K,Ve),Ie;if(je===null){for(;Ve<ee.length;Ve++)je=ge(K,ee[Ve],pe),je!==null&&(q=b(je,q,Ve),We===null?Ie=je:We.sibling=je,We=je);return ot&&os(K,Ve),Ie}for(je=h(je);Ve<ee.length;Ve++)Ht=le(je,K,Ve,ee[Ve],pe),Ht!==null&&(n&&Ht.alternate!==null&&je.delete(Ht.key===null?Ve:Ht.key),q=b(Ht,q,Ve),We===null?Ie=Ht:We.sibling=Ht,We=Ht);return n&&je.forEach(function(Hi){return o(K,Hi)}),ot&&os(K,Ve),Ie}function Ge(K,q,ee,pe){if(ee==null)throw Error(s(151));for(var Ie=null,We=null,je=q,Ve=q=0,Ht=null,st=ee.next();je!==null&&!st.done;Ve++,st=ee.next()){je.index>Ve?(Ht=je,je=null):Ht=je.sibling;var Hi=ie(K,je,st.value,pe);if(Hi===null){je===null&&(je=Ht);break}n&&je&&Hi.alternate===null&&o(K,je),q=b(Hi,q,Ve),We===null?Ie=Hi:We.sibling=Hi,We=Hi,je=Ht}if(st.done)return r(K,je),ot&&os(K,Ve),Ie;if(je===null){for(;!st.done;Ve++,st=ee.next())st=ge(K,st.value,pe),st!==null&&(q=b(st,q,Ve),We===null?Ie=st:We.sibling=st,We=st);return ot&&os(K,Ve),Ie}for(je=h(je);!st.done;Ve++,st=ee.next())st=le(je,K,Ve,st.value,pe),st!==null&&(n&&st.alternate!==null&&je.delete(st.key===null?Ve:st.key),q=b(st,q,Ve),We===null?Ie=st:We.sibling=st,We=st);return n&&je.forEach(function(Py){return o(K,Py)}),ot&&os(K,Ve),Ie}function ft(K,q,ee,pe){if(typeof ee=="object"&&ee!==null&&ee.type===R&&ee.key===null&&(ee=ee.props.children),typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case C:e:{for(var Ie=ee.key;q!==null;){if(q.key===Ie){if(Ie=ee.type,Ie===R){if(q.tag===7){r(K,q.sibling),pe=x(q,ee.props.children),pe.return=K,K=pe;break e}}else if(q.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===re&&Xh(Ie)===q.type){r(K,q.sibling),pe=x(q,ee.props),hl(pe,ee),pe.return=K,K=pe;break e}r(K,q);break}else o(K,q);q=q.sibling}ee.type===R?(pe=is(ee.props.children,K.mode,pe,ee.key),pe.return=K,K=pe):(pe=ya(ee.type,ee.key,ee.props,null,K.mode,pe),hl(pe,ee),pe.return=K,K=pe)}return T(K);case N:e:{for(Ie=ee.key;q!==null;){if(q.key===Ie)if(q.tag===4&&q.stateNode.containerInfo===ee.containerInfo&&q.stateNode.implementation===ee.implementation){r(K,q.sibling),pe=x(q,ee.children||[]),pe.return=K,K=pe;break e}else{r(K,q);break}else o(K,q);q=q.sibling}pe=ac(ee,K.mode,pe),pe.return=K,K=pe}return T(K);case re:return Ie=ee._init,ee=Ie(ee._payload),ft(K,q,ee,pe)}if(H(ee))return Be(K,q,ee,pe);if(me(ee)){if(Ie=me(ee),typeof Ie!="function")throw Error(s(150));return ee=Ie.call(ee),Ge(K,q,ee,pe)}if(typeof ee.then=="function")return ft(K,q,Da(ee),pe);if(ee.$$typeof===$)return ft(K,q,Ta(K,ee),pe);Pa(K,ee)}return typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint"?(ee=""+ee,q!==null&&q.tag===6?(r(K,q.sibling),pe=x(q,ee),pe.return=K,K=pe):(r(K,q),pe=lc(ee,K.mode,pe),pe.return=K,K=pe),T(K)):r(K,q)}return function(K,q,ee,pe){try{dl=0;var Ie=ft(K,q,ee,pe);return Qs=null,Ie}catch(je){if(je===nl||je===ka)throw je;var We=un(29,je,null,K.mode);return We.lanes=pe,We.return=K,We}finally{}}}var Xs=Wh(!0),Zh=Wh(!1),kn=j(null),Vn=null;function Ni(n){var o=n.alternate;Z(jt,jt.current&1),Z(kn,n),Vn===null&&(o===null||Fs.current!==null||o.memoizedState!==null)&&(Vn=n)}function ef(n){if(n.tag===22){if(Z(jt,jt.current),Z(kn,n),Vn===null){var o=n.alternate;o!==null&&o.memoizedState!==null&&(Vn=n)}}else ki()}function ki(){Z(jt,jt.current),Z(kn,kn.current)}function ii(n){F(kn),Vn===n&&(Vn=null),F(jt)}var jt=j(0);function Ua(n){for(var o=n;o!==null;){if(o.tag===13){var r=o.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||Au(r)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function Gc(n,o,r,h){o=n.memoizedState,r=r(h,o),r=r==null?o:y({},o,r),n.memoizedState=r,n.lanes===0&&(n.updateQueue.baseState=r)}var Vc={enqueueSetState:function(n,o,r){n=n._reactInternals;var h=mn(),x=bi(h);x.payload=o,r!=null&&(x.callback=r),o=Ci(n,x,h),o!==null&&(pn(o,n,h),sl(o,n,h))},enqueueReplaceState:function(n,o,r){n=n._reactInternals;var h=mn(),x=bi(h);x.tag=1,x.payload=o,r!=null&&(x.callback=r),o=Ci(n,x,h),o!==null&&(pn(o,n,h),sl(o,n,h))},enqueueForceUpdate:function(n,o){n=n._reactInternals;var r=mn(),h=bi(r);h.tag=2,o!=null&&(h.callback=o),o=Ci(n,h,r),o!==null&&(pn(o,n,r),sl(o,n,r))}};function tf(n,o,r,h,x,b,T){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(h,b,T):o.prototype&&o.prototype.isPureReactComponent?!Yo(r,h)||!Yo(x,b):!0}function nf(n,o,r,h){n=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(r,h),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(r,h),o.state!==n&&Vc.enqueueReplaceState(o,o.state,null)}function hs(n,o){var r=o;if("ref"in o){r={};for(var h in o)h!=="ref"&&(r[h]=o[h])}if(n=n.defaultProps){r===o&&(r=y({},r));for(var x in n)r[x]===void 0&&(r[x]=n[x])}return r}var Ha=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)};function sf(n){Ha(n)}function of(n){console.error(n)}function lf(n){Ha(n)}function Oa(n,o){try{var r=n.onUncaughtError;r(o.value,{componentStack:o.stack})}catch(h){setTimeout(function(){throw h})}}function af(n,o,r){try{var h=n.onCaughtError;h(r.value,{componentStack:r.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function $c(n,o,r){return r=bi(r),r.tag=3,r.payload={element:null},r.callback=function(){Oa(n,o)},r}function rf(n){return n=bi(n),n.tag=3,n}function cf(n,o,r,h){var x=r.type.getDerivedStateFromError;if(typeof x=="function"){var b=h.value;n.payload=function(){return x(b)},n.callback=function(){af(o,r,h)}}var T=r.stateNode;T!==null&&typeof T.componentDidCatch=="function"&&(n.callback=function(){af(o,r,h),typeof x!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var w=h.stack;this.componentDidCatch(h.value,{componentStack:w!==null?w:""})})}function Px(n,o,r,h,x){if(r.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(o=r.alternate,o!==null&&Zo(o,r,x,!0),r=kn.current,r!==null){switch(r.tag){case 13:return Vn===null?hu():r.alternate===null&&Tt===0&&(Tt=3),r.flags&=-257,r.flags|=65536,r.lanes=x,h===xc?r.flags|=16384:(o=r.updateQueue,o===null?r.updateQueue=new Set([h]):o.add(h),mu(n,h,x)),!1;case 22:return r.flags|=65536,h===xc?r.flags|=16384:(o=r.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([h])},r.updateQueue=o):(r=o.retryQueue,r===null?o.retryQueue=new Set([h]):r.add(h)),mu(n,h,x)),!1}throw Error(s(435,r.tag))}return mu(n,h,x),hu(),!1}if(ot)return o=kn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=x,h!==uc&&(n=Error(s(422),{cause:h}),Wo(bn(n,r)))):(h!==uc&&(o=Error(s(423),{cause:h}),Wo(bn(o,r))),n=n.current.alternate,n.flags|=65536,x&=-x,n.lanes|=x,h=bn(h,r),x=$c(n.stateNode,h,x),bc(n,x),Tt!==4&&(Tt=2)),!1;var b=Error(s(520),{cause:h});if(b=bn(b,r),vl===null?vl=[b]:vl.push(b),Tt!==4&&(Tt=2),o===null)return!0;h=bn(h,r),r=o;do{switch(r.tag){case 3:return r.flags|=65536,n=x&-x,r.lanes|=n,n=$c(r.stateNode,h,n),bc(r,n),!1;case 1:if(o=r.type,b=r.stateNode,(r.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ri===null||!Ri.has(b))))return r.flags|=65536,x&=-x,r.lanes|=x,x=rf(x),cf(x,n,r,h),bc(r,x),!1}r=r.return}while(r!==null);return!1}var uf=Error(s(461)),Pt=!1;function Bt(n,o,r,h){o.child=n===null?Zh(o,null,r,h):Xs(o,n.child,r,h)}function df(n,o,r,h,x){r=r.render;var b=o.ref;if("ref"in h){var T={};for(var w in h)w!=="ref"&&(T[w]=h[w])}else T=h;return cs(o),h=Sc(n,o,r,T,b,x),w=wc(),n!==null&&!Pt?(Ec(n,o,x),si(n,o,x)):(ot&&w&&rc(o),o.flags|=1,Bt(n,o,h,x),o.child)}function hf(n,o,r,h,x){if(n===null){var b=r.type;return typeof b=="function"&&!oc(b)&&b.defaultProps===void 0&&r.compare===null?(o.tag=15,o.type=b,ff(n,o,b,h,x)):(n=ya(r.type,null,h,o,o.mode,x),n.ref=o.ref,n.return=o,o.child=n)}if(b=n.child,!Qc(n,x)){var T=b.memoizedProps;if(r=r.compare,r=r!==null?r:Yo,r(T,h)&&n.ref===o.ref)return si(n,o,x)}return o.flags|=1,n=Xn(b,h),n.ref=o.ref,n.return=o,o.child=n}function ff(n,o,r,h,x){if(n!==null){var b=n.memoizedProps;if(Yo(b,h)&&n.ref===o.ref)if(Pt=!1,o.pendingProps=h=b,Qc(n,x))(n.flags&131072)!==0&&(Pt=!0);else return o.lanes=n.lanes,si(n,o,x)}return Bc(n,o,r,h,x)}function mf(n,o,r){var h=o.pendingProps,x=h.children,b=n!==null?n.memoizedState:null;if(h.mode==="hidden"){if((o.flags&128)!==0){if(h=b!==null?b.baseLanes|r:r,n!==null){for(x=o.child=n.child,b=0;x!==null;)b=b|x.lanes|x.childLanes,x=x.sibling;o.childLanes=b&~h}else o.childLanes=0,o.child=null;return pf(n,o,h,r)}if((r&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},n!==null&&Na(o,b!==null?b.cachePool:null),b!==null?hh(o,b):Tc(),ef(o);else return o.lanes=o.childLanes=536870912,pf(n,o,b!==null?b.baseLanes|r:r,r)}else b!==null?(Na(o,b.cachePool),hh(o,b),ki(),o.memoizedState=null):(n!==null&&Na(o,null),Tc(),ki());return Bt(n,o,x,r),o.child}function pf(n,o,r,h){var x=gc();return x=x===null?null:{parent:Lt._currentValue,pool:x},o.memoizedState={baseLanes:r,cachePool:x},n!==null&&Na(o,null),Tc(),ef(o),n!==null&&Zo(n,o,h,!0),null}function Ga(n,o){var r=o.ref;if(r===null)n!==null&&n.ref!==null&&(o.flags|=4194816);else{if(typeof r!="function"&&typeof r!="object")throw Error(s(284));(n===null||n.ref!==r)&&(o.flags|=4194816)}}function Bc(n,o,r,h,x){return cs(o),r=Sc(n,o,r,h,void 0,x),h=wc(),n!==null&&!Pt?(Ec(n,o,x),si(n,o,x)):(ot&&h&&rc(o),o.flags|=1,Bt(n,o,r,x),o.child)}function gf(n,o,r,h,x,b){return cs(o),o.updateQueue=null,r=mh(o,h,r,x),fh(n),h=wc(),n!==null&&!Pt?(Ec(n,o,b),si(n,o,b)):(ot&&h&&rc(o),o.flags|=1,Bt(n,o,r,b),o.child)}function xf(n,o,r,h,x){if(cs(o),o.stateNode===null){var b=Vs,T=r.contextType;typeof T=="object"&&T!==null&&(b=Xt(T)),b=new r(h,b),o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Vc,o.stateNode=b,b._reactInternals=o,b=o.stateNode,b.props=h,b.state=o.memoizedState,b.refs={},yc(o),T=r.contextType,b.context=typeof T=="object"&&T!==null?Xt(T):Vs,b.state=o.memoizedState,T=r.getDerivedStateFromProps,typeof T=="function"&&(Gc(o,r,T,h),b.state=o.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(T=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),T!==b.state&&Vc.enqueueReplaceState(b,b.state,null),ll(o,h,b,x),ol(),b.state=o.memoizedState),typeof b.componentDidMount=="function"&&(o.flags|=4194308),h=!0}else if(n===null){b=o.stateNode;var w=o.memoizedProps,U=hs(r,w);b.props=U;var te=b.context,he=r.contextType;T=Vs,typeof he=="object"&&he!==null&&(T=Xt(he));var ge=r.getDerivedStateFromProps;he=typeof ge=="function"||typeof b.getSnapshotBeforeUpdate=="function",w=o.pendingProps!==w,he||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(w||te!==T)&&nf(o,b,h,T),vi=!1;var ie=o.memoizedState;b.state=ie,ll(o,h,b,x),ol(),te=o.memoizedState,w||ie!==te||vi?(typeof ge=="function"&&(Gc(o,r,ge,h),te=o.memoizedState),(U=vi||tf(o,r,U,h,ie,te,T))?(he||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(o.flags|=4194308)):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=h,o.memoizedState=te),b.props=h,b.state=te,b.context=T,h=U):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),h=!1)}else{b=o.stateNode,vc(n,o),T=o.memoizedProps,he=hs(r,T),b.props=he,ge=o.pendingProps,ie=b.context,te=r.contextType,U=Vs,typeof te=="object"&&te!==null&&(U=Xt(te)),w=r.getDerivedStateFromProps,(te=typeof w=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(T!==ge||ie!==U)&&nf(o,b,h,U),vi=!1,ie=o.memoizedState,b.state=ie,ll(o,h,b,x),ol();var le=o.memoizedState;T!==ge||ie!==le||vi||n!==null&&n.dependencies!==null&&Ca(n.dependencies)?(typeof w=="function"&&(Gc(o,r,w,h),le=o.memoizedState),(he=vi||tf(o,r,he,h,ie,le,U)||n!==null&&n.dependencies!==null&&Ca(n.dependencies))?(te||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(h,le,U),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(h,le,U)),typeof b.componentDidUpdate=="function"&&(o.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof b.componentDidUpdate!="function"||T===n.memoizedProps&&ie===n.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||T===n.memoizedProps&&ie===n.memoizedState||(o.flags|=1024),o.memoizedProps=h,o.memoizedState=le),b.props=h,b.state=le,b.context=U,h=he):(typeof b.componentDidUpdate!="function"||T===n.memoizedProps&&ie===n.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||T===n.memoizedProps&&ie===n.memoizedState||(o.flags|=1024),h=!1)}return b=h,Ga(n,o),h=(o.flags&128)!==0,b||h?(b=o.stateNode,r=h&&typeof r.getDerivedStateFromError!="function"?null:b.render(),o.flags|=1,n!==null&&h?(o.child=Xs(o,n.child,null,x),o.child=Xs(o,null,r,x)):Bt(n,o,r,x),o.memoizedState=b.state,n=o.child):n=si(n,o,x),n}function yf(n,o,r,h){return Xo(),o.flags|=256,Bt(n,o,r,h),o.child}var qc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function zc(n){return{baseLanes:n,cachePool:sh()}}function Fc(n,o,r){return n=n!==null?n.childLanes&~r:0,o&&(n|=Sn),n}function vf(n,o,r){var h=o.pendingProps,x=!1,b=(o.flags&128)!==0,T;if((T=b)||(T=n!==null&&n.memoizedState===null?!1:(jt.current&2)!==0),T&&(x=!0,o.flags&=-129),T=(o.flags&32)!==0,o.flags&=-33,n===null){if(ot){if(x?Ni(o):ki(),ot){var w=Ct,U;if(U=w){e:{for(U=w,w=Gn;U.nodeType!==8;){if(!w){w=null;break e}if(U=Pn(U.nextSibling),U===null){w=null;break e}}w=U}w!==null?(o.memoizedState={dehydrated:w,treeContext:ss!==null?{id:Wn,overflow:Zn}:null,retryLane:536870912,hydrationErrors:null},U=un(18,null,null,0),U.stateNode=w,U.return=o,o.child=U,nn=o,Ct=null,U=!0):U=!1}U||as(o)}if(w=o.memoizedState,w!==null&&(w=w.dehydrated,w!==null))return Au(w)?o.lanes=32:o.lanes=536870912,null;ii(o)}return w=h.children,h=h.fallback,x?(ki(),x=o.mode,w=Va({mode:"hidden",children:w},x),h=is(h,x,r,null),w.return=o,h.return=o,w.sibling=h,o.child=w,x=o.child,x.memoizedState=zc(r),x.childLanes=Fc(n,T,r),o.memoizedState=qc,h):(Ni(o),Kc(o,w))}if(U=n.memoizedState,U!==null&&(w=U.dehydrated,w!==null)){if(b)o.flags&256?(Ni(o),o.flags&=-257,o=Yc(n,o,r)):o.memoizedState!==null?(ki(),o.child=n.child,o.flags|=128,o=null):(ki(),x=h.fallback,w=o.mode,h=Va({mode:"visible",children:h.children},w),x=is(x,w,r,null),x.flags|=2,h.return=o,x.return=o,h.sibling=x,o.child=h,Xs(o,n.child,null,r),h=o.child,h.memoizedState=zc(r),h.childLanes=Fc(n,T,r),o.memoizedState=qc,o=x);else if(Ni(o),Au(w)){if(T=w.nextSibling&&w.nextSibling.dataset,T)var te=T.dgst;T=te,h=Error(s(419)),h.stack="",h.digest=T,Wo({value:h,source:null,stack:null}),o=Yc(n,o,r)}else if(Pt||Zo(n,o,r,!1),T=(r&n.childLanes)!==0,Pt||T){if(T=pt,T!==null&&(h=r&-r,h=(h&42)!==0?1:Mo(h),h=(h&(T.suspendedLanes|r))!==0?0:h,h!==0&&h!==U.retryLane))throw U.retryLane=h,Gs(n,h),pn(T,n,h),uf;w.data==="$?"||hu(),o=Yc(n,o,r)}else w.data==="$?"?(o.flags|=192,o.child=n.child,o=null):(n=U.treeContext,Ct=Pn(w.nextSibling),nn=o,ot=!0,ls=null,Gn=!1,n!==null&&(Tn[Nn++]=Wn,Tn[Nn++]=Zn,Tn[Nn++]=ss,Wn=n.id,Zn=n.overflow,ss=o),o=Kc(o,h.children),o.flags|=4096);return o}return x?(ki(),x=h.fallback,w=o.mode,U=n.child,te=U.sibling,h=Xn(U,{mode:"hidden",children:h.children}),h.subtreeFlags=U.subtreeFlags&65011712,te!==null?x=Xn(te,x):(x=is(x,w,r,null),x.flags|=2),x.return=o,h.return=o,h.sibling=x,o.child=h,h=x,x=o.child,w=n.child.memoizedState,w===null?w=zc(r):(U=w.cachePool,U!==null?(te=Lt._currentValue,U=U.parent!==te?{parent:te,pool:te}:U):U=sh(),w={baseLanes:w.baseLanes|r,cachePool:U}),x.memoizedState=w,x.childLanes=Fc(n,T,r),o.memoizedState=qc,h):(Ni(o),r=n.child,n=r.sibling,r=Xn(r,{mode:"visible",children:h.children}),r.return=o,r.sibling=null,n!==null&&(T=o.deletions,T===null?(o.deletions=[n],o.flags|=16):T.push(n)),o.child=r,o.memoizedState=null,r)}function Kc(n,o){return o=Va({mode:"visible",children:o},n.mode),o.return=n,n.child=o}function Va(n,o){return n=un(22,n,null,o),n.lanes=0,n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},n}function Yc(n,o,r){return Xs(o,n.child,null,r),n=Kc(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function bf(n,o,r){n.lanes|=o;var h=n.alternate;h!==null&&(h.lanes|=o),hc(n.return,o,r)}function Jc(n,o,r,h,x){var b=n.memoizedState;b===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:h,tail:r,tailMode:x}:(b.isBackwards=o,b.rendering=null,b.renderingStartTime=0,b.last=h,b.tail=r,b.tailMode=x)}function Cf(n,o,r){var h=o.pendingProps,x=h.revealOrder,b=h.tail;if(Bt(n,o,h.children,r),h=jt.current,(h&2)!==0)h=h&1|2,o.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&bf(n,r,o);else if(n.tag===19)bf(n,r,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}h&=1}switch(Z(jt,h),x){case"forwards":for(r=o.child,x=null;r!==null;)n=r.alternate,n!==null&&Ua(n)===null&&(x=r),r=r.sibling;r=x,r===null?(x=o.child,o.child=null):(x=r.sibling,r.sibling=null),Jc(o,!1,x,r,b);break;case"backwards":for(r=null,x=o.child,o.child=null;x!==null;){if(n=x.alternate,n!==null&&Ua(n)===null){o.child=x;break}n=x.sibling,x.sibling=r,r=x,x=n}Jc(o,!0,r,null,b);break;case"together":Jc(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function si(n,o,r){if(n!==null&&(o.dependencies=n.dependencies),Ai|=o.lanes,(r&o.childLanes)===0)if(n!==null){if(Zo(n,o,r,!1),(r&o.childLanes)===0)return null}else return null;if(n!==null&&o.child!==n.child)throw Error(s(153));if(o.child!==null){for(n=o.child,r=Xn(n,n.pendingProps),o.child=r,r.return=o;n.sibling!==null;)n=n.sibling,r=r.sibling=Xn(n,n.pendingProps),r.return=o;r.sibling=null}return o.child}function Qc(n,o){return(n.lanes&o)!==0?!0:(n=n.dependencies,!!(n!==null&&Ca(n)))}function Ux(n,o,r){switch(o.tag){case 3:B(o,o.stateNode.containerInfo),yi(o,Lt,n.memoizedState.cache),Xo();break;case 27:case 5:xe(o);break;case 4:B(o,o.stateNode.containerInfo);break;case 10:yi(o,o.type,o.memoizedProps.value);break;case 13:var h=o.memoizedState;if(h!==null)return h.dehydrated!==null?(Ni(o),o.flags|=128,null):(r&o.child.childLanes)!==0?vf(n,o,r):(Ni(o),n=si(n,o,r),n!==null?n.sibling:null);Ni(o);break;case 19:var x=(n.flags&128)!==0;if(h=(r&o.childLanes)!==0,h||(Zo(n,o,r,!1),h=(r&o.childLanes)!==0),x){if(h)return Cf(n,o,r);o.flags|=128}if(x=o.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),Z(jt,jt.current),h)break;return null;case 22:case 23:return o.lanes=0,mf(n,o,r);case 24:yi(o,Lt,n.memoizedState.cache)}return si(n,o,r)}function Tf(n,o,r){if(n!==null)if(n.memoizedProps!==o.pendingProps)Pt=!0;else{if(!Qc(n,r)&&(o.flags&128)===0)return Pt=!1,Ux(n,o,r);Pt=(n.flags&131072)!==0}else Pt=!1,ot&&(o.flags&1048576)!==0&&Xd(o,ba,o.index);switch(o.lanes=0,o.tag){case 16:e:{n=o.pendingProps;var h=o.elementType,x=h._init;if(h=x(h._payload),o.type=h,typeof h=="function")oc(h)?(n=hs(h,n),o.tag=1,o=xf(null,o,h,n,r)):(o.tag=0,o=Bc(null,o,h,n,r));else{if(h!=null){if(x=h.$$typeof,x===ne){o.tag=11,o=df(null,o,h,n,r);break e}else if(x===de){o.tag=14,o=hf(null,o,h,n,r);break e}}throw o=ue(h)||h,Error(s(306,o,""))}}return o;case 0:return Bc(n,o,o.type,o.pendingProps,r);case 1:return h=o.type,x=hs(h,o.pendingProps),xf(n,o,h,x,r);case 3:e:{if(B(o,o.stateNode.containerInfo),n===null)throw Error(s(387));h=o.pendingProps;var b=o.memoizedState;x=b.element,vc(n,o),ll(o,h,null,r);var T=o.memoizedState;if(h=T.cache,yi(o,Lt,h),h!==b.cache&&fc(o,[Lt],r,!0),ol(),h=T.element,b.isDehydrated)if(b={element:h,isDehydrated:!1,cache:T.cache},o.updateQueue.baseState=b,o.memoizedState=b,o.flags&256){o=yf(n,o,h,r);break e}else if(h!==x){x=bn(Error(s(424)),o),Wo(x),o=yf(n,o,h,r);break e}else{switch(n=o.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(Ct=Pn(n.firstChild),nn=o,ot=!0,ls=null,Gn=!0,r=Zh(o,null,h,r),o.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling}else{if(Xo(),h===x){o=si(n,o,r);break e}Bt(n,o,h,r)}o=o.child}return o;case 26:return Ga(n,o),n===null?(r=wm(o.type,null,o.pendingProps,null))?o.memoizedState=r:ot||(r=o.type,n=o.pendingProps,h=tr(M.current).createElement(r),h[Dt]=o,h[Yt]=n,zt(h,r,n),Mt(h),o.stateNode=h):o.memoizedState=wm(o.type,n.memoizedProps,o.pendingProps,n.memoizedState),null;case 27:return xe(o),n===null&&ot&&(h=o.stateNode=Nm(o.type,o.pendingProps,M.current),nn=o,Gn=!0,x=Ct,Li(o.type)?(Ru=x,Ct=Pn(h.firstChild)):Ct=x),Bt(n,o,o.pendingProps.children,r),Ga(n,o),n===null&&(o.flags|=4194304),o.child;case 5:return n===null&&ot&&((x=h=Ct)&&(h=dy(h,o.type,o.pendingProps,Gn),h!==null?(o.stateNode=h,nn=o,Ct=Pn(h.firstChild),Gn=!1,x=!0):x=!1),x||as(o)),xe(o),x=o.type,b=o.pendingProps,T=n!==null?n.memoizedProps:null,h=b.children,wu(x,b)?h=null:T!==null&&wu(x,T)&&(o.flags|=32),o.memoizedState!==null&&(x=Sc(n,o,Ax,null,null,r),Ml._currentValue=x),Ga(n,o),Bt(n,o,h,r),o.child;case 6:return n===null&&ot&&((n=r=Ct)&&(r=hy(r,o.pendingProps,Gn),r!==null?(o.stateNode=r,nn=o,Ct=null,n=!0):n=!1),n||as(o)),null;case 13:return vf(n,o,r);case 4:return B(o,o.stateNode.containerInfo),h=o.pendingProps,n===null?o.child=Xs(o,null,h,r):Bt(n,o,h,r),o.child;case 11:return df(n,o,o.type,o.pendingProps,r);case 7:return Bt(n,o,o.pendingProps,r),o.child;case 8:return Bt(n,o,o.pendingProps.children,r),o.child;case 12:return Bt(n,o,o.pendingProps.children,r),o.child;case 10:return h=o.pendingProps,yi(o,o.type,h.value),Bt(n,o,h.children,r),o.child;case 9:return x=o.type._context,h=o.pendingProps.children,cs(o),x=Xt(x),h=h(x),o.flags|=1,Bt(n,o,h,r),o.child;case 14:return hf(n,o,o.type,o.pendingProps,r);case 15:return ff(n,o,o.type,o.pendingProps,r);case 19:return Cf(n,o,r);case 31:return h=o.pendingProps,r=o.mode,h={mode:h.mode,children:h.children},n===null?(r=Va(h,r),r.ref=o.ref,o.child=r,r.return=o,o=r):(r=Xn(n.child,h),r.ref=o.ref,o.child=r,r.return=o,o=r),o;case 22:return mf(n,o,r);case 24:return cs(o),h=Xt(Lt),n===null?(x=gc(),x===null&&(x=pt,b=mc(),x.pooledCache=b,b.refCount++,b!==null&&(x.pooledCacheLanes|=r),x=b),o.memoizedState={parent:h,cache:x},yc(o),yi(o,Lt,x)):((n.lanes&r)!==0&&(vc(n,o),ll(o,null,null,r),ol()),x=n.memoizedState,b=o.memoizedState,x.parent!==h?(x={parent:h,cache:h},o.memoizedState=x,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=x),yi(o,Lt,h)):(h=b.cache,yi(o,Lt,h),h!==x.cache&&fc(o,[Lt],r,!0))),Bt(n,o,o.pendingProps.children,r),o.child;case 29:throw o.pendingProps}throw Error(s(156,o.tag))}function oi(n){n.flags|=4}function Nf(n,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Im(o)){if(o=kn.current,o!==null&&((nt&4194048)===nt?Vn!==null:(nt&62914560)!==nt&&(nt&536870912)===0||o!==Vn))throw il=xc,oh;n.flags|=8192}}function $a(n,o){o!==null&&(n.flags|=4),n.flags&16384&&(o=n.tag!==22?Fl():536870912,n.lanes|=o,to|=o)}function fl(n,o){if(!ot)switch(n.tailMode){case"hidden":o=n.tail;for(var r=null;o!==null;)o.alternate!==null&&(r=o),o=o.sibling;r===null?n.tail=null:r.sibling=null;break;case"collapsed":r=n.tail;for(var h=null;r!==null;)r.alternate!==null&&(h=r),r=r.sibling;h===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:h.sibling=null}}function bt(n){var o=n.alternate!==null&&n.alternate.child===n.child,r=0,h=0;if(o)for(var x=n.child;x!==null;)r|=x.lanes|x.childLanes,h|=x.subtreeFlags&65011712,h|=x.flags&65011712,x.return=n,x=x.sibling;else for(x=n.child;x!==null;)r|=x.lanes|x.childLanes,h|=x.subtreeFlags,h|=x.flags,x.return=n,x=x.sibling;return n.subtreeFlags|=h,n.childLanes=r,o}function Hx(n,o,r){var h=o.pendingProps;switch(cc(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bt(o),null;case 1:return bt(o),null;case 3:return r=o.stateNode,h=null,n!==null&&(h=n.memoizedState.cache),o.memoizedState.cache!==h&&(o.flags|=2048),ti(Lt),X(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Qo(o)?oi(o):n===null||n.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,eh())),bt(o),null;case 26:return r=o.memoizedState,n===null?(oi(o),r!==null?(bt(o),Nf(o,r)):(bt(o),o.flags&=-16777217)):r?r!==n.memoizedState?(oi(o),bt(o),Nf(o,r)):(bt(o),o.flags&=-16777217):(n.memoizedProps!==h&&oi(o),bt(o),o.flags&=-16777217),null;case 27:Ne(o),r=M.current;var x=o.type;if(n!==null&&o.stateNode!=null)n.memoizedProps!==h&&oi(o);else{if(!h){if(o.stateNode===null)throw Error(s(166));return bt(o),null}n=A.current,Qo(o)?Wd(o):(n=Nm(x,h,r),o.stateNode=n,oi(o))}return bt(o),null;case 5:if(Ne(o),r=o.type,n!==null&&o.stateNode!=null)n.memoizedProps!==h&&oi(o);else{if(!h){if(o.stateNode===null)throw Error(s(166));return bt(o),null}if(n=A.current,Qo(o))Wd(o);else{switch(x=tr(M.current),n){case 1:n=x.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:n=x.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":n=x.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":n=x.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":n=x.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild);break;case"select":n=typeof h.is=="string"?x.createElement("select",{is:h.is}):x.createElement("select"),h.multiple?n.multiple=!0:h.size&&(n.size=h.size);break;default:n=typeof h.is=="string"?x.createElement(r,{is:h.is}):x.createElement(r)}}n[Dt]=o,n[Yt]=h;e:for(x=o.child;x!==null;){if(x.tag===5||x.tag===6)n.appendChild(x.stateNode);else if(x.tag!==4&&x.tag!==27&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===o)break e;for(;x.sibling===null;){if(x.return===null||x.return===o)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}o.stateNode=n;e:switch(zt(n,r,h),r){case"button":case"input":case"select":case"textarea":n=!!h.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&oi(o)}}return bt(o),o.flags&=-16777217,null;case 6:if(n&&o.stateNode!=null)n.memoizedProps!==h&&oi(o);else{if(typeof h!="string"&&o.stateNode===null)throw Error(s(166));if(n=M.current,Qo(o)){if(n=o.stateNode,r=o.memoizedProps,h=null,x=nn,x!==null)switch(x.tag){case 27:case 5:h=x.memoizedProps}n[Dt]=o,n=!!(n.nodeValue===r||h!==null&&h.suppressHydrationWarning===!0||gm(n.nodeValue,r)),n||as(o)}else n=tr(n).createTextNode(h),n[Dt]=o,o.stateNode=n}return bt(o),null;case 13:if(h=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(x=Qo(o),h!==null&&h.dehydrated!==null){if(n===null){if(!x)throw Error(s(318));if(x=o.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(s(317));x[Dt]=o}else Xo(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;bt(o),x=!1}else x=eh(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=x),x=!0;if(!x)return o.flags&256?(ii(o),o):(ii(o),null)}if(ii(o),(o.flags&128)!==0)return o.lanes=r,o;if(r=h!==null,n=n!==null&&n.memoizedState!==null,r){h=o.child,x=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(x=h.alternate.memoizedState.cachePool.pool);var b=null;h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(b=h.memoizedState.cachePool.pool),b!==x&&(h.flags|=2048)}return r!==n&&r&&(o.child.flags|=8192),$a(o,o.updateQueue),bt(o),null;case 4:return X(),n===null&&Cu(o.stateNode.containerInfo),bt(o),null;case 10:return ti(o.type),bt(o),null;case 19:if(F(jt),x=o.memoizedState,x===null)return bt(o),null;if(h=(o.flags&128)!==0,b=x.rendering,b===null)if(h)fl(x,!1);else{if(Tt!==0||n!==null&&(n.flags&128)!==0)for(n=o.child;n!==null;){if(b=Ua(n),b!==null){for(o.flags|=128,fl(x,!1),n=b.updateQueue,o.updateQueue=n,$a(o,n),o.subtreeFlags=0,n=r,r=o.child;r!==null;)Qd(r,n),r=r.sibling;return Z(jt,jt.current&1|2),o.child}n=n.sibling}x.tail!==null&&Se()>za&&(o.flags|=128,h=!0,fl(x,!1),o.lanes=4194304)}else{if(!h)if(n=Ua(b),n!==null){if(o.flags|=128,h=!0,n=n.updateQueue,o.updateQueue=n,$a(o,n),fl(x,!0),x.tail===null&&x.tailMode==="hidden"&&!b.alternate&&!ot)return bt(o),null}else 2*Se()-x.renderingStartTime>za&&r!==536870912&&(o.flags|=128,h=!0,fl(x,!1),o.lanes=4194304);x.isBackwards?(b.sibling=o.child,o.child=b):(n=x.last,n!==null?n.sibling=b:o.child=b,x.last=b)}return x.tail!==null?(o=x.tail,x.rendering=o,x.tail=o.sibling,x.renderingStartTime=Se(),o.sibling=null,n=jt.current,Z(jt,h?n&1|2:n&1),o):(bt(o),null);case 22:case 23:return ii(o),Nc(),h=o.memoizedState!==null,n!==null?n.memoizedState!==null!==h&&(o.flags|=8192):h&&(o.flags|=8192),h?(r&536870912)!==0&&(o.flags&128)===0&&(bt(o),o.subtreeFlags&6&&(o.flags|=8192)):bt(o),r=o.updateQueue,r!==null&&$a(o,r.retryQueue),r=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(r=n.memoizedState.cachePool.pool),h=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),h!==r&&(o.flags|=2048),n!==null&&F(us),null;case 24:return r=null,n!==null&&(r=n.memoizedState.cache),o.memoizedState.cache!==r&&(o.flags|=2048),ti(Lt),bt(o),null;case 25:return null;case 30:return null}throw Error(s(156,o.tag))}function Ox(n,o){switch(cc(o),o.tag){case 1:return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 3:return ti(Lt),X(),n=o.flags,(n&65536)!==0&&(n&128)===0?(o.flags=n&-65537|128,o):null;case 26:case 27:case 5:return Ne(o),null;case 13:if(ii(o),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error(s(340));Xo()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 19:return F(jt),null;case 4:return X(),null;case 10:return ti(o.type),null;case 22:case 23:return ii(o),Nc(),n!==null&&F(us),n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 24:return ti(Lt),null;case 25:return null;default:return null}}function kf(n,o){switch(cc(o),o.tag){case 3:ti(Lt),X();break;case 26:case 27:case 5:Ne(o);break;case 4:X();break;case 13:ii(o);break;case 19:F(jt);break;case 10:ti(o.type);break;case 22:case 23:ii(o),Nc(),n!==null&&F(us);break;case 24:ti(Lt)}}function ml(n,o){try{var r=o.updateQueue,h=r!==null?r.lastEffect:null;if(h!==null){var x=h.next;r=x;do{if((r.tag&n)===n){h=void 0;var b=r.create,T=r.inst;h=b(),T.destroy=h}r=r.next}while(r!==x)}}catch(w){mt(o,o.return,w)}}function Si(n,o,r){try{var h=o.updateQueue,x=h!==null?h.lastEffect:null;if(x!==null){var b=x.next;h=b;do{if((h.tag&n)===n){var T=h.inst,w=T.destroy;if(w!==void 0){T.destroy=void 0,x=o;var U=r,te=w;try{te()}catch(he){mt(x,U,he)}}}h=h.next}while(h!==b)}}catch(he){mt(o,o.return,he)}}function Sf(n){var o=n.updateQueue;if(o!==null){var r=n.stateNode;try{dh(o,r)}catch(h){mt(n,n.return,h)}}}function wf(n,o,r){r.props=hs(n.type,n.memoizedProps),r.state=n.memoizedState;try{r.componentWillUnmount()}catch(h){mt(n,o,h)}}function pl(n,o){try{var r=n.ref;if(r!==null){switch(n.tag){case 26:case 27:case 5:var h=n.stateNode;break;case 30:h=n.stateNode;break;default:h=n.stateNode}typeof r=="function"?n.refCleanup=r(h):r.current=h}}catch(x){mt(n,o,x)}}function $n(n,o){var r=n.ref,h=n.refCleanup;if(r!==null)if(typeof h=="function")try{h()}catch(x){mt(n,o,x)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof r=="function")try{r(null)}catch(x){mt(n,o,x)}else r.current=null}function Ef(n){var o=n.type,r=n.memoizedProps,h=n.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":r.autoFocus&&h.focus();break e;case"img":r.src?h.src=r.src:r.srcSet&&(h.srcset=r.srcSet)}}catch(x){mt(n,n.return,x)}}function Xc(n,o,r){try{var h=n.stateNode;ly(h,n.type,r,o),h[Yt]=o}catch(x){mt(n,n.return,x)}}function Mf(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&Li(n.type)||n.tag===4}function Wc(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Mf(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&Li(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Zc(n,o,r){var h=n.tag;if(h===5||h===6)n=n.stateNode,o?(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r).insertBefore(n,o):(o=r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,o.appendChild(n),r=r._reactRootContainer,r!=null||o.onclick!==null||(o.onclick=er));else if(h!==4&&(h===27&&Li(n.type)&&(r=n.stateNode,o=null),n=n.child,n!==null))for(Zc(n,o,r),n=n.sibling;n!==null;)Zc(n,o,r),n=n.sibling}function Ba(n,o,r){var h=n.tag;if(h===5||h===6)n=n.stateNode,o?r.insertBefore(n,o):r.appendChild(n);else if(h!==4&&(h===27&&Li(n.type)&&(r=n.stateNode),n=n.child,n!==null))for(Ba(n,o,r),n=n.sibling;n!==null;)Ba(n,o,r),n=n.sibling}function Af(n){var o=n.stateNode,r=n.memoizedProps;try{for(var h=n.type,x=o.attributes;x.length;)o.removeAttributeNode(x[0]);zt(o,h,r),o[Dt]=n,o[Yt]=r}catch(b){mt(n,n.return,b)}}var li=!1,wt=!1,eu=!1,Rf=typeof WeakSet=="function"?WeakSet:Set,Ut=null;function Gx(n,o){if(n=n.containerInfo,ku=ar,n=Gd(n),Wr(n)){if("selectionStart"in n)var r={start:n.selectionStart,end:n.selectionEnd};else e:{r=(r=n.ownerDocument)&&r.defaultView||window;var h=r.getSelection&&r.getSelection();if(h&&h.rangeCount!==0){r=h.anchorNode;var x=h.anchorOffset,b=h.focusNode;h=h.focusOffset;try{r.nodeType,b.nodeType}catch{r=null;break e}var T=0,w=-1,U=-1,te=0,he=0,ge=n,ie=null;t:for(;;){for(var le;ge!==r||x!==0&&ge.nodeType!==3||(w=T+x),ge!==b||h!==0&&ge.nodeType!==3||(U=T+h),ge.nodeType===3&&(T+=ge.nodeValue.length),(le=ge.firstChild)!==null;)ie=ge,ge=le;for(;;){if(ge===n)break t;if(ie===r&&++te===x&&(w=T),ie===b&&++he===h&&(U=T),(le=ge.nextSibling)!==null)break;ge=ie,ie=ge.parentNode}ge=le}r=w===-1||U===-1?null:{start:w,end:U}}else r=null}r=r||{start:0,end:0}}else r=null;for(Su={focusedElem:n,selectionRange:r},ar=!1,Ut=o;Ut!==null;)if(o=Ut,n=o.child,(o.subtreeFlags&1024)!==0&&n!==null)n.return=o,Ut=n;else for(;Ut!==null;){switch(o=Ut,b=o.alternate,n=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((n&1024)!==0&&b!==null){n=void 0,r=o,x=b.memoizedProps,b=b.memoizedState,h=r.stateNode;try{var Be=hs(r.type,x,r.elementType===r.type);n=h.getSnapshotBeforeUpdate(Be,b),h.__reactInternalSnapshotBeforeUpdate=n}catch(Ge){mt(r,r.return,Ge)}}break;case 3:if((n&1024)!==0){if(n=o.stateNode.containerInfo,r=n.nodeType,r===9)Mu(n);else if(r===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":Mu(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(s(163))}if(n=o.sibling,n!==null){n.return=o.return,Ut=n;break}Ut=o.return}}function If(n,o,r){var h=r.flags;switch(r.tag){case 0:case 11:case 15:wi(n,r),h&4&&ml(5,r);break;case 1:if(wi(n,r),h&4)if(n=r.stateNode,o===null)try{n.componentDidMount()}catch(T){mt(r,r.return,T)}else{var x=hs(r.type,o.memoizedProps);o=o.memoizedState;try{n.componentDidUpdate(x,o,n.__reactInternalSnapshotBeforeUpdate)}catch(T){mt(r,r.return,T)}}h&64&&Sf(r),h&512&&pl(r,r.return);break;case 3:if(wi(n,r),h&64&&(n=r.updateQueue,n!==null)){if(o=null,r.child!==null)switch(r.child.tag){case 27:case 5:o=r.child.stateNode;break;case 1:o=r.child.stateNode}try{dh(n,o)}catch(T){mt(r,r.return,T)}}break;case 27:o===null&&h&4&&Af(r);case 26:case 5:wi(n,r),o===null&&h&4&&Ef(r),h&512&&pl(r,r.return);break;case 12:wi(n,r);break;case 13:wi(n,r),h&4&&jf(n,r),h&64&&(n=r.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(r=Jx.bind(null,r),fy(n,r))));break;case 22:if(h=r.memoizedState!==null||li,!h){o=o!==null&&o.memoizedState!==null||wt,x=li;var b=wt;li=h,(wt=o)&&!b?Ei(n,r,(r.subtreeFlags&8772)!==0):wi(n,r),li=x,wt=b}break;case 30:break;default:wi(n,r)}}function _f(n){var o=n.alternate;o!==null&&(n.alternate=null,_f(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&Io(o)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var vt=null,an=!1;function ai(n,o,r){for(r=r.child;r!==null;)Lf(n,o,r),r=r.sibling}function Lf(n,o,r){if(qe&&typeof qe.onCommitFiberUnmount=="function")try{qe.onCommitFiberUnmount(De,r)}catch{}switch(r.tag){case 26:wt||$n(r,o),ai(n,o,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode,r.parentNode.removeChild(r));break;case 27:wt||$n(r,o);var h=vt,x=an;Li(r.type)&&(vt=r.stateNode,an=!1),ai(n,o,r),kl(r.stateNode),vt=h,an=x;break;case 5:wt||$n(r,o);case 6:if(h=vt,x=an,vt=null,ai(n,o,r),vt=h,an=x,vt!==null)if(an)try{(vt.nodeType===9?vt.body:vt.nodeName==="HTML"?vt.ownerDocument.body:vt).removeChild(r.stateNode)}catch(b){mt(r,o,b)}else try{vt.removeChild(r.stateNode)}catch(b){mt(r,o,b)}break;case 18:vt!==null&&(an?(n=vt,Cm(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,r.stateNode),_l(n)):Cm(vt,r.stateNode));break;case 4:h=vt,x=an,vt=r.stateNode.containerInfo,an=!0,ai(n,o,r),vt=h,an=x;break;case 0:case 11:case 14:case 15:wt||Si(2,r,o),wt||Si(4,r,o),ai(n,o,r);break;case 1:wt||($n(r,o),h=r.stateNode,typeof h.componentWillUnmount=="function"&&wf(r,o,h)),ai(n,o,r);break;case 21:ai(n,o,r);break;case 22:wt=(h=wt)||r.memoizedState!==null,ai(n,o,r),wt=h;break;default:ai(n,o,r)}}function jf(n,o){if(o.memoizedState===null&&(n=o.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{_l(n)}catch(r){mt(o,o.return,r)}}function Vx(n){switch(n.tag){case 13:case 19:var o=n.stateNode;return o===null&&(o=n.stateNode=new Rf),o;case 22:return n=n.stateNode,o=n._retryCache,o===null&&(o=n._retryCache=new Rf),o;default:throw Error(s(435,n.tag))}}function tu(n,o){var r=Vx(n);o.forEach(function(h){var x=Qx.bind(null,n,h);r.has(h)||(r.add(h),h.then(x,x))})}function dn(n,o){var r=o.deletions;if(r!==null)for(var h=0;h<r.length;h++){var x=r[h],b=n,T=o,w=T;e:for(;w!==null;){switch(w.tag){case 27:if(Li(w.type)){vt=w.stateNode,an=!1;break e}break;case 5:vt=w.stateNode,an=!1;break e;case 3:case 4:vt=w.stateNode.containerInfo,an=!0;break e}w=w.return}if(vt===null)throw Error(s(160));Lf(b,T,x),vt=null,an=!1,b=x.alternate,b!==null&&(b.return=null),x.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)Df(o,n),o=o.sibling}var Dn=null;function Df(n,o){var r=n.alternate,h=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:dn(o,n),hn(n),h&4&&(Si(3,n,n.return),ml(3,n),Si(5,n,n.return));break;case 1:dn(o,n),hn(n),h&512&&(wt||r===null||$n(r,r.return)),h&64&&li&&(n=n.updateQueue,n!==null&&(h=n.callbacks,h!==null&&(r=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=r===null?h:r.concat(h))));break;case 26:var x=Dn;if(dn(o,n),hn(n),h&512&&(wt||r===null||$n(r,r.return)),h&4){var b=r!==null?r.memoizedState:null;if(h=n.memoizedState,r===null)if(h===null)if(n.stateNode===null){e:{h=n.type,r=n.memoizedProps,x=x.ownerDocument||x;t:switch(h){case"title":b=x.getElementsByTagName("title")[0],(!b||b[$i]||b[Dt]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=x.createElement(h),x.head.insertBefore(b,x.querySelector("head > title"))),zt(b,h,r),b[Dt]=n,Mt(b),h=b;break e;case"link":var T=Am("link","href",x).get(h+(r.href||""));if(T){for(var w=0;w<T.length;w++)if(b=T[w],b.getAttribute("href")===(r.href==null||r.href===""?null:r.href)&&b.getAttribute("rel")===(r.rel==null?null:r.rel)&&b.getAttribute("title")===(r.title==null?null:r.title)&&b.getAttribute("crossorigin")===(r.crossOrigin==null?null:r.crossOrigin)){T.splice(w,1);break t}}b=x.createElement(h),zt(b,h,r),x.head.appendChild(b);break;case"meta":if(T=Am("meta","content",x).get(h+(r.content||""))){for(w=0;w<T.length;w++)if(b=T[w],b.getAttribute("content")===(r.content==null?null:""+r.content)&&b.getAttribute("name")===(r.name==null?null:r.name)&&b.getAttribute("property")===(r.property==null?null:r.property)&&b.getAttribute("http-equiv")===(r.httpEquiv==null?null:r.httpEquiv)&&b.getAttribute("charset")===(r.charSet==null?null:r.charSet)){T.splice(w,1);break t}}b=x.createElement(h),zt(b,h,r),x.head.appendChild(b);break;default:throw Error(s(468,h))}b[Dt]=n,Mt(b),h=b}n.stateNode=h}else Rm(x,n.type,n.stateNode);else n.stateNode=Mm(x,h,n.memoizedProps);else b!==h?(b===null?r.stateNode!==null&&(r=r.stateNode,r.parentNode.removeChild(r)):b.count--,h===null?Rm(x,n.type,n.stateNode):Mm(x,h,n.memoizedProps)):h===null&&n.stateNode!==null&&Xc(n,n.memoizedProps,r.memoizedProps)}break;case 27:dn(o,n),hn(n),h&512&&(wt||r===null||$n(r,r.return)),r!==null&&h&4&&Xc(n,n.memoizedProps,r.memoizedProps);break;case 5:if(dn(o,n),hn(n),h&512&&(wt||r===null||$n(r,r.return)),n.flags&32){x=n.stateNode;try{$e(x,"")}catch(le){mt(n,n.return,le)}}h&4&&n.stateNode!=null&&(x=n.memoizedProps,Xc(n,x,r!==null?r.memoizedProps:x)),h&1024&&(eu=!0);break;case 6:if(dn(o,n),hn(n),h&4){if(n.stateNode===null)throw Error(s(162));h=n.memoizedProps,r=n.stateNode;try{r.nodeValue=h}catch(le){mt(n,n.return,le)}}break;case 3:if(sr=null,x=Dn,Dn=nr(o.containerInfo),dn(o,n),Dn=x,hn(n),h&4&&r!==null&&r.memoizedState.isDehydrated)try{_l(o.containerInfo)}catch(le){mt(n,n.return,le)}eu&&(eu=!1,Pf(n));break;case 4:h=Dn,Dn=nr(n.stateNode.containerInfo),dn(o,n),hn(n),Dn=h;break;case 12:dn(o,n),hn(n);break;case 13:dn(o,n),hn(n),n.child.flags&8192&&n.memoizedState!==null!=(r!==null&&r.memoizedState!==null)&&(au=Se()),h&4&&(h=n.updateQueue,h!==null&&(n.updateQueue=null,tu(n,h)));break;case 22:x=n.memoizedState!==null;var U=r!==null&&r.memoizedState!==null,te=li,he=wt;if(li=te||x,wt=he||U,dn(o,n),wt=he,li=te,hn(n),h&8192)e:for(o=n.stateNode,o._visibility=x?o._visibility&-2:o._visibility|1,x&&(r===null||U||li||wt||fs(n)),r=null,o=n;;){if(o.tag===5||o.tag===26){if(r===null){U=r=o;try{if(b=U.stateNode,x)T=b.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none";else{w=U.stateNode;var ge=U.memoizedProps.style,ie=ge!=null&&ge.hasOwnProperty("display")?ge.display:null;w.style.display=ie==null||typeof ie=="boolean"?"":(""+ie).trim()}}catch(le){mt(U,U.return,le)}}}else if(o.tag===6){if(r===null){U=o;try{U.stateNode.nodeValue=x?"":U.memoizedProps}catch(le){mt(U,U.return,le)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===n)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break e;for(;o.sibling===null;){if(o.return===null||o.return===n)break e;r===o&&(r=null),o=o.return}r===o&&(r=null),o.sibling.return=o.return,o=o.sibling}h&4&&(h=n.updateQueue,h!==null&&(r=h.retryQueue,r!==null&&(h.retryQueue=null,tu(n,r))));break;case 19:dn(o,n),hn(n),h&4&&(h=n.updateQueue,h!==null&&(n.updateQueue=null,tu(n,h)));break;case 30:break;case 21:break;default:dn(o,n),hn(n)}}function hn(n){var o=n.flags;if(o&2){try{for(var r,h=n.return;h!==null;){if(Mf(h)){r=h;break}h=h.return}if(r==null)throw Error(s(160));switch(r.tag){case 27:var x=r.stateNode,b=Wc(n);Ba(n,b,x);break;case 5:var T=r.stateNode;r.flags&32&&($e(T,""),r.flags&=-33);var w=Wc(n);Ba(n,w,T);break;case 3:case 4:var U=r.stateNode.containerInfo,te=Wc(n);Zc(n,te,U);break;default:throw Error(s(161))}}catch(he){mt(n,n.return,he)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function Pf(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var o=n;Pf(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),n=n.sibling}}function wi(n,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)If(n,o.alternate,o),o=o.sibling}function fs(n){for(n=n.child;n!==null;){var o=n;switch(o.tag){case 0:case 11:case 14:case 15:Si(4,o,o.return),fs(o);break;case 1:$n(o,o.return);var r=o.stateNode;typeof r.componentWillUnmount=="function"&&wf(o,o.return,r),fs(o);break;case 27:kl(o.stateNode);case 26:case 5:$n(o,o.return),fs(o);break;case 22:o.memoizedState===null&&fs(o);break;case 30:fs(o);break;default:fs(o)}n=n.sibling}}function Ei(n,o,r){for(r=r&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var h=o.alternate,x=n,b=o,T=b.flags;switch(b.tag){case 0:case 11:case 15:Ei(x,b,r),ml(4,b);break;case 1:if(Ei(x,b,r),h=b,x=h.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(te){mt(h,h.return,te)}if(h=b,x=h.updateQueue,x!==null){var w=h.stateNode;try{var U=x.shared.hiddenCallbacks;if(U!==null)for(x.shared.hiddenCallbacks=null,x=0;x<U.length;x++)uh(U[x],w)}catch(te){mt(h,h.return,te)}}r&&T&64&&Sf(b),pl(b,b.return);break;case 27:Af(b);case 26:case 5:Ei(x,b,r),r&&h===null&&T&4&&Ef(b),pl(b,b.return);break;case 12:Ei(x,b,r);break;case 13:Ei(x,b,r),r&&T&4&&jf(x,b);break;case 22:b.memoizedState===null&&Ei(x,b,r),pl(b,b.return);break;case 30:break;default:Ei(x,b,r)}o=o.sibling}}function nu(n,o){var r=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(r=n.memoizedState.cachePool.pool),n=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(n=o.memoizedState.cachePool.pool),n!==r&&(n!=null&&n.refCount++,r!=null&&el(r))}function iu(n,o){n=null,o.alternate!==null&&(n=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==n&&(o.refCount++,n!=null&&el(n))}function Bn(n,o,r,h){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)Uf(n,o,r,h),o=o.sibling}function Uf(n,o,r,h){var x=o.flags;switch(o.tag){case 0:case 11:case 15:Bn(n,o,r,h),x&2048&&ml(9,o);break;case 1:Bn(n,o,r,h);break;case 3:Bn(n,o,r,h),x&2048&&(n=null,o.alternate!==null&&(n=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==n&&(o.refCount++,n!=null&&el(n)));break;case 12:if(x&2048){Bn(n,o,r,h),n=o.stateNode;try{var b=o.memoizedProps,T=b.id,w=b.onPostCommit;typeof w=="function"&&w(T,o.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(U){mt(o,o.return,U)}}else Bn(n,o,r,h);break;case 13:Bn(n,o,r,h);break;case 23:break;case 22:b=o.stateNode,T=o.alternate,o.memoizedState!==null?b._visibility&2?Bn(n,o,r,h):gl(n,o):b._visibility&2?Bn(n,o,r,h):(b._visibility|=2,Ws(n,o,r,h,(o.subtreeFlags&10256)!==0)),x&2048&&nu(T,o);break;case 24:Bn(n,o,r,h),x&2048&&iu(o.alternate,o);break;default:Bn(n,o,r,h)}}function Ws(n,o,r,h,x){for(x=x&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var b=n,T=o,w=r,U=h,te=T.flags;switch(T.tag){case 0:case 11:case 15:Ws(b,T,w,U,x),ml(8,T);break;case 23:break;case 22:var he=T.stateNode;T.memoizedState!==null?he._visibility&2?Ws(b,T,w,U,x):gl(b,T):(he._visibility|=2,Ws(b,T,w,U,x)),x&&te&2048&&nu(T.alternate,T);break;case 24:Ws(b,T,w,U,x),x&&te&2048&&iu(T.alternate,T);break;default:Ws(b,T,w,U,x)}o=o.sibling}}function gl(n,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var r=n,h=o,x=h.flags;switch(h.tag){case 22:gl(r,h),x&2048&&nu(h.alternate,h);break;case 24:gl(r,h),x&2048&&iu(h.alternate,h);break;default:gl(r,h)}o=o.sibling}}var xl=8192;function Zs(n){if(n.subtreeFlags&xl)for(n=n.child;n!==null;)Hf(n),n=n.sibling}function Hf(n){switch(n.tag){case 26:Zs(n),n.flags&xl&&n.memoizedState!==null&&wy(Dn,n.memoizedState,n.memoizedProps);break;case 5:Zs(n);break;case 3:case 4:var o=Dn;Dn=nr(n.stateNode.containerInfo),Zs(n),Dn=o;break;case 22:n.memoizedState===null&&(o=n.alternate,o!==null&&o.memoizedState!==null?(o=xl,xl=16777216,Zs(n),xl=o):Zs(n));break;default:Zs(n)}}function Of(n){var o=n.alternate;if(o!==null&&(n=o.child,n!==null)){o.child=null;do o=n.sibling,n.sibling=null,n=o;while(n!==null)}}function yl(n){var o=n.deletions;if((n.flags&16)!==0){if(o!==null)for(var r=0;r<o.length;r++){var h=o[r];Ut=h,Vf(h,n)}Of(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Gf(n),n=n.sibling}function Gf(n){switch(n.tag){case 0:case 11:case 15:yl(n),n.flags&2048&&Si(9,n,n.return);break;case 3:yl(n);break;case 12:yl(n);break;case 22:var o=n.stateNode;n.memoizedState!==null&&o._visibility&2&&(n.return===null||n.return.tag!==13)?(o._visibility&=-3,qa(n)):yl(n);break;default:yl(n)}}function qa(n){var o=n.deletions;if((n.flags&16)!==0){if(o!==null)for(var r=0;r<o.length;r++){var h=o[r];Ut=h,Vf(h,n)}Of(n)}for(n=n.child;n!==null;){switch(o=n,o.tag){case 0:case 11:case 15:Si(8,o,o.return),qa(o);break;case 22:r=o.stateNode,r._visibility&2&&(r._visibility&=-3,qa(o));break;default:qa(o)}n=n.sibling}}function Vf(n,o){for(;Ut!==null;){var r=Ut;switch(r.tag){case 0:case 11:case 15:Si(8,r,o);break;case 23:case 22:if(r.memoizedState!==null&&r.memoizedState.cachePool!==null){var h=r.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:el(r.memoizedState.cache)}if(h=r.child,h!==null)h.return=r,Ut=h;else e:for(r=n;Ut!==null;){h=Ut;var x=h.sibling,b=h.return;if(_f(h),h===r){Ut=null;break e}if(x!==null){x.return=b,Ut=x;break e}Ut=b}}}var $x={getCacheForType:function(n){var o=Xt(Lt),r=o.data.get(n);return r===void 0&&(r=n(),o.data.set(n,r)),r}},Bx=typeof WeakMap=="function"?WeakMap:Map,at=0,pt=null,Ze=null,nt=0,rt=0,fn=null,Mi=!1,eo=!1,su=!1,ri=0,Tt=0,Ai=0,ms=0,ou=0,Sn=0,to=0,vl=null,rn=null,lu=!1,au=0,za=1/0,Fa=null,Ri=null,qt=0,Ii=null,no=null,io=0,ru=0,cu=null,$f=null,bl=0,uu=null;function mn(){if((at&2)!==0&&nt!==0)return nt&-nt;if(k.T!==null){var n=qs;return n!==0?n:xu()}return Jl()}function Bf(){Sn===0&&(Sn=(nt&536870912)===0||ot?zl():536870912);var n=kn.current;return n!==null&&(n.flags|=32),Sn}function pn(n,o,r){(n===pt&&(rt===2||rt===9)||n.cancelPendingCommit!==null)&&(so(n,0),_i(n,nt,Sn,!1)),Vi(n,r),((at&2)===0||n!==pt)&&(n===pt&&((at&2)===0&&(ms|=r),Tt===4&&_i(n,nt,Sn,!1)),qn(n))}function qf(n,o,r){if((at&6)!==0)throw Error(s(327));var h=!r&&(o&124)===0&&(o&n.expiredLanes)===0||xn(n,o),x=h?Fx(n,o):fu(n,o,!0),b=h;do{if(x===0){eo&&!h&&_i(n,o,0,!1);break}else{if(r=n.current.alternate,b&&!qx(r)){x=fu(n,o,!1),b=!1;continue}if(x===2){if(b=o,n.errorRecoveryDisabledLanes&b)var T=0;else T=n.pendingLanes&-536870913,T=T!==0?T:T&536870912?536870912:0;if(T!==0){o=T;e:{var w=n;x=vl;var U=w.current.memoizedState.isDehydrated;if(U&&(so(w,T).flags|=256),T=fu(w,T,!1),T!==2){if(su&&!U){w.errorRecoveryDisabledLanes|=b,ms|=b,x=4;break e}b=rn,rn=x,b!==null&&(rn===null?rn=b:rn.push.apply(rn,b))}x=T}if(b=!1,x!==2)continue}}if(x===1){so(n,0),_i(n,o,0,!0);break}e:{switch(h=n,b=x,b){case 0:case 1:throw Error(s(345));case 4:if((o&4194048)!==o)break;case 6:_i(h,o,Sn,!Mi);break e;case 2:rn=null;break;case 3:case 5:break;default:throw Error(s(329))}if((o&62914560)===o&&(x=au+300-Se(),10<x)){if(_i(h,o,Sn,!Mi),Ue(h,0,!0)!==0)break e;h.timeoutHandle=vm(zf.bind(null,h,r,rn,Fa,lu,o,Sn,ms,to,Mi,b,2,-0,0),x);break e}zf(h,r,rn,Fa,lu,o,Sn,ms,to,Mi,b,0,-0,0)}}break}while(!0);qn(n)}function zf(n,o,r,h,x,b,T,w,U,te,he,ge,ie,le){if(n.timeoutHandle=-1,ge=o.subtreeFlags,(ge&8192||(ge&16785408)===16785408)&&(El={stylesheets:null,count:0,unsuspend:Sy},Hf(o),ge=Ey(),ge!==null)){n.cancelPendingCommit=ge(Wf.bind(null,n,o,b,r,h,x,T,w,U,he,1,ie,le)),_i(n,b,T,!te);return}Wf(n,o,b,r,h,x,T,w,U)}function qx(n){for(var o=n;;){var r=o.tag;if((r===0||r===11||r===15)&&o.flags&16384&&(r=o.updateQueue,r!==null&&(r=r.stores,r!==null)))for(var h=0;h<r.length;h++){var x=r[h],b=x.getSnapshot;x=x.value;try{if(!cn(b(),x))return!1}catch{return!1}}if(r=o.child,o.subtreeFlags&16384&&r!==null)r.return=o,o=r;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function _i(n,o,r,h){o&=~ou,o&=~ms,n.suspendedLanes|=o,n.pingedLanes&=~o,h&&(n.warmLanes|=o),h=n.expirationTimes;for(var x=o;0<x;){var b=31-Ke(x),T=1<<b;h[b]=-1,x&=~T}r!==0&&Kl(n,r,o)}function Ka(){return(at&6)===0?(Cl(0),!1):!0}function du(){if(Ze!==null){if(rt===0)var n=Ze.return;else n=Ze,ei=rs=null,Mc(n),Qs=null,dl=0,n=Ze;for(;n!==null;)kf(n.alternate,n),n=n.return;Ze=null}}function so(n,o){var r=n.timeoutHandle;r!==-1&&(n.timeoutHandle=-1,ry(r)),r=n.cancelPendingCommit,r!==null&&(n.cancelPendingCommit=null,r()),du(),pt=n,Ze=r=Xn(n.current,null),nt=o,rt=0,fn=null,Mi=!1,eo=xn(n,o),su=!1,to=Sn=ou=ms=Ai=Tt=0,rn=vl=null,lu=!1,(o&8)!==0&&(o|=o&32);var h=n.entangledLanes;if(h!==0)for(n=n.entanglements,h&=o;0<h;){var x=31-Ke(h),b=1<<x;o|=n[x],h&=~b}return ri=o,pa(),r}function Ff(n,o){Xe=null,k.H=ja,o===nl||o===ka?(o=rh(),rt=3):o===oh?(o=rh(),rt=4):rt=o===uf?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,fn=o,Ze===null&&(Tt=1,Oa(n,bn(o,n.current)))}function Kf(){var n=k.H;return k.H=ja,n===null?ja:n}function Yf(){var n=k.A;return k.A=$x,n}function hu(){Tt=4,Mi||(nt&4194048)!==nt&&kn.current!==null||(eo=!0),(Ai&134217727)===0&&(ms&134217727)===0||pt===null||_i(pt,nt,Sn,!1)}function fu(n,o,r){var h=at;at|=2;var x=Kf(),b=Yf();(pt!==n||nt!==o)&&(Fa=null,so(n,o)),o=!1;var T=Tt;e:do try{if(rt!==0&&Ze!==null){var w=Ze,U=fn;switch(rt){case 8:du(),T=6;break e;case 3:case 2:case 9:case 6:kn.current===null&&(o=!0);var te=rt;if(rt=0,fn=null,oo(n,w,U,te),r&&eo){T=0;break e}break;default:te=rt,rt=0,fn=null,oo(n,w,U,te)}}zx(),T=Tt;break}catch(he){Ff(n,he)}while(!0);return o&&n.shellSuspendCounter++,ei=rs=null,at=h,k.H=x,k.A=b,Ze===null&&(pt=null,nt=0,pa()),T}function zx(){for(;Ze!==null;)Jf(Ze)}function Fx(n,o){var r=at;at|=2;var h=Kf(),x=Yf();pt!==n||nt!==o?(Fa=null,za=Se()+500,so(n,o)):eo=xn(n,o);e:do try{if(rt!==0&&Ze!==null){o=Ze;var b=fn;t:switch(rt){case 1:rt=0,fn=null,oo(n,o,b,1);break;case 2:case 9:if(lh(b)){rt=0,fn=null,Qf(o);break}o=function(){rt!==2&&rt!==9||pt!==n||(rt=7),qn(n)},b.then(o,o);break e;case 3:rt=7;break e;case 4:rt=5;break e;case 7:lh(b)?(rt=0,fn=null,Qf(o)):(rt=0,fn=null,oo(n,o,b,7));break;case 5:var T=null;switch(Ze.tag){case 26:T=Ze.memoizedState;case 5:case 27:var w=Ze;if(!T||Im(T)){rt=0,fn=null;var U=w.sibling;if(U!==null)Ze=U;else{var te=w.return;te!==null?(Ze=te,Ya(te)):Ze=null}break t}}rt=0,fn=null,oo(n,o,b,5);break;case 6:rt=0,fn=null,oo(n,o,b,6);break;case 8:du(),Tt=6;break e;default:throw Error(s(462))}}Kx();break}catch(he){Ff(n,he)}while(!0);return ei=rs=null,k.H=h,k.A=x,at=r,Ze!==null?0:(pt=null,nt=0,pa(),Tt)}function Kx(){for(;Ze!==null&&!ye();)Jf(Ze)}function Jf(n){var o=Tf(n.alternate,n,ri);n.memoizedProps=n.pendingProps,o===null?Ya(n):Ze=o}function Qf(n){var o=n,r=o.alternate;switch(o.tag){case 15:case 0:o=gf(r,o,o.pendingProps,o.type,void 0,nt);break;case 11:o=gf(r,o,o.pendingProps,o.type.render,o.ref,nt);break;case 5:Mc(o);default:kf(r,o),o=Ze=Qd(o,ri),o=Tf(r,o,ri)}n.memoizedProps=n.pendingProps,o===null?Ya(n):Ze=o}function oo(n,o,r,h){ei=rs=null,Mc(o),Qs=null,dl=0;var x=o.return;try{if(Px(n,x,o,r,nt)){Tt=1,Oa(n,bn(r,n.current)),Ze=null;return}}catch(b){if(x!==null)throw Ze=x,b;Tt=1,Oa(n,bn(r,n.current)),Ze=null;return}o.flags&32768?(ot||h===1?n=!0:eo||(nt&536870912)!==0?n=!1:(Mi=n=!0,(h===2||h===9||h===3||h===6)&&(h=kn.current,h!==null&&h.tag===13&&(h.flags|=16384))),Xf(o,n)):Ya(o)}function Ya(n){var o=n;do{if((o.flags&32768)!==0){Xf(o,Mi);return}n=o.return;var r=Hx(o.alternate,o,ri);if(r!==null){Ze=r;return}if(o=o.sibling,o!==null){Ze=o;return}Ze=o=n}while(o!==null);Tt===0&&(Tt=5)}function Xf(n,o){do{var r=Ox(n.alternate,n);if(r!==null){r.flags&=32767,Ze=r;return}if(r=n.return,r!==null&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!o&&(n=n.sibling,n!==null)){Ze=n;return}Ze=n=r}while(n!==null);Tt=6,Ze=null}function Wf(n,o,r,h,x,b,T,w,U){n.cancelPendingCommit=null;do Ja();while(qt!==0);if((at&6)!==0)throw Error(s(327));if(o!==null){if(o===n.current)throw Error(s(177));if(b=o.lanes|o.childLanes,b|=ic,Ur(n,r,b,T,w,U),n===pt&&(Ze=pt=null,nt=0),no=o,Ii=n,io=r,ru=b,cu=x,$f=h,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,Xx(Fe,function(){return im(),null})):(n.callbackNode=null,n.callbackPriority=0),h=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||h){h=k.T,k.T=null,x=S.p,S.p=2,T=at,at|=4;try{Gx(n,o,r)}finally{at=T,S.p=x,k.T=h}}qt=1,Zf(),em(),tm()}}function Zf(){if(qt===1){qt=0;var n=Ii,o=no,r=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||r){r=k.T,k.T=null;var h=S.p;S.p=2;var x=at;at|=4;try{Df(o,n);var b=Su,T=Gd(n.containerInfo),w=b.focusedElem,U=b.selectionRange;if(T!==w&&w&&w.ownerDocument&&Od(w.ownerDocument.documentElement,w)){if(U!==null&&Wr(w)){var te=U.start,he=U.end;if(he===void 0&&(he=te),"selectionStart"in w)w.selectionStart=te,w.selectionEnd=Math.min(he,w.value.length);else{var ge=w.ownerDocument||document,ie=ge&&ge.defaultView||window;if(ie.getSelection){var le=ie.getSelection(),Be=w.textContent.length,Ge=Math.min(U.start,Be),ft=U.end===void 0?Ge:Math.min(U.end,Be);!le.extend&&Ge>ft&&(T=ft,ft=Ge,Ge=T);var K=Hd(w,Ge),q=Hd(w,ft);if(K&&q&&(le.rangeCount!==1||le.anchorNode!==K.node||le.anchorOffset!==K.offset||le.focusNode!==q.node||le.focusOffset!==q.offset)){var ee=ge.createRange();ee.setStart(K.node,K.offset),le.removeAllRanges(),Ge>ft?(le.addRange(ee),le.extend(q.node,q.offset)):(ee.setEnd(q.node,q.offset),le.addRange(ee))}}}}for(ge=[],le=w;le=le.parentNode;)le.nodeType===1&&ge.push({element:le,left:le.scrollLeft,top:le.scrollTop});for(typeof w.focus=="function"&&w.focus(),w=0;w<ge.length;w++){var pe=ge[w];pe.element.scrollLeft=pe.left,pe.element.scrollTop=pe.top}}ar=!!ku,Su=ku=null}finally{at=x,S.p=h,k.T=r}}n.current=o,qt=2}}function em(){if(qt===2){qt=0;var n=Ii,o=no,r=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||r){r=k.T,k.T=null;var h=S.p;S.p=2;var x=at;at|=4;try{If(n,o.alternate,o)}finally{at=x,S.p=h,k.T=r}}qt=3}}function tm(){if(qt===4||qt===3){qt=0,we();var n=Ii,o=no,r=io,h=$f;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?qt=5:(qt=0,no=Ii=null,nm(n,n.pendingLanes));var x=n.pendingLanes;if(x===0&&(Ri=null),Ao(r),o=o.stateNode,qe&&typeof qe.onCommitFiberRoot=="function")try{qe.onCommitFiberRoot(De,o,void 0,(o.current.flags&128)===128)}catch{}if(h!==null){o=k.T,x=S.p,S.p=2,k.T=null;try{for(var b=n.onRecoverableError,T=0;T<h.length;T++){var w=h[T];b(w.value,{componentStack:w.stack})}}finally{k.T=o,S.p=x}}(io&3)!==0&&Ja(),qn(n),x=n.pendingLanes,(r&4194090)!==0&&(x&42)!==0?n===uu?bl++:(bl=0,uu=n):bl=0,Cl(0)}}function nm(n,o){(n.pooledCacheLanes&=o)===0&&(o=n.pooledCache,o!=null&&(n.pooledCache=null,el(o)))}function Ja(n){return Zf(),em(),tm(),im()}function im(){if(qt!==5)return!1;var n=Ii,o=ru;ru=0;var r=Ao(io),h=k.T,x=S.p;try{S.p=32>r?32:r,k.T=null,r=cu,cu=null;var b=Ii,T=io;if(qt=0,no=Ii=null,io=0,(at&6)!==0)throw Error(s(331));var w=at;if(at|=4,Gf(b.current),Uf(b,b.current,T,r),at=w,Cl(0,!1),qe&&typeof qe.onPostCommitFiberRoot=="function")try{qe.onPostCommitFiberRoot(De,b)}catch{}return!0}finally{S.p=x,k.T=h,nm(n,o)}}function sm(n,o,r){o=bn(r,o),o=$c(n.stateNode,o,2),n=Ci(n,o,2),n!==null&&(Vi(n,2),qn(n))}function mt(n,o,r){if(n.tag===3)sm(n,n,r);else for(;o!==null;){if(o.tag===3){sm(o,n,r);break}else if(o.tag===1){var h=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Ri===null||!Ri.has(h))){n=bn(r,n),r=rf(2),h=Ci(o,r,2),h!==null&&(cf(r,h,o,n),Vi(h,2),qn(h));break}}o=o.return}}function mu(n,o,r){var h=n.pingCache;if(h===null){h=n.pingCache=new Bx;var x=new Set;h.set(o,x)}else x=h.get(o),x===void 0&&(x=new Set,h.set(o,x));x.has(r)||(su=!0,x.add(r),n=Yx.bind(null,n,o,r),o.then(n,n))}function Yx(n,o,r){var h=n.pingCache;h!==null&&h.delete(o),n.pingedLanes|=n.suspendedLanes&r,n.warmLanes&=~r,pt===n&&(nt&r)===r&&(Tt===4||Tt===3&&(nt&62914560)===nt&&300>Se()-au?(at&2)===0&&so(n,0):ou|=r,to===nt&&(to=0)),qn(n)}function om(n,o){o===0&&(o=Fl()),n=Gs(n,o),n!==null&&(Vi(n,o),qn(n))}function Jx(n){var o=n.memoizedState,r=0;o!==null&&(r=o.retryLane),om(n,r)}function Qx(n,o){var r=0;switch(n.tag){case 13:var h=n.stateNode,x=n.memoizedState;x!==null&&(r=x.retryLane);break;case 19:h=n.stateNode;break;case 22:h=n.stateNode._retryCache;break;default:throw Error(s(314))}h!==null&&h.delete(o),om(n,r)}function Xx(n,o){return Ee(n,o)}var Qa=null,lo=null,pu=!1,Xa=!1,gu=!1,ps=0;function qn(n){n!==lo&&n.next===null&&(lo===null?Qa=lo=n:lo=lo.next=n),Xa=!0,pu||(pu=!0,Zx())}function Cl(n,o){if(!gu&&Xa){gu=!0;do for(var r=!1,h=Qa;h!==null;){if(n!==0){var x=h.pendingLanes;if(x===0)var b=0;else{var T=h.suspendedLanes,w=h.pingedLanes;b=(1<<31-Ke(42|n)+1)-1,b&=x&~(T&~w),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(r=!0,cm(h,b))}else b=nt,b=Ue(h,h===pt?b:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(b&3)===0||xn(h,b)||(r=!0,cm(h,b));h=h.next}while(r);gu=!1}}function Wx(){lm()}function lm(){Xa=pu=!1;var n=0;ps!==0&&(ay()&&(n=ps),ps=0);for(var o=Se(),r=null,h=Qa;h!==null;){var x=h.next,b=am(h,o);b===0?(h.next=null,r===null?Qa=x:r.next=x,x===null&&(lo=r)):(r=h,(n!==0||(b&3)!==0)&&(Xa=!0)),h=x}Cl(n)}function am(n,o){for(var r=n.suspendedLanes,h=n.pingedLanes,x=n.expirationTimes,b=n.pendingLanes&-62914561;0<b;){var T=31-Ke(b),w=1<<T,U=x[T];U===-1?((w&r)===0||(w&h)!==0)&&(x[T]=wo(w,o)):U<=o&&(n.expiredLanes|=w),b&=~w}if(o=pt,r=nt,r=Ue(n,n===o?r:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),h=n.callbackNode,r===0||n===o&&(rt===2||rt===9)||n.cancelPendingCommit!==null)return h!==null&&h!==null&&Re(h),n.callbackNode=null,n.callbackPriority=0;if((r&3)===0||xn(n,r)){if(o=r&-r,o===n.callbackPriority)return o;switch(h!==null&&Re(h),Ao(r)){case 2:case 8:r=gt;break;case 32:r=Fe;break;case 268435456:r=ve;break;default:r=Fe}return h=rm.bind(null,n),r=Ee(r,h),n.callbackPriority=o,n.callbackNode=r,o}return h!==null&&h!==null&&Re(h),n.callbackPriority=2,n.callbackNode=null,2}function rm(n,o){if(qt!==0&&qt!==5)return n.callbackNode=null,n.callbackPriority=0,null;var r=n.callbackNode;if(Ja()&&n.callbackNode!==r)return null;var h=nt;return h=Ue(n,n===pt?h:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),h===0?null:(qf(n,h,o),am(n,Se()),n.callbackNode!=null&&n.callbackNode===r?rm.bind(null,n):null)}function cm(n,o){if(Ja())return null;qf(n,o,!0)}function Zx(){cy(function(){(at&6)!==0?Ee(_e,Wx):lm()})}function xu(){return ps===0&&(ps=zl()),ps}function um(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Qi(""+n)}function dm(n,o){var r=o.ownerDocument.createElement("input");return r.name=o.name,r.value=o.value,n.id&&r.setAttribute("form",n.id),o.parentNode.insertBefore(r,o),n=new FormData(n),r.parentNode.removeChild(r),n}function ey(n,o,r,h,x){if(o==="submit"&&r&&r.stateNode===x){var b=um((x[Yt]||null).action),T=h.submitter;T&&(o=(o=T[Yt]||null)?um(o.formAction):T.getAttribute("formAction"),o!==null&&(b=o,T=null));var w=new _s("action","action",null,h,x);n.push({event:w,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(ps!==0){var U=T?dm(x,T):new FormData(x);Uc(r,{pending:!0,data:U,method:x.method,action:b},null,U)}}else typeof b=="function"&&(w.preventDefault(),U=T?dm(x,T):new FormData(x),Uc(r,{pending:!0,data:U,method:x.method,action:b},b,U))},currentTarget:x}]})}}for(var yu=0;yu<nc.length;yu++){var vu=nc[yu],ty=vu.toLowerCase(),ny=vu[0].toUpperCase()+vu.slice(1);jn(ty,"on"+ny)}jn(Bd,"onAnimationEnd"),jn(qd,"onAnimationIteration"),jn(zd,"onAnimationStart"),jn("dblclick","onDoubleClick"),jn("focusin","onFocus"),jn("focusout","onBlur"),jn(vx,"onTransitionRun"),jn(bx,"onTransitionStart"),jn(Cx,"onTransitionCancel"),jn(Fd,"onTransitionEnd"),Fn("onMouseEnter",["mouseout","mouseover"]),Fn("onMouseLeave",["mouseout","mouseover"]),Fn("onPointerEnter",["pointerout","pointerover"]),Fn("onPointerLeave",["pointerout","pointerover"]),Rn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Rn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Rn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Rn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Rn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Rn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Tl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),iy=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Tl));function hm(n,o){o=(o&4)!==0;for(var r=0;r<n.length;r++){var h=n[r],x=h.event;h=h.listeners;e:{var b=void 0;if(o)for(var T=h.length-1;0<=T;T--){var w=h[T],U=w.instance,te=w.currentTarget;if(w=w.listener,U!==b&&x.isPropagationStopped())break e;b=w,x.currentTarget=te;try{b(x)}catch(he){Ha(he)}x.currentTarget=null,b=U}else for(T=0;T<h.length;T++){if(w=h[T],U=w.instance,te=w.currentTarget,w=w.listener,U!==b&&x.isPropagationStopped())break e;b=w,x.currentTarget=te;try{b(x)}catch(he){Ha(he)}x.currentTarget=null,b=U}}}}function et(n,o){var r=o[Ro];r===void 0&&(r=o[Ro]=new Set);var h=n+"__bubble";r.has(h)||(fm(o,n,2,!1),r.add(h))}function bu(n,o,r){var h=0;o&&(h|=4),fm(r,n,h,o)}var Wa="_reactListening"+Math.random().toString(36).slice(2);function Cu(n){if(!n[Wa]){n[Wa]=!0,Xl.forEach(function(r){r!=="selectionchange"&&(iy.has(r)||bu(r,!1,n),bu(r,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[Wa]||(o[Wa]=!0,bu("selectionchange",!1,o))}}function fm(n,o,r,h){switch(Um(o)){case 2:var x=Ry;break;case 8:x=Iy;break;default:x=Du}r=x.bind(null,o,r,n),x=void 0,!gi||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(x=!0),h?x!==void 0?n.addEventListener(o,r,{capture:!0,passive:x}):n.addEventListener(o,r,!0):x!==void 0?n.addEventListener(o,r,{passive:x}):n.addEventListener(o,r,!1)}function Tu(n,o,r,h,x){var b=h;if((o&1)===0&&(o&2)===0&&h!==null)e:for(;;){if(h===null)return;var T=h.tag;if(T===3||T===4){var w=h.stateNode.containerInfo;if(w===x)break;if(T===4)for(T=h.return;T!==null;){var U=T.tag;if((U===3||U===4)&&T.stateNode.containerInfo===x)return;T=T.return}for(;w!==null;){if(T=fi(w),T===null)return;if(U=T.tag,U===5||U===6||U===26||U===27){h=b=T;continue e}w=w.parentNode}}h=h.return}In(function(){var te=b,he=Xi(r),ge=[];e:{var ie=Kd.get(n);if(ie!==void 0){var le=_s,Be=n;switch(n){case"keypress":if(Wi(r)===0)break e;case"keydown":case"keyup":le=da;break;case"focusin":Be="focus",le=Bo;break;case"focusout":Be="blur",le=Bo;break;case"beforeblur":case"afterblur":le=Bo;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":le=ia;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":le=qr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":le=fe;break;case Bd:case qd:case zd:le=oa;break;case Fd:le=ke;break;case"scroll":case"scrollend":le=$r;break;case"wheel":le=tt;break;case"copy":case"cut":case"paste":le=Kr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":le=fa;break;case"toggle":case"beforetoggle":le=Oe}var Ge=(o&4)!==0,ft=!Ge&&(n==="scroll"||n==="scrollend"),K=Ge?ie!==null?ie+"Capture":null:ie;Ge=[];for(var q=te,ee;q!==null;){var pe=q;if(ee=pe.stateNode,pe=pe.tag,pe!==5&&pe!==26&&pe!==27||ee===null||K===null||(pe=Yn(q,K),pe!=null&&Ge.push(Nl(q,pe,ee))),ft)break;q=q.return}0<Ge.length&&(ie=new le(ie,Be,null,r,he),ge.push({event:ie,listeners:Ge}))}}if((o&7)===0){e:{if(ie=n==="mouseover"||n==="pointerover",le=n==="mouseout"||n==="pointerout",ie&&r!==As&&(Be=r.relatedTarget||r.fromElement)&&(fi(Be)||Be[hi]))break e;if((le||ie)&&(ie=he.window===he?he:(ie=he.ownerDocument)?ie.defaultView||ie.parentWindow:window,le?(Be=r.relatedTarget||r.toElement,le=te,Be=Be?fi(Be):null,Be!==null&&(ft=u(Be),Ge=Be.tag,Be!==ft||Ge!==5&&Ge!==27&&Ge!==6)&&(Be=null)):(le=null,Be=te),le!==Be)){if(Ge=ia,pe="onMouseLeave",K="onMouseEnter",q="mouse",(n==="pointerout"||n==="pointerover")&&(Ge=fa,pe="onPointerLeave",K="onPointerEnter",q="pointer"),ft=le==null?ie:Bi(le),ee=Be==null?ie:Bi(Be),ie=new Ge(pe,q+"leave",le,r,he),ie.target=ft,ie.relatedTarget=ee,pe=null,fi(he)===te&&(Ge=new Ge(K,q+"enter",Be,r,he),Ge.target=ee,Ge.relatedTarget=ft,pe=Ge),ft=pe,le&&Be)t:{for(Ge=le,K=Be,q=0,ee=Ge;ee;ee=ao(ee))q++;for(ee=0,pe=K;pe;pe=ao(pe))ee++;for(;0<q-ee;)Ge=ao(Ge),q--;for(;0<ee-q;)K=ao(K),ee--;for(;q--;){if(Ge===K||K!==null&&Ge===K.alternate)break t;Ge=ao(Ge),K=ao(K)}Ge=null}else Ge=null;le!==null&&mm(ge,ie,le,Ge,!1),Be!==null&&ft!==null&&mm(ge,ft,Be,Ge,!0)}}e:{if(ie=te?Bi(te):window,le=ie.nodeName&&ie.nodeName.toLowerCase(),le==="select"||le==="input"&&ie.type==="file")var Ie=_d;else if(Rd(ie))if(Ld)Ie=gx;else{Ie=mx;var We=fx}else le=ie.nodeName,!le||le.toLowerCase()!=="input"||ie.type!=="checkbox"&&ie.type!=="radio"?te&&Nt(te.elementType)&&(Ie=_d):Ie=px;if(Ie&&(Ie=Ie(n,te))){Id(ge,Ie,r,he);break e}We&&We(n,ie,te),n==="focusout"&&te&&ie.type==="number"&&te.memoizedProps.value!=null&&Ji(ie,"number",ie.value)}switch(We=te?Bi(te):window,n){case"focusin":(Rd(We)||We.contentEditable==="true")&&(Us=We,Zr=te,Jo=null);break;case"focusout":Jo=Zr=Us=null;break;case"mousedown":ec=!0;break;case"contextmenu":case"mouseup":case"dragend":ec=!1,Vd(ge,r,he);break;case"selectionchange":if(yx)break;case"keydown":case"keyup":Vd(ge,r,he)}var je;if(Jr)e:{switch(n){case"compositionstart":var Ve="onCompositionStart";break e;case"compositionend":Ve="onCompositionEnd";break e;case"compositionupdate":Ve="onCompositionUpdate";break e}Ve=void 0}else Ps?Md(n,r)&&(Ve="onCompositionEnd"):n==="keydown"&&r.keyCode===229&&(Ve="onCompositionStart");Ve&&(Sd&&r.locale!=="ko"&&(Ps||Ve!=="onCompositionStart"?Ve==="onCompositionEnd"&&Ps&&(je=_n()):(Gt=he,Is="value"in Gt?Gt.value:Gt.textContent,Ps=!0)),We=Za(te,Ve),0<We.length&&(Ve=new qo(Ve,n,null,r,he),ge.push({event:Ve,listeners:We}),je?Ve.data=je:(je=Ad(r),je!==null&&(Ve.data=je)))),(je=rx?cx(n,r):ux(n,r))&&(Ve=Za(te,"onBeforeInput"),0<Ve.length&&(We=new qo("onBeforeInput","beforeinput",null,r,he),ge.push({event:We,listeners:Ve}),We.data=je)),ey(ge,n,te,r,he)}hm(ge,o)})}function Nl(n,o,r){return{instance:n,listener:o,currentTarget:r}}function Za(n,o){for(var r=o+"Capture",h=[];n!==null;){var x=n,b=x.stateNode;if(x=x.tag,x!==5&&x!==26&&x!==27||b===null||(x=Yn(n,r),x!=null&&h.unshift(Nl(n,x,b)),x=Yn(n,o),x!=null&&h.push(Nl(n,x,b))),n.tag===3)return h;n=n.return}return[]}function ao(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function mm(n,o,r,h,x){for(var b=o._reactName,T=[];r!==null&&r!==h;){var w=r,U=w.alternate,te=w.stateNode;if(w=w.tag,U!==null&&U===h)break;w!==5&&w!==26&&w!==27||te===null||(U=te,x?(te=Yn(r,b),te!=null&&T.unshift(Nl(r,te,U))):x||(te=Yn(r,b),te!=null&&T.push(Nl(r,te,U)))),r=r.return}T.length!==0&&n.push({event:o,listeners:T})}var sy=/\r\n?/g,oy=/\u0000|\uFFFD/g;function pm(n){return(typeof n=="string"?n:""+n).replace(sy,`
`).replace(oy,"")}function gm(n,o){return o=pm(o),pm(n)===o}function er(){}function ht(n,o,r,h,x,b){switch(r){case"children":typeof h=="string"?o==="body"||o==="textarea"&&h===""||$e(n,h):(typeof h=="number"||typeof h=="bigint")&&o!=="body"&&$e(n,""+h);break;case"className":zi(n,"class",h);break;case"tabIndex":zi(n,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":zi(n,r,h);break;case"style":na(n,h,b);break;case"data":if(o!=="object"){zi(n,"data",h);break}case"src":case"href":if(h===""&&(o!=="a"||r!=="href")){n.removeAttribute(r);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){n.removeAttribute(r);break}h=Qi(""+h),n.setAttribute(r,h);break;case"action":case"formAction":if(typeof h=="function"){n.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(r==="formAction"?(o!=="input"&&ht(n,o,"name",x.name,x,null),ht(n,o,"formEncType",x.formEncType,x,null),ht(n,o,"formMethod",x.formMethod,x,null),ht(n,o,"formTarget",x.formTarget,x,null)):(ht(n,o,"encType",x.encType,x,null),ht(n,o,"method",x.method,x,null),ht(n,o,"target",x.target,x,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){n.removeAttribute(r);break}h=Qi(""+h),n.setAttribute(r,h);break;case"onClick":h!=null&&(n.onclick=er);break;case"onScroll":h!=null&&et("scroll",n);break;case"onScrollEnd":h!=null&&et("scrollend",n);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(s(61));if(r=h.__html,r!=null){if(x.children!=null)throw Error(s(60));n.innerHTML=r}}break;case"multiple":n.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":n.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){n.removeAttribute("xlink:href");break}r=Qi(""+h),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?n.setAttribute(r,""+h):n.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?n.setAttribute(r,""):n.removeAttribute(r);break;case"capture":case"download":h===!0?n.setAttribute(r,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?n.setAttribute(r,h):n.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?n.setAttribute(r,h):n.removeAttribute(r);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?n.removeAttribute(r):n.setAttribute(r,h);break;case"popover":et("beforetoggle",n),et("toggle",n),qi(n,"popover",h);break;case"xlinkActuate":yn(n,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":yn(n,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":yn(n,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":yn(n,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":yn(n,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":yn(n,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":yn(n,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":yn(n,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":yn(n,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":qi(n,"is",h);break;case"innerText":case"textContent":break;default:(!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(r=kt.get(r)||r,qi(n,r,h))}}function Nu(n,o,r,h,x,b){switch(r){case"style":na(n,h,b);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(s(61));if(r=h.__html,r!=null){if(x.children!=null)throw Error(s(60));n.innerHTML=r}}break;case"children":typeof h=="string"?$e(n,h):(typeof h=="number"||typeof h=="bigint")&&$e(n,""+h);break;case"onScroll":h!=null&&et("scroll",n);break;case"onScrollEnd":h!=null&&et("scrollend",n);break;case"onClick":h!=null&&(n.onclick=er);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!_o.hasOwnProperty(r))e:{if(r[0]==="o"&&r[1]==="n"&&(x=r.endsWith("Capture"),o=r.slice(2,x?r.length-7:void 0),b=n[Yt]||null,b=b!=null?b[r]:null,typeof b=="function"&&n.removeEventListener(o,b,x),typeof h=="function")){typeof b!="function"&&b!==null&&(r in n?n[r]=null:n.hasAttribute(r)&&n.removeAttribute(r)),n.addEventListener(o,h,x);break e}r in n?n[r]=h:h===!0?n.setAttribute(r,""):qi(n,r,h)}}}function zt(n,o,r){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":et("error",n),et("load",n);var h=!1,x=!1,b;for(b in r)if(r.hasOwnProperty(b)){var T=r[b];if(T!=null)switch(b){case"src":h=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:ht(n,o,b,T,r,null)}}x&&ht(n,o,"srcSet",r.srcSet,r,null),h&&ht(n,o,"src",r.src,r,null);return;case"input":et("invalid",n);var w=b=T=x=null,U=null,te=null;for(h in r)if(r.hasOwnProperty(h)){var he=r[h];if(he!=null)switch(h){case"name":x=he;break;case"type":T=he;break;case"checked":U=he;break;case"defaultChecked":te=he;break;case"value":b=he;break;case"defaultValue":w=he;break;case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(s(137,o));break;default:ht(n,o,h,he,r,null)}}Ms(n,b,w,U,te,T,x,!1),Fi(n);return;case"select":et("invalid",n),h=T=b=null;for(x in r)if(r.hasOwnProperty(x)&&(w=r[x],w!=null))switch(x){case"value":b=w;break;case"defaultValue":T=w;break;case"multiple":h=w;default:ht(n,o,x,w,r,null)}o=b,r=T,n.multiple=!!h,o!=null?On(n,!!h,o,!1):r!=null&&On(n,!!h,r,!0);return;case"textarea":et("invalid",n),b=x=h=null;for(T in r)if(r.hasOwnProperty(T)&&(w=r[T],w!=null))switch(T){case"value":h=w;break;case"defaultValue":x=w;break;case"children":b=w;break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(s(91));break;default:ht(n,o,T,w,r,null)}ta(n,h,x,b),Fi(n);return;case"option":for(U in r)if(r.hasOwnProperty(U)&&(h=r[U],h!=null))switch(U){case"selected":n.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:ht(n,o,U,h,r,null)}return;case"dialog":et("beforetoggle",n),et("toggle",n),et("cancel",n),et("close",n);break;case"iframe":case"object":et("load",n);break;case"video":case"audio":for(h=0;h<Tl.length;h++)et(Tl[h],n);break;case"image":et("error",n),et("load",n);break;case"details":et("toggle",n);break;case"embed":case"source":case"link":et("error",n),et("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(te in r)if(r.hasOwnProperty(te)&&(h=r[te],h!=null))switch(te){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:ht(n,o,te,h,r,null)}return;default:if(Nt(o)){for(he in r)r.hasOwnProperty(he)&&(h=r[he],h!==void 0&&Nu(n,o,he,h,r,void 0));return}}for(w in r)r.hasOwnProperty(w)&&(h=r[w],h!=null&&ht(n,o,w,h,r,null))}function ly(n,o,r,h){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,b=null,T=null,w=null,U=null,te=null,he=null;for(le in r){var ge=r[le];if(r.hasOwnProperty(le)&&ge!=null)switch(le){case"checked":break;case"value":break;case"defaultValue":U=ge;default:h.hasOwnProperty(le)||ht(n,o,le,null,h,ge)}}for(var ie in h){var le=h[ie];if(ge=r[ie],h.hasOwnProperty(ie)&&(le!=null||ge!=null))switch(ie){case"type":b=le;break;case"name":x=le;break;case"checked":te=le;break;case"defaultChecked":he=le;break;case"value":T=le;break;case"defaultValue":w=le;break;case"children":case"dangerouslySetInnerHTML":if(le!=null)throw Error(s(137,o));break;default:le!==ge&&ht(n,o,ie,le,h,ge)}}Yi(n,T,w,U,te,he,b,x);return;case"select":le=T=w=ie=null;for(b in r)if(U=r[b],r.hasOwnProperty(b)&&U!=null)switch(b){case"value":break;case"multiple":le=U;default:h.hasOwnProperty(b)||ht(n,o,b,null,h,U)}for(x in h)if(b=h[x],U=r[x],h.hasOwnProperty(x)&&(b!=null||U!=null))switch(x){case"value":ie=b;break;case"defaultValue":w=b;break;case"multiple":T=b;default:b!==U&&ht(n,o,x,b,h,U)}o=w,r=T,h=le,ie!=null?On(n,!!r,ie,!1):!!h!=!!r&&(o!=null?On(n,!!r,o,!0):On(n,!!r,r?[]:"",!1));return;case"textarea":le=ie=null;for(w in r)if(x=r[w],r.hasOwnProperty(w)&&x!=null&&!h.hasOwnProperty(w))switch(w){case"value":break;case"children":break;default:ht(n,o,w,null,h,x)}for(T in h)if(x=h[T],b=r[T],h.hasOwnProperty(T)&&(x!=null||b!=null))switch(T){case"value":ie=x;break;case"defaultValue":le=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(s(91));break;default:x!==b&&ht(n,o,T,x,h,b)}ea(n,ie,le);return;case"option":for(var Be in r)if(ie=r[Be],r.hasOwnProperty(Be)&&ie!=null&&!h.hasOwnProperty(Be))switch(Be){case"selected":n.selected=!1;break;default:ht(n,o,Be,null,h,ie)}for(U in h)if(ie=h[U],le=r[U],h.hasOwnProperty(U)&&ie!==le&&(ie!=null||le!=null))switch(U){case"selected":n.selected=ie&&typeof ie!="function"&&typeof ie!="symbol";break;default:ht(n,o,U,ie,h,le)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ge in r)ie=r[Ge],r.hasOwnProperty(Ge)&&ie!=null&&!h.hasOwnProperty(Ge)&&ht(n,o,Ge,null,h,ie);for(te in h)if(ie=h[te],le=r[te],h.hasOwnProperty(te)&&ie!==le&&(ie!=null||le!=null))switch(te){case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(s(137,o));break;default:ht(n,o,te,ie,h,le)}return;default:if(Nt(o)){for(var ft in r)ie=r[ft],r.hasOwnProperty(ft)&&ie!==void 0&&!h.hasOwnProperty(ft)&&Nu(n,o,ft,void 0,h,ie);for(he in h)ie=h[he],le=r[he],!h.hasOwnProperty(he)||ie===le||ie===void 0&&le===void 0||Nu(n,o,he,ie,h,le);return}}for(var K in r)ie=r[K],r.hasOwnProperty(K)&&ie!=null&&!h.hasOwnProperty(K)&&ht(n,o,K,null,h,ie);for(ge in h)ie=h[ge],le=r[ge],!h.hasOwnProperty(ge)||ie===le||ie==null&&le==null||ht(n,o,ge,ie,h,le)}var ku=null,Su=null;function tr(n){return n.nodeType===9?n:n.ownerDocument}function xm(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ym(n,o){if(n===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&o==="foreignObject"?0:n}function wu(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Eu=null;function ay(){var n=window.event;return n&&n.type==="popstate"?n===Eu?!1:(Eu=n,!0):(Eu=null,!1)}var vm=typeof setTimeout=="function"?setTimeout:void 0,ry=typeof clearTimeout=="function"?clearTimeout:void 0,bm=typeof Promise=="function"?Promise:void 0,cy=typeof queueMicrotask=="function"?queueMicrotask:typeof bm<"u"?function(n){return bm.resolve(null).then(n).catch(uy)}:vm;function uy(n){setTimeout(function(){throw n})}function Li(n){return n==="head"}function Cm(n,o){var r=o,h=0,x=0;do{var b=r.nextSibling;if(n.removeChild(r),b&&b.nodeType===8)if(r=b.data,r==="/$"){if(0<h&&8>h){r=h;var T=n.ownerDocument;if(r&1&&kl(T.documentElement),r&2&&kl(T.body),r&4)for(r=T.head,kl(r),T=r.firstChild;T;){var w=T.nextSibling,U=T.nodeName;T[$i]||U==="SCRIPT"||U==="STYLE"||U==="LINK"&&T.rel.toLowerCase()==="stylesheet"||r.removeChild(T),T=w}}if(x===0){n.removeChild(b),_l(o);return}x--}else r==="$"||r==="$?"||r==="$!"?x++:h=r.charCodeAt(0)-48;else h=0;r=b}while(r);_l(o)}function Mu(n){var o=n.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var r=o;switch(o=o.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":Mu(r),Io(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(r.rel.toLowerCase()==="stylesheet")continue}n.removeChild(r)}}function dy(n,o,r,h){for(;n.nodeType===1;){var x=r;if(n.nodeName.toLowerCase()!==o.toLowerCase()){if(!h&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(h){if(!n[$i])switch(o){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(b=n.getAttribute("rel"),b==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(b!==x.rel||n.getAttribute("href")!==(x.href==null||x.href===""?null:x.href)||n.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||n.getAttribute("title")!==(x.title==null?null:x.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(b=n.getAttribute("src"),(b!==(x.src==null?null:x.src)||n.getAttribute("type")!==(x.type==null?null:x.type)||n.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&b&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(o==="input"&&n.type==="hidden"){var b=x.name==null?null:""+x.name;if(x.type==="hidden"&&n.getAttribute("name")===b)return n}else return n;if(n=Pn(n.nextSibling),n===null)break}return null}function hy(n,o,r){if(o==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!r||(n=Pn(n.nextSibling),n===null))return null;return n}function Au(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState==="complete"}function fy(n,o){var r=n.ownerDocument;if(n.data!=="$?"||r.readyState==="complete")o();else{var h=function(){o(),r.removeEventListener("DOMContentLoaded",h)};r.addEventListener("DOMContentLoaded",h),n._reactRetry=h}}function Pn(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return n}var Ru=null;function Tm(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var r=n.data;if(r==="$"||r==="$!"||r==="$?"){if(o===0)return n;o--}else r==="/$"&&o++}n=n.previousSibling}return null}function Nm(n,o,r){switch(o=tr(r),n){case"html":if(n=o.documentElement,!n)throw Error(s(452));return n;case"head":if(n=o.head,!n)throw Error(s(453));return n;case"body":if(n=o.body,!n)throw Error(s(454));return n;default:throw Error(s(451))}}function kl(n){for(var o=n.attributes;o.length;)n.removeAttributeNode(o[0]);Io(n)}var wn=new Map,km=new Set;function nr(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var ci=S.d;S.d={f:my,r:py,D:gy,C:xy,L:yy,m:vy,X:Cy,S:by,M:Ty};function my(){var n=ci.f(),o=Ka();return n||o}function py(n){var o=mi(n);o!==null&&o.tag===5&&o.type==="form"?Bh(o):ci.r(n)}var ro=typeof document>"u"?null:document;function Sm(n,o,r){var h=ro;if(h&&typeof o=="string"&&o){var x=Qt(o);x='link[rel="'+n+'"][href="'+x+'"]',typeof r=="string"&&(x+='[crossorigin="'+r+'"]'),km.has(x)||(km.add(x),n={rel:n,crossOrigin:r,href:o},h.querySelector(x)===null&&(o=h.createElement("link"),zt(o,"link",n),Mt(o),h.head.appendChild(o)))}}function gy(n){ci.D(n),Sm("dns-prefetch",n,null)}function xy(n,o){ci.C(n,o),Sm("preconnect",n,o)}function yy(n,o,r){ci.L(n,o,r);var h=ro;if(h&&n&&o){var x='link[rel="preload"][as="'+Qt(o)+'"]';o==="image"&&r&&r.imageSrcSet?(x+='[imagesrcset="'+Qt(r.imageSrcSet)+'"]',typeof r.imageSizes=="string"&&(x+='[imagesizes="'+Qt(r.imageSizes)+'"]')):x+='[href="'+Qt(n)+'"]';var b=x;switch(o){case"style":b=co(n);break;case"script":b=uo(n)}wn.has(b)||(n=y({rel:"preload",href:o==="image"&&r&&r.imageSrcSet?void 0:n,as:o},r),wn.set(b,n),h.querySelector(x)!==null||o==="style"&&h.querySelector(Sl(b))||o==="script"&&h.querySelector(wl(b))||(o=h.createElement("link"),zt(o,"link",n),Mt(o),h.head.appendChild(o)))}}function vy(n,o){ci.m(n,o);var r=ro;if(r&&n){var h=o&&typeof o.as=="string"?o.as:"script",x='link[rel="modulepreload"][as="'+Qt(h)+'"][href="'+Qt(n)+'"]',b=x;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=uo(n)}if(!wn.has(b)&&(n=y({rel:"modulepreload",href:n},o),wn.set(b,n),r.querySelector(x)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(wl(b)))return}h=r.createElement("link"),zt(h,"link",n),Mt(h),r.head.appendChild(h)}}}function by(n,o,r){ci.S(n,o,r);var h=ro;if(h&&n){var x=pi(h).hoistableStyles,b=co(n);o=o||"default";var T=x.get(b);if(!T){var w={loading:0,preload:null};if(T=h.querySelector(Sl(b)))w.loading=5;else{n=y({rel:"stylesheet",href:n,"data-precedence":o},r),(r=wn.get(b))&&Iu(n,r);var U=T=h.createElement("link");Mt(U),zt(U,"link",n),U._p=new Promise(function(te,he){U.onload=te,U.onerror=he}),U.addEventListener("load",function(){w.loading|=1}),U.addEventListener("error",function(){w.loading|=2}),w.loading|=4,ir(T,o,h)}T={type:"stylesheet",instance:T,count:1,state:w},x.set(b,T)}}}function Cy(n,o){ci.X(n,o);var r=ro;if(r&&n){var h=pi(r).hoistableScripts,x=uo(n),b=h.get(x);b||(b=r.querySelector(wl(x)),b||(n=y({src:n,async:!0},o),(o=wn.get(x))&&_u(n,o),b=r.createElement("script"),Mt(b),zt(b,"link",n),r.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},h.set(x,b))}}function Ty(n,o){ci.M(n,o);var r=ro;if(r&&n){var h=pi(r).hoistableScripts,x=uo(n),b=h.get(x);b||(b=r.querySelector(wl(x)),b||(n=y({src:n,async:!0,type:"module"},o),(o=wn.get(x))&&_u(n,o),b=r.createElement("script"),Mt(b),zt(b,"link",n),r.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},h.set(x,b))}}function wm(n,o,r,h){var x=(x=M.current)?nr(x):null;if(!x)throw Error(s(446));switch(n){case"meta":case"title":return null;case"style":return typeof r.precedence=="string"&&typeof r.href=="string"?(o=co(r.href),r=pi(x).hoistableStyles,h=r.get(o),h||(h={type:"style",instance:null,count:0,state:null},r.set(o,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(r.rel==="stylesheet"&&typeof r.href=="string"&&typeof r.precedence=="string"){n=co(r.href);var b=pi(x).hoistableStyles,T=b.get(n);if(T||(x=x.ownerDocument||x,T={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(n,T),(b=x.querySelector(Sl(n)))&&!b._p&&(T.instance=b,T.state.loading=5),wn.has(n)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},wn.set(n,r),b||Ny(x,n,r,T.state))),o&&h===null)throw Error(s(528,""));return T}if(o&&h!==null)throw Error(s(529,""));return null;case"script":return o=r.async,r=r.src,typeof r=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=uo(r),r=pi(x).hoistableScripts,h=r.get(o),h||(h={type:"script",instance:null,count:0,state:null},r.set(o,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,n))}}function co(n){return'href="'+Qt(n)+'"'}function Sl(n){return'link[rel="stylesheet"]['+n+"]"}function Em(n){return y({},n,{"data-precedence":n.precedence,precedence:null})}function Ny(n,o,r,h){n.querySelector('link[rel="preload"][as="style"]['+o+"]")?h.loading=1:(o=n.createElement("link"),h.preload=o,o.addEventListener("load",function(){return h.loading|=1}),o.addEventListener("error",function(){return h.loading|=2}),zt(o,"link",r),Mt(o),n.head.appendChild(o))}function uo(n){return'[src="'+Qt(n)+'"]'}function wl(n){return"script[async]"+n}function Mm(n,o,r){if(o.count++,o.instance===null)switch(o.type){case"style":var h=n.querySelector('style[data-href~="'+Qt(r.href)+'"]');if(h)return o.instance=h,Mt(h),h;var x=y({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return h=(n.ownerDocument||n).createElement("style"),Mt(h),zt(h,"style",x),ir(h,r.precedence,n),o.instance=h;case"stylesheet":x=co(r.href);var b=n.querySelector(Sl(x));if(b)return o.state.loading|=4,o.instance=b,Mt(b),b;h=Em(r),(x=wn.get(x))&&Iu(h,x),b=(n.ownerDocument||n).createElement("link"),Mt(b);var T=b;return T._p=new Promise(function(w,U){T.onload=w,T.onerror=U}),zt(b,"link",h),o.state.loading|=4,ir(b,r.precedence,n),o.instance=b;case"script":return b=uo(r.src),(x=n.querySelector(wl(b)))?(o.instance=x,Mt(x),x):(h=r,(x=wn.get(b))&&(h=y({},r),_u(h,x)),n=n.ownerDocument||n,x=n.createElement("script"),Mt(x),zt(x,"link",h),n.head.appendChild(x),o.instance=x);case"void":return null;default:throw Error(s(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(h=o.instance,o.state.loading|=4,ir(h,r.precedence,n));return o.instance}function ir(n,o,r){for(var h=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=h.length?h[h.length-1]:null,b=x,T=0;T<h.length;T++){var w=h[T];if(w.dataset.precedence===o)b=w;else if(b!==x)break}b?b.parentNode.insertBefore(n,b.nextSibling):(o=r.nodeType===9?r.head:r,o.insertBefore(n,o.firstChild))}function Iu(n,o){n.crossOrigin==null&&(n.crossOrigin=o.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=o.referrerPolicy),n.title==null&&(n.title=o.title)}function _u(n,o){n.crossOrigin==null&&(n.crossOrigin=o.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=o.referrerPolicy),n.integrity==null&&(n.integrity=o.integrity)}var sr=null;function Am(n,o,r){if(sr===null){var h=new Map,x=sr=new Map;x.set(r,h)}else x=sr,h=x.get(r),h||(h=new Map,x.set(r,h));if(h.has(n))return h;for(h.set(n,null),r=r.getElementsByTagName(n),x=0;x<r.length;x++){var b=r[x];if(!(b[$i]||b[Dt]||n==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var T=b.getAttribute(o)||"";T=n+T;var w=h.get(T);w?w.push(b):h.set(T,[b])}}return h}function Rm(n,o,r){n=n.ownerDocument||n,n.head.insertBefore(r,o==="title"?n.querySelector("head > title"):null)}function ky(n,o,r){if(r===1||o.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return n=o.disabled,typeof o.precedence=="string"&&n==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function Im(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}var El=null;function Sy(){}function wy(n,o,r){if(El===null)throw Error(s(475));var h=El;if(o.type==="stylesheet"&&(typeof r.media!="string"||matchMedia(r.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var x=co(r.href),b=n.querySelector(Sl(x));if(b){n=b._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(h.count++,h=or.bind(h),n.then(h,h)),o.state.loading|=4,o.instance=b,Mt(b);return}b=n.ownerDocument||n,r=Em(r),(x=wn.get(x))&&Iu(r,x),b=b.createElement("link"),Mt(b);var T=b;T._p=new Promise(function(w,U){T.onload=w,T.onerror=U}),zt(b,"link",r),o.instance=b}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(o,n),(n=o.state.preload)&&(o.state.loading&3)===0&&(h.count++,o=or.bind(h),n.addEventListener("load",o),n.addEventListener("error",o))}}function Ey(){if(El===null)throw Error(s(475));var n=El;return n.stylesheets&&n.count===0&&Lu(n,n.stylesheets),0<n.count?function(o){var r=setTimeout(function(){if(n.stylesheets&&Lu(n,n.stylesheets),n.unsuspend){var h=n.unsuspend;n.unsuspend=null,h()}},6e4);return n.unsuspend=o,function(){n.unsuspend=null,clearTimeout(r)}}:null}function or(){if(this.count--,this.count===0){if(this.stylesheets)Lu(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var lr=null;function Lu(n,o){n.stylesheets=null,n.unsuspend!==null&&(n.count++,lr=new Map,o.forEach(My,n),lr=null,or.call(n))}function My(n,o){if(!(o.state.loading&4)){var r=lr.get(n);if(r)var h=r.get(null);else{r=new Map,lr.set(n,r);for(var x=n.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<x.length;b++){var T=x[b];(T.nodeName==="LINK"||T.getAttribute("media")!=="not all")&&(r.set(T.dataset.precedence,T),h=T)}h&&r.set(null,h)}x=o.instance,T=x.getAttribute("data-precedence"),b=r.get(T)||h,b===h&&r.set(null,x),r.set(T,x),this.count++,h=or.bind(this),x.addEventListener("load",h),x.addEventListener("error",h),b?b.parentNode.insertBefore(x,b.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(x,n.firstChild)),o.state.loading|=4}}var Ml={$$typeof:$,Provider:null,Consumer:null,_currentValue:V,_currentValue2:V,_threadCount:0};function Ay(n,o,r,h,x,b,T,w){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Eo(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Eo(0),this.hiddenUpdates=Eo(null),this.identifierPrefix=h,this.onUncaughtError=x,this.onCaughtError=b,this.onRecoverableError=T,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=w,this.incompleteTransitions=new Map}function _m(n,o,r,h,x,b,T,w,U,te,he,ge){return n=new Ay(n,o,r,T,w,U,te,ge),o=1,b===!0&&(o|=24),b=un(3,null,null,o),n.current=b,b.stateNode=n,o=mc(),o.refCount++,n.pooledCache=o,o.refCount++,b.memoizedState={element:h,isDehydrated:r,cache:o},yc(b),n}function Lm(n){return n?(n=Vs,n):Vs}function jm(n,o,r,h,x,b){x=Lm(x),h.context===null?h.context=x:h.pendingContext=x,h=bi(o),h.payload={element:r},b=b===void 0?null:b,b!==null&&(h.callback=b),r=Ci(n,h,o),r!==null&&(pn(r,n,o),sl(r,n,o))}function Dm(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var r=n.retryLane;n.retryLane=r!==0&&r<o?r:o}}function ju(n,o){Dm(n,o),(n=n.alternate)&&Dm(n,o)}function Pm(n){if(n.tag===13){var o=Gs(n,67108864);o!==null&&pn(o,n,67108864),ju(n,67108864)}}var ar=!0;function Ry(n,o,r,h){var x=k.T;k.T=null;var b=S.p;try{S.p=2,Du(n,o,r,h)}finally{S.p=b,k.T=x}}function Iy(n,o,r,h){var x=k.T;k.T=null;var b=S.p;try{S.p=8,Du(n,o,r,h)}finally{S.p=b,k.T=x}}function Du(n,o,r,h){if(ar){var x=Pu(h);if(x===null)Tu(n,o,h,rr,r),Hm(n,h);else if(Ly(x,n,o,r,h))h.stopPropagation();else if(Hm(n,h),o&4&&-1<_y.indexOf(n)){for(;x!==null;){var b=mi(x);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var T=Ot(b.pendingLanes);if(T!==0){var w=b;for(w.pendingLanes|=2,w.entangledLanes|=2;T;){var U=1<<31-Ke(T);w.entanglements[1]|=U,T&=~U}qn(b),(at&6)===0&&(za=Se()+500,Cl(0))}}break;case 13:w=Gs(b,2),w!==null&&pn(w,b,2),Ka(),ju(b,2)}if(b=Pu(h),b===null&&Tu(n,o,h,rr,r),b===x)break;x=b}x!==null&&h.stopPropagation()}else Tu(n,o,h,null,r)}}function Pu(n){return n=Xi(n),Uu(n)}var rr=null;function Uu(n){if(rr=null,n=fi(n),n!==null){var o=u(n);if(o===null)n=null;else{var r=o.tag;if(r===13){if(n=f(o),n!==null)return n;n=null}else if(r===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null)}}return rr=n,null}function Um(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ce()){case _e:return 2;case gt:return 8;case Fe:case Q:return 32;case ve:return 268435456;default:return 32}default:return 32}}var Hu=!1,ji=null,Di=null,Pi=null,Al=new Map,Rl=new Map,Ui=[],_y="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Hm(n,o){switch(n){case"focusin":case"focusout":ji=null;break;case"dragenter":case"dragleave":Di=null;break;case"mouseover":case"mouseout":Pi=null;break;case"pointerover":case"pointerout":Al.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rl.delete(o.pointerId)}}function Il(n,o,r,h,x,b){return n===null||n.nativeEvent!==b?(n={blockedOn:o,domEventName:r,eventSystemFlags:h,nativeEvent:b,targetContainers:[x]},o!==null&&(o=mi(o),o!==null&&Pm(o)),n):(n.eventSystemFlags|=h,o=n.targetContainers,x!==null&&o.indexOf(x)===-1&&o.push(x),n)}function Ly(n,o,r,h,x){switch(o){case"focusin":return ji=Il(ji,n,o,r,h,x),!0;case"dragenter":return Di=Il(Di,n,o,r,h,x),!0;case"mouseover":return Pi=Il(Pi,n,o,r,h,x),!0;case"pointerover":var b=x.pointerId;return Al.set(b,Il(Al.get(b)||null,n,o,r,h,x)),!0;case"gotpointercapture":return b=x.pointerId,Rl.set(b,Il(Rl.get(b)||null,n,o,r,h,x)),!0}return!1}function Om(n){var o=fi(n.target);if(o!==null){var r=u(o);if(r!==null){if(o=r.tag,o===13){if(o=f(r),o!==null){n.blockedOn=o,Hr(n.priority,function(){if(r.tag===13){var h=mn();h=Mo(h);var x=Gs(r,h);x!==null&&pn(x,r,h),ju(r,h)}});return}}else if(o===3&&r.stateNode.current.memoizedState.isDehydrated){n.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}n.blockedOn=null}function cr(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var r=Pu(n.nativeEvent);if(r===null){r=n.nativeEvent;var h=new r.constructor(r.type,r);As=h,r.target.dispatchEvent(h),As=null}else return o=mi(r),o!==null&&Pm(o),n.blockedOn=r,!1;o.shift()}return!0}function Gm(n,o,r){cr(n)&&r.delete(o)}function jy(){Hu=!1,ji!==null&&cr(ji)&&(ji=null),Di!==null&&cr(Di)&&(Di=null),Pi!==null&&cr(Pi)&&(Pi=null),Al.forEach(Gm),Rl.forEach(Gm)}function ur(n,o){n.blockedOn===o&&(n.blockedOn=null,Hu||(Hu=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,jy)))}var dr=null;function Vm(n){dr!==n&&(dr=n,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){dr===n&&(dr=null);for(var o=0;o<n.length;o+=3){var r=n[o],h=n[o+1],x=n[o+2];if(typeof h!="function"){if(Uu(h||r)===null)continue;break}var b=mi(r);b!==null&&(n.splice(o,3),o-=3,Uc(b,{pending:!0,data:x,method:r.method,action:h},h,x))}}))}function _l(n){function o(U){return ur(U,n)}ji!==null&&ur(ji,n),Di!==null&&ur(Di,n),Pi!==null&&ur(Pi,n),Al.forEach(o),Rl.forEach(o);for(var r=0;r<Ui.length;r++){var h=Ui[r];h.blockedOn===n&&(h.blockedOn=null)}for(;0<Ui.length&&(r=Ui[0],r.blockedOn===null);)Om(r),r.blockedOn===null&&Ui.shift();if(r=(n.ownerDocument||n).$$reactFormReplay,r!=null)for(h=0;h<r.length;h+=3){var x=r[h],b=r[h+1],T=x[Yt]||null;if(typeof b=="function")T||Vm(r);else if(T){var w=null;if(b&&b.hasAttribute("formAction")){if(x=b,T=b[Yt]||null)w=T.formAction;else if(Uu(x)!==null)continue}else w=T.action;typeof w=="function"?r[h+1]=w:(r.splice(h,3),h-=3),Vm(r)}}}function Ou(n){this._internalRoot=n}hr.prototype.render=Ou.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error(s(409));var r=o.current,h=mn();jm(r,h,n,o,null,null)},hr.prototype.unmount=Ou.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var o=n.containerInfo;jm(n.current,2,null,n,null,null),Ka(),o[hi]=null}};function hr(n){this._internalRoot=n}hr.prototype.unstable_scheduleHydration=function(n){if(n){var o=Jl();n={blockedOn:null,target:n,priority:o};for(var r=0;r<Ui.length&&o!==0&&o<Ui[r].priority;r++);Ui.splice(r,0,n),r===0&&Om(n)}};var $m=e.version;if($m!=="19.1.0")throw Error(s(527,$m,"19.1.0"));S.findDOMNode=function(n){var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error(s(188)):(n=Object.keys(n).join(","),Error(s(268,n)));return n=g(o),n=n!==null?m(n):null,n=n===null?null:n.stateNode,n};var Dy={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fr.isDisabled&&fr.supportsFiber)try{De=fr.inject(Dy),qe=fr}catch{}}return jl.createRoot=function(n,o){if(!a(n))throw Error(s(299));var r=!1,h="",x=sf,b=of,T=lf,w=null;return o!=null&&(o.unstable_strictMode===!0&&(r=!0),o.identifierPrefix!==void 0&&(h=o.identifierPrefix),o.onUncaughtError!==void 0&&(x=o.onUncaughtError),o.onCaughtError!==void 0&&(b=o.onCaughtError),o.onRecoverableError!==void 0&&(T=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(w=o.unstable_transitionCallbacks)),o=_m(n,1,!1,null,null,r,h,x,b,T,w,null),n[hi]=o.current,Cu(n),new Ou(o)},jl.hydrateRoot=function(n,o,r){if(!a(n))throw Error(s(299));var h=!1,x="",b=sf,T=of,w=lf,U=null,te=null;return r!=null&&(r.unstable_strictMode===!0&&(h=!0),r.identifierPrefix!==void 0&&(x=r.identifierPrefix),r.onUncaughtError!==void 0&&(b=r.onUncaughtError),r.onCaughtError!==void 0&&(T=r.onCaughtError),r.onRecoverableError!==void 0&&(w=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(U=r.unstable_transitionCallbacks),r.formState!==void 0&&(te=r.formState)),o=_m(n,1,!0,o,r??null,h,x,b,T,w,U,te),o.context=Lm(null),r=o.current,h=mn(),h=Mo(h),x=bi(h),x.callback=null,Ci(r,x,h),r=h,o.current.lanes=r,Vi(o,r),qn(o),n[hi]=o.current,Cu(n),new hr(o)},jl.version="19.1.0",jl}var Wm;function qy(){if(Wm)return $u.exports;Wm=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),$u.exports=By(),$u.exports}var zy=qy();const Fy=jg(zy);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Ky,Yy;function Jy(){return{geminiUrl:Ky,vertexUrl:Yy}}function Qy(t,e,i){var s,a,u;if(!(!((s=t.httpOptions)===null||s===void 0)&&s.baseUrl)){const f=Jy();return t.vertexai?(a=f.vertexUrl)!==null&&a!==void 0?a:e:(u=f.geminiUrl)!==null&&u!==void 0?u:i}return t.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ts{}function Le(t,e){const i=/\{([^}]+)\}/g;return t.replace(i,(s,a)=>{if(Object.prototype.hasOwnProperty.call(e,a)){const u=e[a];return u!=null?String(u):""}else throw new Error(`Key '${a}' not found in valueMap.`)})}function d(t,e,i){for(let u=0;u<e.length-1;u++){const f=e[u];if(f.endsWith("[]")){const p=f.slice(0,-2);if(!(p in t))if(Array.isArray(i))t[p]=Array.from({length:i.length},()=>({}));else throw new Error(`Value must be a list given an array path ${f}`);if(Array.isArray(t[p])){const g=t[p];if(Array.isArray(i))for(let m=0;m<g.length;m++){const y=g[m];d(y,e.slice(u+1),i[m])}else for(const m of g)d(m,e.slice(u+1),i)}return}else if(f.endsWith("[0]")){const p=f.slice(0,-3);p in t||(t[p]=[{}]);const g=t[p];d(g[0],e.slice(u+1),i);return}(!t[f]||typeof t[f]!="object")&&(t[f]={}),t=t[f]}const s=e[e.length-1],a=t[s];if(a!==void 0){if(!i||typeof i=="object"&&Object.keys(i).length===0||i===a)return;if(typeof a=="object"&&typeof i=="object"&&a!==null&&i!==null)Object.assign(a,i);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else t[s]=i}function c(t,e){try{if(e.length===1&&e[0]==="_self")return t;for(let i=0;i<e.length;i++){if(typeof t!="object"||t===null)return;const s=e[i];if(s.endsWith("[]")){const a=s.slice(0,-2);if(a in t){const u=t[a];return Array.isArray(u)?u.map(f=>c(f,e.slice(i+1))):void 0}else return}else t=t[s]}return t}catch(i){if(i instanceof TypeError)return;throw i}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Zm;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Zm||(Zm={}));var ep;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(ep||(ep={}));var _t;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(_t||(_t={}));var tp;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(tp||(tp={}));var np;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(np||(np={}));var ip;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(ip||(ip={}));var sp;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(sp||(sp={}));var op;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(op||(op={}));var lp;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(lp||(lp={}));var ap;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(ap||(ap={}));var rp;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(rp||(rp={}));var cp;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(cp||(cp={}));var up;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(up||(up={}));var dp;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(dp||(dp={}));var hp;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY"})(hp||(hp={}));var fp;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(fp||(fp={}));var Tr;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Tr||(Tr={}));var mp;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(mp||(mp={}));var Yu;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Yu||(Yu={}));var pp;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(pp||(pp={}));var gp;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(gp||(gp={}));var xp;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(xp||(xp={}));var yp;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(yp||(yp={}));var vp;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(vp||(vp={}));var bp;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(bp||(bp={}));var Cp;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(Cp||(Cp={}));var Tp;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(Tp||(Tp={}));var Np;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Np||(Np={}));var kp;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(kp||(kp={}));var Sp;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Sp||(Sp={}));var wp;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(wp||(wp={}));var Ep;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(Ep||(Ep={}));var Mp;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(Mp||(Mp={}));var Ap;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(Ap||(Ap={}));var Rp;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(Rp||(Rp={}));var Ip;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Ip||(Ip={}));var _p;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(_p||(_p={}));var Lp;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Lp||(Lp={}));var jp;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(jp||(jp={}));var Dp;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(Dp||(Dp={}));var Pp;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Pp||(Pp={}));var fo;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(fo||(fo={}));class Ju{constructor(e){const i={};for(const s of e.headers.entries())i[s[0]]=s[1];this.headers=i,this.responseInternal=e}json(){return this.responseInternal.json()}}class Dl{get text(){var e,i,s,a,u,f,p,g;if(((a=(s=(i=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||i===void 0?void 0:i.content)===null||s===void 0?void 0:s.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let m="",y=!1;const v=[];for(const C of(g=(p=(f=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.content)===null||p===void 0?void 0:p.parts)!==null&&g!==void 0?g:[]){for(const[N,R]of Object.entries(C))N!=="text"&&N!=="thought"&&(R!==null||R!==void 0)&&v.push(N);if(typeof C.text=="string"){if(typeof C.thought=="boolean"&&C.thought)continue;y=!0,m+=C.text}}return v.length>0&&console.warn(`there are non-text parts ${v} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),y?m:void 0}get data(){var e,i,s,a,u,f,p,g;if(((a=(s=(i=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||i===void 0?void 0:i.content)===null||s===void 0?void 0:s.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let m="";const y=[];for(const v of(g=(p=(f=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.content)===null||p===void 0?void 0:p.parts)!==null&&g!==void 0?g:[]){for(const[C,N]of Object.entries(v))C!=="inlineData"&&(N!==null||N!==void 0)&&y.push(C);v.inlineData&&typeof v.inlineData.data=="string"&&(m+=atob(v.inlineData.data))}return y.length>0&&console.warn(`there are non-data parts ${y} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),m.length>0?btoa(m):void 0}get functionCalls(){var e,i,s,a,u,f,p,g;if(((a=(s=(i=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||i===void 0?void 0:i.content)===null||s===void 0?void 0:s.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const m=(g=(p=(f=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.content)===null||p===void 0?void 0:p.parts)===null||g===void 0?void 0:g.filter(y=>y.functionCall).map(y=>y.functionCall).filter(y=>y!==void 0);if((m==null?void 0:m.length)!==0)return m}get executableCode(){var e,i,s,a,u,f,p,g,m;if(((a=(s=(i=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||i===void 0?void 0:i.content)===null||s===void 0?void 0:s.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const y=(g=(p=(f=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.content)===null||p===void 0?void 0:p.parts)===null||g===void 0?void 0:g.filter(v=>v.executableCode).map(v=>v.executableCode).filter(v=>v!==void 0);if((y==null?void 0:y.length)!==0)return(m=y==null?void 0:y[0])===null||m===void 0?void 0:m.code}get codeExecutionResult(){var e,i,s,a,u,f,p,g,m;if(((a=(s=(i=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||i===void 0?void 0:i.content)===null||s===void 0?void 0:s.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const y=(g=(p=(f=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.content)===null||p===void 0?void 0:p.parts)===null||g===void 0?void 0:g.filter(v=>v.codeExecutionResult).map(v=>v.codeExecutionResult).filter(v=>v!==void 0);if((y==null?void 0:y.length)!==0)return(m=y==null?void 0:y[0])===null||m===void 0?void 0:m.output}}class Up{}class Hp{}class Xy{}class Wy{}class Op{}class Gp{}class Vp{}class Zy{}class $p{}class Bp{}class qp{}class ev{}class tv{}class nv{}class zp{}class iv{get text(){var e,i,s;let a="",u=!1;const f=[];for(const p of(s=(i=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||i===void 0?void 0:i.parts)!==null&&s!==void 0?s:[]){for(const[g,m]of Object.entries(p))g!=="text"&&g!=="thought"&&m!==null&&f.push(g);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;u=!0,a+=p.text}}return f.length>0&&console.warn(`there are non-text parts ${f} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?a:void 0}get data(){var e,i,s;let a="";const u=[];for(const f of(s=(i=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||i===void 0?void 0:i.parts)!==null&&s!==void 0?s:[]){for(const[p,g]of Object.entries(f))p!=="inlineData"&&g!==null&&u.push(p);f.inlineData&&typeof f.inlineData.data=="string"&&(a+=atob(f.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}}class sv{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ut(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const i=e.split("/",2);return`publishers/${i[0]}/models/${i[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Pg(t,e){const i=ut(t,e);return i?i.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${i}`:i.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${i}`:i:""}function Ug(t){return Array.isArray(t)?t.map(e=>Nr(e)):[Nr(t)]}function Nr(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function Hg(t){const e=Nr(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Og(t){const e=Nr(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Fp(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Gg(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Fp(e)):[Fp(t)]}function Qu(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function Kp(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function Yp(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function en(t){if(t==null)throw new Error("ContentUnion is required");return Qu(t)?t:{role:"user",parts:Gg(t)}}function Vg(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(i=>{const s=en(i);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(t.isVertexAI()){const i=en(e);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]}return Array.isArray(e)?e.map(i=>en(i)):[en(e)]}function En(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(Kp(t)||Yp(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[en(t)]}const e=[],i=[],s=Qu(t[0]);for(const a of t){const u=Qu(a);if(u!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(u)e.push(a);else{if(Kp(a)||Yp(a))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");i.push(a)}}return s||e.push({role:"user",parts:Gg(i)}),e}function ov(t,e){t.includes("null")&&(e.nullable=!0);const i=t.filter(s=>s!=="null");if(i.length===1)e.type=Object.values(_t).includes(i[0].toUpperCase())?i[0].toUpperCase():_t.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of i)e.anyOf.push({type:Object.values(_t).includes(s.toUpperCase())?s.toUpperCase():_t.TYPE_UNSPECIFIED})}}function go(t){const e={},i=["items"],s=["anyOf"],a=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const u=t.anyOf;u!=null&&u.length==2&&(u[0].type==="null"?(e.nullable=!0,t=u[1]):u[1].type==="null"&&(e.nullable=!0,t=u[0])),t.type instanceof Array&&ov(t.type,e);for(const[f,p]of Object.entries(t))if(p!=null)if(f=="type"){if(p==="null")throw new Error("type: null can not be the only possible type for the field.");if(p instanceof Array)continue;e.type=Object.values(_t).includes(p.toUpperCase())?p.toUpperCase():_t.TYPE_UNSPECIFIED}else if(i.includes(f))e[f]=go(p);else if(s.includes(f)){const g=[];for(const m of p){if(m.type=="null"){e.nullable=!0;continue}g.push(go(m))}e[f]=g}else if(a.includes(f)){const g={};for(const[m,y]of Object.entries(p))g[m]=go(y);e[f]=g}else{if(f==="additionalProperties")continue;e[f]=p}return e}function ud(t){return go(t)}function dd(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function hd(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function To(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=go(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=go(e.response));return t}function No(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const i of t)e.push(i);return e}function lv(t,e,i,s=1){const a=!e.startsWith(`${i}/`)&&e.split("/").length===s;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${i}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:a?`projects/${t.getProject()}/locations/${t.getLocation()}/${i}/${e}`:e:a?`${i}/${e}`:e}function ui(t,e){if(typeof e!="string")throw new Error("name must be a string");return lv(t,e,"cachedContents")}function $g(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function di(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function av(t){return t!=null&&typeof t=="object"&&"name"in t}function rv(t){return t!=null&&typeof t=="object"&&"video"in t}function cv(t){return t!=null&&typeof t=="object"&&"uri"in t}function Bg(t){var e;let i;if(av(t)&&(i=t.name),!(cv(t)&&(i=t.uri,i===void 0))&&!(rv(t)&&(i=(e=t.video)===null||e===void 0?void 0:e.uri,i===void 0))){if(typeof t=="string"&&(i=t),i===void 0)throw new Error("Could not extract file name from the provided input.");if(i.startsWith("https://")){const a=i.split("files/")[1].match(/[a-z0-9]+/);if(a===null)throw new Error(`Could not extract file name from URI ${i}`);i=a[0]}else i.startsWith("files/")&&(i=i.split("files/")[1]);return i}}function qg(t,e){let i;return t.isVertexAI()?i=e?"publishers/google/models":"models":i=e?"models":"tunedModels",i}function zg(t){for(const e of["models","tunedModels","publisherModels"])if(uv(t,e))return t[e];return[]}function uv(t,e){return t!==null&&typeof t=="object"&&e in t}function dv(t,e={}){const i=t,s={name:i.name,description:i.description,parametersJsonSchema:i.inputSchema};return e.behavior&&(s.behavior=e.behavior),{functionDeclarations:[s]}}function hv(t,e={}){const i=[],s=new Set;for(const a of t){const u=a.name;if(s.has(u))throw new Error(`Duplicate function name ${u} found in MCP tools. Please ensure function names are unique.`);s.add(u);const f=dv(a,e);f.functionDeclarations&&i.push(...f.functionDeclarations)}return{functionDeclarations:i}}function Fg(t,e){if(typeof e!="string"&&!Array.isArray(e)){if(t&&t.isVertexAI()){if(e.gcsUri&&e.bigqueryUri)throw new Error("Only one of `gcsUri` or `bigqueryUri` can be set.");if(!e.gcsUri&&!e.bigqueryUri)throw new Error("One of `gcsUri` or `bigqueryUri` must be set.")}else{if(e.inlinedRequests&&e.fileName)throw new Error("Only one of `inlinedRequests` or `fileName` can be set.");if(!e.inlinedRequests&&!e.fileName)throw new Error("One of `inlinedRequests` or `fileName` must be set.")}return e}else{if(Array.isArray(e))return{inlinedRequests:e};if(typeof e=="string"){if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:[e]};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};if(e.startsWith("files/"))return{fileName:e}}}throw new Error(`Unsupported source: ${e}`)}function fv(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function ko(t,e){const i=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(i))return i.split("/").pop();throw new Error(`Invalid batch job name: ${i}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(i))return i.split("/").pop();if(/^\d+$/.test(i))return i;throw new Error(`Invalid batch job name: ${i}.`)}function Kg(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mv(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function pv(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(t,["data"]);i!=null&&d(e,["data"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function gv(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(t,["fileUri"]);i!=null&&d(e,["fileUri"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function xv(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],mv(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],pv(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],gv(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function Yg(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>xv(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function yv(t){const e={},i=c(t,["anyOf"]);i!=null&&d(e,["anyOf"],i);const s=c(t,["default"]);s!=null&&d(e,["default"],s);const a=c(t,["description"]);a!=null&&d(e,["description"],a);const u=c(t,["enum"]);u!=null&&d(e,["enum"],u);const f=c(t,["example"]);f!=null&&d(e,["example"],f);const p=c(t,["format"]);p!=null&&d(e,["format"],p);const g=c(t,["items"]);g!=null&&d(e,["items"],g);const m=c(t,["maxItems"]);m!=null&&d(e,["maxItems"],m);const y=c(t,["maxLength"]);y!=null&&d(e,["maxLength"],y);const v=c(t,["maxProperties"]);v!=null&&d(e,["maxProperties"],v);const C=c(t,["maximum"]);C!=null&&d(e,["maximum"],C);const N=c(t,["minItems"]);N!=null&&d(e,["minItems"],N);const R=c(t,["minLength"]);R!=null&&d(e,["minLength"],R);const L=c(t,["minProperties"]);L!=null&&d(e,["minProperties"],L);const O=c(t,["minimum"]);O!=null&&d(e,["minimum"],O);const J=c(t,["nullable"]);J!=null&&d(e,["nullable"],J);const P=c(t,["pattern"]);P!=null&&d(e,["pattern"],P);const $=c(t,["properties"]);$!=null&&d(e,["properties"],$);const ne=c(t,["propertyOrdering"]);ne!=null&&d(e,["propertyOrdering"],ne);const z=c(t,["required"]);z!=null&&d(e,["required"],z);const ae=c(t,["title"]);ae!=null&&d(e,["title"],ae);const de=c(t,["type"]);return de!=null&&d(e,["type"],de),e}function vv(t){const e={};if(c(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=c(t,["category"]);i!=null&&d(e,["category"],i);const s=c(t,["threshold"]);return s!=null&&d(e,["threshold"],s),e}function bv(t){const e={},i=c(t,["behavior"]);i!=null&&d(e,["behavior"],i);const s=c(t,["description"]);s!=null&&d(e,["description"],s);const a=c(t,["name"]);a!=null&&d(e,["name"],a);const u=c(t,["parameters"]);u!=null&&d(e,["parameters"],u);const f=c(t,["parametersJsonSchema"]);f!=null&&d(e,["parametersJsonSchema"],f);const p=c(t,["response"]);p!=null&&d(e,["response"],p);const g=c(t,["responseJsonSchema"]);return g!=null&&d(e,["responseJsonSchema"],g),e}function Cv(t){const e={},i=c(t,["startTime"]);i!=null&&d(e,["startTime"],i);const s=c(t,["endTime"]);return s!=null&&d(e,["endTime"],s),e}function Tv(t){const e={},i=c(t,["timeRangeFilter"]);return i!=null&&d(e,["timeRangeFilter"],Cv(i)),e}function Nv(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["dynamicThreshold"]);return s!=null&&d(e,["dynamicThreshold"],s),e}function kv(t){const e={},i=c(t,["dynamicRetrievalConfig"]);return i!=null&&d(e,["dynamicRetrievalConfig"],Nv(i)),e}function Sv(){return{}}function wv(t){const e={},i=c(t,["functionDeclarations"]);if(i!=null){let g=i;Array.isArray(g)&&(g=g.map(m=>bv(m))),d(e,["functionDeclarations"],g)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=c(t,["googleSearch"]);s!=null&&d(e,["googleSearch"],Tv(s));const a=c(t,["googleSearchRetrieval"]);if(a!=null&&d(e,["googleSearchRetrieval"],kv(a)),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(c(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");c(t,["urlContext"])!=null&&d(e,["urlContext"],Sv());const f=c(t,["codeExecution"]);f!=null&&d(e,["codeExecution"],f);const p=c(t,["computerUse"]);return p!=null&&d(e,["computerUse"],p),e}function Ev(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["allowedFunctionNames"]);return s!=null&&d(e,["allowedFunctionNames"],s),e}function Mv(t){const e={},i=c(t,["latitude"]);i!=null&&d(e,["latitude"],i);const s=c(t,["longitude"]);return s!=null&&d(e,["longitude"],s),e}function Av(t){const e={},i=c(t,["latLng"]);i!=null&&d(e,["latLng"],Mv(i));const s=c(t,["languageCode"]);return s!=null&&d(e,["languageCode"],s),e}function Rv(t){const e={},i=c(t,["functionCallingConfig"]);i!=null&&d(e,["functionCallingConfig"],Ev(i));const s=c(t,["retrievalConfig"]);return s!=null&&d(e,["retrievalConfig"],Av(s)),e}function Iv(t){const e={},i=c(t,["voiceName"]);return i!=null&&d(e,["voiceName"],i),e}function Jg(t){const e={},i=c(t,["prebuiltVoiceConfig"]);return i!=null&&d(e,["prebuiltVoiceConfig"],Iv(i)),e}function _v(t){const e={},i=c(t,["speaker"]);i!=null&&d(e,["speaker"],i);const s=c(t,["voiceConfig"]);return s!=null&&d(e,["voiceConfig"],Jg(s)),e}function Lv(t){const e={},i=c(t,["speakerVoiceConfigs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>_v(a))),d(e,["speakerVoiceConfigs"],s)}return e}function jv(t){const e={},i=c(t,["voiceConfig"]);i!=null&&d(e,["voiceConfig"],Jg(i));const s=c(t,["multiSpeakerVoiceConfig"]);s!=null&&d(e,["multiSpeakerVoiceConfig"],Lv(s));const a=c(t,["languageCode"]);return a!=null&&d(e,["languageCode"],a),e}function Dv(t){const e={},i=c(t,["includeThoughts"]);i!=null&&d(e,["includeThoughts"],i);const s=c(t,["thinkingBudget"]);return s!=null&&d(e,["thinkingBudget"],s),e}function Pv(t,e,i){const s={},a=c(e,["systemInstruction"]);i!==void 0&&a!=null&&d(i,["systemInstruction"],Yg(en(a)));const u=c(e,["temperature"]);u!=null&&d(s,["temperature"],u);const f=c(e,["topP"]);f!=null&&d(s,["topP"],f);const p=c(e,["topK"]);p!=null&&d(s,["topK"],p);const g=c(e,["candidateCount"]);g!=null&&d(s,["candidateCount"],g);const m=c(e,["maxOutputTokens"]);m!=null&&d(s,["maxOutputTokens"],m);const y=c(e,["stopSequences"]);y!=null&&d(s,["stopSequences"],y);const v=c(e,["responseLogprobs"]);v!=null&&d(s,["responseLogprobs"],v);const C=c(e,["logprobs"]);C!=null&&d(s,["logprobs"],C);const N=c(e,["presencePenalty"]);N!=null&&d(s,["presencePenalty"],N);const R=c(e,["frequencyPenalty"]);R!=null&&d(s,["frequencyPenalty"],R);const L=c(e,["seed"]);L!=null&&d(s,["seed"],L);const O=c(e,["responseMimeType"]);O!=null&&d(s,["responseMimeType"],O);const J=c(e,["responseSchema"]);J!=null&&d(s,["responseSchema"],yv(ud(J)));const P=c(e,["responseJsonSchema"]);if(P!=null&&d(s,["responseJsonSchema"],P),c(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(c(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const $=c(e,["safetySettings"]);if(i!==void 0&&$!=null){let _=$;Array.isArray(_)&&(_=_.map(me=>vv(me))),d(i,["safetySettings"],_)}const ne=c(e,["tools"]);if(i!==void 0&&ne!=null){let _=No(ne);Array.isArray(_)&&(_=_.map(me=>wv(To(me)))),d(i,["tools"],_)}const z=c(e,["toolConfig"]);if(i!==void 0&&z!=null&&d(i,["toolConfig"],Rv(z)),c(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const ae=c(e,["cachedContent"]);i!==void 0&&ae!=null&&d(i,["cachedContent"],ui(t,ae));const de=c(e,["responseModalities"]);de!=null&&d(s,["responseModalities"],de);const re=c(e,["mediaResolution"]);re!=null&&d(s,["mediaResolution"],re);const se=c(e,["speechConfig"]);if(se!=null&&d(s,["speechConfig"],jv(dd(se))),c(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const oe=c(e,["thinkingConfig"]);return oe!=null&&d(s,["thinkingConfig"],Dv(oe)),s}function Uv(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["request","model"],ut(t,s));const a=c(e,["contents"]);if(a!=null){let f=En(a);Array.isArray(f)&&(f=f.map(p=>Yg(p))),d(i,["request","contents"],f)}const u=c(e,["config"]);return u!=null&&d(i,["request","generationConfig"],Pv(t,u,i)),i}function Hv(t,e){const i={};if(c(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(c(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(c(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=c(e,["fileName"]);s!=null&&d(i,["fileName"],s);const a=c(e,["inlinedRequests"]);if(a!=null){let u=a;Array.isArray(u)&&(u=u.map(f=>Uv(t,f))),d(i,["requests","requests"],u)}return i}function Ov(t,e){const i={},s=c(t,["displayName"]);if(e!==void 0&&s!=null&&d(e,["batch","displayName"],s),c(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return i}function Gv(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["src"]);a!=null&&d(i,["batch","inputConfig"],Hv(t,Fg(t,a)));const u=c(e,["config"]);return u!=null&&d(i,["config"],Ov(u,i)),i}function Vv(t,e){const i={},s=c(e,["name"]);s!=null&&d(i,["_url","name"],ko(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function $v(t,e){const i={},s=c(e,["name"]);s!=null&&d(i,["_url","name"],ko(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function Bv(t,e){const i={},s=c(t,["pageSize"]);e!==void 0&&s!=null&&d(e,["_query","pageSize"],s);const a=c(t,["pageToken"]);if(e!==void 0&&a!=null&&d(e,["_query","pageToken"],a),c(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return i}function qv(t){const e={},i=c(t,["config"]);return i!=null&&d(e,["config"],Bv(i,e)),e}function zv(t,e){const i={},s=c(e,["name"]);s!=null&&d(i,["_url","name"],ko(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function Fv(t){const e={},i=c(t,["format"]);i!=null&&d(e,["instancesFormat"],i);const s=c(t,["gcsUri"]);s!=null&&d(e,["gcsSource","uris"],s);const a=c(t,["bigqueryUri"]);if(a!=null&&d(e,["bigquerySource","inputUri"],a),c(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(c(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function Kv(t){const e={},i=c(t,["format"]);i!=null&&d(e,["predictionsFormat"],i);const s=c(t,["gcsUri"]);s!=null&&d(e,["gcsDestination","outputUriPrefix"],s);const a=c(t,["bigqueryUri"]);if(a!=null&&d(e,["bigqueryDestination","outputUri"],a),c(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(c(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");return e}function Yv(t,e){const i={},s=c(t,["displayName"]);e!==void 0&&s!=null&&d(e,["displayName"],s);const a=c(t,["dest"]);return e!==void 0&&a!=null&&d(e,["outputConfig"],Kv(fv(a))),i}function Jv(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["model"],ut(t,s));const a=c(e,["src"]);a!=null&&d(i,["inputConfig"],Fv(Fg(t,a)));const u=c(e,["config"]);return u!=null&&d(i,["config"],Yv(u,i)),i}function Qv(t,e){const i={},s=c(e,["name"]);s!=null&&d(i,["_url","name"],ko(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function Xv(t,e){const i={},s=c(e,["name"]);s!=null&&d(i,["_url","name"],ko(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function Wv(t,e){const i={},s=c(t,["pageSize"]);e!==void 0&&s!=null&&d(e,["_query","pageSize"],s);const a=c(t,["pageToken"]);e!==void 0&&a!=null&&d(e,["_query","pageToken"],a);const u=c(t,["filter"]);return e!==void 0&&u!=null&&d(e,["_query","filter"],u),i}function Zv(t){const e={},i=c(t,["config"]);return i!=null&&d(e,["config"],Wv(i,e)),e}function eb(t,e){const i={},s=c(e,["name"]);s!=null&&d(i,["_url","name"],ko(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function tb(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function nb(t){const e={},i=c(t,["data"]);i!=null&&d(e,["data"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function ib(t){const e={},i=c(t,["fileUri"]);i!=null&&d(e,["fileUri"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function sb(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],tb(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],nb(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],ib(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function ob(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>sb(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function lb(t){const e={},i=c(t,["citationSources"]);return i!=null&&d(e,["citations"],i),e}function ab(t){const e={},i=c(t,["retrievedUrl"]);i!=null&&d(e,["retrievedUrl"],i);const s=c(t,["urlRetrievalStatus"]);return s!=null&&d(e,["urlRetrievalStatus"],s),e}function rb(t){const e={},i=c(t,["urlMetadata"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>ab(a))),d(e,["urlMetadata"],s)}return e}function cb(t){const e={},i=c(t,["content"]);i!=null&&d(e,["content"],ob(i));const s=c(t,["citationMetadata"]);s!=null&&d(e,["citationMetadata"],lb(s));const a=c(t,["tokenCount"]);a!=null&&d(e,["tokenCount"],a);const u=c(t,["finishReason"]);u!=null&&d(e,["finishReason"],u);const f=c(t,["urlContextMetadata"]);f!=null&&d(e,["urlContextMetadata"],rb(f));const p=c(t,["avgLogprobs"]);p!=null&&d(e,["avgLogprobs"],p);const g=c(t,["groundingMetadata"]);g!=null&&d(e,["groundingMetadata"],g);const m=c(t,["index"]);m!=null&&d(e,["index"],m);const y=c(t,["logprobsResult"]);y!=null&&d(e,["logprobsResult"],y);const v=c(t,["safetyRatings"]);return v!=null&&d(e,["safetyRatings"],v),e}function ub(t){const e={},i=c(t,["sdkHttpResponse"]);i!=null&&d(e,["sdkHttpResponse"],i);const s=c(t,["candidates"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(g=>cb(g))),d(e,["candidates"],p)}const a=c(t,["modelVersion"]);a!=null&&d(e,["modelVersion"],a);const u=c(t,["promptFeedback"]);u!=null&&d(e,["promptFeedback"],u);const f=c(t,["usageMetadata"]);return f!=null&&d(e,["usageMetadata"],f),e}function Qg(t){const e={},i=c(t,["details"]);i!=null&&d(e,["details"],i);const s=c(t,["code"]);s!=null&&d(e,["code"],s);const a=c(t,["message"]);return a!=null&&d(e,["message"],a),e}function db(t){const e={},i=c(t,["response"]);i!=null&&d(e,["response"],ub(i));const s=c(t,["error"]);return s!=null&&d(e,["error"],Qg(s)),e}function hb(t){const e={},i=c(t,["responsesFile"]);i!=null&&d(e,["fileName"],i);const s=c(t,["inlinedResponses","inlinedResponses"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(u=>db(u))),d(e,["inlinedResponses"],a)}return e}function Xu(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["metadata","displayName"]);s!=null&&d(e,["displayName"],s);const a=c(t,["metadata","state"]);a!=null&&d(e,["state"],Kg(a));const u=c(t,["metadata","createTime"]);u!=null&&d(e,["createTime"],u);const f=c(t,["metadata","endTime"]);f!=null&&d(e,["endTime"],f);const p=c(t,["metadata","updateTime"]);p!=null&&d(e,["updateTime"],p);const g=c(t,["metadata","model"]);g!=null&&d(e,["model"],g);const m=c(t,["metadata","output"]);return m!=null&&d(e,["dest"],hb(m)),e}function fb(t){const e={},i=c(t,["nextPageToken"]);i!=null&&d(e,["nextPageToken"],i);const s=c(t,["operations"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(u=>Xu(u))),d(e,["batchJobs"],a)}return e}function mb(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["done"]);s!=null&&d(e,["done"],s);const a=c(t,["error"]);return a!=null&&d(e,["error"],Qg(a)),e}function Xg(t){const e={},i=c(t,["details"]);i!=null&&d(e,["details"],i);const s=c(t,["code"]);s!=null&&d(e,["code"],s);const a=c(t,["message"]);return a!=null&&d(e,["message"],a),e}function pb(t){const e={},i=c(t,["instancesFormat"]);i!=null&&d(e,["format"],i);const s=c(t,["gcsSource","uris"]);s!=null&&d(e,["gcsUri"],s);const a=c(t,["bigquerySource","inputUri"]);return a!=null&&d(e,["bigqueryUri"],a),e}function gb(t){const e={},i=c(t,["predictionsFormat"]);i!=null&&d(e,["format"],i);const s=c(t,["gcsDestination","outputUriPrefix"]);s!=null&&d(e,["gcsUri"],s);const a=c(t,["bigqueryDestination","outputUri"]);return a!=null&&d(e,["bigqueryUri"],a),e}function Wu(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["displayName"]);s!=null&&d(e,["displayName"],s);const a=c(t,["state"]);a!=null&&d(e,["state"],Kg(a));const u=c(t,["error"]);u!=null&&d(e,["error"],Xg(u));const f=c(t,["createTime"]);f!=null&&d(e,["createTime"],f);const p=c(t,["startTime"]);p!=null&&d(e,["startTime"],p);const g=c(t,["endTime"]);g!=null&&d(e,["endTime"],g);const m=c(t,["updateTime"]);m!=null&&d(e,["updateTime"],m);const y=c(t,["model"]);y!=null&&d(e,["model"],y);const v=c(t,["inputConfig"]);v!=null&&d(e,["src"],pb(v));const C=c(t,["outputConfig"]);return C!=null&&d(e,["dest"],gb(C)),e}function xb(t){const e={},i=c(t,["nextPageToken"]);i!=null&&d(e,["nextPageToken"],i);const s=c(t,["batchPredictionJobs"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(u=>Wu(u))),d(e,["batchJobs"],a)}return e}function yb(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["done"]);s!=null&&d(e,["done"],s);const a=c(t,["error"]);return a!=null&&d(e,["error"],Xg(a)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ys;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(ys||(ys={}));class Bl{constructor(e,i,s,a){this.pageInternal=[],this.paramsInternal={},this.requestInternal=i,this.init(e,s,a)}init(e,i,s){var a,u;this.nameInternal=e,this.pageInternal=i[this.nameInternal]||[],this.idxInternal=0;let f={config:{}};s?typeof s=="object"?f=Object.assign({},s):f=s:f={config:{}},f.config&&(f.config.pageToken=i.nextPageToken),this.paramsInternal=f,this.pageInternalSize=(u=(a=f.config)===null||a===void 0?void 0:a.pageSize)!==null&&u!==void 0?u:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class vb extends Ts{constructor(e){super(),this.apiClient=e,this.create=async i=>{if(this.apiClient.isVertexAI()){const a=Date.now().toString();if(Array.isArray(i.src))throw new Error("InlinedRequest[] is not supported in Vertex AI. Please use Google Cloud Storage URI or BigQuery URI instead.");if(i.config=i.config||{},i.config.displayName===void 0&&(i.config.displayName="genaiBatchJob_${timestampStr}"),i.config.dest===void 0&&typeof i.src=="string")if(i.src.startsWith("gs://")&&i.src.endsWith(".jsonl"))i.config.dest=`${i.src.slice(0,-6)}/dest`;else if(i.src.startsWith("bq://"))i.config.dest=`${i.src}_dest_${a}`;else throw new Error("Unsupported source:"+i.src)}return await this.createInternal(i)},this.list=async(i={})=>new Bl(ys.PAGED_ITEM_BATCH_JOBS,s=>this.listInternal(s),await this.listInternal(i),i)}async createInternal(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=Jv(this.apiClient,e);return p=Le("batchPredictionJobs",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>Wu(y))}else{const m=Gv(this.apiClient,e);return p=Le("{model}:batchGenerateContent",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>Xu(y))}}async get(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=Qv(this.apiClient,e);return p=Le("batchPredictionJobs/{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>Wu(y))}else{const m=Vv(this.apiClient,e);return p=Le("batches/{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>Xu(y))}}async cancel(e){var i,s,a,u;let f="",p={};if(this.apiClient.isVertexAI()){const g=Xv(this.apiClient,e);f=Le("batchPredictionJobs/{name}:cancel",g._url),p=g._query,delete g.config,delete g._url,delete g._query,await this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const g=$v(this.apiClient,e);f=Le("batches/{name}:cancel",g._url),p=g._query,delete g.config,delete g._url,delete g._query,await this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal})}}async listInternal(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=Zv(e);return p=Le("batchPredictionJobs",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>{const v=xb(y),C=new zp;return Object.assign(C,v),C})}else{const m=qv(e);return p=Le("batches",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>{const v=fb(y),C=new zp;return Object.assign(C,v),C})}}async delete(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=eb(this.apiClient,e);return p=Le("batchPredictionJobs/{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>yb(y))}else{const m=zv(this.apiClient,e);return p=Le("batches/{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>mb(y))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function bb(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function Cb(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(t,["data"]);i!=null&&d(e,["data"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function Tb(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(t,["fileUri"]);i!=null&&d(e,["fileUri"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function Nb(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],bb(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],Cb(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],Tb(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function Jp(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>Nb(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function kb(t){const e={},i=c(t,["behavior"]);i!=null&&d(e,["behavior"],i);const s=c(t,["description"]);s!=null&&d(e,["description"],s);const a=c(t,["name"]);a!=null&&d(e,["name"],a);const u=c(t,["parameters"]);u!=null&&d(e,["parameters"],u);const f=c(t,["parametersJsonSchema"]);f!=null&&d(e,["parametersJsonSchema"],f);const p=c(t,["response"]);p!=null&&d(e,["response"],p);const g=c(t,["responseJsonSchema"]);return g!=null&&d(e,["responseJsonSchema"],g),e}function Sb(t){const e={},i=c(t,["startTime"]);i!=null&&d(e,["startTime"],i);const s=c(t,["endTime"]);return s!=null&&d(e,["endTime"],s),e}function wb(t){const e={},i=c(t,["timeRangeFilter"]);return i!=null&&d(e,["timeRangeFilter"],Sb(i)),e}function Eb(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["dynamicThreshold"]);return s!=null&&d(e,["dynamicThreshold"],s),e}function Mb(t){const e={},i=c(t,["dynamicRetrievalConfig"]);return i!=null&&d(e,["dynamicRetrievalConfig"],Eb(i)),e}function Ab(){return{}}function Rb(t){const e={},i=c(t,["functionDeclarations"]);if(i!=null){let g=i;Array.isArray(g)&&(g=g.map(m=>kb(m))),d(e,["functionDeclarations"],g)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=c(t,["googleSearch"]);s!=null&&d(e,["googleSearch"],wb(s));const a=c(t,["googleSearchRetrieval"]);if(a!=null&&d(e,["googleSearchRetrieval"],Mb(a)),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(c(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");c(t,["urlContext"])!=null&&d(e,["urlContext"],Ab());const f=c(t,["codeExecution"]);f!=null&&d(e,["codeExecution"],f);const p=c(t,["computerUse"]);return p!=null&&d(e,["computerUse"],p),e}function Ib(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["allowedFunctionNames"]);return s!=null&&d(e,["allowedFunctionNames"],s),e}function _b(t){const e={},i=c(t,["latitude"]);i!=null&&d(e,["latitude"],i);const s=c(t,["longitude"]);return s!=null&&d(e,["longitude"],s),e}function Lb(t){const e={},i=c(t,["latLng"]);i!=null&&d(e,["latLng"],_b(i));const s=c(t,["languageCode"]);return s!=null&&d(e,["languageCode"],s),e}function jb(t){const e={},i=c(t,["functionCallingConfig"]);i!=null&&d(e,["functionCallingConfig"],Ib(i));const s=c(t,["retrievalConfig"]);return s!=null&&d(e,["retrievalConfig"],Lb(s)),e}function Db(t,e){const i={},s=c(t,["ttl"]);e!==void 0&&s!=null&&d(e,["ttl"],s);const a=c(t,["expireTime"]);e!==void 0&&a!=null&&d(e,["expireTime"],a);const u=c(t,["displayName"]);e!==void 0&&u!=null&&d(e,["displayName"],u);const f=c(t,["contents"]);if(e!==void 0&&f!=null){let y=En(f);Array.isArray(y)&&(y=y.map(v=>Jp(v))),d(e,["contents"],y)}const p=c(t,["systemInstruction"]);e!==void 0&&p!=null&&d(e,["systemInstruction"],Jp(en(p)));const g=c(t,["tools"]);if(e!==void 0&&g!=null){let y=g;Array.isArray(y)&&(y=y.map(v=>Rb(v))),d(e,["tools"],y)}const m=c(t,["toolConfig"]);if(e!==void 0&&m!=null&&d(e,["toolConfig"],jb(m)),c(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return i}function Pb(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["model"],Pg(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],Db(a,i)),i}function Ub(t,e){const i={},s=c(e,["name"]);s!=null&&d(i,["_url","name"],ui(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function Hb(t,e){const i={},s=c(e,["name"]);s!=null&&d(i,["_url","name"],ui(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function Ob(t,e){const i={},s=c(t,["ttl"]);e!==void 0&&s!=null&&d(e,["ttl"],s);const a=c(t,["expireTime"]);return e!==void 0&&a!=null&&d(e,["expireTime"],a),i}function Gb(t,e){const i={},s=c(e,["name"]);s!=null&&d(i,["_url","name"],ui(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],Ob(a,i)),i}function Vb(t,e){const i={},s=c(t,["pageSize"]);e!==void 0&&s!=null&&d(e,["_query","pageSize"],s);const a=c(t,["pageToken"]);return e!==void 0&&a!=null&&d(e,["_query","pageToken"],a),i}function $b(t){const e={},i=c(t,["config"]);return i!=null&&d(e,["config"],Vb(i,e)),e}function Bb(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function qb(t){const e={},i=c(t,["displayName"]);i!=null&&d(e,["displayName"],i);const s=c(t,["data"]);s!=null&&d(e,["data"],s);const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function zb(t){const e={},i=c(t,["displayName"]);i!=null&&d(e,["displayName"],i);const s=c(t,["fileUri"]);s!=null&&d(e,["fileUri"],s);const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function Fb(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],Bb(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],qb(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],zb(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function Qp(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>Fb(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function Kb(t){const e={};if(c(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const i=c(t,["description"]);i!=null&&d(e,["description"],i);const s=c(t,["name"]);s!=null&&d(e,["name"],s);const a=c(t,["parameters"]);a!=null&&d(e,["parameters"],a);const u=c(t,["parametersJsonSchema"]);u!=null&&d(e,["parametersJsonSchema"],u);const f=c(t,["response"]);f!=null&&d(e,["response"],f);const p=c(t,["responseJsonSchema"]);return p!=null&&d(e,["responseJsonSchema"],p),e}function Yb(t){const e={},i=c(t,["startTime"]);i!=null&&d(e,["startTime"],i);const s=c(t,["endTime"]);return s!=null&&d(e,["endTime"],s),e}function Jb(t){const e={},i=c(t,["timeRangeFilter"]);return i!=null&&d(e,["timeRangeFilter"],Yb(i)),e}function Qb(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["dynamicThreshold"]);return s!=null&&d(e,["dynamicThreshold"],s),e}function Xb(t){const e={},i=c(t,["dynamicRetrievalConfig"]);return i!=null&&d(e,["dynamicRetrievalConfig"],Qb(i)),e}function Wb(){return{}}function Zb(t){const e={},i=c(t,["apiKeyString"]);return i!=null&&d(e,["apiKeyString"],i),e}function eC(t){const e={},i=c(t,["apiKeyConfig"]);i!=null&&d(e,["apiKeyConfig"],Zb(i));const s=c(t,["authType"]);s!=null&&d(e,["authType"],s);const a=c(t,["googleServiceAccountConfig"]);a!=null&&d(e,["googleServiceAccountConfig"],a);const u=c(t,["httpBasicAuthConfig"]);u!=null&&d(e,["httpBasicAuthConfig"],u);const f=c(t,["oauthConfig"]);f!=null&&d(e,["oauthConfig"],f);const p=c(t,["oidcConfig"]);return p!=null&&d(e,["oidcConfig"],p),e}function tC(t){const e={},i=c(t,["authConfig"]);return i!=null&&d(e,["authConfig"],eC(i)),e}function nC(){return{}}function iC(t){const e={},i=c(t,["functionDeclarations"]);if(i!=null){let v=i;Array.isArray(v)&&(v=v.map(C=>Kb(C))),d(e,["functionDeclarations"],v)}const s=c(t,["retrieval"]);s!=null&&d(e,["retrieval"],s);const a=c(t,["googleSearch"]);a!=null&&d(e,["googleSearch"],Jb(a));const u=c(t,["googleSearchRetrieval"]);u!=null&&d(e,["googleSearchRetrieval"],Xb(u)),c(t,["enterpriseWebSearch"])!=null&&d(e,["enterpriseWebSearch"],Wb());const p=c(t,["googleMaps"]);p!=null&&d(e,["googleMaps"],tC(p)),c(t,["urlContext"])!=null&&d(e,["urlContext"],nC());const m=c(t,["codeExecution"]);m!=null&&d(e,["codeExecution"],m);const y=c(t,["computerUse"]);return y!=null&&d(e,["computerUse"],y),e}function sC(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["allowedFunctionNames"]);return s!=null&&d(e,["allowedFunctionNames"],s),e}function oC(t){const e={},i=c(t,["latitude"]);i!=null&&d(e,["latitude"],i);const s=c(t,["longitude"]);return s!=null&&d(e,["longitude"],s),e}function lC(t){const e={},i=c(t,["latLng"]);i!=null&&d(e,["latLng"],oC(i));const s=c(t,["languageCode"]);return s!=null&&d(e,["languageCode"],s),e}function aC(t){const e={},i=c(t,["functionCallingConfig"]);i!=null&&d(e,["functionCallingConfig"],sC(i));const s=c(t,["retrievalConfig"]);return s!=null&&d(e,["retrievalConfig"],lC(s)),e}function rC(t,e){const i={},s=c(t,["ttl"]);e!==void 0&&s!=null&&d(e,["ttl"],s);const a=c(t,["expireTime"]);e!==void 0&&a!=null&&d(e,["expireTime"],a);const u=c(t,["displayName"]);e!==void 0&&u!=null&&d(e,["displayName"],u);const f=c(t,["contents"]);if(e!==void 0&&f!=null){let v=En(f);Array.isArray(v)&&(v=v.map(C=>Qp(C))),d(e,["contents"],v)}const p=c(t,["systemInstruction"]);e!==void 0&&p!=null&&d(e,["systemInstruction"],Qp(en(p)));const g=c(t,["tools"]);if(e!==void 0&&g!=null){let v=g;Array.isArray(v)&&(v=v.map(C=>iC(C))),d(e,["tools"],v)}const m=c(t,["toolConfig"]);e!==void 0&&m!=null&&d(e,["toolConfig"],aC(m));const y=c(t,["kmsKeyName"]);return e!==void 0&&y!=null&&d(e,["encryption_spec","kmsKeyName"],y),i}function cC(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["model"],Pg(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],rC(a,i)),i}function uC(t,e){const i={},s=c(e,["name"]);s!=null&&d(i,["_url","name"],ui(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function dC(t,e){const i={},s=c(e,["name"]);s!=null&&d(i,["_url","name"],ui(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function hC(t,e){const i={},s=c(t,["ttl"]);e!==void 0&&s!=null&&d(e,["ttl"],s);const a=c(t,["expireTime"]);return e!==void 0&&a!=null&&d(e,["expireTime"],a),i}function fC(t,e){const i={},s=c(e,["name"]);s!=null&&d(i,["_url","name"],ui(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],hC(a,i)),i}function mC(t,e){const i={},s=c(t,["pageSize"]);e!==void 0&&s!=null&&d(e,["_query","pageSize"],s);const a=c(t,["pageToken"]);return e!==void 0&&a!=null&&d(e,["_query","pageToken"],a),i}function pC(t){const e={},i=c(t,["config"]);return i!=null&&d(e,["config"],mC(i,e)),e}function yr(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["displayName"]);s!=null&&d(e,["displayName"],s);const a=c(t,["model"]);a!=null&&d(e,["model"],a);const u=c(t,["createTime"]);u!=null&&d(e,["createTime"],u);const f=c(t,["updateTime"]);f!=null&&d(e,["updateTime"],f);const p=c(t,["expireTime"]);p!=null&&d(e,["expireTime"],p);const g=c(t,["usageMetadata"]);return g!=null&&d(e,["usageMetadata"],g),e}function gC(){return{}}function xC(t){const e={},i=c(t,["nextPageToken"]);i!=null&&d(e,["nextPageToken"],i);const s=c(t,["cachedContents"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(u=>yr(u))),d(e,["cachedContents"],a)}return e}function vr(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["displayName"]);s!=null&&d(e,["displayName"],s);const a=c(t,["model"]);a!=null&&d(e,["model"],a);const u=c(t,["createTime"]);u!=null&&d(e,["createTime"],u);const f=c(t,["updateTime"]);f!=null&&d(e,["updateTime"],f);const p=c(t,["expireTime"]);p!=null&&d(e,["expireTime"],p);const g=c(t,["usageMetadata"]);return g!=null&&d(e,["usageMetadata"],g),e}function yC(){return{}}function vC(t){const e={},i=c(t,["nextPageToken"]);i!=null&&d(e,["nextPageToken"],i);const s=c(t,["cachedContents"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(u=>vr(u))),d(e,["cachedContents"],a)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class bC extends Ts{constructor(e){super(),this.apiClient=e,this.list=async(i={})=>new Bl(ys.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(i),i)}async create(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=cC(this.apiClient,e);return p=Le("cachedContents",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>vr(y))}else{const m=Pb(this.apiClient,e);return p=Le("cachedContents",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>yr(y))}}async get(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=uC(this.apiClient,e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>vr(y))}else{const m=Ub(this.apiClient,e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>yr(y))}}async delete(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=dC(this.apiClient,e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(()=>{const y=yC(),v=new Bp;return Object.assign(v,y),v})}else{const m=Hb(this.apiClient,e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(()=>{const y=gC(),v=new Bp;return Object.assign(v,y),v})}}async update(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=fC(this.apiClient,e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>vr(y))}else{const m=Gb(this.apiClient,e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"PATCH",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>yr(y))}}async listInternal(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=pC(e);return p=Le("cachedContents",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>{const v=vC(y),C=new qp;return Object.assign(C,v),C})}else{const m=$b(e);return p=Le("cachedContents",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>{const v=xC(y),C=new qp;return Object.assign(C,v),C})}}}function Xp(t){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function yt(t){return this instanceof yt?(this.v=t,this):new yt(t)}function xo(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=i.apply(t,e||[]),a,u=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),p("next"),p("throw"),p("return",f),a[Symbol.asyncIterator]=function(){return this},a;function f(N){return function(R){return Promise.resolve(R).then(N,v)}}function p(N,R){s[N]&&(a[N]=function(L){return new Promise(function(O,J){u.push([N,L,O,J])>1||g(N,L)})},R&&(a[N]=R(a[N])))}function g(N,R){try{m(s[N](R))}catch(L){C(u[0][3],L)}}function m(N){N.value instanceof yt?Promise.resolve(N.value.v).then(y,v):C(u[0][2],N)}function y(N){g("next",N)}function v(N){g("throw",N)}function C(N,R){N(R),u.shift(),u.length&&g(u[0][0],u[0][1])}}function Ul(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],i;return e?e.call(t):(t=typeof Xp=="function"?Xp(t):t[Symbol.iterator](),i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i);function s(u){i[u]=t[u]&&function(f){return new Promise(function(p,g){f=t[u](f),a(p,g,f.done,f.value)})}}function a(u,f,p,g){Promise.resolve(g).then(function(m){u({value:m,done:p})},f)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function CC(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const i=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return i===void 0?!1:Wg(i)}function Wg(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function TC(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Wp(t){if(t===void 0||t.length===0)return[];const e=[],i=t.length;let s=0;for(;s<i;)if(t[s].role==="user")e.push(t[s]),s++;else{const a=[];let u=!0;for(;s<i&&t[s].role==="model";)a.push(t[s]),u&&!Wg(t[s])&&(u=!1),s++;u?e.push(...a):e.pop()}return e}class NC{constructor(e,i){this.modelsModule=e,this.apiClient=i}create(e){return new kC(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class kC{constructor(e,i,s,a={},u=[]){this.apiClient=e,this.modelsModule=i,this.model=s,this.config=a,this.history=u,this.sendPromise=Promise.resolve(),TC(u)}async sendMessage(e){var i;await this.sendPromise;const s=en(e.message),a=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(i=e.config)!==null&&i!==void 0?i:this.config});return this.sendPromise=(async()=>{var u,f,p;const g=await a,m=(f=(u=g.candidates)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.content,y=g.automaticFunctionCallingHistory,v=this.getHistory(!0).length;let C=[];y!=null&&(C=(p=y.slice(v))!==null&&p!==void 0?p:[]);const N=m?[m]:[];this.recordHistory(s,N,C)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),a}async sendMessageStream(e){var i;await this.sendPromise;const s=en(e.message),a=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(i=e.config)!==null&&i!==void 0?i:this.config});this.sendPromise=a.then(()=>{}).catch(()=>{});const u=await a;return this.processStreamResponse(u,s)}getHistory(e=!1){const i=e?Wp(this.history):this.history;return structuredClone(i)}processStreamResponse(e,i){var s,a;return xo(this,arguments,function*(){var f,p,g,m;const y=[];try{for(var v=!0,C=Ul(e),N;N=yield yt(C.next()),f=N.done,!f;v=!0){m=N.value,v=!1;const R=m;if(CC(R)){const L=(a=(s=R.candidates)===null||s===void 0?void 0:s[0])===null||a===void 0?void 0:a.content;L!==void 0&&y.push(L)}yield yield yt(R)}}catch(R){p={error:R}}finally{try{!v&&!f&&(g=C.return)&&(yield yt(g.call(C)))}finally{if(p)throw p.error}}this.recordHistory(i,y)})}recordHistory(e,i,s){let a=[];i.length>0&&i.every(u=>u.role!==void 0)?a=i:a.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...Wp(s)):this.history.push(e),this.history.push(...a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ir extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Ir.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function SC(t,e){const i={},s=c(t,["pageSize"]);e!==void 0&&s!=null&&d(e,["_query","pageSize"],s);const a=c(t,["pageToken"]);return e!==void 0&&a!=null&&d(e,["_query","pageToken"],a),i}function wC(t){const e={},i=c(t,["config"]);return i!=null&&d(e,["config"],SC(i,e)),e}function EC(t){const e={},i=c(t,["details"]);i!=null&&d(e,["details"],i);const s=c(t,["message"]);s!=null&&d(e,["message"],s);const a=c(t,["code"]);return a!=null&&d(e,["code"],a),e}function MC(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["displayName"]);s!=null&&d(e,["displayName"],s);const a=c(t,["mimeType"]);a!=null&&d(e,["mimeType"],a);const u=c(t,["sizeBytes"]);u!=null&&d(e,["sizeBytes"],u);const f=c(t,["createTime"]);f!=null&&d(e,["createTime"],f);const p=c(t,["expirationTime"]);p!=null&&d(e,["expirationTime"],p);const g=c(t,["updateTime"]);g!=null&&d(e,["updateTime"],g);const m=c(t,["sha256Hash"]);m!=null&&d(e,["sha256Hash"],m);const y=c(t,["uri"]);y!=null&&d(e,["uri"],y);const v=c(t,["downloadUri"]);v!=null&&d(e,["downloadUri"],v);const C=c(t,["state"]);C!=null&&d(e,["state"],C);const N=c(t,["source"]);N!=null&&d(e,["source"],N);const R=c(t,["videoMetadata"]);R!=null&&d(e,["videoMetadata"],R);const L=c(t,["error"]);return L!=null&&d(e,["error"],EC(L)),e}function AC(t){const e={},i=c(t,["file"]);i!=null&&d(e,["file"],MC(i));const s=c(t,["config"]);return s!=null&&d(e,["config"],s),e}function RC(t){const e={},i=c(t,["name"]);i!=null&&d(e,["_url","file"],Bg(i));const s=c(t,["config"]);return s!=null&&d(e,["config"],s),e}function IC(t){const e={},i=c(t,["name"]);i!=null&&d(e,["_url","file"],Bg(i));const s=c(t,["config"]);return s!=null&&d(e,["config"],s),e}function _C(t){const e={},i=c(t,["details"]);i!=null&&d(e,["details"],i);const s=c(t,["message"]);s!=null&&d(e,["message"],s);const a=c(t,["code"]);return a!=null&&d(e,["code"],a),e}function Zu(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["displayName"]);s!=null&&d(e,["displayName"],s);const a=c(t,["mimeType"]);a!=null&&d(e,["mimeType"],a);const u=c(t,["sizeBytes"]);u!=null&&d(e,["sizeBytes"],u);const f=c(t,["createTime"]);f!=null&&d(e,["createTime"],f);const p=c(t,["expirationTime"]);p!=null&&d(e,["expirationTime"],p);const g=c(t,["updateTime"]);g!=null&&d(e,["updateTime"],g);const m=c(t,["sha256Hash"]);m!=null&&d(e,["sha256Hash"],m);const y=c(t,["uri"]);y!=null&&d(e,["uri"],y);const v=c(t,["downloadUri"]);v!=null&&d(e,["downloadUri"],v);const C=c(t,["state"]);C!=null&&d(e,["state"],C);const N=c(t,["source"]);N!=null&&d(e,["source"],N);const R=c(t,["videoMetadata"]);R!=null&&d(e,["videoMetadata"],R);const L=c(t,["error"]);return L!=null&&d(e,["error"],_C(L)),e}function LC(t){const e={},i=c(t,["nextPageToken"]);i!=null&&d(e,["nextPageToken"],i);const s=c(t,["files"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(u=>Zu(u))),d(e,["files"],a)}return e}function jC(t){const e={},i=c(t,["sdkHttpResponse"]);return i!=null&&d(e,["sdkHttpResponse"],i),e}function DC(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class PC extends Ts{constructor(e){super(),this.apiClient=e,this.list=async(i={})=>new Bl(ys.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(i),i)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(i=>Zu(i))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var i,s;let a,u="",f={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const p=wC(e);return u=Le("files",p._url),f=p._query,delete p.config,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),a.then(g=>{const m=LC(g),y=new ev;return Object.assign(y,m),y})}}async createInternal(e){var i,s;let a,u="",f={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const p=AC(e);return u=Le("upload/v1beta/files",p._url),f=p._query,delete p.config,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),a.then(g=>{const m=jC(g),y=new tv;return Object.assign(y,m),y})}}async get(e){var i,s;let a,u="",f={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const p=RC(e);return u=Le("files/{file}",p._url),f=p._query,delete p.config,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),a.then(g=>Zu(g))}}async delete(e){var i,s;let a,u="",f={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const p=IC(e);return u=Le("files/{file}",p._url),f=p._query,delete p.config,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),a.then(()=>{const g=DC(),m=new nv;return Object.assign(m,g),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function UC(t){const e={},i=c(t,["voiceName"]);return i!=null&&d(e,["voiceName"],i),e}function Zg(t){const e={},i=c(t,["prebuiltVoiceConfig"]);return i!=null&&d(e,["prebuiltVoiceConfig"],UC(i)),e}function HC(t){const e={},i=c(t,["speaker"]);i!=null&&d(e,["speaker"],i);const s=c(t,["voiceConfig"]);return s!=null&&d(e,["voiceConfig"],Zg(s)),e}function OC(t){const e={},i=c(t,["speakerVoiceConfigs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>HC(a))),d(e,["speakerVoiceConfigs"],s)}return e}function GC(t){const e={},i=c(t,["voiceConfig"]);i!=null&&d(e,["voiceConfig"],Zg(i));const s=c(t,["multiSpeakerVoiceConfig"]);s!=null&&d(e,["multiSpeakerVoiceConfig"],OC(s));const a=c(t,["languageCode"]);return a!=null&&d(e,["languageCode"],a),e}function VC(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function $C(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(t,["data"]);i!=null&&d(e,["data"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function BC(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(t,["fileUri"]);i!=null&&d(e,["fileUri"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function qC(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],VC(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],$C(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],BC(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function zC(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>qC(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function FC(t){const e={},i=c(t,["behavior"]);i!=null&&d(e,["behavior"],i);const s=c(t,["description"]);s!=null&&d(e,["description"],s);const a=c(t,["name"]);a!=null&&d(e,["name"],a);const u=c(t,["parameters"]);u!=null&&d(e,["parameters"],u);const f=c(t,["parametersJsonSchema"]);f!=null&&d(e,["parametersJsonSchema"],f);const p=c(t,["response"]);p!=null&&d(e,["response"],p);const g=c(t,["responseJsonSchema"]);return g!=null&&d(e,["responseJsonSchema"],g),e}function KC(t){const e={},i=c(t,["startTime"]);i!=null&&d(e,["startTime"],i);const s=c(t,["endTime"]);return s!=null&&d(e,["endTime"],s),e}function YC(t){const e={},i=c(t,["timeRangeFilter"]);return i!=null&&d(e,["timeRangeFilter"],KC(i)),e}function JC(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["dynamicThreshold"]);return s!=null&&d(e,["dynamicThreshold"],s),e}function QC(t){const e={},i=c(t,["dynamicRetrievalConfig"]);return i!=null&&d(e,["dynamicRetrievalConfig"],JC(i)),e}function XC(){return{}}function WC(t){const e={},i=c(t,["functionDeclarations"]);if(i!=null){let g=i;Array.isArray(g)&&(g=g.map(m=>FC(m))),d(e,["functionDeclarations"],g)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=c(t,["googleSearch"]);s!=null&&d(e,["googleSearch"],YC(s));const a=c(t,["googleSearchRetrieval"]);if(a!=null&&d(e,["googleSearchRetrieval"],QC(a)),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(c(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");c(t,["urlContext"])!=null&&d(e,["urlContext"],XC());const f=c(t,["codeExecution"]);f!=null&&d(e,["codeExecution"],f);const p=c(t,["computerUse"]);return p!=null&&d(e,["computerUse"],p),e}function ZC(t){const e={},i=c(t,["handle"]);if(i!=null&&d(e,["handle"],i),c(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Zp(){return{}}function e1(t){const e={},i=c(t,["disabled"]);i!=null&&d(e,["disabled"],i);const s=c(t,["startOfSpeechSensitivity"]);s!=null&&d(e,["startOfSpeechSensitivity"],s);const a=c(t,["endOfSpeechSensitivity"]);a!=null&&d(e,["endOfSpeechSensitivity"],a);const u=c(t,["prefixPaddingMs"]);u!=null&&d(e,["prefixPaddingMs"],u);const f=c(t,["silenceDurationMs"]);return f!=null&&d(e,["silenceDurationMs"],f),e}function t1(t){const e={},i=c(t,["automaticActivityDetection"]);i!=null&&d(e,["automaticActivityDetection"],e1(i));const s=c(t,["activityHandling"]);s!=null&&d(e,["activityHandling"],s);const a=c(t,["turnCoverage"]);return a!=null&&d(e,["turnCoverage"],a),e}function n1(t){const e={},i=c(t,["targetTokens"]);return i!=null&&d(e,["targetTokens"],i),e}function i1(t){const e={},i=c(t,["triggerTokens"]);i!=null&&d(e,["triggerTokens"],i);const s=c(t,["slidingWindow"]);return s!=null&&d(e,["slidingWindow"],n1(s)),e}function s1(t){const e={},i=c(t,["proactiveAudio"]);return i!=null&&d(e,["proactiveAudio"],i),e}function o1(t,e){const i={},s=c(t,["generationConfig"]);e!==void 0&&s!=null&&d(e,["setup","generationConfig"],s);const a=c(t,["responseModalities"]);e!==void 0&&a!=null&&d(e,["setup","generationConfig","responseModalities"],a);const u=c(t,["temperature"]);e!==void 0&&u!=null&&d(e,["setup","generationConfig","temperature"],u);const f=c(t,["topP"]);e!==void 0&&f!=null&&d(e,["setup","generationConfig","topP"],f);const p=c(t,["topK"]);e!==void 0&&p!=null&&d(e,["setup","generationConfig","topK"],p);const g=c(t,["maxOutputTokens"]);e!==void 0&&g!=null&&d(e,["setup","generationConfig","maxOutputTokens"],g);const m=c(t,["mediaResolution"]);e!==void 0&&m!=null&&d(e,["setup","generationConfig","mediaResolution"],m);const y=c(t,["seed"]);e!==void 0&&y!=null&&d(e,["setup","generationConfig","seed"],y);const v=c(t,["speechConfig"]);e!==void 0&&v!=null&&d(e,["setup","generationConfig","speechConfig"],GC(hd(v)));const C=c(t,["enableAffectiveDialog"]);e!==void 0&&C!=null&&d(e,["setup","generationConfig","enableAffectiveDialog"],C);const N=c(t,["systemInstruction"]);e!==void 0&&N!=null&&d(e,["setup","systemInstruction"],zC(en(N)));const R=c(t,["tools"]);if(e!==void 0&&R!=null){let z=No(R);Array.isArray(z)&&(z=z.map(ae=>WC(To(ae)))),d(e,["setup","tools"],z)}const L=c(t,["sessionResumption"]);e!==void 0&&L!=null&&d(e,["setup","sessionResumption"],ZC(L));const O=c(t,["inputAudioTranscription"]);e!==void 0&&O!=null&&d(e,["setup","inputAudioTranscription"],Zp());const J=c(t,["outputAudioTranscription"]);e!==void 0&&J!=null&&d(e,["setup","outputAudioTranscription"],Zp());const P=c(t,["realtimeInputConfig"]);e!==void 0&&P!=null&&d(e,["setup","realtimeInputConfig"],t1(P));const $=c(t,["contextWindowCompression"]);e!==void 0&&$!=null&&d(e,["setup","contextWindowCompression"],i1($));const ne=c(t,["proactivity"]);return e!==void 0&&ne!=null&&d(e,["setup","proactivity"],s1(ne)),i}function l1(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["setup","model"],ut(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],o1(a,i)),i}function a1(){return{}}function r1(){return{}}function c1(t){const e={},i=c(t,["media"]);i!=null&&d(e,["mediaChunks"],Ug(i));const s=c(t,["audio"]);s!=null&&d(e,["audio"],Og(s));const a=c(t,["audioStreamEnd"]);a!=null&&d(e,["audioStreamEnd"],a);const u=c(t,["video"]);u!=null&&d(e,["video"],Hg(u));const f=c(t,["text"]);return f!=null&&d(e,["text"],f),c(t,["activityStart"])!=null&&d(e,["activityStart"],a1()),c(t,["activityEnd"])!=null&&d(e,["activityEnd"],r1()),e}function e0(t){const e={},i=c(t,["text"]);i!=null&&d(e,["text"],i);const s=c(t,["weight"]);return s!=null&&d(e,["weight"],s),e}function u1(t){const e={},i=c(t,["weightedPrompts"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>e0(a))),d(e,["weightedPrompts"],s)}return e}function t0(t){const e={},i=c(t,["temperature"]);i!=null&&d(e,["temperature"],i);const s=c(t,["topK"]);s!=null&&d(e,["topK"],s);const a=c(t,["seed"]);a!=null&&d(e,["seed"],a);const u=c(t,["guidance"]);u!=null&&d(e,["guidance"],u);const f=c(t,["bpm"]);f!=null&&d(e,["bpm"],f);const p=c(t,["density"]);p!=null&&d(e,["density"],p);const g=c(t,["brightness"]);g!=null&&d(e,["brightness"],g);const m=c(t,["scale"]);m!=null&&d(e,["scale"],m);const y=c(t,["muteBass"]);y!=null&&d(e,["muteBass"],y);const v=c(t,["muteDrums"]);v!=null&&d(e,["muteDrums"],v);const C=c(t,["onlyBassAndDrums"]);return C!=null&&d(e,["onlyBassAndDrums"],C),e}function d1(t){const e={},i=c(t,["musicGenerationConfig"]);return i!=null&&d(e,["musicGenerationConfig"],t0(i)),e}function n0(t){const e={},i=c(t,["model"]);return i!=null&&d(e,["model"],i),e}function i0(t){const e={},i=c(t,["weightedPrompts"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>e0(a))),d(e,["weightedPrompts"],s)}return e}function ed(t){const e={},i=c(t,["setup"]);i!=null&&d(e,["setup"],n0(i));const s=c(t,["clientContent"]);s!=null&&d(e,["clientContent"],i0(s));const a=c(t,["musicGenerationConfig"]);a!=null&&d(e,["musicGenerationConfig"],t0(a));const u=c(t,["playbackControl"]);return u!=null&&d(e,["playbackControl"],u),e}function h1(t){const e={},i=c(t,["voiceName"]);return i!=null&&d(e,["voiceName"],i),e}function f1(t){const e={},i=c(t,["prebuiltVoiceConfig"]);return i!=null&&d(e,["prebuiltVoiceConfig"],h1(i)),e}function m1(t){const e={},i=c(t,["voiceConfig"]);if(i!=null&&d(e,["voiceConfig"],f1(i)),c(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const s=c(t,["languageCode"]);return s!=null&&d(e,["languageCode"],s),e}function p1(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function g1(t){const e={},i=c(t,["displayName"]);i!=null&&d(e,["displayName"],i);const s=c(t,["data"]);s!=null&&d(e,["data"],s);const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function x1(t){const e={},i=c(t,["displayName"]);i!=null&&d(e,["displayName"],i);const s=c(t,["fileUri"]);s!=null&&d(e,["fileUri"],s);const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function y1(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],p1(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],g1(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],x1(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function v1(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>y1(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function b1(t){const e={};if(c(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const i=c(t,["description"]);i!=null&&d(e,["description"],i);const s=c(t,["name"]);s!=null&&d(e,["name"],s);const a=c(t,["parameters"]);a!=null&&d(e,["parameters"],a);const u=c(t,["parametersJsonSchema"]);u!=null&&d(e,["parametersJsonSchema"],u);const f=c(t,["response"]);f!=null&&d(e,["response"],f);const p=c(t,["responseJsonSchema"]);return p!=null&&d(e,["responseJsonSchema"],p),e}function C1(t){const e={},i=c(t,["startTime"]);i!=null&&d(e,["startTime"],i);const s=c(t,["endTime"]);return s!=null&&d(e,["endTime"],s),e}function T1(t){const e={},i=c(t,["timeRangeFilter"]);return i!=null&&d(e,["timeRangeFilter"],C1(i)),e}function N1(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["dynamicThreshold"]);return s!=null&&d(e,["dynamicThreshold"],s),e}function k1(t){const e={},i=c(t,["dynamicRetrievalConfig"]);return i!=null&&d(e,["dynamicRetrievalConfig"],N1(i)),e}function S1(){return{}}function w1(t){const e={},i=c(t,["apiKeyString"]);return i!=null&&d(e,["apiKeyString"],i),e}function E1(t){const e={},i=c(t,["apiKeyConfig"]);i!=null&&d(e,["apiKeyConfig"],w1(i));const s=c(t,["authType"]);s!=null&&d(e,["authType"],s);const a=c(t,["googleServiceAccountConfig"]);a!=null&&d(e,["googleServiceAccountConfig"],a);const u=c(t,["httpBasicAuthConfig"]);u!=null&&d(e,["httpBasicAuthConfig"],u);const f=c(t,["oauthConfig"]);f!=null&&d(e,["oauthConfig"],f);const p=c(t,["oidcConfig"]);return p!=null&&d(e,["oidcConfig"],p),e}function M1(t){const e={},i=c(t,["authConfig"]);return i!=null&&d(e,["authConfig"],E1(i)),e}function A1(){return{}}function R1(t){const e={},i=c(t,["functionDeclarations"]);if(i!=null){let v=i;Array.isArray(v)&&(v=v.map(C=>b1(C))),d(e,["functionDeclarations"],v)}const s=c(t,["retrieval"]);s!=null&&d(e,["retrieval"],s);const a=c(t,["googleSearch"]);a!=null&&d(e,["googleSearch"],T1(a));const u=c(t,["googleSearchRetrieval"]);u!=null&&d(e,["googleSearchRetrieval"],k1(u)),c(t,["enterpriseWebSearch"])!=null&&d(e,["enterpriseWebSearch"],S1());const p=c(t,["googleMaps"]);p!=null&&d(e,["googleMaps"],M1(p)),c(t,["urlContext"])!=null&&d(e,["urlContext"],A1());const m=c(t,["codeExecution"]);m!=null&&d(e,["codeExecution"],m);const y=c(t,["computerUse"]);return y!=null&&d(e,["computerUse"],y),e}function I1(t){const e={},i=c(t,["handle"]);i!=null&&d(e,["handle"],i);const s=c(t,["transparent"]);return s!=null&&d(e,["transparent"],s),e}function eg(){return{}}function _1(t){const e={},i=c(t,["disabled"]);i!=null&&d(e,["disabled"],i);const s=c(t,["startOfSpeechSensitivity"]);s!=null&&d(e,["startOfSpeechSensitivity"],s);const a=c(t,["endOfSpeechSensitivity"]);a!=null&&d(e,["endOfSpeechSensitivity"],a);const u=c(t,["prefixPaddingMs"]);u!=null&&d(e,["prefixPaddingMs"],u);const f=c(t,["silenceDurationMs"]);return f!=null&&d(e,["silenceDurationMs"],f),e}function L1(t){const e={},i=c(t,["automaticActivityDetection"]);i!=null&&d(e,["automaticActivityDetection"],_1(i));const s=c(t,["activityHandling"]);s!=null&&d(e,["activityHandling"],s);const a=c(t,["turnCoverage"]);return a!=null&&d(e,["turnCoverage"],a),e}function j1(t){const e={},i=c(t,["targetTokens"]);return i!=null&&d(e,["targetTokens"],i),e}function D1(t){const e={},i=c(t,["triggerTokens"]);i!=null&&d(e,["triggerTokens"],i);const s=c(t,["slidingWindow"]);return s!=null&&d(e,["slidingWindow"],j1(s)),e}function P1(t){const e={},i=c(t,["proactiveAudio"]);return i!=null&&d(e,["proactiveAudio"],i),e}function U1(t,e){const i={},s=c(t,["generationConfig"]);e!==void 0&&s!=null&&d(e,["setup","generationConfig"],s);const a=c(t,["responseModalities"]);e!==void 0&&a!=null&&d(e,["setup","generationConfig","responseModalities"],a);const u=c(t,["temperature"]);e!==void 0&&u!=null&&d(e,["setup","generationConfig","temperature"],u);const f=c(t,["topP"]);e!==void 0&&f!=null&&d(e,["setup","generationConfig","topP"],f);const p=c(t,["topK"]);e!==void 0&&p!=null&&d(e,["setup","generationConfig","topK"],p);const g=c(t,["maxOutputTokens"]);e!==void 0&&g!=null&&d(e,["setup","generationConfig","maxOutputTokens"],g);const m=c(t,["mediaResolution"]);e!==void 0&&m!=null&&d(e,["setup","generationConfig","mediaResolution"],m);const y=c(t,["seed"]);e!==void 0&&y!=null&&d(e,["setup","generationConfig","seed"],y);const v=c(t,["speechConfig"]);e!==void 0&&v!=null&&d(e,["setup","generationConfig","speechConfig"],m1(hd(v)));const C=c(t,["enableAffectiveDialog"]);e!==void 0&&C!=null&&d(e,["setup","generationConfig","enableAffectiveDialog"],C);const N=c(t,["systemInstruction"]);e!==void 0&&N!=null&&d(e,["setup","systemInstruction"],v1(en(N)));const R=c(t,["tools"]);if(e!==void 0&&R!=null){let z=No(R);Array.isArray(z)&&(z=z.map(ae=>R1(To(ae)))),d(e,["setup","tools"],z)}const L=c(t,["sessionResumption"]);e!==void 0&&L!=null&&d(e,["setup","sessionResumption"],I1(L));const O=c(t,["inputAudioTranscription"]);e!==void 0&&O!=null&&d(e,["setup","inputAudioTranscription"],eg());const J=c(t,["outputAudioTranscription"]);e!==void 0&&J!=null&&d(e,["setup","outputAudioTranscription"],eg());const P=c(t,["realtimeInputConfig"]);e!==void 0&&P!=null&&d(e,["setup","realtimeInputConfig"],L1(P));const $=c(t,["contextWindowCompression"]);e!==void 0&&$!=null&&d(e,["setup","contextWindowCompression"],D1($));const ne=c(t,["proactivity"]);return e!==void 0&&ne!=null&&d(e,["setup","proactivity"],P1(ne)),i}function H1(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["setup","model"],ut(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],U1(a,i)),i}function O1(){return{}}function G1(){return{}}function V1(t){const e={},i=c(t,["media"]);i!=null&&d(e,["mediaChunks"],Ug(i));const s=c(t,["audio"]);s!=null&&d(e,["audio"],Og(s));const a=c(t,["audioStreamEnd"]);a!=null&&d(e,["audioStreamEnd"],a);const u=c(t,["video"]);u!=null&&d(e,["video"],Hg(u));const f=c(t,["text"]);return f!=null&&d(e,["text"],f),c(t,["activityStart"])!=null&&d(e,["activityStart"],O1()),c(t,["activityEnd"])!=null&&d(e,["activityEnd"],G1()),e}function $1(){return{}}function B1(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function q1(t){const e={},i=c(t,["data"]);i!=null&&d(e,["data"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function z1(t){const e={},i=c(t,["fileUri"]);i!=null&&d(e,["fileUri"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function F1(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],B1(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],q1(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],z1(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function K1(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>F1(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function tg(t){const e={},i=c(t,["text"]);i!=null&&d(e,["text"],i);const s=c(t,["finished"]);return s!=null&&d(e,["finished"],s),e}function Y1(t){const e={},i=c(t,["retrievedUrl"]);i!=null&&d(e,["retrievedUrl"],i);const s=c(t,["urlRetrievalStatus"]);return s!=null&&d(e,["urlRetrievalStatus"],s),e}function J1(t){const e={},i=c(t,["urlMetadata"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>Y1(a))),d(e,["urlMetadata"],s)}return e}function Q1(t){const e={},i=c(t,["modelTurn"]);i!=null&&d(e,["modelTurn"],K1(i));const s=c(t,["turnComplete"]);s!=null&&d(e,["turnComplete"],s);const a=c(t,["interrupted"]);a!=null&&d(e,["interrupted"],a);const u=c(t,["groundingMetadata"]);u!=null&&d(e,["groundingMetadata"],u);const f=c(t,["generationComplete"]);f!=null&&d(e,["generationComplete"],f);const p=c(t,["inputTranscription"]);p!=null&&d(e,["inputTranscription"],tg(p));const g=c(t,["outputTranscription"]);g!=null&&d(e,["outputTranscription"],tg(g));const m=c(t,["urlContextMetadata"]);return m!=null&&d(e,["urlContextMetadata"],J1(m)),e}function X1(t){const e={},i=c(t,["id"]);i!=null&&d(e,["id"],i);const s=c(t,["args"]);s!=null&&d(e,["args"],s);const a=c(t,["name"]);return a!=null&&d(e,["name"],a),e}function W1(t){const e={},i=c(t,["functionCalls"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>X1(a))),d(e,["functionCalls"],s)}return e}function Z1(t){const e={},i=c(t,["ids"]);return i!=null&&d(e,["ids"],i),e}function mr(t){const e={},i=c(t,["modality"]);i!=null&&d(e,["modality"],i);const s=c(t,["tokenCount"]);return s!=null&&d(e,["tokenCount"],s),e}function eT(t){const e={},i=c(t,["promptTokenCount"]);i!=null&&d(e,["promptTokenCount"],i);const s=c(t,["cachedContentTokenCount"]);s!=null&&d(e,["cachedContentTokenCount"],s);const a=c(t,["responseTokenCount"]);a!=null&&d(e,["responseTokenCount"],a);const u=c(t,["toolUsePromptTokenCount"]);u!=null&&d(e,["toolUsePromptTokenCount"],u);const f=c(t,["thoughtsTokenCount"]);f!=null&&d(e,["thoughtsTokenCount"],f);const p=c(t,["totalTokenCount"]);p!=null&&d(e,["totalTokenCount"],p);const g=c(t,["promptTokensDetails"]);if(g!=null){let C=g;Array.isArray(C)&&(C=C.map(N=>mr(N))),d(e,["promptTokensDetails"],C)}const m=c(t,["cacheTokensDetails"]);if(m!=null){let C=m;Array.isArray(C)&&(C=C.map(N=>mr(N))),d(e,["cacheTokensDetails"],C)}const y=c(t,["responseTokensDetails"]);if(y!=null){let C=y;Array.isArray(C)&&(C=C.map(N=>mr(N))),d(e,["responseTokensDetails"],C)}const v=c(t,["toolUsePromptTokensDetails"]);if(v!=null){let C=v;Array.isArray(C)&&(C=C.map(N=>mr(N))),d(e,["toolUsePromptTokensDetails"],C)}return e}function tT(t){const e={},i=c(t,["timeLeft"]);return i!=null&&d(e,["timeLeft"],i),e}function nT(t){const e={},i=c(t,["newHandle"]);i!=null&&d(e,["newHandle"],i);const s=c(t,["resumable"]);s!=null&&d(e,["resumable"],s);const a=c(t,["lastConsumedClientMessageIndex"]);return a!=null&&d(e,["lastConsumedClientMessageIndex"],a),e}function iT(t){const e={};c(t,["setupComplete"])!=null&&d(e,["setupComplete"],$1());const s=c(t,["serverContent"]);s!=null&&d(e,["serverContent"],Q1(s));const a=c(t,["toolCall"]);a!=null&&d(e,["toolCall"],W1(a));const u=c(t,["toolCallCancellation"]);u!=null&&d(e,["toolCallCancellation"],Z1(u));const f=c(t,["usageMetadata"]);f!=null&&d(e,["usageMetadata"],eT(f));const p=c(t,["goAway"]);p!=null&&d(e,["goAway"],tT(p));const g=c(t,["sessionResumptionUpdate"]);return g!=null&&d(e,["sessionResumptionUpdate"],nT(g)),e}function sT(){return{}}function oT(t){const e={},i=c(t,["text"]);i!=null&&d(e,["text"],i);const s=c(t,["weight"]);return s!=null&&d(e,["weight"],s),e}function lT(t){const e={},i=c(t,["weightedPrompts"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>oT(a))),d(e,["weightedPrompts"],s)}return e}function aT(t){const e={},i=c(t,["temperature"]);i!=null&&d(e,["temperature"],i);const s=c(t,["topK"]);s!=null&&d(e,["topK"],s);const a=c(t,["seed"]);a!=null&&d(e,["seed"],a);const u=c(t,["guidance"]);u!=null&&d(e,["guidance"],u);const f=c(t,["bpm"]);f!=null&&d(e,["bpm"],f);const p=c(t,["density"]);p!=null&&d(e,["density"],p);const g=c(t,["brightness"]);g!=null&&d(e,["brightness"],g);const m=c(t,["scale"]);m!=null&&d(e,["scale"],m);const y=c(t,["muteBass"]);y!=null&&d(e,["muteBass"],y);const v=c(t,["muteDrums"]);v!=null&&d(e,["muteDrums"],v);const C=c(t,["onlyBassAndDrums"]);return C!=null&&d(e,["onlyBassAndDrums"],C),e}function rT(t){const e={},i=c(t,["clientContent"]);i!=null&&d(e,["clientContent"],lT(i));const s=c(t,["musicGenerationConfig"]);return s!=null&&d(e,["musicGenerationConfig"],aT(s)),e}function cT(t){const e={},i=c(t,["data"]);i!=null&&d(e,["data"],i);const s=c(t,["mimeType"]);s!=null&&d(e,["mimeType"],s);const a=c(t,["sourceMetadata"]);return a!=null&&d(e,["sourceMetadata"],rT(a)),e}function uT(t){const e={},i=c(t,["audioChunks"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>cT(a))),d(e,["audioChunks"],s)}return e}function dT(t){const e={},i=c(t,["text"]);i!=null&&d(e,["text"],i);const s=c(t,["filteredReason"]);return s!=null&&d(e,["filteredReason"],s),e}function hT(t){const e={};c(t,["setupComplete"])!=null&&d(e,["setupComplete"],sT());const s=c(t,["serverContent"]);s!=null&&d(e,["serverContent"],uT(s));const a=c(t,["filteredPrompt"]);return a!=null&&d(e,["filteredPrompt"],dT(a)),e}function fT(t){const e={},i=c(t,["sessionId"]);return i!=null&&d(e,["sessionId"],i),e}function mT(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function pT(t){const e={},i=c(t,["displayName"]);i!=null&&d(e,["displayName"],i);const s=c(t,["data"]);s!=null&&d(e,["data"],s);const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function gT(t){const e={},i=c(t,["displayName"]);i!=null&&d(e,["displayName"],i);const s=c(t,["fileUri"]);s!=null&&d(e,["fileUri"],s);const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function xT(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],mT(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],pT(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],gT(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function yT(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>xT(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function ng(t){const e={},i=c(t,["text"]);i!=null&&d(e,["text"],i);const s=c(t,["finished"]);return s!=null&&d(e,["finished"],s),e}function vT(t){const e={},i=c(t,["modelTurn"]);i!=null&&d(e,["modelTurn"],yT(i));const s=c(t,["turnComplete"]);s!=null&&d(e,["turnComplete"],s);const a=c(t,["interrupted"]);a!=null&&d(e,["interrupted"],a);const u=c(t,["groundingMetadata"]);u!=null&&d(e,["groundingMetadata"],u);const f=c(t,["generationComplete"]);f!=null&&d(e,["generationComplete"],f);const p=c(t,["inputTranscription"]);p!=null&&d(e,["inputTranscription"],ng(p));const g=c(t,["outputTranscription"]);return g!=null&&d(e,["outputTranscription"],ng(g)),e}function bT(t){const e={},i=c(t,["args"]);i!=null&&d(e,["args"],i);const s=c(t,["name"]);return s!=null&&d(e,["name"],s),e}function CT(t){const e={},i=c(t,["functionCalls"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>bT(a))),d(e,["functionCalls"],s)}return e}function TT(t){const e={},i=c(t,["ids"]);return i!=null&&d(e,["ids"],i),e}function pr(t){const e={},i=c(t,["modality"]);i!=null&&d(e,["modality"],i);const s=c(t,["tokenCount"]);return s!=null&&d(e,["tokenCount"],s),e}function NT(t){const e={},i=c(t,["promptTokenCount"]);i!=null&&d(e,["promptTokenCount"],i);const s=c(t,["cachedContentTokenCount"]);s!=null&&d(e,["cachedContentTokenCount"],s);const a=c(t,["candidatesTokenCount"]);a!=null&&d(e,["responseTokenCount"],a);const u=c(t,["toolUsePromptTokenCount"]);u!=null&&d(e,["toolUsePromptTokenCount"],u);const f=c(t,["thoughtsTokenCount"]);f!=null&&d(e,["thoughtsTokenCount"],f);const p=c(t,["totalTokenCount"]);p!=null&&d(e,["totalTokenCount"],p);const g=c(t,["promptTokensDetails"]);if(g!=null){let N=g;Array.isArray(N)&&(N=N.map(R=>pr(R))),d(e,["promptTokensDetails"],N)}const m=c(t,["cacheTokensDetails"]);if(m!=null){let N=m;Array.isArray(N)&&(N=N.map(R=>pr(R))),d(e,["cacheTokensDetails"],N)}const y=c(t,["candidatesTokensDetails"]);if(y!=null){let N=y;Array.isArray(N)&&(N=N.map(R=>pr(R))),d(e,["responseTokensDetails"],N)}const v=c(t,["toolUsePromptTokensDetails"]);if(v!=null){let N=v;Array.isArray(N)&&(N=N.map(R=>pr(R))),d(e,["toolUsePromptTokensDetails"],N)}const C=c(t,["trafficType"]);return C!=null&&d(e,["trafficType"],C),e}function kT(t){const e={},i=c(t,["timeLeft"]);return i!=null&&d(e,["timeLeft"],i),e}function ST(t){const e={},i=c(t,["newHandle"]);i!=null&&d(e,["newHandle"],i);const s=c(t,["resumable"]);s!=null&&d(e,["resumable"],s);const a=c(t,["lastConsumedClientMessageIndex"]);return a!=null&&d(e,["lastConsumedClientMessageIndex"],a),e}function wT(t){const e={},i=c(t,["setupComplete"]);i!=null&&d(e,["setupComplete"],fT(i));const s=c(t,["serverContent"]);s!=null&&d(e,["serverContent"],vT(s));const a=c(t,["toolCall"]);a!=null&&d(e,["toolCall"],CT(a));const u=c(t,["toolCallCancellation"]);u!=null&&d(e,["toolCallCancellation"],TT(u));const f=c(t,["usageMetadata"]);f!=null&&d(e,["usageMetadata"],NT(f));const p=c(t,["goAway"]);p!=null&&d(e,["goAway"],kT(p));const g=c(t,["sessionResumptionUpdate"]);return g!=null&&d(e,["sessionResumptionUpdate"],ST(g)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ET(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function MT(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(t,["data"]);i!=null&&d(e,["data"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function AT(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(t,["fileUri"]);i!=null&&d(e,["fileUri"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function RT(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],ET(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],MT(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],AT(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function _r(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>RT(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function IT(t){const e={},i=c(t,["anyOf"]);i!=null&&d(e,["anyOf"],i);const s=c(t,["default"]);s!=null&&d(e,["default"],s);const a=c(t,["description"]);a!=null&&d(e,["description"],a);const u=c(t,["enum"]);u!=null&&d(e,["enum"],u);const f=c(t,["example"]);f!=null&&d(e,["example"],f);const p=c(t,["format"]);p!=null&&d(e,["format"],p);const g=c(t,["items"]);g!=null&&d(e,["items"],g);const m=c(t,["maxItems"]);m!=null&&d(e,["maxItems"],m);const y=c(t,["maxLength"]);y!=null&&d(e,["maxLength"],y);const v=c(t,["maxProperties"]);v!=null&&d(e,["maxProperties"],v);const C=c(t,["maximum"]);C!=null&&d(e,["maximum"],C);const N=c(t,["minItems"]);N!=null&&d(e,["minItems"],N);const R=c(t,["minLength"]);R!=null&&d(e,["minLength"],R);const L=c(t,["minProperties"]);L!=null&&d(e,["minProperties"],L);const O=c(t,["minimum"]);O!=null&&d(e,["minimum"],O);const J=c(t,["nullable"]);J!=null&&d(e,["nullable"],J);const P=c(t,["pattern"]);P!=null&&d(e,["pattern"],P);const $=c(t,["properties"]);$!=null&&d(e,["properties"],$);const ne=c(t,["propertyOrdering"]);ne!=null&&d(e,["propertyOrdering"],ne);const z=c(t,["required"]);z!=null&&d(e,["required"],z);const ae=c(t,["title"]);ae!=null&&d(e,["title"],ae);const de=c(t,["type"]);return de!=null&&d(e,["type"],de),e}function _T(t){const e={};if(c(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=c(t,["category"]);i!=null&&d(e,["category"],i);const s=c(t,["threshold"]);return s!=null&&d(e,["threshold"],s),e}function LT(t){const e={},i=c(t,["behavior"]);i!=null&&d(e,["behavior"],i);const s=c(t,["description"]);s!=null&&d(e,["description"],s);const a=c(t,["name"]);a!=null&&d(e,["name"],a);const u=c(t,["parameters"]);u!=null&&d(e,["parameters"],u);const f=c(t,["parametersJsonSchema"]);f!=null&&d(e,["parametersJsonSchema"],f);const p=c(t,["response"]);p!=null&&d(e,["response"],p);const g=c(t,["responseJsonSchema"]);return g!=null&&d(e,["responseJsonSchema"],g),e}function jT(t){const e={},i=c(t,["startTime"]);i!=null&&d(e,["startTime"],i);const s=c(t,["endTime"]);return s!=null&&d(e,["endTime"],s),e}function DT(t){const e={},i=c(t,["timeRangeFilter"]);return i!=null&&d(e,["timeRangeFilter"],jT(i)),e}function PT(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["dynamicThreshold"]);return s!=null&&d(e,["dynamicThreshold"],s),e}function UT(t){const e={},i=c(t,["dynamicRetrievalConfig"]);return i!=null&&d(e,["dynamicRetrievalConfig"],PT(i)),e}function HT(){return{}}function OT(t){const e={},i=c(t,["functionDeclarations"]);if(i!=null){let g=i;Array.isArray(g)&&(g=g.map(m=>LT(m))),d(e,["functionDeclarations"],g)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=c(t,["googleSearch"]);s!=null&&d(e,["googleSearch"],DT(s));const a=c(t,["googleSearchRetrieval"]);if(a!=null&&d(e,["googleSearchRetrieval"],UT(a)),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(c(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");c(t,["urlContext"])!=null&&d(e,["urlContext"],HT());const f=c(t,["codeExecution"]);f!=null&&d(e,["codeExecution"],f);const p=c(t,["computerUse"]);return p!=null&&d(e,["computerUse"],p),e}function GT(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["allowedFunctionNames"]);return s!=null&&d(e,["allowedFunctionNames"],s),e}function VT(t){const e={},i=c(t,["latitude"]);i!=null&&d(e,["latitude"],i);const s=c(t,["longitude"]);return s!=null&&d(e,["longitude"],s),e}function $T(t){const e={},i=c(t,["latLng"]);i!=null&&d(e,["latLng"],VT(i));const s=c(t,["languageCode"]);return s!=null&&d(e,["languageCode"],s),e}function BT(t){const e={},i=c(t,["functionCallingConfig"]);i!=null&&d(e,["functionCallingConfig"],GT(i));const s=c(t,["retrievalConfig"]);return s!=null&&d(e,["retrievalConfig"],$T(s)),e}function qT(t){const e={},i=c(t,["voiceName"]);return i!=null&&d(e,["voiceName"],i),e}function s0(t){const e={},i=c(t,["prebuiltVoiceConfig"]);return i!=null&&d(e,["prebuiltVoiceConfig"],qT(i)),e}function zT(t){const e={},i=c(t,["speaker"]);i!=null&&d(e,["speaker"],i);const s=c(t,["voiceConfig"]);return s!=null&&d(e,["voiceConfig"],s0(s)),e}function FT(t){const e={},i=c(t,["speakerVoiceConfigs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>zT(a))),d(e,["speakerVoiceConfigs"],s)}return e}function KT(t){const e={},i=c(t,["voiceConfig"]);i!=null&&d(e,["voiceConfig"],s0(i));const s=c(t,["multiSpeakerVoiceConfig"]);s!=null&&d(e,["multiSpeakerVoiceConfig"],FT(s));const a=c(t,["languageCode"]);return a!=null&&d(e,["languageCode"],a),e}function YT(t){const e={},i=c(t,["includeThoughts"]);i!=null&&d(e,["includeThoughts"],i);const s=c(t,["thinkingBudget"]);return s!=null&&d(e,["thinkingBudget"],s),e}function JT(t,e,i){const s={},a=c(e,["systemInstruction"]);i!==void 0&&a!=null&&d(i,["systemInstruction"],_r(en(a)));const u=c(e,["temperature"]);u!=null&&d(s,["temperature"],u);const f=c(e,["topP"]);f!=null&&d(s,["topP"],f);const p=c(e,["topK"]);p!=null&&d(s,["topK"],p);const g=c(e,["candidateCount"]);g!=null&&d(s,["candidateCount"],g);const m=c(e,["maxOutputTokens"]);m!=null&&d(s,["maxOutputTokens"],m);const y=c(e,["stopSequences"]);y!=null&&d(s,["stopSequences"],y);const v=c(e,["responseLogprobs"]);v!=null&&d(s,["responseLogprobs"],v);const C=c(e,["logprobs"]);C!=null&&d(s,["logprobs"],C);const N=c(e,["presencePenalty"]);N!=null&&d(s,["presencePenalty"],N);const R=c(e,["frequencyPenalty"]);R!=null&&d(s,["frequencyPenalty"],R);const L=c(e,["seed"]);L!=null&&d(s,["seed"],L);const O=c(e,["responseMimeType"]);O!=null&&d(s,["responseMimeType"],O);const J=c(e,["responseSchema"]);J!=null&&d(s,["responseSchema"],IT(ud(J)));const P=c(e,["responseJsonSchema"]);if(P!=null&&d(s,["responseJsonSchema"],P),c(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(c(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const $=c(e,["safetySettings"]);if(i!==void 0&&$!=null){let _=$;Array.isArray(_)&&(_=_.map(me=>_T(me))),d(i,["safetySettings"],_)}const ne=c(e,["tools"]);if(i!==void 0&&ne!=null){let _=No(ne);Array.isArray(_)&&(_=_.map(me=>OT(To(me)))),d(i,["tools"],_)}const z=c(e,["toolConfig"]);if(i!==void 0&&z!=null&&d(i,["toolConfig"],BT(z)),c(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const ae=c(e,["cachedContent"]);i!==void 0&&ae!=null&&d(i,["cachedContent"],ui(t,ae));const de=c(e,["responseModalities"]);de!=null&&d(s,["responseModalities"],de);const re=c(e,["mediaResolution"]);re!=null&&d(s,["mediaResolution"],re);const se=c(e,["speechConfig"]);if(se!=null&&d(s,["speechConfig"],KT(dd(se))),c(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const oe=c(e,["thinkingConfig"]);return oe!=null&&d(s,["thinkingConfig"],YT(oe)),s}function ig(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["contents"]);if(a!=null){let f=En(a);Array.isArray(f)&&(f=f.map(p=>_r(p))),d(i,["contents"],f)}const u=c(e,["config"]);return u!=null&&d(i,["generationConfig"],JT(t,u,i)),i}function QT(t,e){const i={},s=c(t,["taskType"]);e!==void 0&&s!=null&&d(e,["requests[]","taskType"],s);const a=c(t,["title"]);e!==void 0&&a!=null&&d(e,["requests[]","title"],a);const u=c(t,["outputDimensionality"]);if(e!==void 0&&u!=null&&d(e,["requests[]","outputDimensionality"],u),c(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(c(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return i}function XT(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["contents"]);a!=null&&d(i,["requests[]","content"],Vg(t,a));const u=c(e,["config"]);u!=null&&d(i,["config"],QT(u,i));const f=c(e,["model"]);return f!==void 0&&d(i,["requests[]","model"],ut(t,f)),i}function WT(t,e){const i={};if(c(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(c(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=c(t,["numberOfImages"]);e!==void 0&&s!=null&&d(e,["parameters","sampleCount"],s);const a=c(t,["aspectRatio"]);e!==void 0&&a!=null&&d(e,["parameters","aspectRatio"],a);const u=c(t,["guidanceScale"]);if(e!==void 0&&u!=null&&d(e,["parameters","guidanceScale"],u),c(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const f=c(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&d(e,["parameters","safetySetting"],f);const p=c(t,["personGeneration"]);e!==void 0&&p!=null&&d(e,["parameters","personGeneration"],p);const g=c(t,["includeSafetyAttributes"]);e!==void 0&&g!=null&&d(e,["parameters","includeSafetyAttributes"],g);const m=c(t,["includeRaiReason"]);e!==void 0&&m!=null&&d(e,["parameters","includeRaiReason"],m);const y=c(t,["language"]);e!==void 0&&y!=null&&d(e,["parameters","language"],y);const v=c(t,["outputMimeType"]);e!==void 0&&v!=null&&d(e,["parameters","outputOptions","mimeType"],v);const C=c(t,["outputCompressionQuality"]);if(e!==void 0&&C!=null&&d(e,["parameters","outputOptions","compressionQuality"],C),c(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(c(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return i}function ZT(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["prompt"]);a!=null&&d(i,["instances[0]","prompt"],a);const u=c(e,["config"]);return u!=null&&d(i,["config"],WT(u,i)),i}function e2(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","name"],ut(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function t2(t,e,i){const s={},a=c(e,["pageSize"]);i!==void 0&&a!=null&&d(i,["_query","pageSize"],a);const u=c(e,["pageToken"]);i!==void 0&&u!=null&&d(i,["_query","pageToken"],u);const f=c(e,["filter"]);i!==void 0&&f!=null&&d(i,["_query","filter"],f);const p=c(e,["queryBase"]);return i!==void 0&&p!=null&&d(i,["_url","models_url"],qg(t,p)),s}function n2(t,e){const i={},s=c(e,["config"]);return s!=null&&d(i,["config"],t2(t,s,i)),i}function i2(t,e){const i={},s=c(t,["displayName"]);e!==void 0&&s!=null&&d(e,["displayName"],s);const a=c(t,["description"]);e!==void 0&&a!=null&&d(e,["description"],a);const u=c(t,["defaultCheckpointId"]);return e!==void 0&&u!=null&&d(e,["defaultCheckpointId"],u),i}function s2(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","name"],ut(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],i2(a,i)),i}function o2(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","name"],ut(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function l2(t){const e={};if(c(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(c(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(c(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function a2(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["contents"]);if(a!=null){let f=En(a);Array.isArray(f)&&(f=f.map(p=>_r(p))),d(i,["contents"],f)}const u=c(e,["config"]);return u!=null&&d(i,["config"],l2(u)),i}function r2(t){const e={};if(c(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const i=c(t,["imageBytes"]);i!=null&&d(e,["bytesBase64Encoded"],di(i));const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function c2(t,e){const i={},s=c(t,["numberOfVideos"]);if(e!==void 0&&s!=null&&d(e,["parameters","sampleCount"],s),c(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(c(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=c(t,["durationSeconds"]);if(e!==void 0&&a!=null&&d(e,["parameters","durationSeconds"],a),c(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=c(t,["aspectRatio"]);if(e!==void 0&&u!=null&&d(e,["parameters","aspectRatio"],u),c(t,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const f=c(t,["personGeneration"]);if(e!==void 0&&f!=null&&d(e,["parameters","personGeneration"],f),c(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const p=c(t,["negativePrompt"]);e!==void 0&&p!=null&&d(e,["parameters","negativePrompt"],p);const g=c(t,["enhancePrompt"]);if(e!==void 0&&g!=null&&d(e,["parameters","enhancePrompt"],g),c(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(c(t,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");if(c(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return i}function u2(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["prompt"]);a!=null&&d(i,["instances[0]","prompt"],a);const u=c(e,["image"]);if(u!=null&&d(i,["instances[0]","image"],r2(u)),c(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");const f=c(e,["config"]);return f!=null&&d(i,["config"],c2(f,i)),i}function d2(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function h2(t){const e={},i=c(t,["displayName"]);i!=null&&d(e,["displayName"],i);const s=c(t,["data"]);s!=null&&d(e,["data"],s);const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function f2(t){const e={},i=c(t,["displayName"]);i!=null&&d(e,["displayName"],i);const s=c(t,["fileUri"]);s!=null&&d(e,["fileUri"],s);const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function m2(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],d2(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],h2(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],f2(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function So(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>m2(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function p2(t){const e={},i=c(t,["anyOf"]);i!=null&&d(e,["anyOf"],i);const s=c(t,["default"]);s!=null&&d(e,["default"],s);const a=c(t,["description"]);a!=null&&d(e,["description"],a);const u=c(t,["enum"]);u!=null&&d(e,["enum"],u);const f=c(t,["example"]);f!=null&&d(e,["example"],f);const p=c(t,["format"]);p!=null&&d(e,["format"],p);const g=c(t,["items"]);g!=null&&d(e,["items"],g);const m=c(t,["maxItems"]);m!=null&&d(e,["maxItems"],m);const y=c(t,["maxLength"]);y!=null&&d(e,["maxLength"],y);const v=c(t,["maxProperties"]);v!=null&&d(e,["maxProperties"],v);const C=c(t,["maximum"]);C!=null&&d(e,["maximum"],C);const N=c(t,["minItems"]);N!=null&&d(e,["minItems"],N);const R=c(t,["minLength"]);R!=null&&d(e,["minLength"],R);const L=c(t,["minProperties"]);L!=null&&d(e,["minProperties"],L);const O=c(t,["minimum"]);O!=null&&d(e,["minimum"],O);const J=c(t,["nullable"]);J!=null&&d(e,["nullable"],J);const P=c(t,["pattern"]);P!=null&&d(e,["pattern"],P);const $=c(t,["properties"]);$!=null&&d(e,["properties"],$);const ne=c(t,["propertyOrdering"]);ne!=null&&d(e,["propertyOrdering"],ne);const z=c(t,["required"]);z!=null&&d(e,["required"],z);const ae=c(t,["title"]);ae!=null&&d(e,["title"],ae);const de=c(t,["type"]);return de!=null&&d(e,["type"],de),e}function g2(t){const e={},i=c(t,["featureSelectionPreference"]);return i!=null&&d(e,["featureSelectionPreference"],i),e}function x2(t){const e={},i=c(t,["method"]);i!=null&&d(e,["method"],i);const s=c(t,["category"]);s!=null&&d(e,["category"],s);const a=c(t,["threshold"]);return a!=null&&d(e,["threshold"],a),e}function y2(t){const e={};if(c(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const i=c(t,["description"]);i!=null&&d(e,["description"],i);const s=c(t,["name"]);s!=null&&d(e,["name"],s);const a=c(t,["parameters"]);a!=null&&d(e,["parameters"],a);const u=c(t,["parametersJsonSchema"]);u!=null&&d(e,["parametersJsonSchema"],u);const f=c(t,["response"]);f!=null&&d(e,["response"],f);const p=c(t,["responseJsonSchema"]);return p!=null&&d(e,["responseJsonSchema"],p),e}function v2(t){const e={},i=c(t,["startTime"]);i!=null&&d(e,["startTime"],i);const s=c(t,["endTime"]);return s!=null&&d(e,["endTime"],s),e}function b2(t){const e={},i=c(t,["timeRangeFilter"]);return i!=null&&d(e,["timeRangeFilter"],v2(i)),e}function C2(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["dynamicThreshold"]);return s!=null&&d(e,["dynamicThreshold"],s),e}function T2(t){const e={},i=c(t,["dynamicRetrievalConfig"]);return i!=null&&d(e,["dynamicRetrievalConfig"],C2(i)),e}function N2(){return{}}function k2(t){const e={},i=c(t,["apiKeyString"]);return i!=null&&d(e,["apiKeyString"],i),e}function S2(t){const e={},i=c(t,["apiKeyConfig"]);i!=null&&d(e,["apiKeyConfig"],k2(i));const s=c(t,["authType"]);s!=null&&d(e,["authType"],s);const a=c(t,["googleServiceAccountConfig"]);a!=null&&d(e,["googleServiceAccountConfig"],a);const u=c(t,["httpBasicAuthConfig"]);u!=null&&d(e,["httpBasicAuthConfig"],u);const f=c(t,["oauthConfig"]);f!=null&&d(e,["oauthConfig"],f);const p=c(t,["oidcConfig"]);return p!=null&&d(e,["oidcConfig"],p),e}function w2(t){const e={},i=c(t,["authConfig"]);return i!=null&&d(e,["authConfig"],S2(i)),e}function E2(){return{}}function o0(t){const e={},i=c(t,["functionDeclarations"]);if(i!=null){let v=i;Array.isArray(v)&&(v=v.map(C=>y2(C))),d(e,["functionDeclarations"],v)}const s=c(t,["retrieval"]);s!=null&&d(e,["retrieval"],s);const a=c(t,["googleSearch"]);a!=null&&d(e,["googleSearch"],b2(a));const u=c(t,["googleSearchRetrieval"]);u!=null&&d(e,["googleSearchRetrieval"],T2(u)),c(t,["enterpriseWebSearch"])!=null&&d(e,["enterpriseWebSearch"],N2());const p=c(t,["googleMaps"]);p!=null&&d(e,["googleMaps"],w2(p)),c(t,["urlContext"])!=null&&d(e,["urlContext"],E2());const m=c(t,["codeExecution"]);m!=null&&d(e,["codeExecution"],m);const y=c(t,["computerUse"]);return y!=null&&d(e,["computerUse"],y),e}function M2(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["allowedFunctionNames"]);return s!=null&&d(e,["allowedFunctionNames"],s),e}function A2(t){const e={},i=c(t,["latitude"]);i!=null&&d(e,["latitude"],i);const s=c(t,["longitude"]);return s!=null&&d(e,["longitude"],s),e}function R2(t){const e={},i=c(t,["latLng"]);i!=null&&d(e,["latLng"],A2(i));const s=c(t,["languageCode"]);return s!=null&&d(e,["languageCode"],s),e}function I2(t){const e={},i=c(t,["functionCallingConfig"]);i!=null&&d(e,["functionCallingConfig"],M2(i));const s=c(t,["retrievalConfig"]);return s!=null&&d(e,["retrievalConfig"],R2(s)),e}function _2(t){const e={},i=c(t,["voiceName"]);return i!=null&&d(e,["voiceName"],i),e}function L2(t){const e={},i=c(t,["prebuiltVoiceConfig"]);return i!=null&&d(e,["prebuiltVoiceConfig"],_2(i)),e}function j2(t){const e={},i=c(t,["voiceConfig"]);if(i!=null&&d(e,["voiceConfig"],L2(i)),c(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const s=c(t,["languageCode"]);return s!=null&&d(e,["languageCode"],s),e}function D2(t){const e={},i=c(t,["includeThoughts"]);i!=null&&d(e,["includeThoughts"],i);const s=c(t,["thinkingBudget"]);return s!=null&&d(e,["thinkingBudget"],s),e}function P2(t,e,i){const s={},a=c(e,["systemInstruction"]);i!==void 0&&a!=null&&d(i,["systemInstruction"],So(en(a)));const u=c(e,["temperature"]);u!=null&&d(s,["temperature"],u);const f=c(e,["topP"]);f!=null&&d(s,["topP"],f);const p=c(e,["topK"]);p!=null&&d(s,["topK"],p);const g=c(e,["candidateCount"]);g!=null&&d(s,["candidateCount"],g);const m=c(e,["maxOutputTokens"]);m!=null&&d(s,["maxOutputTokens"],m);const y=c(e,["stopSequences"]);y!=null&&d(s,["stopSequences"],y);const v=c(e,["responseLogprobs"]);v!=null&&d(s,["responseLogprobs"],v);const C=c(e,["logprobs"]);C!=null&&d(s,["logprobs"],C);const N=c(e,["presencePenalty"]);N!=null&&d(s,["presencePenalty"],N);const R=c(e,["frequencyPenalty"]);R!=null&&d(s,["frequencyPenalty"],R);const L=c(e,["seed"]);L!=null&&d(s,["seed"],L);const O=c(e,["responseMimeType"]);O!=null&&d(s,["responseMimeType"],O);const J=c(e,["responseSchema"]);J!=null&&d(s,["responseSchema"],p2(ud(J)));const P=c(e,["responseJsonSchema"]);P!=null&&d(s,["responseJsonSchema"],P);const $=c(e,["routingConfig"]);$!=null&&d(s,["routingConfig"],$);const ne=c(e,["modelSelectionConfig"]);ne!=null&&d(s,["modelConfig"],g2(ne));const z=c(e,["safetySettings"]);if(i!==void 0&&z!=null){let H=z;Array.isArray(H)&&(H=H.map(k=>x2(k))),d(i,["safetySettings"],H)}const ae=c(e,["tools"]);if(i!==void 0&&ae!=null){let H=No(ae);Array.isArray(H)&&(H=H.map(k=>o0(To(k)))),d(i,["tools"],H)}const de=c(e,["toolConfig"]);i!==void 0&&de!=null&&d(i,["toolConfig"],I2(de));const re=c(e,["labels"]);i!==void 0&&re!=null&&d(i,["labels"],re);const se=c(e,["cachedContent"]);i!==void 0&&se!=null&&d(i,["cachedContent"],ui(t,se));const oe=c(e,["responseModalities"]);oe!=null&&d(s,["responseModalities"],oe);const _=c(e,["mediaResolution"]);_!=null&&d(s,["mediaResolution"],_);const me=c(e,["speechConfig"]);me!=null&&d(s,["speechConfig"],j2(dd(me)));const Y=c(e,["audioTimestamp"]);Y!=null&&d(s,["audioTimestamp"],Y);const ue=c(e,["thinkingConfig"]);return ue!=null&&d(s,["thinkingConfig"],D2(ue)),s}function sg(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["contents"]);if(a!=null){let f=En(a);Array.isArray(f)&&(f=f.map(p=>So(p))),d(i,["contents"],f)}const u=c(e,["config"]);return u!=null&&d(i,["generationConfig"],P2(t,u,i)),i}function U2(t,e){const i={},s=c(t,["taskType"]);e!==void 0&&s!=null&&d(e,["instances[]","task_type"],s);const a=c(t,["title"]);e!==void 0&&a!=null&&d(e,["instances[]","title"],a);const u=c(t,["outputDimensionality"]);e!==void 0&&u!=null&&d(e,["parameters","outputDimensionality"],u);const f=c(t,["mimeType"]);e!==void 0&&f!=null&&d(e,["instances[]","mimeType"],f);const p=c(t,["autoTruncate"]);return e!==void 0&&p!=null&&d(e,["parameters","autoTruncate"],p),i}function H2(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["contents"]);a!=null&&d(i,["instances[]","content"],Vg(t,a));const u=c(e,["config"]);return u!=null&&d(i,["config"],U2(u,i)),i}function O2(t,e){const i={},s=c(t,["outputGcsUri"]);e!==void 0&&s!=null&&d(e,["parameters","storageUri"],s);const a=c(t,["negativePrompt"]);e!==void 0&&a!=null&&d(e,["parameters","negativePrompt"],a);const u=c(t,["numberOfImages"]);e!==void 0&&u!=null&&d(e,["parameters","sampleCount"],u);const f=c(t,["aspectRatio"]);e!==void 0&&f!=null&&d(e,["parameters","aspectRatio"],f);const p=c(t,["guidanceScale"]);e!==void 0&&p!=null&&d(e,["parameters","guidanceScale"],p);const g=c(t,["seed"]);e!==void 0&&g!=null&&d(e,["parameters","seed"],g);const m=c(t,["safetyFilterLevel"]);e!==void 0&&m!=null&&d(e,["parameters","safetySetting"],m);const y=c(t,["personGeneration"]);e!==void 0&&y!=null&&d(e,["parameters","personGeneration"],y);const v=c(t,["includeSafetyAttributes"]);e!==void 0&&v!=null&&d(e,["parameters","includeSafetyAttributes"],v);const C=c(t,["includeRaiReason"]);e!==void 0&&C!=null&&d(e,["parameters","includeRaiReason"],C);const N=c(t,["language"]);e!==void 0&&N!=null&&d(e,["parameters","language"],N);const R=c(t,["outputMimeType"]);e!==void 0&&R!=null&&d(e,["parameters","outputOptions","mimeType"],R);const L=c(t,["outputCompressionQuality"]);e!==void 0&&L!=null&&d(e,["parameters","outputOptions","compressionQuality"],L);const O=c(t,["addWatermark"]);e!==void 0&&O!=null&&d(e,["parameters","addWatermark"],O);const J=c(t,["enhancePrompt"]);return e!==void 0&&J!=null&&d(e,["parameters","enhancePrompt"],J),i}function G2(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["prompt"]);a!=null&&d(i,["instances[0]","prompt"],a);const u=c(e,["config"]);return u!=null&&d(i,["config"],O2(u,i)),i}function Lr(t){const e={},i=c(t,["gcsUri"]);i!=null&&d(e,["gcsUri"],i);const s=c(t,["imageBytes"]);s!=null&&d(e,["bytesBase64Encoded"],di(s));const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function V2(t){const e={},i=c(t,["maskMode"]);i!=null&&d(e,["maskMode"],i);const s=c(t,["segmentationClasses"]);s!=null&&d(e,["maskClasses"],s);const a=c(t,["maskDilation"]);return a!=null&&d(e,["dilation"],a),e}function $2(t){const e={},i=c(t,["controlType"]);i!=null&&d(e,["controlType"],i);const s=c(t,["enableControlImageComputation"]);return s!=null&&d(e,["computeControl"],s),e}function B2(t){const e={},i=c(t,["styleDescription"]);return i!=null&&d(e,["styleDescription"],i),e}function q2(t){const e={},i=c(t,["subjectType"]);i!=null&&d(e,["subjectType"],i);const s=c(t,["subjectDescription"]);return s!=null&&d(e,["subjectDescription"],s),e}function z2(t){const e={},i=c(t,["referenceImage"]);i!=null&&d(e,["referenceImage"],Lr(i));const s=c(t,["referenceId"]);s!=null&&d(e,["referenceId"],s);const a=c(t,["referenceType"]);a!=null&&d(e,["referenceType"],a);const u=c(t,["maskImageConfig"]);u!=null&&d(e,["maskImageConfig"],V2(u));const f=c(t,["controlImageConfig"]);f!=null&&d(e,["controlImageConfig"],$2(f));const p=c(t,["styleImageConfig"]);p!=null&&d(e,["styleImageConfig"],B2(p));const g=c(t,["subjectImageConfig"]);return g!=null&&d(e,["subjectImageConfig"],q2(g)),e}function F2(t,e){const i={},s=c(t,["outputGcsUri"]);e!==void 0&&s!=null&&d(e,["parameters","storageUri"],s);const a=c(t,["negativePrompt"]);e!==void 0&&a!=null&&d(e,["parameters","negativePrompt"],a);const u=c(t,["numberOfImages"]);e!==void 0&&u!=null&&d(e,["parameters","sampleCount"],u);const f=c(t,["aspectRatio"]);e!==void 0&&f!=null&&d(e,["parameters","aspectRatio"],f);const p=c(t,["guidanceScale"]);e!==void 0&&p!=null&&d(e,["parameters","guidanceScale"],p);const g=c(t,["seed"]);e!==void 0&&g!=null&&d(e,["parameters","seed"],g);const m=c(t,["safetyFilterLevel"]);e!==void 0&&m!=null&&d(e,["parameters","safetySetting"],m);const y=c(t,["personGeneration"]);e!==void 0&&y!=null&&d(e,["parameters","personGeneration"],y);const v=c(t,["includeSafetyAttributes"]);e!==void 0&&v!=null&&d(e,["parameters","includeSafetyAttributes"],v);const C=c(t,["includeRaiReason"]);e!==void 0&&C!=null&&d(e,["parameters","includeRaiReason"],C);const N=c(t,["language"]);e!==void 0&&N!=null&&d(e,["parameters","language"],N);const R=c(t,["outputMimeType"]);e!==void 0&&R!=null&&d(e,["parameters","outputOptions","mimeType"],R);const L=c(t,["outputCompressionQuality"]);e!==void 0&&L!=null&&d(e,["parameters","outputOptions","compressionQuality"],L);const O=c(t,["addWatermark"]);e!==void 0&&O!=null&&d(e,["parameters","addWatermark"],O);const J=c(t,["editMode"]);e!==void 0&&J!=null&&d(e,["parameters","editMode"],J);const P=c(t,["baseSteps"]);return e!==void 0&&P!=null&&d(e,["parameters","editConfig","baseSteps"],P),i}function K2(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["prompt"]);a!=null&&d(i,["instances[0]","prompt"],a);const u=c(e,["referenceImages"]);if(u!=null){let p=u;Array.isArray(p)&&(p=p.map(g=>z2(g))),d(i,["instances[0]","referenceImages"],p)}const f=c(e,["config"]);return f!=null&&d(i,["config"],F2(f,i)),i}function Y2(t,e){const i={},s=c(t,["includeRaiReason"]);e!==void 0&&s!=null&&d(e,["parameters","includeRaiReason"],s);const a=c(t,["outputMimeType"]);e!==void 0&&a!=null&&d(e,["parameters","outputOptions","mimeType"],a);const u=c(t,["outputCompressionQuality"]);e!==void 0&&u!=null&&d(e,["parameters","outputOptions","compressionQuality"],u);const f=c(t,["enhanceInputImage"]);e!==void 0&&f!=null&&d(e,["parameters","upscaleConfig","enhanceInputImage"],f);const p=c(t,["imagePreservationFactor"]);e!==void 0&&p!=null&&d(e,["parameters","upscaleConfig","imagePreservationFactor"],p);const g=c(t,["numberOfImages"]);e!==void 0&&g!=null&&d(e,["parameters","sampleCount"],g);const m=c(t,["mode"]);return e!==void 0&&m!=null&&d(e,["parameters","mode"],m),i}function J2(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["image"]);a!=null&&d(i,["instances[0]","image"],Lr(a));const u=c(e,["upscaleFactor"]);u!=null&&d(i,["parameters","upscaleConfig","upscaleFactor"],u);const f=c(e,["config"]);return f!=null&&d(i,["config"],Y2(f,i)),i}function Q2(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","name"],ut(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function X2(t,e,i){const s={},a=c(e,["pageSize"]);i!==void 0&&a!=null&&d(i,["_query","pageSize"],a);const u=c(e,["pageToken"]);i!==void 0&&u!=null&&d(i,["_query","pageToken"],u);const f=c(e,["filter"]);i!==void 0&&f!=null&&d(i,["_query","filter"],f);const p=c(e,["queryBase"]);return i!==void 0&&p!=null&&d(i,["_url","models_url"],qg(t,p)),s}function W2(t,e){const i={},s=c(e,["config"]);return s!=null&&d(i,["config"],X2(t,s,i)),i}function Z2(t,e){const i={},s=c(t,["displayName"]);e!==void 0&&s!=null&&d(e,["displayName"],s);const a=c(t,["description"]);e!==void 0&&a!=null&&d(e,["description"],a);const u=c(t,["defaultCheckpointId"]);return e!==void 0&&u!=null&&d(e,["defaultCheckpointId"],u),i}function eN(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],Z2(a,i)),i}function tN(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","name"],ut(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],a),i}function nN(t,e){const i={},s=c(t,["systemInstruction"]);e!==void 0&&s!=null&&d(e,["systemInstruction"],So(en(s)));const a=c(t,["tools"]);if(e!==void 0&&a!=null){let f=a;Array.isArray(f)&&(f=f.map(p=>o0(p))),d(e,["tools"],f)}const u=c(t,["generationConfig"]);return e!==void 0&&u!=null&&d(e,["generationConfig"],u),i}function iN(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["contents"]);if(a!=null){let f=En(a);Array.isArray(f)&&(f=f.map(p=>So(p))),d(i,["contents"],f)}const u=c(e,["config"]);return u!=null&&d(i,["config"],nN(u,i)),i}function sN(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["contents"]);if(a!=null){let f=En(a);Array.isArray(f)&&(f=f.map(p=>So(p))),d(i,["contents"],f)}const u=c(e,["config"]);return u!=null&&d(i,["config"],u),i}function oN(t){const e={},i=c(t,["uri"]);i!=null&&d(e,["gcsUri"],i);const s=c(t,["videoBytes"]);s!=null&&d(e,["bytesBase64Encoded"],di(s));const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function lN(t,e){const i={},s=c(t,["numberOfVideos"]);e!==void 0&&s!=null&&d(e,["parameters","sampleCount"],s);const a=c(t,["outputGcsUri"]);e!==void 0&&a!=null&&d(e,["parameters","storageUri"],a);const u=c(t,["fps"]);e!==void 0&&u!=null&&d(e,["parameters","fps"],u);const f=c(t,["durationSeconds"]);e!==void 0&&f!=null&&d(e,["parameters","durationSeconds"],f);const p=c(t,["seed"]);e!==void 0&&p!=null&&d(e,["parameters","seed"],p);const g=c(t,["aspectRatio"]);e!==void 0&&g!=null&&d(e,["parameters","aspectRatio"],g);const m=c(t,["resolution"]);e!==void 0&&m!=null&&d(e,["parameters","resolution"],m);const y=c(t,["personGeneration"]);e!==void 0&&y!=null&&d(e,["parameters","personGeneration"],y);const v=c(t,["pubsubTopic"]);e!==void 0&&v!=null&&d(e,["parameters","pubsubTopic"],v);const C=c(t,["negativePrompt"]);e!==void 0&&C!=null&&d(e,["parameters","negativePrompt"],C);const N=c(t,["enhancePrompt"]);e!==void 0&&N!=null&&d(e,["parameters","enhancePrompt"],N);const R=c(t,["generateAudio"]);e!==void 0&&R!=null&&d(e,["parameters","generateAudio"],R);const L=c(t,["lastFrame"]);e!==void 0&&L!=null&&d(e,["instances[0]","lastFrame"],Lr(L));const O=c(t,["compressionQuality"]);return e!==void 0&&O!=null&&d(e,["parameters","compressionQuality"],O),i}function aN(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["_url","model"],ut(t,s));const a=c(e,["prompt"]);a!=null&&d(i,["instances[0]","prompt"],a);const u=c(e,["image"]);u!=null&&d(i,["instances[0]","image"],Lr(u));const f=c(e,["video"]);f!=null&&d(i,["instances[0]","video"],oN(f));const p=c(e,["config"]);return p!=null&&d(i,["config"],lN(p,i)),i}function rN(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function cN(t){const e={},i=c(t,["data"]);i!=null&&d(e,["data"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function uN(t){const e={},i=c(t,["fileUri"]);i!=null&&d(e,["fileUri"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function dN(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],rN(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],cN(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],uN(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function hN(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>dN(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function fN(t){const e={},i=c(t,["citationSources"]);return i!=null&&d(e,["citations"],i),e}function mN(t){const e={},i=c(t,["retrievedUrl"]);i!=null&&d(e,["retrievedUrl"],i);const s=c(t,["urlRetrievalStatus"]);return s!=null&&d(e,["urlRetrievalStatus"],s),e}function pN(t){const e={},i=c(t,["urlMetadata"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>mN(a))),d(e,["urlMetadata"],s)}return e}function gN(t){const e={},i=c(t,["content"]);i!=null&&d(e,["content"],hN(i));const s=c(t,["citationMetadata"]);s!=null&&d(e,["citationMetadata"],fN(s));const a=c(t,["tokenCount"]);a!=null&&d(e,["tokenCount"],a);const u=c(t,["finishReason"]);u!=null&&d(e,["finishReason"],u);const f=c(t,["urlContextMetadata"]);f!=null&&d(e,["urlContextMetadata"],pN(f));const p=c(t,["avgLogprobs"]);p!=null&&d(e,["avgLogprobs"],p);const g=c(t,["groundingMetadata"]);g!=null&&d(e,["groundingMetadata"],g);const m=c(t,["index"]);m!=null&&d(e,["index"],m);const y=c(t,["logprobsResult"]);y!=null&&d(e,["logprobsResult"],y);const v=c(t,["safetyRatings"]);return v!=null&&d(e,["safetyRatings"],v),e}function og(t){const e={},i=c(t,["sdkHttpResponse"]);i!=null&&d(e,["sdkHttpResponse"],i);const s=c(t,["candidates"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(g=>gN(g))),d(e,["candidates"],p)}const a=c(t,["modelVersion"]);a!=null&&d(e,["modelVersion"],a);const u=c(t,["promptFeedback"]);u!=null&&d(e,["promptFeedback"],u);const f=c(t,["usageMetadata"]);return f!=null&&d(e,["usageMetadata"],f),e}function xN(t){const e={},i=c(t,["values"]);return i!=null&&d(e,["values"],i),e}function yN(){return{}}function vN(t){const e={},i=c(t,["embeddings"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>xN(u))),d(e,["embeddings"],a)}return c(t,["metadata"])!=null&&d(e,["metadata"],yN()),e}function bN(t){const e={},i=c(t,["bytesBase64Encoded"]);i!=null&&d(e,["imageBytes"],di(i));const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function l0(t){const e={},i=c(t,["safetyAttributes","categories"]);i!=null&&d(e,["categories"],i);const s=c(t,["safetyAttributes","scores"]);s!=null&&d(e,["scores"],s);const a=c(t,["contentType"]);return a!=null&&d(e,["contentType"],a),e}function CN(t){const e={},i=c(t,["_self"]);i!=null&&d(e,["image"],bN(i));const s=c(t,["raiFilteredReason"]);s!=null&&d(e,["raiFilteredReason"],s);const a=c(t,["_self"]);return a!=null&&d(e,["safetyAttributes"],l0(a)),e}function TN(t){const e={},i=c(t,["predictions"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>CN(u))),d(e,["generatedImages"],a)}const s=c(t,["positivePromptSafetyAttributes"]);return s!=null&&d(e,["positivePromptSafetyAttributes"],l0(s)),e}function NN(t){const e={},i=c(t,["baseModel"]);i!=null&&d(e,["baseModel"],i);const s=c(t,["createTime"]);s!=null&&d(e,["createTime"],s);const a=c(t,["updateTime"]);return a!=null&&d(e,["updateTime"],a),e}function td(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["displayName"]);s!=null&&d(e,["displayName"],s);const a=c(t,["description"]);a!=null&&d(e,["description"],a);const u=c(t,["version"]);u!=null&&d(e,["version"],u);const f=c(t,["_self"]);f!=null&&d(e,["tunedModelInfo"],NN(f));const p=c(t,["inputTokenLimit"]);p!=null&&d(e,["inputTokenLimit"],p);const g=c(t,["outputTokenLimit"]);g!=null&&d(e,["outputTokenLimit"],g);const m=c(t,["supportedGenerationMethods"]);return m!=null&&d(e,["supportedActions"],m),e}function kN(t){const e={},i=c(t,["nextPageToken"]);i!=null&&d(e,["nextPageToken"],i);const s=c(t,["_self"]);if(s!=null){let a=zg(s);Array.isArray(a)&&(a=a.map(u=>td(u))),d(e,["models"],a)}return e}function SN(){return{}}function wN(t){const e={},i=c(t,["totalTokens"]);i!=null&&d(e,["totalTokens"],i);const s=c(t,["cachedContentTokenCount"]);return s!=null&&d(e,["cachedContentTokenCount"],s),e}function EN(t){const e={},i=c(t,["video","uri"]);i!=null&&d(e,["uri"],i);const s=c(t,["video","encodedVideo"]);s!=null&&d(e,["videoBytes"],di(s));const a=c(t,["encoding"]);return a!=null&&d(e,["mimeType"],a),e}function MN(t){const e={},i=c(t,["_self"]);return i!=null&&d(e,["video"],EN(i)),e}function AN(t){const e={},i=c(t,["generatedSamples"]);if(i!=null){let u=i;Array.isArray(u)&&(u=u.map(f=>MN(f))),d(e,["generatedVideos"],u)}const s=c(t,["raiMediaFilteredCount"]);s!=null&&d(e,["raiMediaFilteredCount"],s);const a=c(t,["raiMediaFilteredReasons"]);return a!=null&&d(e,["raiMediaFilteredReasons"],a),e}function RN(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["metadata"]);s!=null&&d(e,["metadata"],s);const a=c(t,["done"]);a!=null&&d(e,["done"],a);const u=c(t,["error"]);u!=null&&d(e,["error"],u);const f=c(t,["response","generateVideoResponse"]);return f!=null&&d(e,["response"],AN(f)),e}function IN(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function _N(t){const e={},i=c(t,["displayName"]);i!=null&&d(e,["displayName"],i);const s=c(t,["data"]);s!=null&&d(e,["data"],s);const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function LN(t){const e={},i=c(t,["displayName"]);i!=null&&d(e,["displayName"],i);const s=c(t,["fileUri"]);s!=null&&d(e,["fileUri"],s);const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function jN(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],IN(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],_N(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],LN(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function DN(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>jN(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function PN(t){const e={},i=c(t,["citations"]);return i!=null&&d(e,["citations"],i),e}function UN(t){const e={},i=c(t,["retrievedUrl"]);i!=null&&d(e,["retrievedUrl"],i);const s=c(t,["urlRetrievalStatus"]);return s!=null&&d(e,["urlRetrievalStatus"],s),e}function HN(t){const e={},i=c(t,["urlMetadata"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>UN(a))),d(e,["urlMetadata"],s)}return e}function ON(t){const e={},i=c(t,["content"]);i!=null&&d(e,["content"],DN(i));const s=c(t,["citationMetadata"]);s!=null&&d(e,["citationMetadata"],PN(s));const a=c(t,["finishMessage"]);a!=null&&d(e,["finishMessage"],a);const u=c(t,["finishReason"]);u!=null&&d(e,["finishReason"],u);const f=c(t,["urlContextMetadata"]);f!=null&&d(e,["urlContextMetadata"],HN(f));const p=c(t,["avgLogprobs"]);p!=null&&d(e,["avgLogprobs"],p);const g=c(t,["groundingMetadata"]);g!=null&&d(e,["groundingMetadata"],g);const m=c(t,["index"]);m!=null&&d(e,["index"],m);const y=c(t,["logprobsResult"]);y!=null&&d(e,["logprobsResult"],y);const v=c(t,["safetyRatings"]);return v!=null&&d(e,["safetyRatings"],v),e}function lg(t){const e={},i=c(t,["sdkHttpResponse"]);i!=null&&d(e,["sdkHttpResponse"],i);const s=c(t,["candidates"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(y=>ON(y))),d(e,["candidates"],m)}const a=c(t,["createTime"]);a!=null&&d(e,["createTime"],a);const u=c(t,["responseId"]);u!=null&&d(e,["responseId"],u);const f=c(t,["modelVersion"]);f!=null&&d(e,["modelVersion"],f);const p=c(t,["promptFeedback"]);p!=null&&d(e,["promptFeedback"],p);const g=c(t,["usageMetadata"]);return g!=null&&d(e,["usageMetadata"],g),e}function GN(t){const e={},i=c(t,["truncated"]);i!=null&&d(e,["truncated"],i);const s=c(t,["token_count"]);return s!=null&&d(e,["tokenCount"],s),e}function VN(t){const e={},i=c(t,["values"]);i!=null&&d(e,["values"],i);const s=c(t,["statistics"]);return s!=null&&d(e,["statistics"],GN(s)),e}function $N(t){const e={},i=c(t,["billableCharacterCount"]);return i!=null&&d(e,["billableCharacterCount"],i),e}function BN(t){const e={},i=c(t,["predictions[]","embeddings"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>VN(u))),d(e,["embeddings"],a)}const s=c(t,["metadata"]);return s!=null&&d(e,["metadata"],$N(s)),e}function qN(t){const e={},i=c(t,["gcsUri"]);i!=null&&d(e,["gcsUri"],i);const s=c(t,["bytesBase64Encoded"]);s!=null&&d(e,["imageBytes"],di(s));const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function a0(t){const e={},i=c(t,["safetyAttributes","categories"]);i!=null&&d(e,["categories"],i);const s=c(t,["safetyAttributes","scores"]);s!=null&&d(e,["scores"],s);const a=c(t,["contentType"]);return a!=null&&d(e,["contentType"],a),e}function fd(t){const e={},i=c(t,["_self"]);i!=null&&d(e,["image"],qN(i));const s=c(t,["raiFilteredReason"]);s!=null&&d(e,["raiFilteredReason"],s);const a=c(t,["_self"]);a!=null&&d(e,["safetyAttributes"],a0(a));const u=c(t,["prompt"]);return u!=null&&d(e,["enhancedPrompt"],u),e}function zN(t){const e={},i=c(t,["predictions"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>fd(u))),d(e,["generatedImages"],a)}const s=c(t,["positivePromptSafetyAttributes"]);return s!=null&&d(e,["positivePromptSafetyAttributes"],a0(s)),e}function FN(t){const e={},i=c(t,["predictions"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>fd(a))),d(e,["generatedImages"],s)}return e}function KN(t){const e={},i=c(t,["predictions"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>fd(a))),d(e,["generatedImages"],s)}return e}function YN(t){const e={},i=c(t,["endpoint"]);i!=null&&d(e,["name"],i);const s=c(t,["deployedModelId"]);return s!=null&&d(e,["deployedModelId"],s),e}function JN(t){const e={},i=c(t,["labels","google-vertex-llm-tuning-base-model-id"]);i!=null&&d(e,["baseModel"],i);const s=c(t,["createTime"]);s!=null&&d(e,["createTime"],s);const a=c(t,["updateTime"]);return a!=null&&d(e,["updateTime"],a),e}function QN(t){const e={},i=c(t,["checkpointId"]);i!=null&&d(e,["checkpointId"],i);const s=c(t,["epoch"]);s!=null&&d(e,["epoch"],s);const a=c(t,["step"]);return a!=null&&d(e,["step"],a),e}function nd(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["displayName"]);s!=null&&d(e,["displayName"],s);const a=c(t,["description"]);a!=null&&d(e,["description"],a);const u=c(t,["versionId"]);u!=null&&d(e,["version"],u);const f=c(t,["deployedModels"]);if(f!=null){let v=f;Array.isArray(v)&&(v=v.map(C=>YN(C))),d(e,["endpoints"],v)}const p=c(t,["labels"]);p!=null&&d(e,["labels"],p);const g=c(t,["_self"]);g!=null&&d(e,["tunedModelInfo"],JN(g));const m=c(t,["defaultCheckpointId"]);m!=null&&d(e,["defaultCheckpointId"],m);const y=c(t,["checkpoints"]);if(y!=null){let v=y;Array.isArray(v)&&(v=v.map(C=>QN(C))),d(e,["checkpoints"],v)}return e}function XN(t){const e={},i=c(t,["nextPageToken"]);i!=null&&d(e,["nextPageToken"],i);const s=c(t,["_self"]);if(s!=null){let a=zg(s);Array.isArray(a)&&(a=a.map(u=>nd(u))),d(e,["models"],a)}return e}function WN(){return{}}function ZN(t){const e={},i=c(t,["totalTokens"]);return i!=null&&d(e,["totalTokens"],i),e}function ek(t){const e={},i=c(t,["tokensInfo"]);return i!=null&&d(e,["tokensInfo"],i),e}function tk(t){const e={},i=c(t,["gcsUri"]);i!=null&&d(e,["uri"],i);const s=c(t,["bytesBase64Encoded"]);s!=null&&d(e,["videoBytes"],di(s));const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function nk(t){const e={},i=c(t,["_self"]);return i!=null&&d(e,["video"],tk(i)),e}function ik(t){const e={},i=c(t,["videos"]);if(i!=null){let u=i;Array.isArray(u)&&(u=u.map(f=>nk(f))),d(e,["generatedVideos"],u)}const s=c(t,["raiMediaFilteredCount"]);s!=null&&d(e,["raiMediaFilteredCount"],s);const a=c(t,["raiMediaFilteredReasons"]);return a!=null&&d(e,["raiMediaFilteredReasons"],a),e}function sk(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["metadata"]);s!=null&&d(e,["metadata"],s);const a=c(t,["done"]);a!=null&&d(e,["done"],a);const u=c(t,["error"]);u!=null&&d(e,["error"],u);const f=c(t,["response"]);return f!=null&&d(e,["response"],ik(f)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ok="Content-Type",lk="X-Server-Timeout",ak="User-Agent",id="x-goog-api-client",rk="1.10.0",ck=`google-genai-sdk/${rk}`,uk="v1beta1",dk="v1beta",ag=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class hk{constructor(e){var i,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const a={};this.clientOptions.vertexai?(a.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:uk,a.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(a.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:dk,a.baseUrl="https://generativelanguage.googleapis.com/"),a.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=a,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(a,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),i=new URL(e);return i.protocol=i.protocol=="http:"?"ws":"wss",i.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,i,s){const a=[this.getRequestUrlInternal(i)];return s&&a.push(this.getBaseResourcePath()),e!==""&&a.push(e),new URL(`${a.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let i=this.clientOptions.httpOptions;e.httpOptions&&(i=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),a=this.constructUrl(e.path,i,s);if(e.queryParams)for(const[f,p]of Object.entries(e.queryParams))a.searchParams.append(f,String(p));let u={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else u.body=e.body;return u=await this.includeExtraHttpOptionsToRequestInit(u,i,e.abortSignal),this.unaryApiCall(a,u,e.httpMethod)}patchHttpOptions(e,i){const s=JSON.parse(JSON.stringify(e));for(const[a,u]of Object.entries(i))typeof u=="object"?s[a]=Object.assign(Object.assign({},s[a]),u):u!==void 0&&(s[a]=u);return s}async requestStream(e){let i=this.clientOptions.httpOptions;e.httpOptions&&(i=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),a=this.constructUrl(e.path,i,s);(!a.searchParams.has("alt")||a.searchParams.get("alt")!=="sse")&&a.searchParams.set("alt","sse");let u={};return u.body=e.body,u=await this.includeExtraHttpOptionsToRequestInit(u,i,e.abortSignal),this.streamApiCall(a,u,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,i,s){if(i&&i.timeout||s){const a=new AbortController,u=a.signal;if(i.timeout&&(i==null?void 0:i.timeout)>0){const f=setTimeout(()=>a.abort(),i.timeout);f&&typeof f.unref=="function"&&f.unref()}s&&s.addEventListener("abort",()=>{a.abort()}),e.signal=u}return i&&i.extraBody!==null&&fk(e,i.extraBody),e.headers=await this.getHeadersInternal(i),e}async unaryApiCall(e,i,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},i),{method:s})).then(async a=>(await rg(a),new Ju(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}async streamApiCall(e,i,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},i),{method:s})).then(async a=>(await rg(a),this.processStreamResponse(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}processStreamResponse(e){var i;return xo(this,arguments,function*(){const a=(i=e==null?void 0:e.body)===null||i===void 0?void 0:i.getReader(),u=new TextDecoder("utf-8");if(!a)throw new Error("Response body is empty");try{let f="";for(;;){const{done:p,value:g}=yield yt(a.read());if(p){if(f.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const m=u.decode(g,{stream:!0});try{const v=JSON.parse(m);if("error"in v){const C=JSON.parse(JSON.stringify(v.error)),N=C.status,R=C.code,L=`got status: ${N}. ${JSON.stringify(v)}`;if(R>=400&&R<600)throw new Ir({message:L,status:R})}}catch(v){if(v.name==="ApiError")throw v}f+=m;let y=f.match(ag);for(;y;){const v=y[1];try{const C=new Response(v,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield yt(new Ju(C)),f=f.slice(y[0].length),y=f.match(ag)}catch(C){throw new Error(`exception parsing stream chunk ${v}. ${C}`)}}}}finally{a.releaseLock()}})}async apiCall(e,i){return fetch(e,i).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},i=ck+" "+this.clientOptions.userAgentExtra;return e[ak]=i,e[id]=i,e[ok]="application/json",e}async getHeadersInternal(e){const i=new Headers;if(e&&e.headers){for(const[s,a]of Object.entries(e.headers))i.append(s,a);e.timeout&&e.timeout>0&&i.append(lk,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(i),i}async uploadFile(e,i){var s;const a={};i!=null&&(a.mimeType=i.mimeType,a.name=i.name,a.displayName=i.displayName),a.name&&!a.name.startsWith("files/")&&(a.name=`files/${a.name}`);const u=this.clientOptions.uploader,f=await u.stat(e);a.sizeBytes=String(f.size);const p=(s=i==null?void 0:i.mimeType)!==null&&s!==void 0?s:f.type;if(p===void 0||p==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");a.mimeType=p;const g=await this.fetchUploadUrl(a,i);return u.upload(e,g,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,i){var s;let a={};i!=null&&i.httpOptions?a=i.httpOptions:a={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const u={file:e},f=await this.request({path:Le("upload/v1beta/files",u._url),body:JSON.stringify(u),httpMethod:"POST",httpOptions:a});if(!f||!(f!=null&&f.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const p=(s=f==null?void 0:f.headers)===null||s===void 0?void 0:s["x-goog-upload-url"];if(p===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return p}}async function rg(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const i=t.status;let s;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await t.json():s={error:{message:await t.text(),code:t.status,status:t.statusText}};const a=JSON.stringify(s);throw i>=400&&i<600?new Ir({message:a,status:i}):new Error(a)}}function fk(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let i={};if(typeof t.body=="string"&&t.body.length>0)try{const u=JSON.parse(t.body);if(typeof u=="object"&&u!==null&&!Array.isArray(u))i=u;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function s(u,f){const p=Object.assign({},u);for(const g in f)if(Object.prototype.hasOwnProperty.call(f,g)){const m=f[g],y=p[g];m&&typeof m=="object"&&!Array.isArray(m)&&y&&typeof y=="object"&&!Array.isArray(y)?p[g]=s(y,m):(y&&m&&typeof y!=typeof m&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${g}". Original type: ${typeof y}, New type: ${typeof m}. Overwriting.`),p[g]=m)}return p}const a=s(i,e);t.body=JSON.stringify(a)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mk="mcp_used/unknown";let pk=!1;function r0(t){for(const e of t)if(md(e)||typeof e=="object"&&"inputSchema"in e)return!0;return pk}function c0(t){var e;const i=(e=t[id])!==null&&e!==void 0?e:"";t[id]=(i+` ${mk}`).trimStart()}function gk(t){var e,i,s;return(s=(i=(e=t.config)===null||e===void 0?void 0:e.tools)===null||i===void 0?void 0:i.some(a=>md(a)))!==null&&s!==void 0?s:!1}function xk(t){var e,i,s;return(s=(i=(e=t.config)===null||e===void 0?void 0:e.tools)===null||i===void 0?void 0:i.some(a=>!md(a)))!==null&&s!==void 0?s:!1}function md(t){return t!==null&&typeof t=="object"&&t instanceof pd}function yk(t,e=100){return xo(this,arguments,function*(){let s,a=0;for(;a<e;){const u=yield yt(t.listTools({cursor:s}));for(const f of u.tools)yield yield yt(f),a++;if(!u.nextCursor)break;s=u.nextCursor}})}class pd{constructor(e=[],i){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=i}static create(e,i){return new pd(e,i)}async initialize(){var e,i,s,a;if(this.mcpTools.length>0)return;const u={},f=[];for(const y of this.mcpClients)try{for(var p=!0,g=(i=void 0,Ul(yk(y))),m;m=await g.next(),e=m.done,!e;p=!0){a=m.value,p=!1;const v=a;f.push(v);const C=v.name;if(u[C])throw new Error(`Duplicate function name ${C} found in MCP tools. Please ensure function names are unique.`);u[C]=y}}catch(v){i={error:v}}finally{try{!p&&!e&&(s=g.return)&&await s.call(g)}finally{if(i)throw i.error}}this.mcpTools=f,this.functionNameToMcpClient=u}async tool(){return await this.initialize(),hv(this.mcpTools,this.config)}async callTool(e){await this.initialize();const i=[];for(const s of e)if(s.name in this.functionNameToMcpClient){const a=this.functionNameToMcpClient[s.name];let u;this.config.timeout&&(u={timeout:this.config.timeout});const f=await a.callTool({name:s.name,arguments:s.args},void 0,u);i.push({functionResponse:{name:s.name,response:f.isError?{error:f}:f}})}return i}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function vk(t,e,i){const s=new sv;let a;i.data instanceof Blob?a=JSON.parse(await i.data.text()):a=JSON.parse(i.data);const u=hT(a);Object.assign(s,u),e(s)}class bk{constructor(e,i,s){this.apiClient=e,this.auth=i,this.webSocketFactory=s}async connect(e){var i,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const a=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion(),f=Nk(this.apiClient.getDefaultHeaders()),p=this.apiClient.getApiKey(),g=`${a}/ws/google.ai.generativelanguage.${u}.GenerativeService.BidiGenerateMusic?key=${p}`;let m=()=>{};const y=new Promise($=>{m=$}),v=e.callbacks,C=function(){m({})},N=this.apiClient,R={onopen:C,onmessage:$=>{vk(N,v.onmessage,$)},onerror:(i=v==null?void 0:v.onerror)!==null&&i!==void 0?i:function($){},onclose:(s=v==null?void 0:v.onclose)!==null&&s!==void 0?s:function($){}},L=this.webSocketFactory.create(g,Tk(f),R);L.connect(),await y;const O=ut(this.apiClient,e.model),J=n0({model:O}),P=ed({setup:J});return L.send(JSON.stringify(P)),new Ck(L,this.apiClient)}}class Ck{constructor(e,i){this.conn=e,this.apiClient=i}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const i=u1(e),s=i0(i);this.conn.send(JSON.stringify({clientContent:s}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const i=d1(e),s=ed(i);this.conn.send(JSON.stringify(s))}sendPlaybackControl(e){const i=ed({playbackControl:e});this.conn.send(JSON.stringify(i))}play(){this.sendPlaybackControl(fo.PLAY)}pause(){this.sendPlaybackControl(fo.PAUSE)}stop(){this.sendPlaybackControl(fo.STOP)}resetContext(){this.sendPlaybackControl(fo.RESET_CONTEXT)}close(){this.conn.close()}}function Tk(t){const e={};return t.forEach((i,s)=>{e[s]=i}),e}function Nk(t){const e=new Headers;for(const[i,s]of Object.entries(t))e.append(i,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const kk="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Sk(t,e,i){const s=new iv;let a;i.data instanceof Blob?a=await i.data.text():i.data instanceof ArrayBuffer?a=new TextDecoder().decode(i.data):a=i.data;const u=JSON.parse(a);if(t.isVertexAI()){const f=wT(u);Object.assign(s,f)}else{const f=iT(u);Object.assign(s,f)}e(s)}class wk{constructor(e,i,s){this.apiClient=e,this.auth=i,this.webSocketFactory=s,this.music=new bk(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var i,s,a,u,f,p;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const g=this.apiClient.getWebsocketBaseUrl(),m=this.apiClient.getApiVersion();let y;const v=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&r0(e.config.tools)&&c0(v);const C=Rk(v);if(this.apiClient.isVertexAI())y=`${g}/ws/google.cloud.aiplatform.${m}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(C);else{const se=this.apiClient.getApiKey();let oe="BidiGenerateContent",_="key";se!=null&&se.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),m!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),oe="BidiGenerateContentConstrained",_="access_token"),y=`${g}/ws/google.ai.generativelanguage.${m}.GenerativeService.${oe}?${_}=${se}`}let N=()=>{};const R=new Promise(se=>{N=se}),L=e.callbacks,O=function(){var se;(se=L==null?void 0:L.onopen)===null||se===void 0||se.call(L),N({})},J=this.apiClient,P={onopen:O,onmessage:se=>{Sk(J,L.onmessage,se)},onerror:(i=L==null?void 0:L.onerror)!==null&&i!==void 0?i:function(se){},onclose:(s=L==null?void 0:L.onclose)!==null&&s!==void 0?s:function(se){}},$=this.webSocketFactory.create(y,Ak(C),P);$.connect(),await R;let ne=ut(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&ne.startsWith("publishers/")){const se=this.apiClient.getProject(),oe=this.apiClient.getLocation();ne=`projects/${se}/locations/${oe}/`+ne}let z={};this.apiClient.isVertexAI()&&((a=e.config)===null||a===void 0?void 0:a.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Tr.AUDIO]}:e.config.responseModalities=[Tr.AUDIO]),!((u=e.config)===null||u===void 0)&&u.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const ae=(p=(f=e.config)===null||f===void 0?void 0:f.tools)!==null&&p!==void 0?p:[],de=[];for(const se of ae)if(this.isCallableTool(se)){const oe=se;de.push(await oe.tool())}else de.push(se);de.length>0&&(e.config.tools=de);const re={model:ne,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?z=H1(this.apiClient,re):z=l1(this.apiClient,re),delete z.config,$.send(JSON.stringify(z)),new Mk($,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const Ek={turnComplete:!0};class Mk{constructor(e,i){this.conn=e,this.apiClient=i}tLiveClientContent(e,i){if(i.turns!==null&&i.turns!==void 0){let s=[];try{s=En(i.turns),e.isVertexAI()?s=s.map(a=>So(a)):s=s.map(a=>_r(a))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof i.turns}'`)}return{clientContent:{turns:s,turnComplete:i.turnComplete}}}return{clientContent:{turnComplete:i.turnComplete}}}tLiveClienttToolResponse(e,i){let s=[];if(i.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(i.functionResponses)?s=i.functionResponses:s=[i.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const u of s){if(typeof u!="object"||u===null||!("name"in u)||!("response"in u))throw new Error(`Could not parse function response, type '${typeof u}'.`);if(!e.isVertexAI()&&!("id"in u))throw new Error(kk)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},Ek),e);const i=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(i))}sendRealtimeInput(e){let i={};this.apiClient.isVertexAI()?i={realtimeInput:V1(e)}:i={realtimeInput:c1(e)},this.conn.send(JSON.stringify(i))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const i=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(i))}close(){this.conn.close()}}function Ak(t){const e={};return t.forEach((i,s)=>{e[s]=i}),e}function Rk(t){const e=new Headers;for(const[i,s]of Object.entries(t))e.append(i,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const cg=10;function ug(t){var e,i,s;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let a=!1;for(const f of(i=t==null?void 0:t.tools)!==null&&i!==void 0?i:[])if(br(f)){a=!0;break}if(!a)return!0;const u=(s=t==null?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return u&&(u<0||!Number.isInteger(u))||u==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",u),!0):!1}function br(t){return"callTool"in t&&typeof t.callTool=="function"}function dg(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ik extends Ts{constructor(e){super(),this.apiClient=e,this.generateContent=async i=>{var s,a,u,f,p;const g=await this.processParamsForMcpUsage(i);if(this.maybeMoveToResponseJsonSchem(i),!gk(i)||ug(i.config))return await this.generateContentInternal(g);if(xk(i))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let m,y;const v=En(g.contents),C=(u=(a=(s=g.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&u!==void 0?u:cg;let N=0;for(;N<C&&(m=await this.generateContentInternal(g),!(!m.functionCalls||m.functionCalls.length===0));){const R=m.candidates[0].content,L=[];for(const O of(p=(f=i.config)===null||f===void 0?void 0:f.tools)!==null&&p!==void 0?p:[])if(br(O)){const P=await O.callTool(m.functionCalls);L.push(...P)}N++,y={role:"user",parts:L},g.contents=En(g.contents),g.contents.push(R),g.contents.push(y),dg(g.config)&&(v.push(R),v.push(y))}return dg(g.config)&&(m.automaticFunctionCallingHistory=v),m},this.generateContentStream=async i=>{if(this.maybeMoveToResponseJsonSchem(i),ug(i.config)){const s=await this.processParamsForMcpUsage(i);return await this.generateContentStreamInternal(s)}else return await this.processAfcStream(i)},this.generateImages=async i=>await this.generateImagesInternal(i).then(s=>{var a;let u;const f=[];if(s!=null&&s.generatedImages)for(const g of s.generatedImages)g&&(g!=null&&g.safetyAttributes)&&((a=g==null?void 0:g.safetyAttributes)===null||a===void 0?void 0:a.contentType)==="Positive Prompt"?u=g==null?void 0:g.safetyAttributes:f.push(g);let p;return u?p={generatedImages:f,positivePromptSafetyAttributes:u}:p={generatedImages:f},p}),this.list=async i=>{var s;const f={config:Object.assign(Object.assign({},{queryBase:!0}),i==null?void 0:i.config)};if(this.apiClient.isVertexAI()&&!f.config.queryBase){if(!((s=f.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");f.config.filter="labels.tune-type:*"}return new Bl(ys.PAGED_ITEM_MODELS,p=>this.listInternal(p),await this.listInternal(f),f)},this.editImage=async i=>{const s={model:i.model,prompt:i.prompt,referenceImages:[],config:i.config};return i.referenceImages&&i.referenceImages&&(s.referenceImages=i.referenceImages.map(a=>a.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async i=>{let s={numberOfImages:1,mode:"upscale"};i.config&&(s=Object.assign(Object.assign({},s),i.config));const a={model:i.model,image:i.image,upscaleFactor:i.upscaleFactor,config:s};return await this.upscaleImageInternal(a)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsForMcpUsage(e){var i,s,a;const u=(i=e.config)===null||i===void 0?void 0:i.tools;if(!u)return e;const f=await Promise.all(u.map(async g=>br(g)?await g.tool():g)),p={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:f})};if(p.config.tools=f,e.config&&e.config.tools&&r0(e.config.tools)){const g=(a=(s=e.config.httpOptions)===null||s===void 0?void 0:s.headers)!==null&&a!==void 0?a:{};let m=Object.assign({},g);Object.keys(m).length===0&&(m=this.apiClient.getDefaultHeaders()),c0(m),p.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:m})}return p}async initAfcToolsMap(e){var i,s,a;const u=new Map;for(const f of(s=(i=e.config)===null||i===void 0?void 0:i.tools)!==null&&s!==void 0?s:[])if(br(f)){const p=f,g=await p.tool();for(const m of(a=g.functionDeclarations)!==null&&a!==void 0?a:[]){if(!m.name)throw new Error("Function declaration name is required.");if(u.has(m.name))throw new Error(`Duplicate tool declaration name: ${m.name}`);u.set(m.name,p)}}return u}async processAfcStream(e){var i,s,a;const u=(a=(s=(i=e.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&a!==void 0?a:cg;let f=!1,p=0;const g=await this.initAfcToolsMap(e);return function(m,y,v){var C,N;return xo(this,arguments,function*(){for(var R,L,O,J;p<u;){f&&(p++,f=!1);const z=yield yt(m.processParamsForMcpUsage(v)),ae=yield yt(m.generateContentStreamInternal(z)),de=[],re=[];try{for(var P=!0,$=(L=void 0,Ul(ae)),ne;ne=yield yt($.next()),R=ne.done,!R;P=!0){J=ne.value,P=!1;const se=J;if(yield yield yt(se),se.candidates&&(!((C=se.candidates[0])===null||C===void 0)&&C.content)){re.push(se.candidates[0].content);for(const oe of(N=se.candidates[0].content.parts)!==null&&N!==void 0?N:[])if(p<u&&oe.functionCall){if(!oe.functionCall.name)throw new Error("Function call name was not returned by the model.");if(y.has(oe.functionCall.name)){const _=yield yt(y.get(oe.functionCall.name).callTool([oe.functionCall]));de.push(..._)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${y.keys()}, mising tool: ${oe.functionCall.name}`)}}}}catch(se){L={error:se}}finally{try{!P&&!R&&(O=$.return)&&(yield yt(O.call($)))}finally{if(L)throw L.error}}if(de.length>0){f=!0;const se=new Dl;se.candidates=[{content:{role:"user",parts:de}}],yield yield yt(se);const oe=[];oe.push(...re),oe.push({role:"user",parts:de});const _=En(v.contents).concat(oe);v.contents=_}else break}})}(this,g,e)}async generateContentInternal(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=sg(this.apiClient,e);return p=Le("{model}:generateContent",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(v=>{const C=v;return C.sdkHttpResponse={headers:y.headers},C})),f.then(y=>{const v=lg(y),C=new Dl;return Object.assign(C,v),C})}else{const m=ig(this.apiClient,e);return p=Le("{model}:generateContent",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json().then(v=>{const C=v;return C.sdkHttpResponse={headers:y.headers},C})),f.then(y=>{const v=og(y),C=new Dl;return Object.assign(C,v),C})}}async generateContentStreamInternal(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=sg(this.apiClient,e);return p=Le("{model}:streamGenerateContent?alt=sse",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.requestStream({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),f.then(function(v){return xo(this,arguments,function*(){var C,N,R,L;try{for(var O=!0,J=Ul(v),P;P=yield yt(J.next()),C=P.done,!C;O=!0){L=P.value,O=!1;const $=L,ne=lg(yield yt($.json()));ne.sdkHttpResponse={headers:$.headers};const z=new Dl;Object.assign(z,ne),yield yield yt(z)}}catch($){N={error:$}}finally{try{!O&&!C&&(R=J.return)&&(yield yt(R.call(J)))}finally{if(N)throw N.error}}})})}else{const m=ig(this.apiClient,e);return p=Le("{model}:streamGenerateContent?alt=sse",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.requestStream({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}),f.then(function(v){return xo(this,arguments,function*(){var C,N,R,L;try{for(var O=!0,J=Ul(v),P;P=yield yt(J.next()),C=P.done,!C;O=!0){L=P.value,O=!1;const $=L,ne=og(yield yt($.json()));ne.sdkHttpResponse={headers:$.headers};const z=new Dl;Object.assign(z,ne),yield yield yt(z)}}catch($){N={error:$}}finally{try{!O&&!C&&(R=J.return)&&(yield yt(R.call(J)))}finally{if(N)throw N.error}}})})}}async embedContent(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=H2(this.apiClient,e);return p=Le("{model}:predict",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>{const v=BN(y),C=new Up;return Object.assign(C,v),C})}else{const m=XT(this.apiClient,e);return p=Le("{model}:batchEmbedContents",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>{const v=vN(y),C=new Up;return Object.assign(C,v),C})}}async generateImagesInternal(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=G2(this.apiClient,e);return p=Le("{model}:predict",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>{const v=zN(y),C=new Hp;return Object.assign(C,v),C})}else{const m=ZT(this.apiClient,e);return p=Le("{model}:predict",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>{const v=TN(y),C=new Hp;return Object.assign(C,v),C})}}async editImageInternal(e){var i,s;let a,u="",f={};if(this.apiClient.isVertexAI()){const p=K2(this.apiClient,e);return u=Le("{model}:predict",p._url),f=p._query,delete p.config,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),a.then(g=>{const m=FN(g),y=new Xy;return Object.assign(y,m),y})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var i,s;let a,u="",f={};if(this.apiClient.isVertexAI()){const p=J2(this.apiClient,e);return u=Le("{model}:predict",p._url),f=p._query,delete p.config,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),a.then(g=>{const m=KN(g),y=new Wy;return Object.assign(y,m),y})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=Q2(this.apiClient,e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>nd(y))}else{const m=e2(this.apiClient,e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>td(y))}}async listInternal(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=W2(this.apiClient,e);return p=Le("{models_url}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>{const v=XN(y),C=new Op;return Object.assign(C,v),C})}else{const m=n2(this.apiClient,e);return p=Le("{models_url}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>{const v=kN(y),C=new Op;return Object.assign(C,v),C})}}async update(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=eN(this.apiClient,e);return p=Le("{model}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>nd(y))}else{const m=s2(this.apiClient,e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"PATCH",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>td(y))}}async delete(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=tN(this.apiClient,e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(()=>{const y=WN(),v=new Gp;return Object.assign(v,y),v})}else{const m=o2(this.apiClient,e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(()=>{const y=SN(),v=new Gp;return Object.assign(v,y),v})}}async countTokens(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=iN(this.apiClient,e);return p=Le("{model}:countTokens",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>{const v=ZN(y),C=new Vp;return Object.assign(C,v),C})}else{const m=a2(this.apiClient,e);return p=Le("{model}:countTokens",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>{const v=wN(y),C=new Vp;return Object.assign(C,v),C})}}async computeTokens(e){var i,s;let a,u="",f={};if(this.apiClient.isVertexAI()){const p=sN(this.apiClient,e);return u=Le("{model}:computeTokens",p._url),f=p._query,delete p.config,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),a.then(g=>{const m=ek(g),y=new Zy;return Object.assign(y,m),y})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=aN(this.apiClient,e);return p=Le("{model}:predictLongRunning",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>sk(y))}else{const m=u2(this.apiClient,e);return p=Le("{model}:predictLongRunning",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>RN(y))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _k(t){const e={},i=c(t,["operationName"]);i!=null&&d(e,["_url","operationName"],i);const s=c(t,["config"]);return s!=null&&d(e,["config"],s),e}function Lk(t){const e={},i=c(t,["operationName"]);i!=null&&d(e,["_url","operationName"],i);const s=c(t,["config"]);return s!=null&&d(e,["config"],s),e}function jk(t){const e={},i=c(t,["operationName"]);i!=null&&d(e,["operationName"],i);const s=c(t,["resourceName"]);s!=null&&d(e,["_url","resourceName"],s);const a=c(t,["config"]);return a!=null&&d(e,["config"],a),e}function Dk(t){const e={},i=c(t,["video","uri"]);i!=null&&d(e,["uri"],i);const s=c(t,["video","encodedVideo"]);s!=null&&d(e,["videoBytes"],di(s));const a=c(t,["encoding"]);return a!=null&&d(e,["mimeType"],a),e}function Pk(t){const e={},i=c(t,["_self"]);return i!=null&&d(e,["video"],Dk(i)),e}function Uk(t){const e={},i=c(t,["generatedSamples"]);if(i!=null){let u=i;Array.isArray(u)&&(u=u.map(f=>Pk(f))),d(e,["generatedVideos"],u)}const s=c(t,["raiMediaFilteredCount"]);s!=null&&d(e,["raiMediaFilteredCount"],s);const a=c(t,["raiMediaFilteredReasons"]);return a!=null&&d(e,["raiMediaFilteredReasons"],a),e}function Hk(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["metadata"]);s!=null&&d(e,["metadata"],s);const a=c(t,["done"]);a!=null&&d(e,["done"],a);const u=c(t,["error"]);u!=null&&d(e,["error"],u);const f=c(t,["response","generateVideoResponse"]);return f!=null&&d(e,["response"],Uk(f)),e}function Ok(t){const e={},i=c(t,["gcsUri"]);i!=null&&d(e,["uri"],i);const s=c(t,["bytesBase64Encoded"]);s!=null&&d(e,["videoBytes"],di(s));const a=c(t,["mimeType"]);return a!=null&&d(e,["mimeType"],a),e}function Gk(t){const e={},i=c(t,["_self"]);return i!=null&&d(e,["video"],Ok(i)),e}function Vk(t){const e={},i=c(t,["videos"]);if(i!=null){let u=i;Array.isArray(u)&&(u=u.map(f=>Gk(f))),d(e,["generatedVideos"],u)}const s=c(t,["raiMediaFilteredCount"]);s!=null&&d(e,["raiMediaFilteredCount"],s);const a=c(t,["raiMediaFilteredReasons"]);return a!=null&&d(e,["raiMediaFilteredReasons"],a),e}function hg(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["metadata"]);s!=null&&d(e,["metadata"],s);const a=c(t,["done"]);a!=null&&d(e,["done"],a);const u=c(t,["error"]);u!=null&&d(e,["error"],u);const f=c(t,["response"]);return f!=null&&d(e,["response"],Vk(f)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $k extends Ts{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const i=e.operation,s=e.config;if(i.name===void 0||i.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=i.name.split("/operations/")[0];let u;return s&&"httpOptions"in s&&(u=s.httpOptions),this.fetchPredictVideosOperationInternal({operationName:i.name,resourceName:a,config:{httpOptions:u}})}else return this.getVideosOperationInternal({operationName:i.name,config:s})}async getVideosOperationInternal(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=Lk(e);return p=Le("{operationName}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>hg(y))}else{const m=_k(e);return p=Le("{operationName}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>Hk(y))}}async fetchPredictVideosOperationInternal(e){var i,s;let a,u="",f={};if(this.apiClient.isVertexAI()){const p=jk(e);return u=Le("{resourceName}:fetchPredictOperation",p._url),f=p._query,delete p.config,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),a.then(g=>hg(g))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Bk(t){const e={},i=c(t,["voiceName"]);return i!=null&&d(e,["voiceName"],i),e}function u0(t){const e={},i=c(t,["prebuiltVoiceConfig"]);return i!=null&&d(e,["prebuiltVoiceConfig"],Bk(i)),e}function qk(t){const e={},i=c(t,["speaker"]);i!=null&&d(e,["speaker"],i);const s=c(t,["voiceConfig"]);return s!=null&&d(e,["voiceConfig"],u0(s)),e}function zk(t){const e={},i=c(t,["speakerVoiceConfigs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>qk(a))),d(e,["speakerVoiceConfigs"],s)}return e}function Fk(t){const e={},i=c(t,["voiceConfig"]);i!=null&&d(e,["voiceConfig"],u0(i));const s=c(t,["multiSpeakerVoiceConfig"]);s!=null&&d(e,["multiSpeakerVoiceConfig"],zk(s));const a=c(t,["languageCode"]);return a!=null&&d(e,["languageCode"],a),e}function Kk(t){const e={},i=c(t,["fps"]);i!=null&&d(e,["fps"],i);const s=c(t,["endOffset"]);s!=null&&d(e,["endOffset"],s);const a=c(t,["startOffset"]);return a!=null&&d(e,["startOffset"],a),e}function Yk(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(t,["data"]);i!=null&&d(e,["data"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function Jk(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(t,["fileUri"]);i!=null&&d(e,["fileUri"],i);const s=c(t,["mimeType"]);return s!=null&&d(e,["mimeType"],s),e}function Qk(t){const e={},i=c(t,["videoMetadata"]);i!=null&&d(e,["videoMetadata"],Kk(i));const s=c(t,["thought"]);s!=null&&d(e,["thought"],s);const a=c(t,["inlineData"]);a!=null&&d(e,["inlineData"],Yk(a));const u=c(t,["fileData"]);u!=null&&d(e,["fileData"],Jk(u));const f=c(t,["thoughtSignature"]);f!=null&&d(e,["thoughtSignature"],f);const p=c(t,["codeExecutionResult"]);p!=null&&d(e,["codeExecutionResult"],p);const g=c(t,["executableCode"]);g!=null&&d(e,["executableCode"],g);const m=c(t,["functionCall"]);m!=null&&d(e,["functionCall"],m);const y=c(t,["functionResponse"]);y!=null&&d(e,["functionResponse"],y);const v=c(t,["text"]);return v!=null&&d(e,["text"],v),e}function Xk(t){const e={},i=c(t,["parts"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>Qk(u))),d(e,["parts"],a)}const s=c(t,["role"]);return s!=null&&d(e,["role"],s),e}function Wk(t){const e={},i=c(t,["behavior"]);i!=null&&d(e,["behavior"],i);const s=c(t,["description"]);s!=null&&d(e,["description"],s);const a=c(t,["name"]);a!=null&&d(e,["name"],a);const u=c(t,["parameters"]);u!=null&&d(e,["parameters"],u);const f=c(t,["parametersJsonSchema"]);f!=null&&d(e,["parametersJsonSchema"],f);const p=c(t,["response"]);p!=null&&d(e,["response"],p);const g=c(t,["responseJsonSchema"]);return g!=null&&d(e,["responseJsonSchema"],g),e}function Zk(t){const e={},i=c(t,["startTime"]);i!=null&&d(e,["startTime"],i);const s=c(t,["endTime"]);return s!=null&&d(e,["endTime"],s),e}function eS(t){const e={},i=c(t,["timeRangeFilter"]);return i!=null&&d(e,["timeRangeFilter"],Zk(i)),e}function tS(t){const e={},i=c(t,["mode"]);i!=null&&d(e,["mode"],i);const s=c(t,["dynamicThreshold"]);return s!=null&&d(e,["dynamicThreshold"],s),e}function nS(t){const e={},i=c(t,["dynamicRetrievalConfig"]);return i!=null&&d(e,["dynamicRetrievalConfig"],tS(i)),e}function iS(){return{}}function sS(t){const e={},i=c(t,["functionDeclarations"]);if(i!=null){let g=i;Array.isArray(g)&&(g=g.map(m=>Wk(m))),d(e,["functionDeclarations"],g)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=c(t,["googleSearch"]);s!=null&&d(e,["googleSearch"],eS(s));const a=c(t,["googleSearchRetrieval"]);if(a!=null&&d(e,["googleSearchRetrieval"],nS(a)),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(c(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");c(t,["urlContext"])!=null&&d(e,["urlContext"],iS());const f=c(t,["codeExecution"]);f!=null&&d(e,["codeExecution"],f);const p=c(t,["computerUse"]);return p!=null&&d(e,["computerUse"],p),e}function oS(t){const e={},i=c(t,["handle"]);if(i!=null&&d(e,["handle"],i),c(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function fg(){return{}}function lS(t){const e={},i=c(t,["disabled"]);i!=null&&d(e,["disabled"],i);const s=c(t,["startOfSpeechSensitivity"]);s!=null&&d(e,["startOfSpeechSensitivity"],s);const a=c(t,["endOfSpeechSensitivity"]);a!=null&&d(e,["endOfSpeechSensitivity"],a);const u=c(t,["prefixPaddingMs"]);u!=null&&d(e,["prefixPaddingMs"],u);const f=c(t,["silenceDurationMs"]);return f!=null&&d(e,["silenceDurationMs"],f),e}function aS(t){const e={},i=c(t,["automaticActivityDetection"]);i!=null&&d(e,["automaticActivityDetection"],lS(i));const s=c(t,["activityHandling"]);s!=null&&d(e,["activityHandling"],s);const a=c(t,["turnCoverage"]);return a!=null&&d(e,["turnCoverage"],a),e}function rS(t){const e={},i=c(t,["targetTokens"]);return i!=null&&d(e,["targetTokens"],i),e}function cS(t){const e={},i=c(t,["triggerTokens"]);i!=null&&d(e,["triggerTokens"],i);const s=c(t,["slidingWindow"]);return s!=null&&d(e,["slidingWindow"],rS(s)),e}function uS(t){const e={},i=c(t,["proactiveAudio"]);return i!=null&&d(e,["proactiveAudio"],i),e}function dS(t,e){const i={},s=c(t,["generationConfig"]);e!==void 0&&s!=null&&d(e,["setup","generationConfig"],s);const a=c(t,["responseModalities"]);e!==void 0&&a!=null&&d(e,["setup","generationConfig","responseModalities"],a);const u=c(t,["temperature"]);e!==void 0&&u!=null&&d(e,["setup","generationConfig","temperature"],u);const f=c(t,["topP"]);e!==void 0&&f!=null&&d(e,["setup","generationConfig","topP"],f);const p=c(t,["topK"]);e!==void 0&&p!=null&&d(e,["setup","generationConfig","topK"],p);const g=c(t,["maxOutputTokens"]);e!==void 0&&g!=null&&d(e,["setup","generationConfig","maxOutputTokens"],g);const m=c(t,["mediaResolution"]);e!==void 0&&m!=null&&d(e,["setup","generationConfig","mediaResolution"],m);const y=c(t,["seed"]);e!==void 0&&y!=null&&d(e,["setup","generationConfig","seed"],y);const v=c(t,["speechConfig"]);e!==void 0&&v!=null&&d(e,["setup","generationConfig","speechConfig"],Fk(hd(v)));const C=c(t,["enableAffectiveDialog"]);e!==void 0&&C!=null&&d(e,["setup","generationConfig","enableAffectiveDialog"],C);const N=c(t,["systemInstruction"]);e!==void 0&&N!=null&&d(e,["setup","systemInstruction"],Xk(en(N)));const R=c(t,["tools"]);if(e!==void 0&&R!=null){let z=No(R);Array.isArray(z)&&(z=z.map(ae=>sS(To(ae)))),d(e,["setup","tools"],z)}const L=c(t,["sessionResumption"]);e!==void 0&&L!=null&&d(e,["setup","sessionResumption"],oS(L));const O=c(t,["inputAudioTranscription"]);e!==void 0&&O!=null&&d(e,["setup","inputAudioTranscription"],fg());const J=c(t,["outputAudioTranscription"]);e!==void 0&&J!=null&&d(e,["setup","outputAudioTranscription"],fg());const P=c(t,["realtimeInputConfig"]);e!==void 0&&P!=null&&d(e,["setup","realtimeInputConfig"],aS(P));const $=c(t,["contextWindowCompression"]);e!==void 0&&$!=null&&d(e,["setup","contextWindowCompression"],cS($));const ne=c(t,["proactivity"]);return e!==void 0&&ne!=null&&d(e,["setup","proactivity"],uS(ne)),i}function hS(t,e){const i={},s=c(e,["model"]);s!=null&&d(i,["setup","model"],ut(t,s));const a=c(e,["config"]);return a!=null&&d(i,["config"],dS(a,i)),i}function fS(t,e,i){const s={},a=c(e,["expireTime"]);i!==void 0&&a!=null&&d(i,["expireTime"],a);const u=c(e,["newSessionExpireTime"]);i!==void 0&&u!=null&&d(i,["newSessionExpireTime"],u);const f=c(e,["uses"]);i!==void 0&&f!=null&&d(i,["uses"],f);const p=c(e,["liveConnectConstraints"]);i!==void 0&&p!=null&&d(i,["bidiGenerateContentSetup"],hS(t,p));const g=c(e,["lockAdditionalFields"]);return i!==void 0&&g!=null&&d(i,["fieldMask"],g),s}function mS(t,e){const i={},s=c(e,["config"]);return s!=null&&d(i,["config"],fS(t,s,i)),i}function pS(t){const e={},i=c(t,["name"]);return i!=null&&d(e,["name"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gS(t){const e=[];for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const s=t[i];if(typeof s=="object"&&s!=null&&Object.keys(s).length>0){const a=Object.keys(s).map(u=>`${i}.${u}`);e.push(...a)}else e.push(i)}return e.join(",")}function xS(t,e){let i=null;const s=t.bidiGenerateContentSetup;if(typeof s=="object"&&s!==null&&"setup"in s){const u=s.setup;typeof u=="object"&&u!==null?(t.bidiGenerateContentSetup=u,i=u):delete t.bidiGenerateContentSetup}else s!==void 0&&delete t.bidiGenerateContentSetup;const a=t.fieldMask;if(i){const u=gS(i);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)u?t.fieldMask=u:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&a!==null&&Array.isArray(a)&&a.length>0){const f=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let p=[];a.length>0&&(p=a.map(m=>f.includes(m)?`generationConfig.${m}`:m));const g=[];u&&g.push(u),p.length>0&&g.push(...p),g.length>0?t.fieldMask=g.join(","):delete t.fieldMask}else delete t.fieldMask}else a!==null&&Array.isArray(a)&&a.length>0?t.fieldMask=a.join(","):delete t.fieldMask;return t}class yS extends Ts{constructor(e){super(),this.apiClient=e}async create(e){var i,s;let a,u="",f={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const p=mS(this.apiClient,e);u=Le("auth_tokens",p._url),f=p._query,delete p.config,delete p._url,delete p._query;const g=xS(p,e.config);return a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),a.then(m=>pS(m))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function vS(t){const e={},i=c(t,["name"]);i!=null&&d(e,["_url","name"],i);const s=c(t,["config"]);return s!=null&&d(e,["config"],s),e}function bS(t,e){const i={},s=c(t,["pageSize"]);e!==void 0&&s!=null&&d(e,["_query","pageSize"],s);const a=c(t,["pageToken"]);e!==void 0&&a!=null&&d(e,["_query","pageToken"],a);const u=c(t,["filter"]);return e!==void 0&&u!=null&&d(e,["_query","filter"],u),i}function CS(t){const e={},i=c(t,["config"]);return i!=null&&d(e,["config"],bS(i,e)),e}function TS(t){const e={},i=c(t,["textInput"]);i!=null&&d(e,["textInput"],i);const s=c(t,["output"]);return s!=null&&d(e,["output"],s),e}function NS(t){const e={};if(c(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(c(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const i=c(t,["examples"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>TS(a))),d(e,["examples","examples"],s)}return e}function kS(t,e){const i={};if(c(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=c(t,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&d(e,["displayName"],s),c(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const a=c(t,["epochCount"]);e!==void 0&&a!=null&&d(e,["tuningTask","hyperparameters","epochCount"],a);const u=c(t,["learningRateMultiplier"]);if(u!=null&&d(i,["tuningTask","hyperparameters","learningRateMultiplier"],u),c(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(c(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const f=c(t,["batchSize"]);e!==void 0&&f!=null&&d(e,["tuningTask","hyperparameters","batchSize"],f);const p=c(t,["learningRate"]);return e!==void 0&&p!=null&&d(e,["tuningTask","hyperparameters","learningRate"],p),i}function SS(t){const e={},i=c(t,["baseModel"]);i!=null&&d(e,["baseModel"],i);const s=c(t,["trainingDataset"]);s!=null&&d(e,["tuningTask","trainingData"],NS(s));const a=c(t,["config"]);return a!=null&&d(e,["config"],kS(a,e)),e}function wS(t){const e={},i=c(t,["name"]);i!=null&&d(e,["_url","name"],i);const s=c(t,["config"]);return s!=null&&d(e,["config"],s),e}function ES(t,e){const i={},s=c(t,["pageSize"]);e!==void 0&&s!=null&&d(e,["_query","pageSize"],s);const a=c(t,["pageToken"]);e!==void 0&&a!=null&&d(e,["_query","pageToken"],a);const u=c(t,["filter"]);return e!==void 0&&u!=null&&d(e,["_query","filter"],u),i}function MS(t){const e={},i=c(t,["config"]);return i!=null&&d(e,["config"],ES(i,e)),e}function AS(t,e){const i={},s=c(t,["gcsUri"]);e!==void 0&&s!=null&&d(e,["supervisedTuningSpec","trainingDatasetUri"],s);const a=c(t,["vertexDatasetResource"]);if(e!==void 0&&a!=null&&d(e,["supervisedTuningSpec","trainingDatasetUri"],a),c(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return i}function RS(t,e){const i={},s=c(t,["gcsUri"]);s!=null&&d(i,["validationDatasetUri"],s);const a=c(t,["vertexDatasetResource"]);return e!==void 0&&a!=null&&d(e,["supervisedTuningSpec","trainingDatasetUri"],a),i}function IS(t,e){const i={},s=c(t,["validationDataset"]);e!==void 0&&s!=null&&d(e,["supervisedTuningSpec"],RS(s,i));const a=c(t,["tunedModelDisplayName"]);e!==void 0&&a!=null&&d(e,["tunedModelDisplayName"],a);const u=c(t,["description"]);e!==void 0&&u!=null&&d(e,["description"],u);const f=c(t,["epochCount"]);e!==void 0&&f!=null&&d(e,["supervisedTuningSpec","hyperParameters","epochCount"],f);const p=c(t,["learningRateMultiplier"]);e!==void 0&&p!=null&&d(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],p);const g=c(t,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&d(e,["supervisedTuningSpec","exportLastCheckpointOnly"],g);const m=c(t,["adapterSize"]);if(e!==void 0&&m!=null&&d(e,["supervisedTuningSpec","hyperParameters","adapterSize"],m),c(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(c(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return i}function _S(t){const e={},i=c(t,["baseModel"]);i!=null&&d(e,["baseModel"],i);const s=c(t,["trainingDataset"]);s!=null&&d(e,["supervisedTuningSpec","trainingDatasetUri"],AS(s,e));const a=c(t,["config"]);return a!=null&&d(e,["config"],IS(a,e)),e}function LS(t){const e={},i=c(t,["name"]);i!=null&&d(e,["model"],i);const s=c(t,["name"]);return s!=null&&d(e,["endpoint"],s),e}function d0(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["state"]);s!=null&&d(e,["state"],$g(s));const a=c(t,["createTime"]);a!=null&&d(e,["createTime"],a);const u=c(t,["tuningTask","startTime"]);u!=null&&d(e,["startTime"],u);const f=c(t,["tuningTask","completeTime"]);f!=null&&d(e,["endTime"],f);const p=c(t,["updateTime"]);p!=null&&d(e,["updateTime"],p);const g=c(t,["description"]);g!=null&&d(e,["description"],g);const m=c(t,["baseModel"]);m!=null&&d(e,["baseModel"],m);const y=c(t,["_self"]);y!=null&&d(e,["tunedModel"],LS(y));const v=c(t,["distillationSpec"]);v!=null&&d(e,["distillationSpec"],v);const C=c(t,["experiment"]);C!=null&&d(e,["experiment"],C);const N=c(t,["labels"]);N!=null&&d(e,["labels"],N);const R=c(t,["pipelineJob"]);R!=null&&d(e,["pipelineJob"],R);const L=c(t,["satisfiesPzi"]);L!=null&&d(e,["satisfiesPzi"],L);const O=c(t,["satisfiesPzs"]);O!=null&&d(e,["satisfiesPzs"],O);const J=c(t,["serviceAccount"]);J!=null&&d(e,["serviceAccount"],J);const P=c(t,["tunedModelDisplayName"]);return P!=null&&d(e,["tunedModelDisplayName"],P),e}function jS(t){const e={},i=c(t,["nextPageToken"]);i!=null&&d(e,["nextPageToken"],i);const s=c(t,["tunedModels"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(u=>d0(u))),d(e,["tuningJobs"],a)}return e}function DS(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["metadata"]);s!=null&&d(e,["metadata"],s);const a=c(t,["done"]);a!=null&&d(e,["done"],a);const u=c(t,["error"]);return u!=null&&d(e,["error"],u),e}function PS(t){const e={},i=c(t,["checkpointId"]);i!=null&&d(e,["checkpointId"],i);const s=c(t,["epoch"]);s!=null&&d(e,["epoch"],s);const a=c(t,["step"]);a!=null&&d(e,["step"],a);const u=c(t,["endpoint"]);return u!=null&&d(e,["endpoint"],u),e}function US(t){const e={},i=c(t,["model"]);i!=null&&d(e,["model"],i);const s=c(t,["endpoint"]);s!=null&&d(e,["endpoint"],s);const a=c(t,["checkpoints"]);if(a!=null){let u=a;Array.isArray(u)&&(u=u.map(f=>PS(f))),d(e,["checkpoints"],u)}return e}function sd(t){const e={},i=c(t,["name"]);i!=null&&d(e,["name"],i);const s=c(t,["state"]);s!=null&&d(e,["state"],$g(s));const a=c(t,["createTime"]);a!=null&&d(e,["createTime"],a);const u=c(t,["startTime"]);u!=null&&d(e,["startTime"],u);const f=c(t,["endTime"]);f!=null&&d(e,["endTime"],f);const p=c(t,["updateTime"]);p!=null&&d(e,["updateTime"],p);const g=c(t,["error"]);g!=null&&d(e,["error"],g);const m=c(t,["description"]);m!=null&&d(e,["description"],m);const y=c(t,["baseModel"]);y!=null&&d(e,["baseModel"],y);const v=c(t,["tunedModel"]);v!=null&&d(e,["tunedModel"],US(v));const C=c(t,["supervisedTuningSpec"]);C!=null&&d(e,["supervisedTuningSpec"],C);const N=c(t,["tuningDataStats"]);N!=null&&d(e,["tuningDataStats"],N);const R=c(t,["encryptionSpec"]);R!=null&&d(e,["encryptionSpec"],R);const L=c(t,["partnerModelTuningSpec"]);L!=null&&d(e,["partnerModelTuningSpec"],L);const O=c(t,["distillationSpec"]);O!=null&&d(e,["distillationSpec"],O);const J=c(t,["experiment"]);J!=null&&d(e,["experiment"],J);const P=c(t,["labels"]);P!=null&&d(e,["labels"],P);const $=c(t,["pipelineJob"]);$!=null&&d(e,["pipelineJob"],$);const ne=c(t,["satisfiesPzi"]);ne!=null&&d(e,["satisfiesPzi"],ne);const z=c(t,["satisfiesPzs"]);z!=null&&d(e,["satisfiesPzs"],z);const ae=c(t,["serviceAccount"]);ae!=null&&d(e,["serviceAccount"],ae);const de=c(t,["tunedModelDisplayName"]);return de!=null&&d(e,["tunedModelDisplayName"],de),e}function HS(t){const e={},i=c(t,["nextPageToken"]);i!=null&&d(e,["nextPageToken"],i);const s=c(t,["tuningJobs"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(u=>sd(u))),d(e,["tuningJobs"],a)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class OS extends Ts{constructor(e){super(),this.apiClient=e,this.get=async i=>await this.getInternal(i),this.list=async(i={})=>new Bl(ys.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(i),i),this.tune=async i=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(i);{const s=await this.tuneMldevInternal(i);let a="";return s.metadata!==void 0&&s.metadata.tunedModel!==void 0?a=s.metadata.tunedModel:s.name!==void 0&&s.name.includes("/operations/")&&(a=s.name.split("/operations/")[0]),{name:a,state:Yu.JOB_STATE_QUEUED}}}}async getInternal(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=wS(e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>sd(y))}else{const m=vS(e);return p=Le("{name}",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>d0(y))}}async listInternal(e){var i,s,a,u;let f,p="",g={};if(this.apiClient.isVertexAI()){const m=MS(e);return p=Le("tuningJobs",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),f.then(y=>{const v=HS(y),C=new $p;return Object.assign(C,v),C})}else{const m=CS(e);return p=Le("tunedModels",m._url),g=m._query,delete m.config,delete m._url,delete m._query,f=this.apiClient.request({path:p,queryParams:g,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(y=>y.json()),f.then(y=>{const v=jS(y),C=new $p;return Object.assign(C,v),C})}}async tuneInternal(e){var i,s;let a,u="",f={};if(this.apiClient.isVertexAI()){const p=_S(e);return u=Le("tuningJobs",p._url),f=p._query,delete p.config,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),a.then(g=>sd(g))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var i,s;let a,u="",f={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const p=SS(e);return u=Le("tunedModels",p._url),f=p._query,delete p.config,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),a.then(g=>DS(g))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class GS{async download(e,i){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const VS=1024*1024*8,$S=3,BS=1e3,qS=2,Fu="x-goog-upload-status";async function zS(t,e,i){var s,a,u;let f=0,p=0,g=new Ju(new Response),m="upload";for(f=t.size;p<f;){const v=Math.min(VS,f-p),C=t.slice(p,p+v);p+v>=f&&(m+=", finalize");let N=0,R=BS;for(;N<$S&&(g=await i.request({path:"",body:C,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":m,"X-Goog-Upload-Offset":String(p),"Content-Length":String(v)}}}),!(!((s=g==null?void 0:g.headers)===null||s===void 0)&&s[Fu]));)N++,await KS(R),R=R*qS;if(p+=v,((a=g==null?void 0:g.headers)===null||a===void 0?void 0:a[Fu])!=="active")break;if(f<=p)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const y=await(g==null?void 0:g.json());if(((u=g==null?void 0:g.headers)===null||u===void 0?void 0:u[Fu])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return y.file}async function FS(t){return{size:t.size,type:t.type}}function KS(t){return new Promise(e=>setTimeout(e,t))}class YS{async upload(e,i,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await zS(e,i,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await FS(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class JS{create(e,i,s){return new QS(e,i,s)}}class QS{constructor(e,i,s){this.url=e,this.headers=i,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mg="x-goog-api-key";class XS{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(mg)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(mg,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const WS="gl-node/";class ZS{constructor(e){var i;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(i=e.vertexai)!==null&&i!==void 0?i:!1,this.apiKey=e.apiKey;const s=Qy(e,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion;const a=new XS(this.apiKey);this.apiClient=new hk({auth:a,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:WS+"web",uploader:new YS,downloader:new GS}),this.models=new Ik(this.apiClient),this.live=new wk(this.apiClient,a,new JS),this.batches=new vb(this.apiClient),this.chats=new NC(this.models,this.apiClient),this.caches=new bC(this.apiClient),this.files=new PC(this.apiClient),this.operations=new $k(this.apiClient),this.authTokens=new yS(this.apiClient),this.tunings=new OS(this.apiClient)}}const Pl=({text:t,icon:e,colorClass:i,hoverClass:s,focusClass:a,onClick:u,disabled:f=!1})=>{const p="bg-slate-800 text-gray-500 cursor-not-allowed",g=async()=>{if(console.log(" MenuButton: Click received for:",t),u){console.log(" MenuButton: Executing onClick for:",t);try{await u(),console.log(" MenuButton: onClick completed for:",t)}catch(m){console.error(" MenuButton: onClick error for:",t,m)}}else console.log(" MenuButton: No onClick handler for:",t)};return l.jsxs("button",{onClick:g,disabled:f,className:`
        flex items-center justify-start w-80 sm:w-96 py-3 px-6 rounded-lg text-white font-semibold shadow-lg 
        transform transition ease-in-out duration-200
        focus:outline-none focus:ring-2 focus:ring-opacity-75
        ${f?p:`${i} ${s} ${a} hover:scale-105 hover:shadow-xl`}
      `,children:[l.jsx("div",{className:"w-5 h-5 mr-4 flex-shrink-0",children:e}),l.jsx("span",{children:t})]})},kr=({className:t})=>l.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M8 5V19L19 12L8 5Z"})}),vs=({className:t})=>l.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M17 3H5C3.89 3 3 3.9 3 5V19C3 20.1 3.89 21 5 21H19C20.1 21 21 20.1 21 19V7L17 3ZM12 19C10.34 19 9 17.66 9 16C9 14.34 10.34 13 12 13C13.66 13 15 14.34 15 16C15 17.66 13.66 19 12 19ZM15 9H5V5H15V9Z"})}),$l=({className:t})=>l.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M13 9H18.5L13 3.5V9ZM6 2H14L20 8V20C20 21.1 19.1 22 18 22H6C4.9 22 4 21.1 4 20V4C4 2.9 4.9 2 6 2ZM12 18V15H9V13H12V10H14V13H17V15H14V18H12Z"})}),h0=({className:t})=>l.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M3.5 18.49L9.5 12.48L13.5 16.48L22 6.92L20.59 5.51L13.5 13.48L9.5 9.48L2 16.99L3.5 18.49Z"})}),pg=({className:t})=>l.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M6 19C6 20.1 6.9 21 8 21H16C17.1 21 18 20.1 18 19V7H6V19ZM19 4H15.5L14.5 3H9.5L8.5 4H5V6H19V4Z"})}),gg=({className:t})=>l.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M6 6H18V18H6V6Z"})}),ew=({className:t})=>l.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12C2.73 16.39 7 19.5 12 19.5S21.27 16.39 23 12C21.27 7.61 17 4.5 12 4.5ZM12 17C9.24 17 7 14.76 7 12S9.24 7 12 7S17 9.24 17 12S14.76 17 12 17ZM12 9C10.34 9 9 10.34 9 12S10.34 15 12 15S15 13.66 15 12S13.66 9 12 9Z"})}),tw=({className:t})=>l.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M12 7C14.76 7 17 9.24 17 12C17 12.65 16.87 13.26 16.64 13.82L19.56 16.74C21.07 15.49 22.26 13.86 23 12C21.27 7.61 17 4.5 12 4.5C10.6 4.5 9.26 4.75 8.04 5.2L10.17 7.33C10.74 7.11 11.35 7 12 7ZM2 4.27L4.28 6.55L4.73 7C3.08 8.3 1.78 10 1 12C2.73 16.39 7 19.5 12 19.5C13.55 19.5 15.03 19.2 16.38 18.66L16.81 19.09L19.73 22L21 20.73L3.27 3L2 4.27ZM7.53 9.8L9.08 11.35C9.03 11.56 9 11.78 9 12C9 13.66 10.34 15 12 15C12.22 15 12.44 14.97 12.65 14.92L14.2 16.47C13.53 16.8 12.79 17 12 17C9.24 17 7 14.76 7 12C7 11.21 7.2 10.47 7.53 9.8Z"})}),f0=({className:t})=>l.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M19.43 12.98C19.51 12.67 19.56 12.34 19.56 12C19.56 11.66 19.51 11.33 19.43 11.02L21.54 9.37C21.73 9.22 21.78 8.95 21.66 8.73L19.66 5.27C19.54 5.05 19.27 4.96 19.05 5.04L16.56 6.04C16.04 5.65 15.48 5.32 14.87 5.07L14.49 2.42C14.46 2.18 14.25 2 14 2H10C9.75 2 9.54 2.18 9.51 2.42L9.13 5.07C8.52 5.32 7.96 5.65 7.44 6.04L4.95 5.04C4.73 4.96 4.46 5.05 4.34 5.27L2.34 8.73C2.21 8.95 2.27 9.22 2.46 9.37L4.57 11.02C4.49 11.33 4.44 11.66 4.44 12C4.44 12.34 4.49 12.67 4.57 12.98L2.46 14.63C2.27 14.78 2.21 15.05 2.34 15.27L4.34 18.73C4.46 18.95 4.73 19.03 4.95 18.96L7.44 17.96C7.96 18.35 8.52 18.68 9.13 18.93L9.51 21.58C9.54 21.82 9.75 22 10 22H14C14.25 22 14.46 21.82 14.49 21.58L14.87 18.93C15.48 18.68 16.04 18.35 16.56 17.96L19.05 18.96C19.27 19.03 19.54 18.95 19.66 18.73L21.66 15.27C21.78 15.05 21.73 14.78 21.54 14.63L19.43 12.98ZM12 15.5C10.07 15.5 8.5 13.93 8.5 12C8.5 10.07 10.07 8.5 12 8.5C13.93 8.5 15.5 10.07 15.5 12C15.5 13.93 13.93 15.5 12 15.5Z"})}),nw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),xg=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),vo=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),iw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L13.196 7.196z"})}),sw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),bo=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),Hl=({className:t})=>l.jsxs("svg",{className:`animate-spin h-5 w-5 ${t}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[l.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),l.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ql=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),m0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),jr=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),p0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 9l4-4 4 4m0 6l-4 4-4-4"})}),g0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),x0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h5M20 20v-5h-5M4 4l1.5 1.5A9 9 0 0120 12M20 20l-1.5-1.5A9 9 0 004 12"})}),Oi=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"currentColor",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM18 13.5l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 18l-1.035.259a3.375 3.375 0 00-2.456 2.456L18 21.75l-.259-1.035a3.375 3.375 0 00-2.456-2.456L14.25 18l1.035-.259a3.375 3.375 0 002.456-2.456L18 13.5z"})}),yg=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 24 24",fill:"currentColor",children:l.jsx("path",{d:"M16 12V4H17V2H7V4H8V12L6 14V16H11.5V22H12.5V16H18V14L16 12Z"})}),y0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),An=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),ow=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),Co=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),lw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),vg=({onStartNewAdventure:t,onQuickPlay:e,hasLastWorldSetup:i,onOpenApiSettings:s,onLoadGameFromFile:a,isUsingDefaultKey:u,onOpenChangelog:f,selectedAiModel:p})=>{const g=E.useRef(null),m=y=>{var C;const v=(C=y.target.files)==null?void 0:C[0];v&&a(v),y.target&&(y.target.value="")};return l.jsxs("div",{className:"bg-white/80 dark:bg-[#1f2238]/80 backdrop-blur-md border border-slate-300 dark:border-slate-700 p-8 rounded-2xl shadow-xl max-w-lg w-full",children:[l.jsx("input",{type:"file",ref:g,onChange:m,accept:".json",className:"hidden"}),l.jsx("header",{className:"text-center mb-10",children:l.jsxs("h1",{className:"text-4xl sm:text-5xl font-bold tracking-wider text-slate-900 dark:text-white",children:[l.jsx("span",{className:"dark:text-purple-400",children:"HY VIT LN "}),l.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-orange-400",children:"CU TRUYN CA BN"})]})}),l.jsxs("main",{className:"flex flex-col items-center space-y-4",children:[l.jsx(Pl,{text:"To Th Gii Mi",icon:l.jsx(kr,{}),onClick:t,colorClass:"bg-gradient-to-r from-purple-600 via-pink-500 to-red-500",hoverClass:"hover:from-purple-700 hover:via-pink-600 hover:to-red-600",focusClass:"focus:ring-pink-500"}),i&&e&&l.jsx(Pl,{text:"Chi Ngay",icon:l.jsx(kr,{}),onClick:e,colorClass:"bg-gradient-to-r from-emerald-500 to-teal-600",hoverClass:"hover:from-emerald-600 hover:to-teal-700",focusClass:"focus:ring-emerald-500"}),l.jsx(Pl,{text:"Ti Game T Tp (.json)",icon:l.jsx($l,{}),onClick:()=>{var y;return(y=g.current)==null?void 0:y.click()},colorClass:"bg-blue-500",hoverClass:"hover:bg-blue-600",focusClass:"focus:ring-blue-400"}),l.jsx(Pl,{text:"Xem Cp Nht Game",icon:l.jsx(h0,{}),onClick:f,colorClass:"bg-green-500",hoverClass:"hover:bg-green-600",focusClass:"focus:ring-green-400"}),l.jsx(Pl,{text:"Thit Lp API Key",icon:l.jsx(f0,{}),onClick:s,colorClass:"bg-slate-700",hoverClass:"hover:bg-slate-600",focusClass:"focus:ring-slate-500"})]}),l.jsx("footer",{className:"mt-6 text-center",children:l.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:["Model AI hin ti: ",l.jsx("span",{className:"font-semibold text-slate-700 dark:text-slate-300",children:p})]})})]})};var Ft=(t=>(t[t.AND_ANY=0]="AND_ANY",t[t.NOT_ALL=1]="NOT_ALL",t[t.NOT_ANY=2]="NOT_ANY",t[t.AND_ALL=3]="AND_ALL",t))(Ft||{}),Pe=(t=>(t[t.PLAYER_INPUT=1]="PLAYER_INPUT",t[t.AI_OUTPUT=2]="AI_OUTPUT",t[t.MEMORY_PROCESSING=3]="MEMORY_PROCESSING",t[t.ENTITY_DETECTION=4]="ENTITY_DETECTION",t[t.QUEST_PROCESSING=5]="QUEST_PROCESSING",t[t.DIALOGUE_FORMATTING=6]="DIALOGUE_FORMATTING",t[t.STAT_EXTRACTION=7]="STAT_EXTRACTION",t[t.COMBAT_FORMATTING=8]="COMBAT_FORMATTING",t))(Pe||{}),ct=(t=>(t[t.NONE=0]="NONE",t[t.RAW=1]="RAW",t[t.ESCAPED=2]="ESCAPED",t))(ct||{});class Zt{static createDefaultRule(){return{id:Date.now().toString(),content:"",isActive:!0,title:"",keywords:[],secondaryKeywords:[],logic:Ft.AND_ANY,alwaysActive:!1,order:100,caseSensitive:!1,matchWholeWords:!1,probability:100,maxActivationsPerTurn:void 0,scanDepth:5,scanPlayerInput:!0,scanAIOutput:!0,scanMemories:!0,tokenWeight:void 0,tokenPriority:100,createdAt:Date.now(),lastActivated:void 0,activationCount:0,category:"general"}}static estimateTokenWeight(e){return e?Math.ceil(e.length/4):0}static validateRule(e){var s,a;const i=[];return e.content.trim()||i.push("Rule content cannot be empty"),e.keywords&&e.keywords.some(u=>!u.trim())&&i.push("Keywords cannot be empty"),e.secondaryKeywords&&e.secondaryKeywords.some(u=>!u.trim())&&i.push("Secondary keywords cannot be empty"),e.probability!==void 0&&(e.probability<0||e.probability>100)&&i.push("Probability must be between 0 and 100"),e.alwaysActive&&((s=e.keywords)!=null&&s.length||(a=e.secondaryKeywords)!=null&&a.length)&&i.push("Always active rules should not have keywords (keywords will be ignored)"),e.order!==void 0&&e.order<0&&i.push("Order must be a positive number"),e.maxActivationsPerTurn!==void 0&&e.maxActivationsPerTurn<1&&i.push("Max activations per turn must be at least 1"),e.scanDepth!==void 0&&e.scanDepth<1&&i.push("Scan depth must be at least 1"),{isValid:i.length===0,errors:i}}static sortByPriority(e){return[...e].sort((i,s)=>(s.order||0)-(i.order||0))}static getLogicDisplayName(e){switch(e){case Ft.AND_ANY:return"ANY (Bt k t kha no)";case Ft.AND_ALL:return"ALL (Tt c t kha)";case Ft.NOT_ALL:return"NOT ALL (Khng phi tt c)";case Ft.NOT_ANY:return"NOT ANY (Khng c t kha no)";default:return"Unknown"}}static getCategoryDisplayName(e){switch(e){case"combat":return" Chin u";case"social":return" X hi";case"exploration":return" Khm ph";case"story":return" Ct truyn";case"items":return" Vt phm";case"skills":return" K nng";case"world":return" Th gii";case"worldinfo":return" WorldInfo";case"general":default:return" Tng qut"}}static getAvailableCategories(){return[{value:"general",label:" Tng qut"},{value:"combat",label:" Chin u"},{value:"social",label:" X hi"},{value:"exploration",label:" Khm ph"},{value:"story",label:" Ct truyn"},{value:"items",label:" Vt phm"},{value:"skills",label:" K nng"},{value:"world",label:" Th gii"},{value:"worldinfo",label:" WorldInfo"}]}static migrateLegacyRule(e){const i=this.createDefaultRule();return i.id=e.id||i.id,i.content=e.content||"",i.isActive=e.isActive!==void 0?e.isActive:!0,i.content&&(i.tokenWeight=this.estimateTokenWeight(i.content)),i}static exportRulesToJSON(e){const i={version:"2.0",exportedAt:new Date().toISOString(),rulesCount:e.length,rules:e};return JSON.stringify(i,null,2)}static importRulesFromJSON(e){const i=[];let s=[];try{const a=JSON.parse(e);if(Array.isArray(a))s=a.map(u=>this.migrateLegacyRule(u));else if(a.rules&&Array.isArray(a.rules))s=a.rules.map(u=>!u.keywords&&!u.title&&!u.order?this.migrateLegacyRule(u):u);else return i.push("Invalid file format. Expected rules array or export object."),{rules:[],errors:i};s.forEach((u,f)=>{const p=this.validateRule(u);p.isValid||i.push(`Rule ${f+1}: ${p.errors.join(", ")}`)})}catch(a){i.push("Failed to parse JSON file: "+(a instanceof Error?a.message:"Unknown error"))}return{rules:s,errors:i}}}const aw=({isOpen:t,onClose:e,suggestions:i,onSelect:s,title:a})=>t?l.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:e,children:l.jsxs("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl w-full max-w-md transform scale-100 transition-all duration-300",onClick:u=>u.stopPropagation(),children:[l.jsxs("div",{className:"p-6 border-b border-white/10 flex justify-between items-center",children:[l.jsx("h3",{className:"text-xl font-bold text-white bg-gradient-to-r from-purple-200 to-pink-200 bg-clip-text text-transparent",children:a}),l.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center rounded-xl bg-white/10 hover:bg-white/20 text-white/70 hover:text-white transition-all duration-200 text-xl leading-none",children:""})]}),l.jsx("div",{className:"p-6 max-h-80 overflow-y-auto",children:i.length>0?l.jsx("ul",{className:"space-y-3",children:i.map((u,f)=>l.jsx("li",{onClick:()=>s(u),className:"p-4 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl hover:bg-gradient-to-r hover:from-purple-500/20 hover:to-pink-500/20 hover:border-purple-400/30 cursor-pointer transition-all duration-300 text-sm text-white/90 hover:text-white hover:shadow-lg transform hover:scale-[1.02]",children:u},f))}):l.jsx("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-xl p-6 text-center",children:l.jsx("p",{className:"text-white/60",children:"Khng c gi  no."})})})]})}):null,v0=()=>{const[t,e]=E.useState(()=>{const u={fontSize:16,fontFamily:"Inter",memoryAutoClean:!0,historyAutoCompress:!0,themeColor:"purple",entityExportEnabled:!0,entityExportInterval:7,entityExportDebugLogging:!0,entityImportEnabled:!0,entityAutoMergeOnImport:!0,entityBackupBeforeImport:!0},f=localStorage.getItem("gameSettings");if(f)try{const p=JSON.parse(f);return{...u,...p}}catch{}return u}),i=u=>{e(u),localStorage.setItem("gameSettings",JSON.stringify(u)),document.documentElement.style.setProperty("--game-font-size",`${u.fontSize}px`),document.documentElement.style.setProperty("--game-font-family",u.fontFamily),document.documentElement.style.setProperty("--game-theme-color",u.themeColor)};return E.useEffect(()=>{document.documentElement.style.setProperty("--game-font-size",`${t.fontSize}px`),document.documentElement.style.setProperty("--game-font-family",t.fontFamily),document.documentElement.style.setProperty("--game-theme-color",t.themeColor)},[t.fontSize,t.fontFamily,t.themeColor]),[{gameSettings:t},{setGameSettings:e,handleSettingsChange:i}]},Ku={fontSize:16,fontFamily:"Inter",memoryAutoClean:!0,historyAutoCompress:!0,themeColor:"purple",entityExportEnabled:!0,entityExportInterval:7,entityExportDebugLogging:!0,entityImportEnabled:!0,entityAutoMergeOnImport:!0,entityBackupBeforeImport:!0},rw=[{value:"Inter",label:"Inter (Mc nh)"},{value:"Merriweather",label:"Merriweather (Serif)"},{value:"Lora",label:"Lora (Serif)"},{value:"Roboto Mono",label:"Roboto Mono (Monospace)"},{value:"Source Code Pro",label:"Source Code Pro (Monospace)"}],Sr=[{id:"dark-slate",name:"en Xm m",description:"Ti tm v b n",colors:{primary:"from-slate-900 via-slate-800 to-slate-900",secondary:"from-gray-800 to-slate-900",accent:"from-slate-600 to-gray-700",text:"slate-200"},preview:"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900"},{id:"deep-blue",name:"Xanh Dng m",description:"Su thm nh i dng",colors:{primary:"from-slate-900 via-blue-900 to-slate-900",secondary:"from-blue-800 to-slate-900",accent:"from-blue-600 to-indigo-700",text:"blue-200"},preview:"bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900"},{id:"purple",name:"Tm Hong Gia",description:"Hin ti (Mc nh)",colors:{primary:"from-slate-900 via-purple-900 to-slate-900",secondary:"from-purple-800 to-slate-900",accent:"from-purple-600 to-pink-700",text:"purple-200"},preview:"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900"},{id:"emerald",name:"Ngc Lc Bo",description:"Ti mt v thanh lch",colors:{primary:"from-slate-900 via-emerald-900 to-slate-900",secondary:"from-emerald-800 to-slate-900",accent:"from-emerald-600 to-teal-700",text:"emerald-200"},preview:"bg-gradient-to-br from-slate-900 via-emerald-900 to-slate-900"},{id:"rose-gold",name:"Hng Vng",description:"m p v lng mn",colors:{primary:"from-slate-800 via-rose-900 to-orange-900",secondary:"from-rose-800 to-orange-800",accent:"from-rose-600 to-orange-600",text:"rose-200"},preview:"bg-gradient-to-br from-slate-800 via-rose-900 to-orange-900"},{id:"sunset",name:"Hong Hn",description:"Sng sa nh hong hn",colors:{primary:"from-orange-800 via-red-900 to-pink-800",secondary:"from-red-700 to-pink-800",accent:"from-orange-500 to-red-600",text:"orange-200"},preview:"bg-gradient-to-br from-orange-800 via-red-900 to-pink-800"}],cw=({isOpen:t,onClose:e,settings:i,onSettingsChange:s})=>{var g;const[a,u]=E.useState(()=>({...Ku,...i}));if(E.useEffect(()=>{u(m=>({...Ku,...i}))},[i]),!t)return null;const f=()=>{s(a),e()},p=()=>{u(Ku)};return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4",onClick:e,children:l.jsxs("div",{className:"bg-white/95 dark:bg-[#2a2f4c]/95 backdrop-blur-sm border-2 border-blue-400 rounded-lg shadow-2xl w-full max-w-2xl text-slate-900 dark:text-white max-h-[90vh] overflow-y-auto",onClick:m=>m.stopPropagation(),children:[l.jsxs("div",{className:"p-6 border-b-2 border-blue-400 flex justify-between items-center",children:[l.jsxs("h3",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400 flex items-center gap-3",children:[l.jsx("span",{className:"text-3xl",children:""}),"Ci t Game"]}),l.jsx("button",{onClick:e,className:"text-gray-500 dark:text-gray-400 hover:text-slate-900 dark:hover:text-white text-3xl leading-none",children:l.jsx(An,{className:"w-6 h-6"})})]}),l.jsxs("div",{className:"p-6 space-y-6",children:[l.jsxs("div",{className:"space-y-4",children:[l.jsx("h4",{className:"text-lg font-semibold text-slate-800 dark:text-gray-100 border-b border-slate-300 dark:border-slate-600 pb-2",children:" Ci t Font"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300",children:["Kch c font: ",a.fontSize,"px"]}),l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("span",{className:"text-sm text-slate-500",children:"12px"}),l.jsx("input",{type:"range",min:"12",max:"24",step:"1",value:a.fontSize||16,onChange:m=>u(y=>({...y,fontSize:parseInt(m.target.value)})),className:"flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer slider"}),l.jsx("span",{className:"text-sm text-slate-500",children:"24px"})]}),l.jsx("div",{className:"p-3 bg-slate-100 dark:bg-slate-800 rounded border text-center",style:{fontSize:`${a.fontSize}px`,fontFamily:a.fontFamily},children:"y l vn bn mu vi font hin ti"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300",children:"Loi font"}),l.jsx("select",{value:a.fontFamily||"Inter",onChange:m=>u(y=>({...y,fontFamily:m.target.value})),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:rw.map(m=>l.jsx("option",{value:m.value,style:{fontFamily:m.value},children:m.label},m.value))})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h4",{className:"text-lg font-semibold text-slate-800 dark:text-gray-100 border-b border-slate-300 dark:border-slate-600 pb-2",children:" Mu Ch "}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Chn bng mu  thay i giao din game"}),l.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:Sr.map(m=>l.jsxs("button",{onClick:()=>u(y=>({...y,themeColor:m.id})),className:`relative p-4 rounded-xl border-2 transition-all duration-300 ${a.themeColor===m.id?"border-blue-500 shadow-lg scale-105":"border-slate-300 dark:border-slate-600 hover:border-blue-400 hover:scale-102"}`,children:[l.jsxs("div",{className:`w-full h-16 rounded-lg mb-3 ${m.preview} relative overflow-hidden`,children:[l.jsx("div",{className:"absolute top-2 left-2 w-4 h-4 bg-white/20 rounded-full blur-sm"}),l.jsx("div",{className:"absolute bottom-2 right-2 w-6 h-6 bg-white/10 rounded-full blur-md"}),l.jsx("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 bg-white/15 rounded-full blur-sm"})]}),l.jsxs("div",{className:"text-left",children:[l.jsx("h5",{className:"font-semibold text-slate-800 dark:text-gray-100 text-sm",children:m.name}),l.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:m.description})]}),a.themeColor===m.id&&l.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:l.jsx("span",{className:"text-white text-xs",children:""})})]},m.id))})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h4",{className:"text-lg font-semibold text-slate-800 dark:text-gray-100 border-b border-slate-300 dark:border-slate-600 pb-2",children:" Ci t Hiu Sut"}),l.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:""}),l.jsx("span",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"T ng dn dp b nh"})]}),l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"T ng xa cc thng tin c  gim ti b nh v ci thin hiu sut"})]}),l.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:a.memoryAutoClean??!0,onChange:m=>u(y=>({...y,memoryAutoClean:m.target.checked})),className:"sr-only peer"}),l.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-slate-600 peer-checked:bg-blue-600"})]})]}),l.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:""}),l.jsx("span",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"T ng nn lch s"})]}),l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"T ng nn lch s game c  tit kim dung lng lu tr"})]}),l.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:a.historyAutoCompress??!0,onChange:m=>u(y=>({...y,historyAutoCompress:m.target.checked})),className:"sr-only peer"}),l.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-slate-600 peer-checked:bg-blue-600"})]})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h4",{className:"text-lg font-semibold text-slate-800 dark:text-gray-100 border-b border-slate-300 dark:border-slate-600 pb-2",children:" Xut Entity T ng"}),l.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:""}),l.jsx("span",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"T ng xut thng tin entity"})]}),l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"T ng xut thng tin nhn vt, vt phm, a im thnh file JSON  tit kim token"})]}),l.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:a.entityExportEnabled??!0,onChange:m=>u(y=>({...y,entityExportEnabled:m.target.checked})),className:"sr-only peer"}),l.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-slate-600 peer-checked:bg-blue-600"})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300",children:[" Tn sut xut: mi ",a.entityExportInterval," lt"]}),l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("span",{className:"text-sm text-slate-500",children:"5"}),l.jsx("input",{type:"range",min:"5",max:"15",step:"1",value:a.entityExportInterval||7,onChange:m=>u(y=>({...y,entityExportInterval:parseInt(m.target.value)})),className:"flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer slider",disabled:!a.entityExportEnabled}),l.jsx("span",{className:"text-sm text-slate-500",children:"15"})]}),l.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Xut file cng thng xuyn th tit kim token cng nhiu, nhng to nhiu file hn"})]}),l.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:""}),l.jsx("span",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Debug logging"})]}),l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Hin th thng tin chi tit v qu trnh xut entity trong Console"})]}),l.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:a.entityExportDebugLogging??!0,onChange:m=>u(y=>({...y,entityExportDebugLogging:m.target.checked})),className:"sr-only peer",disabled:!a.entityExportEnabled}),l.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-slate-600 peer-checked:bg-blue-600 disabled:opacity-50"})]})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h4",{className:"text-lg font-semibold text-slate-800 dark:text-gray-100 border-b border-slate-300 dark:border-slate-600 pb-2",children:" Nhp Entity T ng"}),l.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:""}),l.jsx("span",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Cho php nhp entity t file"})]}),l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Bt tnh nng nhp thng tin entity t file JSON  xut trc "})]}),l.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:a.entityImportEnabled??!0,onChange:m=>u(y=>({...y,entityImportEnabled:m.target.checked})),className:"sr-only peer"}),l.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-slate-600 peer-checked:bg-blue-600"})]})]}),l.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:""}),l.jsx("span",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"T ng merge khi c conflict"})]}),l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"T ng kt hp thng tin khi entity  tn ti trong game"})]}),l.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:a.entityAutoMergeOnImport??!0,onChange:m=>u(y=>({...y,entityAutoMergeOnImport:m.target.checked})),className:"sr-only peer",disabled:!a.entityImportEnabled}),l.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-slate-600 peer-checked:bg-blue-600 disabled:opacity-50"})]})]}),l.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:""}),l.jsx("span",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"To backup trc khi import"})]}),l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"T ng to file backup cc entity hin ti trc khi nhp d liu mi"})]}),l.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:a.entityBackupBeforeImport??!0,onChange:m=>u(y=>({...y,entityBackupBeforeImport:m.target.checked})),className:"sr-only peer",disabled:!a.entityImportEnabled}),l.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-slate-600 peer-checked:bg-blue-600 disabled:opacity-50"})]})]})]}),l.jsxs("div",{className:"space-y-2 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[l.jsxs("h5",{className:"font-semibold text-blue-800 dark:text-blue-200 flex items-center gap-2",children:[l.jsx("span",{children:""}),"Ci t hin ti"]}),l.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[l.jsxs("div",{children:["Font: ",a.fontFamily," - ",a.fontSize,"px"]}),l.jsxs("div",{children:["Mu ch : ",((g=Sr.find(m=>m.id===a.themeColor))==null?void 0:g.name)||"Tm Hong Gia"]}),l.jsxs("div",{children:["Dn dp b nh: ",a.memoryAutoClean?" Bt":" Tt"]}),l.jsxs("div",{children:["Nn lch s: ",a.historyAutoCompress?" Bt":" Tt"]}),l.jsxs("div",{children:["Xut entity: ",a.entityExportEnabled?" Bt":" Tt"]}),a.entityExportEnabled&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{children:["Tn sut xut: Mi ",a.entityExportInterval," lt"]}),l.jsxs("div",{children:["Debug logging: ",a.entityExportDebugLogging?" Bt":" Tt"]})]}),l.jsxs("div",{children:["Nhp entity: ",a.entityImportEnabled?" Bt":" Tt"]}),a.entityImportEnabled&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{children:["Auto merge: ",a.entityAutoMergeOnImport?" Bt":" Tt"]}),l.jsxs("div",{children:["Backup trc import: ",a.entityBackupBeforeImport?" Bt":" Tt"]})]})]})]})]}),l.jsxs("div",{className:"p-6 border-t border-slate-200 dark:border-slate-700 flex justify-between",children:[l.jsx("button",{onClick:p,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md font-semibold transition-colors duration-200 flex items-center gap-2",children:" t li mc nh"}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md font-semibold transition-colors duration-200",children:"Hy"}),l.jsx("button",{onClick:f,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-semibold transition-colors duration-200 flex items-center gap-2",children:" Lu ci t"})]})]})]})})},b0=t=>{const e=Sr.find(i=>i.id===t);return e?e.colors:Sr.find(i=>i.id==="purple").colors},uw=({onBack:t,onStartGame:e,isInitializing:i,initProgress:s,initCurrentStep:a,initSubStep:u})=>{const{ai:f,isAiReady:p,apiKeyError:g,selectedModel:m}=E.useContext(vd),[y]=v0(),{gameSettings:v}=y,[C,N]=E.useState({storyName:"",genre:"",worldDetail:"",worldTime:{day:1,month:1,year:1e3},startLocation:"",customStartLocation:"",expName:"Kinh Nghim",realmTiers:[{id:"1",name:"Luyn Kh",requiredExp:0},{id:"2",name:"Trc C",requiredExp:100}],writingStyle:"second_person",difficulty:"normal",allowNsfw:!1,characterName:"",characterAge:"",characterAppearance:"",customPersonality:"",personalityFromList:"",gender:"ai_decides",bio:"",startSkills:[{name:"",description:"",mastery:""}],addGoal:"",customRules:[]}),[R,L]=E.useState("context"),[O,J]=E.useState({genre:!1,worldDetail:!1,character:!1}),[P,$]=E.useState(!1),[ne,z]=E.useState(null),ae=E.useRef(!1),[de,re]=E.useState([]),[se,oe]=E.useState(!1),_=E.useRef(null),me=E.useRef(null),Y=E.useRef(null),ue=E.useRef(null),H=Q=>{const{name:ve,value:be,type:Ae}=Q.target,De=Ae==="checkbox",qe=Q.target.checked;N(ve==="customPersonality"?ze=>({...ze,customPersonality:be,personalityFromList:""}):ve==="personalityFromList"?ze=>({...ze,personalityFromList:be,customPersonality:""}):ve==="startLocation"?ze=>({...ze,startLocation:be,customStartLocation:be!=="Tu chn"?"":ze.customStartLocation}):ze=>({...ze,[ve]:De?qe:be}))},k=()=>{const Q=Zt.createDefaultRule();N(ve=>({...ve,customRules:[...ve.customRules,Q]}))},S=Q=>{N(ve=>({...ve,customRules:ve.customRules.filter(be=>be.id!==Q)}))},V=(Q,ve,be)=>{N(Ae=>({...Ae,customRules:Ae.customRules.map(De=>{if(De.id===Q){const qe={...De,[ve]:be};return ve==="content"&&(qe.tokenWeight=Zt.estimateTokenWeight(be)),qe}return De})}))},W=(Q,ve)=>{N(be=>({...be,customRules:be.customRules.map(Ae=>Ae.id===Q?{...Ae,isActive:ve}:Ae)}))},I=Q=>{N(ve=>({...ve,expName:Q.target.value}))},j=(Q,ve,be)=>{N(Ae=>({...Ae,realmTiers:Ae.realmTiers.map(De=>De.id===Q?{...De,[ve]:be}:De)}))},F=()=>{const Q=(C.realmTiers.length+1).toString(),ve={id:Q,name:`Cnh Gii ${Q}`,requiredExp:C.realmTiers.length>0?C.realmTiers[C.realmTiers.length-1].requiredExp+100:0};N(be=>({...be,realmTiers:[...be.realmTiers,ve]}))},Z=Q=>{C.realmTiers.length>1&&N(ve=>({...ve,realmTiers:ve.realmTiers.filter(be=>be.id!==Q)}))},A=async()=>{if(!p||!f){z(g||"AI cha sn sng. Vui lng kim tra thit lp API Key.");return}if(ae.current)return;ae.current=!0,$(!0),J(ve=>({...ve,genre:!0})),z(null);const Q="Gi  5 ch /bi cnh c o cho game phiu lu vn bn, phong cch tiu thuyt mng. BT BUC 100% ting Vit, KHNG dng ting Anh. Mi ci trn mt dng.";try{const Ae=(await f.models.generateContent({model:m,contents:Q})).text.trim().split(`
`).map(De=>De.replace(/^[*-]\s*/,"").trim()).filter(Boolean);re(Ae),oe(!0)}catch(ve){console.error("Error generating genre suggestions:",ve),z("Gp li khi to gi . Vui lng kim tra API Key v th li."),re([])}finally{ae.current=!1,$(!1),J(ve=>({...ve,genre:!1}))}},G=async()=>{if(!p||!f){z(g||"AI cha sn sng. Vui lng kim tra thit lp API Key.");return}if(ae.current)return;ae.current=!0,$(!0),J(ve=>({...ve,worldDetail:!0})),z(null);const Q=`Da trn th loi "${C.genre}" v  tng "${C.worldDetail}", hy vit mt bi cnh th gii chi tit v hp dn (khong 3-5 dng) theo vn phong tiu thuyt mng Trung Quc. Bi cnh cn khi gi s t m v gii thiu mt xung t hoc yu t c bit ca th gii. 

QUAN TRNG: BT BUC 100% ting Vit, TUYT I KHNG dng ting Anh.

V d: "Giang H him c y ry anh hng ho hn v ma u tn bo, ni cng php v b tch quyt nh tt c, h thng cho php bn ot ly ni lc, kinh nghim chin u t cc cao th chnh t, khin bn phi n mnh gia v vn n on giang h v la chn gia chnh o gi to hay ma o tn khc."`;try{const be=(await f.models.generateContent({model:m,contents:Q})).text.trim();N(Ae=>({...Ae,worldDetail:be}))}catch(ve){console.error("Error generating suggestion for world detail:",ve),ve.toString().includes("429")?z("Bn  gi yu cu qu nhanh. Vui lng ch mt lt ri th li."):z("Gp li khi to gi . Vui lng kim tra API Key v th li.")}finally{ae.current=!1,$(!1),J(ve=>({...ve,worldDetail:!1}))}},M=async()=>{if(!p||!f){z(g||"AI cha sn sng. Vui lng kim tra thit lp API Key.");return}if(ae.current)return;ae.current=!0,$(!0),J(Ae=>({...Ae,character:!0})),z(null);const Q=C.customPersonality||C.personalityFromList,ve=`Da trn thng tin nhn vt sau, hy to mt tiu s v k nng khi u ph hp cho game nhp vai vn bn:
- Tn nhn vt (do ngi dng t): '${C.characterName||"Cha c"}'
- Tui: '${C.characterAge||"Cha c"}'
- Dung mo: '${C.characterAppearance||"Cha c"}'
- Tn truyn: '${C.storyName||"Cha c"}'
- Th loi: '${C.genre||"Cha c"}'
- Bi cnh: '${C.worldDetail||"Cha c"}'
- Gii tnh: '${C.gender}'
- Tnh cch: '${Q||"Cha c"}'
Vui lng to ra mt tiu s ngn (2-3 cu) v mt k nng khi u ph hp. KHNG c thay i tn nhn vt. Vn phong cn ging tiu thuyt mng. 

QUAN TRNG: BT BUC s dng 100% ting Vit. TUYT I KHNG dng ting Anh. Tr v kt qu di dng JSON vi hai kha: "bio" v "skill".`,be={type:_t.OBJECT,properties:{bio:{type:_t.STRING,description:"Tiu s nhn vt gi  (2-3 cu, BT BUC 100% ting Vit, KHNG dng ting Anh)."},skill:{type:_t.STRING,description:"K nng khi u gi  (BT BUC 100% ting Vit, KHNG dng ting Anh)."}},required:["bio","skill"]};try{const De=(await f.models.generateContent({model:m,contents:ve,config:{responseMimeType:"application/json",responseSchema:be}})).text.trim(),qe=JSON.parse(De);N(ze=>({...ze,bio:qe.bio||"",startSkills:qe.skill?[{name:qe.skill,description:"",mastery:""}]:[{name:"",description:"",mastery:""}]}))}catch(Ae){console.error("Error generating character suggestions:",Ae),Ae.toString().includes("429")?z("Bn  gi yu cu qu nhanh. Vui lng ch mt lt ri th li."):z("Gp li khi to gi  nhn vt. Vui lng kim tra API Key v th li.")}finally{ae.current=!1,$(!1),J(Ae=>({...Ae,character:!1}))}},D=()=>{const Q=JSON.stringify(C,null,2),ve=new Blob([Q],{type:"application/json"}),be=URL.createObjectURL(ve),Ae=document.createElement("a"),De=new Date().toISOString().replace(/[:.]/g,"-");Ae.download=`AI-RolePlay-WorldSetup-${De}.json`,Ae.href=be,document.body.appendChild(Ae),Ae.click(),document.body.removeChild(Ae),URL.revokeObjectURL(be)},B=()=>{var Q;(Q=_.current)==null||Q.click()},X=Q=>{var Ae;const ve=(Ae=Q.target.files)==null?void 0:Ae[0];if(!ve)return;const be=new FileReader;be.onload=De=>{var qe;try{const ze=(qe=De.target)==null?void 0:qe.result;if(typeof ze=="string"){const Ke=JSON.parse(ze);if(Ke.storyName!==void 0&&Ke.characterName!==void 0&&Ke.bio!==void 0){const Ye={...C,...Ke,customRules:Ke.customRules||[],startLocation:Ke.startLocation||"",customStartLocation:Ke.customStartLocation||"",expName:Ke.expName||"Kinh Nghim",realmTiers:Ke.realmTiers||[{id:"1",name:"Luyn Kh",requiredExp:0},{id:"2",name:"Trc C",requiredExp:100}],startSkills:Ke.startSkills?Ke.startSkills.map(Et=>({name:Et.name||"",description:Et.description||"",mastery:Et.mastery||""})):[{name:"",description:"",mastery:""}]};N(Ye),alert(" ti thit lp thnh cng!")}else throw new Error("Tp khng cha d liu thit lp hp l.")}}catch(ze){console.error("Li khi ti tp thit lp:",ze),alert("Khng th c tp thit lp. Tp c th b hng hoc khng ng nh dng.")}},be.readAsText(ve),Q.target&&(Q.target.value="")},xe=()=>{if(C.customRules.length===0){alert("Khng c lut no  lu.");return}const Q=Zt.exportRulesToJSON(C.customRules),ve=new Blob([Q],{type:"application/json"}),be=URL.createObjectURL(ve),Ae=document.createElement("a"),De=new Date().toISOString().replace(/[:.]/g,"-");Ae.download=`AI-RolePlay-EnhancedRules-${De}.json`,Ae.href=be,document.body.appendChild(Ae),Ae.click(),document.body.removeChild(Ae),URL.revokeObjectURL(be)},Ne=()=>{var Q;(Q=me.current)==null||Q.click()},Te=Q=>{var Ae;const ve=(Ae=Q.target.files)==null?void 0:Ae[0];if(!ve)return;const be=new FileReader;be.onload=De=>{var qe;try{const ze=(qe=De.target)==null?void 0:qe.result;if(typeof ze=="string"){const{rules:Ke,errors:Ye}=Zt.importRulesFromJSON(ze);if(Ye.length>0&&alert(`Cnh bo khi nhp file:
`+Ye.join(`
`)),Ke.length>0){const Et=new Set(C.customRules.map(it=>it.id)),Kt=Ke.map(it=>Et.has(it.id)?{...it,id:`${Date.now()}-${Math.random()}`}:it);N(it=>({...it,customRules:[...it.customRules,...Kt]})),alert(` nhp thnh cng ${Kt.length} lut.`)}}}catch(ze){console.error("Li khi ti tp lut:",ze),alert("Khng th c tp lut. Tp c th b hng hoc khng ng nh dng.")}},be.readAsText(ve),Q.target&&(Q.target.value="")},Ee=(Q,ve)=>{const be=Zt.createDefaultRule();return be.id=`worldinfo-${ve}-${Date.now()}`,be.title=Q.comment||`WorldInfo Entry ${ve}`,be.content=Q.content||"",be.keywords=Array.isArray(Q.key)?Q.key:Q.key?[Q.key]:[],be.secondaryKeywords=Array.isArray(Q.keysecondary)?Q.keysecondary:Q.keysecondary?[Q.keysecondary]:[],be.logic=Q.selectiveLogic||0,be.order=Q.order||100,be.probability=Q.probability!==void 0?Q.probability:100,be.scanDepth=Q.depth||5,be.caseSensitive=Q.caseSensitive!==null?Q.caseSensitive:!1,be.matchWholeWords=Q.matchWholeWords!==null?Q.matchWholeWords:!1,be.isActive=!Q.disable,be.category=Q.group||"worldinfo",be},Re=()=>{var Q;(Q=ue.current)==null||Q.click()},ye=Q=>{var Ae;const ve=(Ae=Q.target.files)==null?void 0:Ae[0];if(!ve)return;const be=new FileReader;be.onload=De=>{var qe;try{const ze=(qe=De.target)==null?void 0:qe.result;if(typeof ze=="string"){const Ke=JSON.parse(ze);if(Ke.entries&&typeof Ke.entries=="object"){const Ye=Ke.entries,Et=[],Kt=new Set(C.customRules.map(it=>it.id));Object.entries(Ye).forEach(([it,tn])=>{if(tn&&tn.content&&typeof tn.content=="string"&&tn.content.trim()){const Ot=Ee(tn,it);let Ue=Ot.id;for(;Kt.has(Ue);)Ue=`${Ot.id}-${Math.random()}`;Ot.id=Ue,Et.push(Ot),Kt.add(Ue)}}),Et.length>0?(N(it=>({...it,customRules:[...it.customRules,...Et]})),alert(` nhp thnh cng ${Et.length} lut t WorldInfo.`)):alert("Khng tm thy ni dung hp l trong WorldInfo entries.")}else throw new Error("Tp khng phi nh dng SillyTavern WorldInfo hp l.")}}catch(ze){console.error("Li khi ti WorldInfo:",ze),alert("Khng th c tp WorldInfo. Tp c th b hng hoc khng ng nh dng SillyTavern WorldInfo.")}},be.readAsText(ve),Q.target&&(Q.target.value="")},we=()=>{var Q;(Q=Y.current)==null||Q.click()},Se=Q=>{var Ae;const ve=(Ae=Q.target.files)==null?void 0:Ae[0];if(!ve)return;const be=new FileReader;be.onload=De=>{var qe;try{const ze=(qe=De.target)==null?void 0:qe.result;if(typeof ze=="string"){const Ke=JSON.parse(ze);if(Ke.worldData&&Ke.customRules&&Array.isArray(Ke.customRules)){const{worldData:Ye,customRules:Et}=Ke,Kt={...C,storyName:Ye.storyName||C.storyName,genre:Ye.genre||C.genre,worldName:Ye.worldName||C.worldName,worldDescription:Ye.worldDescription||C.worldDescription,worldDetail:Ye.worldDetail||C.worldDetail,worldTime:Ye.worldTime||C.worldTime,startLocation:Ye.startLocation||C.startLocation,customStartLocation:Ye.customStartLocation||C.customStartLocation,expName:Ye.expName||C.expName,realmTiers:Ye.realmTiers||C.realmTiers,writingStyle:Ye.writingStyle||C.writingStyle,difficulty:Ye.difficulty||C.difficulty,allowNsfw:Ye.allowNsfw!==void 0?Ye.allowNsfw:C.allowNsfw,characterName:Ye.characterName||C.characterName,characterAge:Ye.characterAge||C.characterAge,characterAppearance:Ye.characterAppearance||C.characterAppearance,customPersonality:Ye.customPersonality||C.customPersonality,personalityFromList:Ye.personalityFromList||C.personalityFromList,gender:Ye.gender||C.gender,bio:Ye.bio||C.bio,startSkills:Ye.startSkills||C.startSkills,addGoal:Ye.addGoal!==void 0?Ye.addGoal:C.addGoal,customRules:Et};N(Kt),alert(` ti thnh cng WorldSetup: "${Ye.storyName||"Unnamed"}" vi ${Et.length} lut ty chnh.`)}else throw new Error("nh dng WorldSetup khng hp l. Cn c worldData v customRules.")}}catch(ze){console.error("Li khi ti WorldSetup:",ze),alert("Khng th c tp WorldSetup. Tp c th b hng hoc khng ng nh dng.")}},be.readAsText(ve),Q.target&&(Q.target.value="")},Ce=async()=>{try{await e(C)}catch(Q){console.error("Error starting game:",Q)}},_e=["Ty Tm S Dc","im m","Nhit Huyt","V S","Nh Nhng","C Tr","Lnh Khc","Kiu Ngo","Ngu Ngc","Gio Hot"],gt=()=>R==="knowledge"?l.jsxs("div",{className:"space-y-4",children:[l.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Thm lut l, vt phm, nhn vt, hoc bt k thng tin no bn mun AI tun theo ngay t u.",l.jsx("br",{}),`V d: "To ra mt thanh kim tn l 'Ha Long Kim' c kh nng phun la."`]}),C.customRules.map((Q,ve)=>l.jsxs("div",{className:"bg-slate-200/50 dark:bg-[#373c5a]/50 p-3 rounded-lg border border-slate-300 dark:border-slate-600 space-y-2",children:[l.jsx("input",{type:"text",value:Q.title||"",onChange:be=>V(Q.id,"title",be.target.value),placeholder:`Tiu  lut #${ve+1}...`,className:"w-full bg-slate-100 dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-2 px-3 text-sm font-medium text-slate-800 dark:text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"}),l.jsx("textarea",{value:Q.content,onChange:be=>V(Q.id,"content",be.target.value),placeholder:`Ni dung lut #${ve+1}...`,className:"w-full h-24 bg-slate-100 dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-2 px-3 text-sm text-slate-800 dark:text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-y"}),l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsxs("label",{htmlFor:`rule-toggle-${Q.id}`,className:"flex items-center cursor-pointer",children:[l.jsx("input",{id:`rule-toggle-${Q.id}`,type:"checkbox",checked:Q.isActive,onChange:be=>W(Q.id,be.target.checked),className:"h-4 w-4 rounded border-gray-400 bg-gray-700 text-purple-600 focus:ring-purple-500"}),l.jsx("span",{className:"ml-2 text-sm text-slate-700 dark:text-gray-300",children:"Hot ng"})]}),Q.order&&Q.order!==100&&l.jsxs("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:[" u tin: ",Q.order]})]}),l.jsx("button",{onClick:()=>S(Q.id),className:"px-3 py-1 bg-red-700 hover:bg-red-600 text-white rounded-md text-xs font-semibold transition-colors",children:"Xa"})]})]},Q.id)),C.customRules.length===0&&l.jsx("p",{className:"text-center text-slate-600 dark:text-slate-400 italic py-4",children:"Cha c lut l ty chnh no."}),l.jsxs("button",{onClick:k,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-md text-white text-sm font-semibold transition-colors duration-200 flex items-center justify-center gap-2",children:[l.jsx(bo,{className:"w-5 h-5"})," Thm Lut Mi"]}),l.jsxs("div",{className:"flex items-center space-x-2 pt-4 border-t border-slate-300 dark:border-slate-700",children:[l.jsxs("button",{onClick:xe,className:"px-3 py-2 bg-green-700 hover:bg-green-600 rounded-md text-white text-sm font-semibold transition-colors duration-200 flex items-center gap-2",children:[l.jsx(vs,{className:"w-4 h-4"})," Lu B Lut"]}),l.jsxs("button",{onClick:Ne,className:"px-3 py-2 bg-sky-600 hover:bg-sky-500 rounded-md text-white text-sm font-semibold transition-colors duration-200 flex items-center gap-2",children:[l.jsx($l,{className:"w-4 h-4"})," Ti B Lut"]}),l.jsxs("button",{onClick:Re,className:"px-3 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-md text-white text-sm font-semibold transition-colors duration-200 flex items-center gap-2",children:[l.jsx(Co,{className:"w-4 h-4"})," Nhp WorldInfo"]})]})]}):l.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[l.jsxs("div",{className:"bg-gradient-to-br from-pink-500/10 to-purple-500/10 backdrop-blur-sm border border-pink-400/20 rounded-2xl p-6 space-y-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx("div",{className:"p-2 bg-pink-500/20 rounded-xl",children:l.jsx(xg,{className:"w-6 h-6 text-pink-300"})}),l.jsx("h2",{className:"text-xl font-bold text-white",children:"Bi Cnh Truyn"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"storyName",className:"block text-sm font-medium text-white/90",children:"Tn Truyn"}),l.jsx("input",{id:"storyName",name:"storyName",type:"text",value:C.storyName,onChange:H,placeholder:"VD: Truyn Thuyt Thn Kim, i o Tranh Phong...",className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white placeholder-white/50 focus:outline-none focus:border-pink-400/50 focus:ring-2 focus:ring-pink-400/20 transition-all duration-300"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"genre",className:"block text-sm font-medium text-white/90",children:"Th Loi"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{id:"genre",name:"genre",type:"text",value:C.genre,onChange:H,placeholder:"VD: Tin hip, Huyn huyn, Kim hip...",className:"flex-1 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white placeholder-white/50 focus:outline-none focus:border-pink-400/50 focus:ring-2 focus:ring-pink-400/20 transition-all duration-300"}),l.jsx("button",{onClick:A,disabled:P,className:"px-4 py-3 bg-gradient-to-r from-pink-500/20 to-purple-500/20 hover:from-pink-500/30 hover:to-purple-500/30 border border-pink-400/30 rounded-xl text-pink-200 hover:text-white transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed backdrop-blur-sm",children:O.genre?l.jsx(Hl,{className:"w-5 h-5 animate-spin"}):l.jsx(Oi,{className:"w-5 h-5"})})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"worldDetail",className:"block text-sm font-medium text-white/90",children:"Th Gii/Bi Cnh Chi Tit"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("textarea",{id:"worldDetail",name:"worldDetail",value:C.worldDetail,onChange:H,placeholder:"VD: i Lc Phong Vn, ni tu tin gi tranh u...",rows:4,className:"flex-1 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white placeholder-white/50 focus:outline-none focus:border-pink-400/50 focus:ring-2 focus:ring-pink-400/20 transition-all duration-300 resize-none"}),l.jsx("button",{onClick:G,disabled:P,className:"px-4 py-3 bg-gradient-to-r from-pink-500/20 to-purple-500/20 hover:from-pink-500/30 hover:to-purple-500/30 border border-pink-400/30 rounded-xl text-pink-200 hover:text-white transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed backdrop-blur-sm self-start",children:O.worldDetail?l.jsx(Hl,{className:"w-5 h-5 animate-spin"}):l.jsx(Oi,{className:"w-5 h-5"})})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{className:"block text-sm font-medium text-white/90",children:"Thi Gian Bt u"}),l.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs text-white/70 mb-1",children:"Ngy"}),l.jsx("input",{type:"number",min:"1",max:"30",value:C.worldTime.day,onChange:Q=>N(ve=>({...ve,worldTime:{...ve.worldTime,day:parseInt(Q.target.value)||1}})),className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg py-2 px-3 text-white focus:outline-none focus:border-pink-400/50 focus:ring-2 focus:ring-pink-400/20 transition-all duration-300 text-center"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs text-white/70 mb-1",children:"Thng"}),l.jsx("input",{type:"number",min:"1",max:"12",value:C.worldTime.month,onChange:Q=>N(ve=>({...ve,worldTime:{...ve.worldTime,month:parseInt(Q.target.value)||1}})),className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg py-2 px-3 text-white focus:outline-none focus:border-pink-400/50 focus:ring-2 focus:ring-pink-400/20 transition-all duration-300 text-center"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs text-white/70 mb-1",children:"Nm"}),l.jsx("input",{type:"number",min:"1",value:C.worldTime.year,onChange:Q=>N(ve=>({...ve,worldTime:{...ve.worldTime,year:parseInt(Q.target.value)||1e3}})),className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg py-2 px-3 text-white focus:outline-none focus:border-pink-400/50 focus:ring-2 focus:ring-pink-400/20 transition-all duration-300 text-center"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{className:"block text-sm font-medium text-white/90",children:"a im bt u"}),l.jsxs("select",{name:"startLocation",value:C.startLocation,onChange:H,className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-pink-400/50 focus:ring-2 focus:ring-pink-400/20 transition-all duration-300",children:[l.jsx("option",{value:"",className:"bg-slate-800 text-white",children:"Chn a im bt u..."}),l.jsx("option",{value:"Hoang d ngu nhin",className:"bg-slate-800 text-white",children:"Hoang d"}),l.jsx("option",{value:"Thn, Lng ngu nhin",className:"bg-slate-800 text-white",children:"Thn, Lng"}),l.jsx("option",{value:"Thnh Th ngu nhin",className:"bg-slate-800 text-white",children:"Thnh Th"}),l.jsx("option",{value:"Mt a im bt k",className:"bg-slate-800 text-white",children:"Ngu Nhin"}),l.jsx("option",{value:"Tu chn",className:"bg-slate-800 text-white",children:"Tu chn"})]}),C.startLocation==="Tu chn"&&l.jsx("input",{id:"customStartLocation",name:"customStartLocation",type:"text",value:C.customStartLocation,onChange:H,placeholder:"Nhp a im ty chn...",className:"w-full mt-2 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white placeholder-white/50 focus:outline-none focus:border-pink-400/50 focus:ring-2 focus:ring-pink-400/20 transition-all duration-300"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{className:"block text-sm font-medium text-white/90",children:"Thit Lp H Thng Cnh Gii"}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{className:"block text-xs text-white/70",children:"Tn n V Kinh Nghim"}),l.jsx("input",{type:"text",value:C.expName,onChange:I,placeholder:"VD: Linh Lc, Chakra, Ma Lc...",className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg py-2 px-3 text-white placeholder-white/50 focus:outline-none focus:border-pink-400/50 focus:ring-2 focus:ring-pink-400/20 transition-all duration-300"})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("label",{className:"block text-xs text-white/70",children:"Cc Cnh Gii"}),l.jsx("div",{className:"flex gap-2",children:l.jsx("button",{type:"button",onClick:F,className:"w-6 h-6 bg-green-500/20 hover:bg-green-500/30 border border-green-400/30 hover:border-green-400/50 rounded text-green-200 hover:text-white transition-all duration-300 flex items-center justify-center text-sm font-bold",title:"Thm cnh gii",children:"+"})})]}),C.realmTiers.map((Q,ve)=>l.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-lg p-3 space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("span",{className:"text-xs text-white/60",children:["Cnh Gii ",ve+1]}),C.realmTiers.length>1&&l.jsx("button",{type:"button",onClick:()=>Z(Q.id),className:"w-5 h-5 bg-red-500/20 hover:bg-red-500/30 border border-red-400/30 hover:border-red-400/50 rounded text-red-200 hover:text-white transition-all duration-300 flex items-center justify-center text-xs font-bold",title:"Xa cnh gii",children:"-"})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs text-white/50 mb-1",children:"Tn Cnh Gii"}),l.jsx("input",{type:"text",value:Q.name,onChange:be=>j(Q.id,"name",be.target.value),placeholder:"VD: Luyn Kh, Trc C...",className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded py-1.5 px-2 text-white text-sm placeholder-white/40 focus:outline-none focus:border-pink-400/50 focus:ring-1 focus:ring-pink-400/20 transition-all duration-300"})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-xs text-white/50 mb-1",children:[C.expName," Cn Thit"]}),l.jsx("input",{type:"number",min:"0",value:Q.requiredExp,onChange:be=>j(Q.id,"requiredExp",parseInt(be.target.value)||0),className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded py-1.5 px-2 text-white text-sm focus:outline-none focus:border-pink-400/50 focus:ring-1 focus:ring-pink-400/20 transition-all duration-300",disabled:ve===0})]})]})]},Q.id))]})]})]}),l.jsxs("div",{className:"bg-gradient-to-br from-sky-500/10 to-blue-500/10 backdrop-blur-sm border border-sky-400/20 rounded-2xl p-6 space-y-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx("div",{className:"p-2 bg-sky-500/20 rounded-xl",children:l.jsx(vo,{className:"w-6 h-6 text-sky-300"})}),l.jsx("h2",{className:"text-xl font-bold text-white",children:"Nhn Vt Chnh"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"characterName",className:"block text-sm font-medium text-white/90",children:"Danh Xng/Tn"}),l.jsx("input",{id:"characterName",name:"characterName",type:"text",value:C.characterName,onChange:H,placeholder:"VD: Dip Phm, Hn Lp...",className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white placeholder-white/50 focus:outline-none focus:border-sky-400/50 focus:ring-2 focus:ring-sky-400/20 transition-all duration-300"})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"characterAge",className:"block text-sm font-medium text-white/90",children:"Tui"}),l.jsx("input",{id:"characterAge",name:"characterAge",type:"text",value:C.characterAge,onChange:H,placeholder:"VD: 20 tui, Thanh nin...",className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white placeholder-white/50 focus:outline-none focus:border-sky-400/50 focus:ring-2 focus:ring-sky-400/20 transition-all duration-300"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"characterAppearance",className:"block text-sm font-medium text-white/90",children:"Dung mo"}),l.jsx("input",{id:"characterAppearance",name:"characterAppearance",type:"text",value:C.characterAppearance,onChange:H,placeholder:"VD: Cao ro, mt sc so...",className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white placeholder-white/50 focus:outline-none focus:border-sky-400/50 focus:ring-2 focus:ring-sky-400/20 transition-all duration-300"})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{className:"block text-sm font-medium text-white/90",children:"Tnh Cch"}),l.jsxs("div",{className:"space-y-2",children:[!C.customPersonality&&l.jsxs("select",{name:"personalityFromList",value:C.personalityFromList,onChange:H,className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-sky-400/50 focus:ring-2 focus:ring-sky-400/20 transition-all duration-300",children:[l.jsx("option",{value:"",className:"bg-slate-800 text-white",children:"Chn tnh cch c sn..."}),_e.map(Q=>l.jsx("option",{value:Q,className:"bg-slate-800 text-white",children:Q},Q))]}),l.jsx("input",{id:"customPersonality",name:"customPersonality",type:"text",value:C.customPersonality,onChange:H,placeholder:"Hoc nhp tnh cch ca bn (VD: Lnh lng)",className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white placeholder-white/50 focus:outline-none focus:border-sky-400/50 focus:ring-2 focus:ring-sky-400/20 transition-all duration-300"})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{className:"block text-sm font-medium text-white/90",children:"Gii Tnh"}),l.jsxs("select",{name:"gender",value:C.gender,onChange:H,className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-sky-400/50 focus:ring-2 focus:ring-sky-400/20 transition-all duration-300",children:[l.jsx("option",{value:"ai_decides",className:"bg-slate-800 text-white",children:" AI quyt nh"}),l.jsx("option",{value:"Nam",className:"bg-slate-800 text-white",children:"Nam"}),l.jsx("option",{value:"N",className:"bg-slate-800 text-white",children:"N"})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"bio",className:"block text-sm font-medium text-white/90",children:"S Lc Tiu S"}),l.jsx("textarea",{id:"bio",name:"bio",value:C.bio,onChange:H,placeholder:"VD: Mt ph vt mang huyt mch thng c...",rows:3,className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white placeholder-white/50 focus:outline-none focus:border-sky-400/50 focus:ring-2 focus:ring-sky-400/20 transition-all duration-300 resize-none"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("label",{htmlFor:"addGoal",className:"block text-sm font-medium text-white/90",children:["Mc Tiu ",l.jsx("span",{className:"text-white/50",children:"(Ty chn)"})]}),l.jsx("textarea",{id:"addGoal",name:"addGoal",value:C.addGoal,onChange:H,placeholder:"VD: Tr thnh cao th v lm, tm li k c b mt...",rows:2,className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white placeholder-white/50 focus:outline-none focus:border-sky-400/50 focus:ring-2 focus:ring-sky-400/20 transition-all duration-300 resize-none"}),l.jsx("p",{className:"text-xs text-white/50",children:"Mc tiu v ng lc ca nhn vt trong hnh trnh."})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("label",{className:"block text-sm font-medium text-white/90",children:["K Nng Khi u ",l.jsx("span",{className:"text-white/50",children:"(Ty chn)"})]}),C.startSkills.map((Q,ve)=>l.jsxs("div",{className:"space-y-2 p-4 bg-white/5 rounded-xl border border-white/10",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("span",{className:"text-sm font-medium text-white/90",children:["K nng ",ve+1]}),l.jsxs("div",{className:"flex gap-2",children:[C.startSkills.length>1&&l.jsx("button",{type:"button",onClick:()=>{const be=C.startSkills.filter((Ae,De)=>De!==ve);N(Ae=>({...Ae,startSkills:be}))},className:"w-6 h-6 bg-red-500/20 hover:bg-red-500/30 border border-red-400/30 rounded-md flex items-center justify-center text-red-400 hover:text-red-300 transition-colors",children:l.jsx("span",{className:"text-sm font-bold",children:""})}),ve===C.startSkills.length-1&&l.jsx("button",{type:"button",onClick:()=>{const be=[...C.startSkills,{name:"",description:"",mastery:""}];N(Ae=>({...Ae,startSkills:be}))},className:"w-6 h-6 bg-green-500/20 hover:bg-green-500/30 border border-green-400/30 rounded-md flex items-center justify-center text-green-400 hover:text-green-300 transition-colors",children:l.jsx("span",{className:"text-sm font-bold",children:"+"})})]})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs font-medium text-white/70 mb-1",children:"Tn k nng"}),l.jsx("input",{type:"text",value:Q.name,onChange:be=>{const Ae=[...C.startSkills];Ae[ve].name=be.target.value,N(De=>({...De,startSkills:Ae}))},placeholder:"VD: Thut n thn",className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg py-2 px-3 text-white placeholder-white/50 focus:outline-none focus:border-sky-400/50 focus:ring-2 focus:ring-sky-400/20 transition-all duration-300"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs font-medium text-white/70 mb-1",children:"M t"}),l.jsx("input",{type:"text",value:Q.description,onChange:be=>{const Ae=[...C.startSkills];Ae[ve].description=be.target.value,N(De=>({...De,startSkills:Ae}))},placeholder:"VD: C th n mnh trong bng ti",className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg py-2 px-3 text-white placeholder-white/50 focus:outline-none focus:border-sky-400/50 focus:ring-2 focus:ring-sky-400/20 transition-all duration-300"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs font-medium text-white/70 mb-1",children:"Mc  thnh tho"}),l.jsxs("select",{value:Q.mastery,onChange:be=>{const Ae=[...C.startSkills];Ae[ve].mastery=be.target.value,N(De=>({...De,startSkills:Ae}))},className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg py-2 px-3 text-white focus:outline-none focus:border-sky-400/50 focus:ring-2 focus:ring-sky-400/20 transition-all duration-300",children:[l.jsx("option",{value:"",className:"bg-slate-800 text-white",children:"Chn mc ..."}),l.jsx("option",{value:"S Cp",className:"bg-slate-800 text-white",children:"S Cp"}),l.jsx("option",{value:"Trung Cp",className:"bg-slate-800 text-white",children:"Trung Cp"}),l.jsx("option",{value:"Cao Cp",className:"bg-slate-800 text-white",children:"Cao Cp"}),l.jsx("option",{value:"i Thnh",className:"bg-slate-800 text-white",children:"i Thnh"}),l.jsx("option",{value:"Vin Mn",className:"bg-slate-800 text-white",children:"Vin Mn"})]})]})]})]},ve)),l.jsx("p",{className:"text-xs text-white/50",children:"Gi  cho AI v loi k nng ngi mun bt u."})]}),l.jsxs("button",{type:"button",onClick:M,disabled:P||!p,className:"group w-full mt-4 flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-sky-500/20 to-blue-500/20 hover:from-sky-500/30 hover:to-blue-500/30 border border-sky-400/30 hover:border-sky-400/50 rounded-xl text-sky-200 hover:text-white transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed backdrop-blur-sm",children:[O.character?l.jsx(Hl,{className:"w-5 h-5 animate-spin"}):l.jsx(Oi,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),l.jsx("span",{className:"font-medium",children:"Gi  Tiu s & K nng"})]})]}),l.jsxs("div",{className:"xl:col-span-2 grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-gradient-to-br from-yellow-500/10 to-orange-500/10 backdrop-blur-sm border border-yellow-400/20 rounded-2xl p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"p-2 bg-yellow-500/20 rounded-xl",children:l.jsx(iw,{className:"w-5 h-5 text-yellow-300"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Phong cch vit"})]}),l.jsxs("select",{name:"writingStyle",value:C.writingStyle,onChange:H,className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-yellow-400/50 focus:ring-2 focus:ring-yellow-400/20 transition-all duration-300",children:[l.jsx("option",{value:"second_person",className:"bg-slate-800 text-white",children:'Ngi th hai - "Ngi" l nhn vt chnh'}),l.jsx("option",{value:"first_person",className:"bg-slate-800 text-white",children:'Ngi th nht - Nhn vt chnh xng "Ta/Ti"'})]})]}),l.jsxs("div",{className:"bg-gradient-to-br from-red-500/10 to-orange-500/10 backdrop-blur-sm border border-red-400/20 rounded-2xl p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"p-2 bg-red-500/20 rounded-xl",children:l.jsx(sw,{className:"w-5 h-5 text-red-300"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:" Kh & Ni Dung"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-white/90 mb-2",children:"Chn  Kh:"}),l.jsxs("select",{name:"difficulty",value:C.difficulty,onChange:H,className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-red-400/50 focus:ring-2 focus:ring-red-400/20 transition-all duration-300",children:[l.jsx("option",{value:"easy",className:"bg-slate-800 text-white",children:"D - To ra cho  s thi"}),l.jsx("option",{value:"normal",className:"bg-slate-800 text-white",children:"Thng - Cn bng, ph hp a s"}),l.jsx("option",{value:"hard",className:"bg-slate-800 text-white",children:"Kh - Th thch cao, Mun n hnh"})]})]}),l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx("input",{id:"allowNsfw",name:"allowNsfw",type:"checkbox",checked:C.allowNsfw,onChange:H,className:"mt-1 h-4 w-4 rounded border-white/20 bg-white/10 text-red-500 focus:ring-red-400/50"}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"allowNsfw",className:"text-sm text-white/90 font-medium",children:"Cho php ni dung 18+ (Cc k chi tit)"}),l.jsx("p",{className:"text-xs text-white/60 mt-1",children:"Khi c chn, AI s k cu chuyn c tnh tit 18+ (c yu t bo lc) v hnh ng ty  nsfw."})]})]})]})]})]})]}),Fe=b0(v.themeColor);return l.jsxs("div",{className:`min-h-screen bg-gradient-to-br ${Fe.primary} relative overflow-hidden`,children:[l.jsx("div",{className:"absolute inset-0 opacity-50",children:l.jsx("div",{className:"w-full h-full",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}})}),l.jsx("div",{className:`absolute top-20 left-20 w-32 h-32 bg-${Fe.text.split("-")[0]}-500/20 rounded-full blur-xl animate-pulse`}),l.jsx("div",{className:`absolute bottom-20 right-20 w-48 h-48 bg-${Fe.text.split("-")[0]}-400/10 rounded-full blur-2xl animate-pulse delay-1000`}),l.jsx("div",{className:`absolute top-1/2 left-1/4 w-24 h-24 bg-${Fe.text.split("-")[0]}-600/15 rounded-full blur-xl animate-pulse delay-500`}),l.jsx("div",{className:"relative z-10 flex items-center justify-center min-h-screen p-4",children:l.jsxs("div",{className:"bg-white/5 backdrop-blur-xl border border-white/10 w-full max-w-6xl rounded-3xl shadow-2xl overflow-hidden",children:[l.jsxs("div",{className:"bg-gradient-to-r from-purple-600/20 via-pink-600/20 to-purple-600/20 border-b border-white/10 p-6",children:[l.jsx("input",{type:"file",ref:_,onChange:X,accept:".json",className:"hidden"}),l.jsx("input",{type:"file",ref:me,onChange:Te,accept:".json",className:"hidden"}),l.jsx("input",{type:"file",ref:Y,onChange:Se,accept:".json",className:"hidden"}),l.jsx("input",{type:"file",ref:ue,onChange:ye,accept:".json",className:"hidden"}),l.jsxs("div",{className:"flex justify-between items-center mb-6",children:[l.jsxs("button",{onClick:t,className:"group flex items-center gap-2 px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 transition-all duration-300 border border-white/20 hover:border-white/30 backdrop-blur-sm text-white",children:[l.jsx(nw,{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform"}),l.jsx("span",{className:"text-sm font-medium",children:"V Trang Ch"})]}),l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsxs("button",{onClick:D,className:"group flex items-center gap-2 px-4 py-2 bg-emerald-500/20 hover:bg-emerald-500/30 rounded-xl border border-emerald-400/30 hover:border-emerald-400/50 text-emerald-100 transition-all duration-300 backdrop-blur-sm",children:[l.jsx(vs,{className:"w-4 h-4 group-hover:scale-110 transition-transform"}),l.jsx("span",{className:"text-sm font-medium",children:"Lu Thit Lp"})]}),l.jsxs("button",{onClick:B,className:"group flex items-center gap-2 px-4 py-2 bg-sky-500/20 hover:bg-sky-500/30 rounded-xl border border-sky-400/30 hover:border-sky-400/50 text-sky-100 transition-all duration-300 backdrop-blur-sm",children:[l.jsx($l,{className:"w-4 h-4 group-hover:scale-110 transition-transform"}),l.jsx("span",{className:"text-sm font-medium",children:"Ti Thit Lp"})]}),l.jsxs("button",{onClick:we,className:"group flex items-center gap-2 px-4 py-2 bg-emerald-500/20 hover:bg-emerald-500/30 rounded-xl border border-emerald-400/30 hover:border-emerald-400/50 text-emerald-100 transition-all duration-300 backdrop-blur-sm",children:[l.jsx(Co,{className:"w-4 h-4 group-hover:scale-110 transition-transform"}),l.jsx("span",{className:"text-sm font-medium",children:"Nhp WorldSetup"})]})]})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("h1",{className:"text-4xl lg:text-5xl font-bold bg-gradient-to-r from-purple-200 via-pink-200 to-purple-200 bg-clip-text text-transparent mb-3",children:"Kin To Th Gii"}),l.jsx("p",{className:"text-white/70 text-lg",children:"Xy dng th gii RPG c o ca ring bn"})]})]}),l.jsx("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-2 m-6 mb-0",children:l.jsxs("div",{className:"flex gap-2",children:[l.jsxs("button",{onClick:()=>L("context"),className:`flex-1 px-6 py-3 text-sm font-semibold rounded-xl transition-all duration-300 ${R==="context"?"bg-gradient-to-r from-purple-500/30 to-pink-500/30 text-white border border-purple-400/50 shadow-lg":"text-white/70 hover:text-white hover:bg-white/10"}`,children:[l.jsx(xg,{className:"w-5 h-5 inline mr-2"}),"Bi Cnh Th Gii"]}),l.jsxs("button",{onClick:()=>L("knowledge"),className:`flex-1 px-6 py-3 text-sm font-semibold rounded-xl transition-all duration-300 ${R==="knowledge"?"bg-gradient-to-r from-purple-500/30 to-pink-500/30 text-white border border-purple-400/50 shadow-lg":"text-white/70 hover:text-white hover:bg-white/10"}`,children:[l.jsx(Oi,{className:"w-5 h-5 inline mr-2"}),"Tri Thc"]})]})}),l.jsx("div",{className:"p-6",children:gt()}),l.jsx("div",{className:"mt-8 border-t border-white/10 pt-6",children:l.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[ne&&l.jsx("div",{className:"bg-red-500/10 backdrop-blur-sm border border-red-400/20 rounded-xl p-4 max-w-lg w-full",children:l.jsx("p",{className:"text-red-300 text-sm text-center font-medium",children:ne})}),l.jsx("button",{onClick:Ce,disabled:!p||i,className:"group w-full max-w-lg bg-gradient-to-r from-emerald-500/30 to-teal-500/30 hover:from-emerald-500/40 hover:to-teal-500/40 border border-emerald-400/40 hover:border-emerald-400/60 backdrop-blur-sm text-white font-bold py-4 px-8 rounded-2xl shadow-2xl text-lg transition-all duration-300 disabled:from-slate-500/20 disabled:to-slate-600/20 disabled:border-slate-500/30 disabled:cursor-not-allowed disabled:text-white/50 transform hover:scale-[1.02] hover:shadow-emerald-500/25",children:i?l.jsxs("div",{className:"flex items-center justify-center gap-3",children:[l.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"}),l.jsx("span",{children:"ang khi to th gii..."})]}):p?l.jsxs("div",{className:"flex items-center justify-center gap-3",children:[l.jsx(Oi,{className:"w-6 h-6 group-hover:rotate-12 transition-transform"}),l.jsx("span",{children:"Khi To Th Gii"}),l.jsx(Oi,{className:"w-6 h-6 group-hover:-rotate-12 transition-transform"})]}):l.jsxs("div",{className:"flex items-center justify-center gap-3",children:[l.jsx(y0,{className:"w-6 h-6"}),l.jsx("span",{children:"AI cha sn sng"})]})}),l.jsx("p",{className:"text-white/50 text-sm text-center max-w-lg",children:"Nhn nt trn  bt u cuc phiu lu RPG ca bn vi AI"})]})})]})}),l.jsx(aw,{isOpen:se,onClose:()=>oe(!1),suggestions:de,onSelect:Q=>{N(ve=>({...ve,genre:Q})),oe(!1)},title:"Gi  th loi"})]})},dw="modulepreload",hw=function(t){return"/"+t},bg={},fw=function(e,i,s){let a=Promise.resolve();if(i&&i.length>0){let f=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),g=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));a=f(i.map(m=>{if(m=hw(m),m in bg)return;bg[m]=!0;const y=m.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${v}`))return;const C=document.createElement("link");if(C.rel=y?"stylesheet":dw,y||(C.as="script"),C.crossOrigin="",C.href=m,g&&C.setAttribute("nonce",g),document.head.appendChild(C),y)return new Promise((N,R)=>{C.addEventListener("load",N),C.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${m}`)))})}))}function u(f){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=f,window.dispatchEvent(p),!p.defaultPrevented)throw f}return a.then(f=>{for(const p of f||[])p.status==="rejected"&&u(p.reason);return e().catch(u)})},Mn={INTJ:{title:"Kin trc s",description:"Nh t tng chin lc, c k hoch cho mi th."},INTP:{title:"Nh logic hc",description:"Nh pht minh sng to vi khao kht kin thc."},ENTJ:{title:"Ch huy",description:"Nh lnh o to bo, giu tr tng tng v c  ch mnh m, lun tm ra hoc to ra mt con ng."},ENTP:{title:"Ngi tranh lun",description:"Nh t tng thng minh v t m, khng th cng li mt th thch tr tu."},INFJ:{title:"Ngi ng h",description:"Yn tnh v huyn b, nhng l nhng nh l tng y cm hng v khng mt mi."},INFP:{title:"Ngi ha gii",description:"Nh th, tt bng v v tha, lun mong mun gip  mt mc ch tt p."},ENFJ:{title:"Ngi lnh o",description:"Nh lnh o li cun v truyn cm hng, c kh nng lm say lng ngi nghe."},ENFP:{title:"Nh vn ng",description:"Tinh thn t do nhit tnh, sng to v ha ng, lun c th tm thy l do  mm ci."},ISTJ:{title:"Nh hu cn",description:"C nhn thc t v da trn s tht, c  tin cy khng th nghi ng."},ISFJ:{title:"Ngi bo v",description:"Ngi bo v rt tn tm v nng hu, lun sn sng bo v nhng ngi thn yu ca h."},ESTJ:{title:"Gim c",description:"Nh qun l xut sc, c mt khng hai trong vic qun l mi th hoc con ngi."},ESFJ:{title:"Lnh s",description:"Nhng ngi cc k quan tm, ha ng v c yu mn, lun ho hc gip ."},ISTP:{title:"Nh k thut",description:"Ngi th nghim to bo v thc t, bc thy ca tt c cc loi cng c."},ISFP:{title:"Nh thm him",description:"Ngh s linh hot v quyn r, lun sn sng khm ph v tri nghim nhng iu mi."},ESTP:{title:"Doanh nhn",description:"Nhng ngi thng minh, nng ng v rt tinh , thc s thch sng  bn b vc thm."},ESFP:{title:"Ngi gii tr",description:"Nhng ngi gii tr t pht, nng ng v nhit tnh, cuc sng khng bao gi nhm chn xung quanh h."}},bd=class bd{static buildIntelligentContext(e,i,s=this.DEFAULT_CONFIG){const a=s.includeArchived?[...e.memories,...e.archivedMemories||[]]:e.memories;console.log(` Enhanced RAG: Building context from ${a.length} memories for action: "${i.substring(0,50)}..."`);const f=a.map(N=>({memory:N,relevanceScore:this.calculateRelevanceScore(N,i,e,s)})).filter(({relevanceScore:N})=>N>=s.importanceThreshold).sort((N,R)=>R.relevanceScore-N.relevanceScore).slice(0,s.maxMemories).map(({memory:N})=>N),p=this.ensureMemoryDiversity(f,s),g=this.extractContextualEntities(p,e),m=this.buildRelationshipContext(p,e),y=this.extractRecentEvents(p,e.turnCount),v=this.calculateContextImportance(p),C=this.estimateTokenUsage(p,g,m);return console.log(` Enhanced RAG: Selected ${p.length} memories, ${g.length} entities, importance: ${v.toFixed(1)}, tokens: ${C}`),{relevantMemories:p,contextualEntities:g,relationshipContext:m,recentEvents:y,importance:v,tokenUsage:C}}static calculateRelevanceScore(e,i,s,a){let u=0;const f=e.importance||0;u+=f*.4;const p=this.calculateTextRelevance(e.text,i);u+=p*30;const g=this.calculateRecencyScore(e,s.turnCount);u+=g*a.recencyWeight*100;const m=this.calculateEntityRelevance(e,i,s);if(u+=m*10,e.category){const y=this.getCategoryBonus(e.category,i);u+=y}return e.source==="chronicle"&&(u+=5),Math.min(100,Math.max(0,u))}static calculateTextRelevance(e,i){const s=e.toLowerCase().split(/\s+/),a=i.toLowerCase().split(/\s+/),u=s.filter(v=>a.some(C=>v.includes(C)||C.includes(v))),f=s.length>0?u.length/s.length:0,p=this.extractContextKeywords(i),g=this.extractContextKeywords(e),m=p.filter(v=>g.includes(v)).length,y=Math.min(1,m*.2);return Math.min(100,f*70+y*30)}static calculateRecencyScore(e,i){const s=i-(e.createdAt||i),a=50;return s<=0?1:s>=a?.1:Math.max(.1,1-s/a)}static calculateEntityRelevance(e,i,s){var f,p;if(!((f=e.relatedEntities)!=null&&f.length))return 0;const a=i.toLowerCase();let u=0;for(const g of e.relatedEntities){if(a.includes(g.toLowerCase())){u++;continue}if((p=s.party)!=null&&p.some(y=>y.name===g)){u+=.5;continue}const m=s.knownEntities[g];m&&m.lastInteraction&&s.turnCount-m.lastInteraction<10&&(u+=.3)}return Math.min(10,u*2)}static getCategoryBonus(e,i){const s=i.toLowerCase();return({combat:["tn cng","nh","chin u","git","chm","bn"],social:["ni","hi","thuyt phc","giao dch","mua","bn"],discovery:["khm ph","tm kim","iu tra","quan st"],relationship:["yu","ght","bn","th","tin tng"],story:["nhim v","quest","mc tiu","hon thnh"]}[e]||[]).filter(p=>s.includes(p)).length*3}static extractContextKeywords(e){const i=[],s=e.toLowerCase(),a=["tn cng","nh","chin u","khm ph","ni chuyn","mua","bn","hc","s dng","i n","ri khi"],u=["kim","khin","o gip","thuc","ma php","k nng","vng","bc","ng","rng","ca","cha kha"],f=["thnh ph","lng","rng","ni","bin","hang ng","lu i","n","ch","tavern","khch sn"];return[...a,...u,...f].forEach(p=>{s.includes(p)&&i.push(p)}),i}static ensureMemoryDiversity(e,i){if(e.length<=3)return e;const s=[],a=new Set,u=new Set;for(const f of e){if(s.length>=i.maxMemories)break;const p=f.category||"general";if(!a.has(p)||a.size<3){s.push(f),a.add(p);const g=f.text.split(" ").slice(0,3).join(" ").toLowerCase();u.add(g)}}for(const f of e){if(s.length>=i.maxMemories)break;if(s.includes(f))continue;const p=f.text.split(" ").slice(0,3).join(" ").toLowerCase();u.has(p)||(s.push(f),u.add(p))}return s}static extractContextualEntities(e,i){const s=new Set;e.forEach(u=>{var f;(f=u.relatedEntities)==null||f.forEach(p=>s.add(p))});const a=[];return s.forEach(u=>{const f=i.knownEntities[u];f&&a.push(f)}),a.sort((u,f)=>{var v,C;const p=(v=i.party)==null?void 0:v.some(N=>N.name===u.name),g=(C=i.party)==null?void 0:C.some(N=>N.name===f.name);if(p&&!g)return-1;if(!p&&g)return 1;const m=u.lastInteraction||0;return(f.lastInteraction||0)-m})}static buildRelationshipContext(e,i){var a;const s=[];return(a=i.party)==null||a.forEach(u=>{u.relationship&&s.push(`${u.name}: ${u.relationship}`)}),e.forEach(u=>{if(u.category==="relationship"||u.text.includes("quan h")){const f=this.extractRelationshipInfo(u.text);f&&s.push(f)}}),[...new Set(s)]}static extractRelationshipInfo(e){const i=[/quan h vi ([^:]+): ([^.!?]+)/i,/([^,]+) l ([^.!?]+) ca/i,/tin tng ([^.!?]+)/i,/th ch vi ([^.!?]+)/i];for(const s of i){const a=e.match(s);if(a)return a[0].trim()}return null}static extractRecentEvents(e,i){const s=[];return e.filter(u=>i-(u.createdAt||i)<=5).sort((u,f)=>(f.createdAt||0)-(u.createdAt||0)).forEach(u=>{const f=this.extractKeyEvents(u.text);s.push(...f)}),s.slice(0,5)}static extractKeyEvents(e){const i=[];return[/hon thnh ([^.!?]+)/gi,/nh bi ([^.!?]+)/gi,/khm ph ([^.!?]+)/gi,/gp ([^.!?]+)/gi,/nhn c ([^.!?]+)/gi].forEach(a=>{const u=e.match(a);u&&i.push(...u.map(f=>f.trim()))}),i}static calculateContextImportance(e){return e.length===0?0:e.reduce((s,a)=>s+(a.importance||0),0)/e.length}static estimateTokenUsage(e,i,s){let a=0;return a+=e.reduce((u,f)=>u+Math.ceil(f.text.length*.8),0),a+=i.reduce((u,f)=>{var p;return u+Math.ceil((((p=f.description)==null?void 0:p.length)||0)*.8)},0),a+=s.reduce((u,f)=>u+Math.ceil(f.length*.8),0),a}static formatContextForPrompt(e){let i="";return e.relevantMemories.length>0&&(i+=`--- RELEVANT MEMORIES ---
`,e.relevantMemories.forEach((s,a)=>{var u;i+=`${a+1}. [${((u=s.category)==null?void 0:u.toUpperCase())||"GENERAL"}] ${s.text}
`}),i+=`
`),e.relationshipContext.length>0&&(i+=`--- RELATIONSHIPS ---
`,e.relationshipContext.forEach(s=>{i+=` ${s}
`}),i+=`
`),e.recentEvents.length>0&&(i+=`--- RECENT EVENTS ---
`,e.recentEvents.forEach(s=>{i+=` ${s}
`}),i+=`
`),i}};bd.DEFAULT_CONFIG={maxMemories:10,maxTokens:2e3,importanceThreshold:30,recencyWeight:.3,relevanceWeight:.5,diversityWeight:.2,includeArchived:!1};let wr=bd;const Vl=class Vl{static buildCompactContext(e,i,s={maxMemories:8,maxTokens:800,importanceThreshold:35,recencyWeight:.3,relevanceWeight:.5,diversityWeight:.2,includeArchived:!1}){const a=performance.now();this.updateRegistry(e);const u=wr.buildIntelligentContext(e,i,s),f=this.createEntityReferences(u.contextualEntities,i),p=this.createMemoryReferences(u.relevantMemories),g=this.createRelationshipKeys(u.relationshipContext),m=this.createEventSummaries(u.recentEvents),y=u.tokenUsage,v=this.estimateCompactTokens(f,p,g,m),C=performance.now();return console.log(` Reference-based RAG: Built compact context in ${(C-a).toFixed(2)}ms`),console.log(` Token savings: ${y}  ${v} (${((y-v)/y*100).toFixed(1)}% reduction)`),{entityReferences:f,memoryReferences:p,relationshipKeys:g,recentEventSummaries:m,externalRegistry:this.registry,tokensSaved:y-v,originalTokens:y}}static updateRegistry(e){var i,s;if(!e){console.warn(" ReferenceBasedRAG: gameState is null/undefined");return}for(const[a,u]of Object.entries(e.knownEntities||{}))u.referenceId||(u.referenceId=this.generateLegacyReferenceId(u),console.log(` Generated legacy reference ID for ${u.name} (${u.type}): ${u.referenceId}`)),this.registry.entities.set(u.referenceId,u);(i=e.memories)==null||i.forEach((a,u)=>{const f=`MEM_${Date.now()}_${u}`;this.registry.memories.set(f,a)}),(s=e.party)==null||s.forEach(a=>{if(a.relationship){const u=`REL_${a.name}_PC`;this.registry.relationships.set(u,a.relationship)}}),this.registry.lastUpdate=Date.now()}static generateLegacyReferenceId(e){const i=`${e.type}_${e.name}_${Date.now()}`;let s=0;for(let f=0;f<i.length;f++){const p=i.charCodeAt(f);s=(s<<5)-s+p,s=s&s}const a=Math.abs(s).toString(16).padStart(8,"0");return`REF_${e.type.substring(0,2).toUpperCase()}_LEG_${a}`}static createEntityReferences(e,i){return e.map(s=>{const a=this.createEntitySummary(s),u=this.calculateEntityRelevance(s,i);return{referenceId:s.referenceId||this.generateLegacyReferenceId(s),name:s.name,type:s.type,summary:a,relevanceScore:u,lastAccessed:Date.now()}}).sort((s,a)=>a.relevanceScore-s.relevanceScore)}static createEntitySummary(e){const i=[];if(e.type==="pc"?i.push("Nhn vt chnh"):e.type==="companion"?i.push("ng hnh"):e.type==="npc"&&i.push("NPC"),e.realm&&i.push(`Cnh gii: ${e.realm}`),e.relationship&&i.push(`Quan h: ${e.relationship}`),e.location&&i.push(`Ti: ${e.location}`),e.description){const a=e.description.length>60?e.description.substring(0,57)+"...":e.description;i.push(a)}const s=i.join(" | ");return s.length>this.SUMMARY_MAX_CHARS?s.substring(0,this.SUMMARY_MAX_CHARS-3)+"...":s}static calculateEntityRelevance(e,i){let s=0;if(e.type==="companion"?s+=40:e.type==="pc"?s+=50:e.type==="npc"?s+=20:s+=10,i.toLowerCase().includes(e.name.toLowerCase())&&(s+=30),e.lastInteraction){const a=Date.now()-e.lastInteraction;a<3e5?s+=20:a<36e5&&(s+=10)}return Math.min(100,s)}static createMemoryReferences(e){return e.map((i,s)=>{const a=i.text.length>80?i.text.substring(0,77)+"...":i.text,u=i.category?`[${i.category.toUpperCase()}]`:"[GENERAL]",f=i.importance?`(${i.importance})`:"";return`${u}${f} ${a}`})}static createRelationshipKeys(e){return e.map(i=>{const s=i.split(":");if(s.length>=2){const a=s[0].trim(),u=s[1].trim().substring(0,30);return`${a}: ${u}`}return i.length>50?i.substring(0,47)+"...":i})}static createEventSummaries(e){return e.map(i=>i.length>60?i.substring(0,57)+"...":i)}static estimateCompactTokens(e,i,s,a){let u=0;return u+=e.reduce((f,p)=>f+Math.ceil((p.name.length+p.summary.length+20)*.8),0),u+=i.reduce((f,p)=>f+Math.ceil(p.length*.8),0),u+=s.reduce((f,p)=>f+Math.ceil(p.length*.8),0),u+=a.reduce((f,p)=>f+Math.ceil(p.length*.8),0),u+=100,u}static formatCompactContextForPrompt(e){let i="";return e.entityReferences.length>0&&(i+=`--- ENTITY REFERENCES ---
`,e.entityReferences.forEach(s=>{i+=` ${s.name} [${s.referenceId}]: ${s.summary}
`}),i+=`
`),e.memoryReferences.length>0&&(i+=`--- MEMORY HIGHLIGHTS ---
`,e.memoryReferences.forEach((s,a)=>{i+=`${a+1}. ${s}
`}),i+=`
`),e.relationshipKeys.length>0&&(i+=`--- RELATIONSHIP STATUS ---
`,e.relationshipKeys.forEach(s=>{i+=` ${s}
`}),i+=`
`),e.recentEventSummaries.length>0&&(i+=`--- RECENT EVENTS ---
`,e.recentEventSummaries.forEach(s=>{i+=` ${s}
`}),i+=`
`),i+=`--- REFERENCE SYSTEM ---
`,i+=`Entities are referenced by ID (e.g., REF_NP_CHA_12345678). Use these IDs when referencing entities.
`,i+=`For detailed entity information, use the reference ID to look up full details.

`,i}static getEntityByReference(e){return this.registry.entities.get(e)||null}static getMemoryByReference(e){return this.registry.memories.get(e)||null}static getRegistrySnapshot(){return{entitiesCount:this.registry.entities.size,memoriesCount:this.registry.memories.size,relationshipsCount:this.registry.relationships.size,lastUpdate:this.registry.lastUpdate}}static clearRegistry(){this.registry.entities.clear(),this.registry.memories.clear(),this.registry.relationships.clear(),this.registry.lastUpdate=0}static findEntitiesByKeyword(e,i=5){var u;const s=[],a=e.toLowerCase();for(const[f,p]of this.registry.entities)(p.name.toLowerCase().includes(a)||(u=p.description)!=null&&u.toLowerCase().includes(a)||p.type.toLowerCase().includes(a))&&s.push({referenceId:f,name:p.name,type:p.type,summary:this.createEntitySummary(p),relevanceScore:this.calculateKeywordRelevance(p,e),lastAccessed:Date.now()});return s.sort((f,p)=>p.relevanceScore-f.relevanceScore).slice(0,i)}static calculateKeywordRelevance(e,i){var u;const s=i.toLowerCase();let a=0;return e.name.toLowerCase()===s?a+=50:e.name.toLowerCase().includes(s)&&(a+=30),e.type.toLowerCase().includes(s)&&(a+=20),(u=e.description)!=null&&u.toLowerCase().includes(s)&&(a+=15),a}};Vl.registry={entities:new Map,memories:new Map,relationships:new Map,lastUpdate:0},Vl.SUMMARY_MAX_CHARS=120,Vl.REFERENCE_ID_PATTERN=/REF_[A-Z]{2}_[A-Z]{3}_[A-F0-9]{8}/g;let Ol=Vl;class mw{constructor(){this.activationHistory=new Map}estimateTokens(e){return e?Math.ceil(e.length/4):0}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}checkKeywordMatch(e,i,s=!1,a=!1){if(!i||i.length===0)return{matches:!1,matchedKeywords:[]};const u=s?e:e.toLowerCase(),f=[];for(const p of i){if(!p.trim())continue;const g=s?p:p.toLowerCase();a?new RegExp(`\\b${this.escapeRegex(g)}\\b`,s?"g":"gi").test(u)&&f.push(p):u.includes(g)&&f.push(p)}return{matches:f.length>0,matchedKeywords:f}}evaluateRuleLogic(e,i,s,a){var m,y,v,C;const u=e.logic||Ft.AND_ANY,f=e.keywords&&e.keywords.length>0,p=e.secondaryKeywords&&e.secondaryKeywords.length>0;if(e.alwaysActive)return{activated:!0,reason:"Always active (constant rule)",matchedKeywords:[]};if(!f&&!p)return{activated:!1,reason:"No keywords defined - rule requires keywords to activate or alwaysActive flag",matchedKeywords:[]};const g=[...i,...s];switch(u){case Ft.AND_ANY:if(i.length>0||s.length>0)return{activated:!0,reason:`AND_ANY: Matched ${g.length} keywords`,matchedKeywords:g};break;case Ft.AND_ALL:const N=((m=e.keywords)==null?void 0:m.length)||0,R=((y=e.secondaryKeywords)==null?void 0:y.length)||0;if(i.length===N&&s.length===R)return{activated:!0,reason:`AND_ALL: All ${N+R} keywords matched`,matchedKeywords:g};break;case Ft.NOT_ALL:const L=(((v=e.keywords)==null?void 0:v.length)||0)+(((C=e.secondaryKeywords)==null?void 0:C.length)||0);if(g.length<L&&g.length>0)return{activated:!0,reason:`NOT_ALL: ${g.length}/${L} keywords matched`,matchedKeywords:g};break;case Ft.NOT_ANY:if(g.length===0)return{activated:!0,reason:"NOT_ANY: No keywords found",matchedKeywords:[]};break}return{activated:!1,reason:`Logic ${Ft[u]} not satisfied`,matchedKeywords:g}}checkProbability(e){return e.probability===void 0||e.probability>=100?!0:e.probability<=0?!1:Math.random()*100<e.probability}checkActivationLimits(e,i){return!e.maxActivationsPerTurn||e.maxActivationsPerTurn<=0?!0:(this.activationHistory.get(e.id)||[]).filter(u=>u===i).length<e.maxActivationsPerTurn}collectScanText(e,i){let s="";const a=e.scanDepth||i.scanDepth||5;if(e.scanPlayerInput!==!1&&i.playerInput&&(s+=i.playerInput+" "),e.scanAIOutput!==!1&&i.aiResponse&&(s+=i.aiResponse+" "),i.gameHistory&&i.gameHistory.length>0){const u=i.gameHistory.slice(-a);for(const f of u)(f.type==="user_action"&&e.scanPlayerInput!==!1||f.type==="ai_response"&&e.scanAIOutput!==!1)&&(s+=f.content+" ")}if(e.scanMemories!==!1&&i.memories){const u=i.memories.filter(f=>!f.pinned||f.importance&&f.importance>70).slice(-a);for(const f of u)s+=f.text+" "}return s.trim()}processRules(e,i){console.log(` Processing ${e.length} rules with context`);const s=[],a=[];let u=0;const f=i.tokenBudget||5e3,p=i.currentTurn||0,g=e.filter(m=>m.isActive).sort((m,y)=>(y.order||0)-(m.order||0));console.log(` ${g.length} active rules to process`);for(const m of g)try{if(!this.checkActivationLimits(m,p)){console.log(` Rule "${m.title||m.id}" skipped: activation limit reached`),a.push(m);continue}if(!this.checkProbability(m)){console.log(` Rule "${m.title||m.id}" skipped: probability check failed`),a.push(m);continue}const y=this.collectScanText(m,i);if(!y){console.log(` Rule "${m.title||m.id}" skipped: no text to scan`);continue}const v=this.checkKeywordMatch(y,m.keywords||[],m.caseSensitive||i.caseSensitive,m.matchWholeWords||i.matchWholeWords),C=this.checkKeywordMatch(y,m.secondaryKeywords||[],m.caseSensitive||i.caseSensitive,m.matchWholeWords||i.matchWholeWords),N=this.evaluateRuleLogic(m,v.matchedKeywords,C.matchedKeywords,y);if(!N.activated){console.log(` Rule "${m.title||m.id}" skipped: ${N.reason}`);continue}const R=m.tokenWeight||this.estimateTokens(m.content);if(u+R>f){console.log(` Rule "${m.title||m.id}" skipped: would exceed token budget`),a.push(m);continue}const L={rule:m,activationReason:N.reason,matchedKeywords:N.matchedKeywords,tokenCost:R,priority:m.order||0};s.push(L),u+=R;const O=this.activationHistory.get(m.id)||[];O.push(p),this.activationHistory.set(m.id,O),m.lastActivated=p,m.activationCount=(m.activationCount||0)+1,console.log(` Rule "${m.title||m.id}" activated: ${N.reason}`)}catch(y){console.error(` Error processing rule "${m.title||m.id}":`,y),a.push(m)}return s.sort((m,y)=>y.priority-m.priority),console.log(` Activation complete: ${s.length} rules activated, ${u} tokens used`),{activatedRules:s,totalTokens:u,budgetExceeded:u>f,skippedRules:a}}formatForPrompt(e){if(e.activatedRules.length===0)return"";let i=`
=== LUT L TY CHNH C KCH HOT ===
`;for(const s of e.activatedRules){const a=s.rule,u=a.title||`Lut ${a.id}`;i+=`
[${u}] ( u tin: ${a.order||0})`,s.matchedKeywords.length>0&&(i+=` - Khp t kha: ${s.matchedKeywords.join(", ")}`),i+=`
${a.content}
`}return i+=`
=== Tng cng: ${e.activatedRules.length} lut, ${e.totalTokens} tokens ===
`,i}clearHistory(){this.activationHistory.clear()}getStats(){const e=Array.from(this.activationHistory.keys()).length,i=Array.from(this.activationHistory.values()).reduce((s,a)=>s+a.length,0);return{totalRules:this.activationHistory.size,activeRules:e,averageActivations:e>0?i/e:0}}}const Cg=new mw,gn={MAX_TOKENS_PER_TURN:9e4,TOKEN_BUFFER:1e4,CHARS_PER_TOKEN:1.2,ALLOCATION:{CRITICAL:.5,IMPORTANT:.25,CONTEXTUAL:.15,SUPPLEMENTAL:.1},USE_REFERENCE_RAG:!0,REFERENCE_RAG_TOKEN_LIMIT:600};class pw{constructor(){this.semanticCache=new Map,this.entityGraph=new Map,this.initializeSystem()}initializeSystem(){}buildEnhancedPrompt(e,i,s="",a=""){const u=performance.now();if(!i)return console.error(" buildEnhancedPrompt: gameState is null/undefined, using fallback"),`Hnh ng: ${e}
Trng thi: Li h thng, khng th x l gameState.`;try{this.currentGameState=i;let f,p=null;gn.USE_REFERENCE_RAG&&(p=Ol.buildCompactContext(i,e,{maxMemories:6,maxTokens:gn.REFERENCE_RAG_TOKEN_LIMIT,importanceThreshold:35,recencyWeight:.3,relevanceWeight:.5,diversityWeight:.2,includeArchived:!1}),f=null);const g=this.analyzeActionIntent(e);this.buildEntityGraph(i.knownEntities);const m=p?p.entityReferences.map(L=>({entity:Ol.getEntityByReference(L.referenceId)||L,score:L.relevanceScore,reason:[`Reference: ${L.referenceId}`]})).filter(L=>L.entity):this.retrieveRelevantEntities(e,g,i,f),y=p?p.originalTokens-p.tokensSaved:(f==null?void 0:f.tokenUsage)||0,v=this.calculateDynamicTokenBudget(m,i,y),C=this.buildPrioritizedContext(m,i,v,e),N=this.assembleFinalPrompt(e,C,s,a,i.worldData,f,p,i),R=performance.now();return console.log(`RAG processing time: ${(R-u).toFixed(2)}ms`),this.enforceTokenLimit(N)}catch(f){return console.error("Enhanced RAG Error:",f),this.buildFallbackPrompt(e,i)}}analyzeActionIntent(e){const i=e.toLowerCase(),s={type:"general",targets:[],keywords:[],isMovement:!1,isCombat:!1,isSocial:!1,isItemUse:!1,isSkillUse:!1,isExploration:!1};return/i|chy|leo|nhy|bay|di chuyn|ti|n|ri|v/.test(i)&&(s.isMovement=!0,s.type="movement"),/tn cng|nh|chm|m|bn|nm|chin u|git/.test(i)&&(s.isCombat=!0,s.type="combat"),/ni|hi|tr li|thuyt phc|da|giao dch|mua|bn/.test(i)&&(s.isSocial=!0,s.type="social"),/s dng|dng|ung|n|trang b|tho|cho|ly/.test(i)&&(s.isItemUse=!0,s.type="item_interaction"),/thi trin|s dng.*php|cng php|k nng/.test(i)&&(s.isSkillUse=!0,s.type="skill_use"),s.targets=this.extractPotentialTargets(e),s.keywords=this.extractKeywords(e),s}buildEntityGraph(e){if(this.entityGraph.clear(),!(!e||typeof e!="object"))for(const[i,s]of Object.entries(e)){const a=new Set;s.owner&&a.add(s.owner),s.location&&a.add(s.location);const u=(s.description||"").toLowerCase();for(const[f,p]of Object.entries(e))i!==f&&u.includes(f.toLowerCase())&&a.add(f);s.skills&&Array.isArray(s.skills)&&s.skills.forEach(f=>a.add(f)),this.entityGraph.set(i,a)}}retrieveRelevantEntities(e,i,s,a){const{knownEntities:u,party:f,gameHistory:p,statuses:g}=s,m=[];Array.isArray(f)&&f.forEach(y=>{m.push({entity:y,score:100,reason:["Party member"]})});for(const[y,v]of Object.entries(u)){if(Array.isArray(f)&&f.some(P=>P.name===y))continue;let C=0;const N=[];e.toLowerCase().includes(y.toLowerCase())&&(C+=50,N.push("Directly mentioned"));const R=this.countRecentMentions(y,p,3);R>0&&(C+=Math.min(30,R*10),N.push(`Recent mentions: ${R}`));const L=f.find(P=>P.type==="pc");if(L!=null&&L.location&&v.location===L.location&&(C+=20,N.push("Same location as PC")),C+=this.getTypeRelevanceScore(v.type,i),v.type==="companion"&&v.skills){const P=Array.isArray(v.skills)?v.skills:v.skills.split(",").map(ne=>ne.trim()),$=this.getCompanionSkillRelevance(P,e,i);C+=$,$>0&&N.push(`Relevant skills: ${P.slice(0,2).join(", ")}`)}const O=this.entityGraph.get(y)||new Set;Array.from(O).some(P=>m.some($=>$.score>50&&$.entity.name===P))&&(C+=15,N.push("Connected to relevant entity")),g.some(P=>P.owner===y)&&(C+=10,N.push("Has active status")),C>0&&m.push({entity:v,score:C,reason:N})}return m.sort((y,v)=>v.score-y.score).filter(y=>y.score>=10)}calculateDynamicTokenBudget(e,i,s=0){var m;const a=gn.MAX_TOKENS_PER_TURN-gn.TOKEN_BUFFER,u=((m=i.quests)==null?void 0:m.some(y=>y.status==="active"))||!1;i.gameHistory.length>20;const f=e.filter(y=>y.score>70).length>5;let p=gn.ALLOCATION.CRITICAL,g=gn.ALLOCATION.IMPORTANT;return f&&(p+=.1,g-=.05),u||(g-=.05,p+=.05),{critical:Math.floor(a*p),important:Math.floor(a*g),contextual:Math.floor(a*gn.ALLOCATION.CONTEXTUAL),supplemental:Math.floor(a*gn.ALLOCATION.SUPPLEMENTAL)}}buildPrioritizedContext(e,i,s,a){const u={critical:"",important:"",contextual:"",supplemental:""};return u.critical=this.buildCriticalContext(e.filter(f=>f.score>=70),i,s.critical),u.important=this.buildImportantContext(e.filter(f=>f.score>=30&&f.score<70),i,s.important),u.contextual=this.buildContextualInfo(i,s.contextual),u.supplemental=this.buildSupplementalContext(i,e,s.supplemental,a),u}buildCriticalContext(e,i,s){let a=`=== TRI THC QUAN TRNG ===
`,u=this.estimateTokens(a);const f=this.formatGameTime(i.gameTime,i.turnCount);a+=f+`

`,u+=this.estimateTokens(f);const p=this.buildEnhancedPartyContext(i,Math.floor(s*.4));p&&(a+=p+`
`,u+=this.estimateTokens(p));const g=s-u,m=e.filter(v=>v.entity.type!=="companion"),y=Math.floor(g/Math.max(1,m.length));return m.forEach(({entity:v,score:C,reason:N})=>{const R=this.formatEntityWithContext(v,i.statuses,N,y,i),L=this.estimateTokens(R);u+L<=s&&(a+=R+`
`,u+=L)}),a}buildEnhancedPartyContext(e,i){const{party:s,statuses:a}=e;if(!s||s.length===0)return"";let u=`**T I PHIU LU:**
`,f=this.estimateTokens(u);e.turnCount&&fw(async()=>{const{partyDebugger:m}=await Promise.resolve().then(()=>Tw);return{partyDebugger:m}},void 0).then(({partyDebugger:m})=>{m.logAIContextBuild({companions:s.filter(y=>y.type==="companion"),contextLength:u.length,includesPersonalities:s.some(y=>y.personality),includesSkills:s.some(y=>y.skills),includesRelationships:s.some(y=>y.relationship)},f,e.turnCount)});const p=s.find(m=>m.type==="pc");if(p){const m=a.filter(N=>N.owner==="pc"||N.owner===p.name);let y=`[Nhn vt chnh] ${p.name}`;const v=[];if(p.motivation&&v.push(`**MC TIU**: ${p.motivation}`),p.location&&v.push(`V tr: ${p.location}`),p.realm&&v.push(`Thc lc: ${p.realm}`),p.learnedSkills&&p.learnedSkills.length>0){const N=p.learnedSkills.map(R=>{const L=Object.values(e.knownEntities).find(O=>O.name===R&&O.type==="skill");return L&&L.mastery?`${R} (${L.mastery})`:R});v.push(`K nng: ${N.join(", ")}`)}m.length>0&&v.push(`Trng thi: ${m.map(N=>N.name).join(", ")}`),v.length>0&&(y+=` - ${v.join(", ")}`),y+=`
`;const C=this.estimateTokens(y);f+C<=i&&(u+=y,f+=C)}const g=s.filter(m=>m.type==="companion");if(g.length>0){g.forEach(v=>{let C=`[ng hnh] ${v.name}`;const N=[];if(v.relationship&&N.push(`Quan h: ${v.relationship}`),v.realm&&N.push(`Cnh gii: ${v.realm}`),v.skills&&v.skills.length>0){const O=Array.isArray(v.skills)?v.skills:v.skills.split(",").map(J=>J.trim());N.push(`Chuyn mn: ${O.slice(0,2).join(", ")}`)}const R=a.filter(O=>O.owner===v.name);if(R.length>0&&N.push(`Trng thi: ${R.map(O=>O.name).join(", ")}`),v.personality){const O=v.personality.length>50?v.personality.substring(0,50)+"...":v.personality;N.push(`Tnh cch: ${O}`)}N.length>0&&(C+=` - ${N.join(", ")}`),C+=`
`;const L=this.estimateTokens(C);f+L<=i&&(u+=C,f+=L)});const m=`
*Lu : Hy ch trng n s tng tc v phi hp gia cc thnh vin trong t i. Mi ng hnh c c tnh v k nng ring, hy th hin iu ny trong cu chuyn.*
`,y=this.estimateTokens(m);f+y<=i&&(u+=m)}return u}buildImportantContext(e,i,s){let a=`
=== THNG TIN LIN QUAN ===
`,u=this.estimateTokens(a);const f=this.buildQuestContext((i.quests||[]).filter(y=>y.status==="active"),Math.floor(s*.3));a+=f,u+=this.estimateTokens(f);const p=this.buildSmartHistoryContext(i.gameHistory,Math.floor(s*.4));a+=p,u+=this.estimateTokens(p);const g=s-u,m=Math.floor(g/Math.max(1,e.length));return e.forEach(({entity:y,reason:v})=>{const C=this.formatEntityBrief(y,v,m),N=this.estimateTokens(C);u+N<=s&&(a+=C+`
`,u+=N)}),a}estimateTokens(e){return Math.ceil(e.length*gn.CHARS_PER_TOKEN)}countRecentMentions(e,i,s){const a=i.slice(-s*2);let u=0;return a.forEach(f=>{const p=f.parts[0].text.toLowerCase(),g=new RegExp(`\\b${e.toLowerCase()}\\b`,"g"),m=p.match(g);u+=m?m.length:0}),u}getTypeRelevanceScore(e,i){var a;return((a={combat:{npc:20,item:15,skill:25,companion:35},social:{npc:30,companion:40,faction:20},item_interaction:{item:30,skill:10,companion:15},movement:{location:30,npc:10,companion:25},skill_use:{skill:40,item:10,companion:30},general:{npc:10,item:10,location:10,companion:20}}[i.type])==null?void 0:a[e])||0}getCompanionSkillRelevance(e,i,s){let a=0;const u=i.toLowerCase(),f=["chin u","tn cng","phng th","kim thut","v thut","magic","php thut"];s.isCombat&&e.some(m=>f.some(y=>m.toLowerCase().includes(y)))&&(a+=25);const p=["thuyt phc","giao tip","m phn","lnh o","charm"];s.isSocial&&e.some(m=>p.some(y=>m.toLowerCase().includes(y)))&&(a+=20);for(const m of e)if(u.includes(m.toLowerCase())){a+=30;break}const g=["do thm","stealth","survival","navigation","tracking"];return s.isMovement&&e.some(m=>g.some(y=>m.toLowerCase().includes(y)))&&(a+=15),a}extractPotentialTargets(e){const i=[],s=e.match(/"([^"]+)"/g);return s&&i.push(...s.map(u=>u.replace(/"/g,""))),e.split(/\s+/).forEach(u=>{u.length>2&&/^[A-Z]/.test(u)&&i.push(u)}),[...new Set(i)]}extractKeywords(e){const i=new Set(["v","ca","l","trong","vi","","n","t"]),s=e.toLowerCase().split(/\s+/).filter(a=>a.length>2&&!i.has(a));return[...new Set(s)]}formatGameTime(e,i){return`Thi gian: Nm ${e.year} Thng ${e.month} Ngy ${e.day}, ${e.hour} gi (Lt ${i})`}aggressiveTruncation(e,i){if(this.estimateTokens(e)<=i)return e;const a=Math.floor(i/gn.CHARS_PER_TOKEN*.9);if(e.length<=a)return e;const u=Math.floor(a*.6),f=Math.floor(a*.3);return u+f<e.length?e.substring(0,u)+`
...[ni dung  c rt gn]...
`+e.substring(e.length-f):e.substring(0,a)+"..."}buildSmartChoiceContext(e,i,s){if(!this.currentGameState)return null;const a=this.currentGameState;let u=`
--- HNG DN TO LA CHN THNG MINH ---
`;const f=this.buildChoiceHistoryContext(a);f&&(u+=f+`
`);const p=this.buildSituationalChoiceContext(a,e);p&&(u+=p+`
`);const g=this.buildPartyChoiceContext(a);g&&(u+=g+`
`);const m=this.buildGoalOrientedChoiceContext(a);return m&&(u+=m+`
`),u+="**QUAN TRNG**: La chn phi ph hp vi tnh hung hin ti, khng lp li nhng g  chn gn y, v to c hi pht trin cu chuyn theo hng th v.",u}buildChoiceHistoryContext(e){const i=e.choiceHistory||[];if(i.length===0)return null;const s=i.filter(u=>e.turnCount-u.turn<=3).flatMap(u=>u.choices).slice(-10);if(s.length===0)return null;let a=`**Trnh lp li cc la chn gn y:**
`;return s.forEach((u,f)=>{a+=` ${u}
`}),a}buildSituationalChoiceContext(e,i){var g,m;const s=(g=e.party)==null?void 0:g.find(y=>y.type==="pc");if(!s)return null;let a=`**To la chn ph hp vi tnh hung:**
`,u=[];s.location&&e.knownEntities[s.location]&&u.push(`Khai thc c im ca a im "${s.location}"`);const f=((m=e.quests)==null?void 0:m.filter(y=>y.status==="active"))||[];if(f.length>0&&u.push(`To la chn tin trin nhim v: "${f[0].title}"`),s.learnedSkills&&s.learnedSkills.length>0){const y=s.learnedSkills.map(v=>{const C=Object.values(e.knownEntities).find(N=>N.name===v&&N.type==="skill");return C&&C.mastery?`${v} (${C.mastery})`:v});u.push(`Cho php s dng k nng: ${y.slice(0,2).join(", ")}`)}const p=Object.values(e.knownEntities).filter(y=>y.type==="npc"&&y.location===s.location).slice(0,2);return p.length>0&&u.push(`Tng tc vi: ${p.map(y=>y.name).join(", ")}`),u.length>0?(a+=u.map(y=>` ${y}`).join(`
`)+`
`,a):null}buildPartyChoiceContext(e){var u;const i=((u=e.party)==null?void 0:u.filter(f=>f.type==="companion"))||[];if(i.length===0)return null;let s=`**To la chn tng tc vi ng hnh:**
`,a=[];return i.forEach(f=>{if(f.skills&&f.skills.length>0){const p=Array.isArray(f.skills)?f.skills:f.skills.split(",").map(g=>g.trim());a.push(`Nh ${f.name} s dng chuyn mn: ${p[0]}`)}f.relationship&&a.push(`Trao i vi ${f.name} da trn mi quan h: ${f.relationship}`)}),a.length>0?(s+=a.slice(0,2).map(f=>` ${f}`).join(`
`)+`
`,s):null}buildGoalOrientedChoiceContext(e){var s;const i=(s=e.party)==null?void 0:s.find(a=>a.type==="pc");return!i||!i.motivation?null:`**To la chn hng ti mc tiu nhn vt:**
 t nht 1-2 la chn phi lin quan n vic thc hin mc tiu: "${i.motivation}"
 To c hi tin gn hn n mc tiu hoc gii quyt tr ngi cn tr mc tiu
`}formatEntityWithContext(e,i,s,a,u){var m,y;let f=` ${e.name} (${e.type})`;const p=[];if(e.type==="companion"){if(f+=" [NG HNH]",e.personality&&p.push(`Tnh cch: ${e.personality}`),e.personalityMbti&&Mn[e.personalityMbti]&&p.push(`MBTI: ${e.personalityMbti} (${Mn[e.personalityMbti].title})`),e.motivation&&p.push(`ng c: ${e.motivation}`),e.relationship&&p.push(`Quan h vi PC: ${e.relationship}`),(m=e.skills)!=null&&m.length){const v=Array.isArray(e.skills)?e.skills:e.skills.split(",").map(C=>C.trim());p.push(`K nng: ${v.slice(0,4).join(", ")}`)}e.realm&&p.push(`Cnh gii: ${e.realm}`)}else if(e.type==="pc"){if(f+=" [NHN VT CHNH]",e.motivation&&p.push(`**MC TIU QUAN TRNG**: ${e.motivation}`),e.learnedSkills&&e.learnedSkills.length>0){const v=e.learnedSkills.map(C=>{const N=Object.values(u.knownEntities).find(R=>R.name===C&&R.type==="skill");return N&&N.mastery?`${C} (${N.mastery})`:C});p.push(`K nng: ${v.join(", ")}`)}e.personality&&p.push(`Tnh cch: ${e.personality}`),e.personalityMbti&&p.push(`MBTI: ${e.personalityMbti}`)}else if(e.type==="npc")if(e.personality&&p.push(`Tnh cch: ${e.personality}`),e.personalityMbti&&p.push(`MBTI: ${e.personalityMbti}`),e.motivation&&p.push(`ng c: ${e.motivation}`),(y=e.skills)!=null&&y.length){const C=`K nng: ${(Array.isArray(e.skills)?e.skills:e.skills.split(",").map(N=>N.trim())).slice(0,3).join(", ")}`;p.push(C),console.log(` Prompt Builder - NPC "${e.name}" skills in prompt:`,C)}else console.log(` Prompt Builder - NPC "${e.name}" has no skills (entity.skills:`,e.skills,")");e.location&&p.push(`V tr: ${e.location}`),e.realm&&e.type!=="companion"&&p.push(`Cnh gii: ${e.realm}`);const g=i.filter(v=>v.owner===e.name);if(g.length>0&&(e.type==="companion"?p.push(`Trng thi: ${g.map(v=>`${v.name} (${v.type})`).slice(0,3).join(", ")}`):p.push(`Trng thi: ${g.map(v=>v.name).slice(0,2).join(", ")}`)),e.description){const v=Math.max(0,a-this.estimateTokens(f+p.join("; "))),C=e.type==="companion"?50:30;if(v>C){const N=this.aggressiveTruncation(e.description,v);p.push(`M t: ${N}`)}}return f+`
  `+p.join(`
  `)}formatEntityBrief(e,i,s){const a=` ${e.name} (${e.type})`,u=i.length>0?` [${i[0]}]`:"",f=e.description?` - ${e.description}`:"",p=a+u+f;return this.aggressiveTruncation(p,s)}buildQuestContext(e,i){if(e.length===0)return"";let s=`**Nhim v ang hot ng:**
`,a=this.estimateTokens(s);return e.forEach(u=>{const f=u.objectives.filter(m=>!m.completed),p=`- ${u.title}: ${f.map(m=>m.description).join(", ")}
`,g=this.estimateTokens(p);a+g<=i&&(s+=p,a+=g)}),s+`
`}buildSmartHistoryContext(e,i){let s=`**Din bin gn y:**
`,a=this.estimateTokens(s);const u=[],f=Math.min(1,e.length);for(let p=e.length-f;p<e.length;p++){const g=e[p];if(g.role==="user"){const m=g.parts[0].text.match(/--- HNH NG CA NGI CHI ---\n"([^"]+)"/);if(m){const y=m[1],v=y.length>100?y.substring(0,100)+"...":y;u.push(`> ${v}`)}}else try{const m=JSON.parse(g.parts[0].text);if(m.story){const y=this.summarizeStory(m.story);if(y){const v=y.length>150?y.substring(0,150)+"...":y;u.push(v)}}}catch{}}return u.forEach(p=>{const g=this.estimateTokens(p+`
`);a+g<=i*.8&&(s+=p+`
`,a+=g)}),s+`
`}summarizeStory(e){var u;const i=e.split(/[.!?]+/).filter(f=>f.trim().length>10),s=/chin u|git|cht|nhn c|mt|thnh cng|tht bi|pht hin|gp/,a=i.filter(f=>s.test(f));return a.length>0?a[0].trim()+".":((u=i[0])==null?void 0:u.trim())+"."||""}buildContextualInfo(e,i){var m;let s=`
=== BI CNH TH GII ===
`,a=this.estimateTokens(s);e.worldData.worldName&&(s+=`Th gii: ${e.worldData.worldName}

`,a+=this.estimateTokens(s));const u=Math.floor((i-a)*.4),f=this.buildChronicleContext(e.chronicle,u);s+=f,a+=this.estimateTokens(f);const p=i-a,g=((m=e.memories)==null?void 0:m.filter(y=>y.pinned))||[];return g.length>0&&p>100&&(s+=`**K c quan trng:**
`,g.slice(0,1).forEach(y=>{const v=`- ${y.text}
`;this.estimateTokens(v)<=p&&(s+=v)})),s}buildChronicleContext(e,i){const s=[];e.memoir.slice(-2).forEach(f=>s.push({memory:f,score:100,type:"memoir"})),e.chapter.slice(-1).forEach(f=>s.push({memory:f,score:70,type:"chapter"})),s.sort((f,p)=>p.score-f.score);let a=`**Bin nin s:**
`,u=this.estimateTokens(a);return s.forEach(({memory:f,type:p})=>{const m=`${p==="memoir"?"[Hi k] ":p==="chapter"?"[Chng] ":"[Lt] "}${f}
`,y=this.estimateTokens(m);u+y<=i&&(a+=m,u+=y)}),a+`
`}buildSupplementalContext(e,i,s,a,u){console.log(` Building supplemental context with ${e.customRules.length} total rules`);const f={playerInput:a,aiResponse:u,gameHistory:e.gameHistory,entities:e.knownEntities,memories:e.memories,currentTurn:e.turnCount,scanDepth:5,tokenBudget:s,caseSensitive:!1,matchWholeWords:!1},p=Cg.processRules(e.customRules,f),g=Cg.formatForPrompt(p);return p.activatedRules.length>0&&(console.log(` Activated ${p.activatedRules.length} rules using ${p.totalTokens} tokens`),p.activatedRules.forEach(m=>{const y=m.rule;console.log(`   "${y.title||y.id}": ${m.activationReason} (Priority: ${y.order||0})`),m.matchedKeywords.length>0&&console.log(`     Matched keywords: ${m.matchedKeywords.join(", ")}`)})),p.budgetExceeded&&console.warn(` Token budget exceeded, ${p.skippedRules.length} rules skipped`),g}assembleFinalPrompt(e,i,s,a,u,f,p,g){let m="";s&&(m+=s+`
`),m+=i.critical+`
`,p?(m+=Ol.formatCompactContextForPrompt(p)+`
`,console.log(` Using Reference-based RAG: ${p.tokensSaved} tokens saved (${(p.tokensSaved/p.originalTokens*100).toFixed(1)}% reduction)`)):f&&f.relevantMemories.length>0&&(m+=wr.formatContextForPrompt(f)+`
`),m+=i.important+`
`,m+=i.contextual+`
`,i.supplemental&&(m+=i.supplemental+`
`);const y=Math.random().toString(36).substring(2,8);if(g){const C=this.analyzePlayerAction(e,g);m+=`
--- HNH NG CA NGI CHI ---
"${e}"
`,m+=`--- BI CNH HNH NG ---
`,m+=`Lt: ${g.turnCount||0} | Thi gian: ${this.formatGameTime(g.gameTime)} | ID: ${y}
`,m+=`Phn tch: ${C.type} - ${C.description}
`,m+=` phc tp: ${C.complexity} | Thi gian d kin: ${C.expectedDuration}
`,C.involvedEntities.length>0&&(m+=`i tng lin quan: ${C.involvedEntities.join(", ")}
`),m+=`--- KT THC BI CNH ---
`}else m+=`
--- HNH NG CA NGI CHI ---
"${e}"
`,m+=`--- BI CNH HNH NG ---
`,m+=`ID: ${y} | Timestamp: ${new Date().toISOString()}
`,m+=`--- KT THC BI CNH ---
`;const v=this.buildSmartChoiceContext(i,p,f);return v&&(m+=`
${v}`),a?m+=`
${a}`:u.allowNsfw&&(m+=`
LU : Ch  NSFW ang BT.`),m+=`
YU CU: Tip tc cu chuyn da trn hnh ng v tri thc  truy xut.

**NGN NG BT BUC:**
-BT BUC s dng 100% ting Vit trong ton b ni dung (story, choices, descriptions)
-TUYT I KHNG dng ting Anh tr tn ring nc ngoi
-Quan h PHI dng ting Vit: "friend""bn b", "enemy""k th", "ally""ng minh", "lover""ngi yu", "family""gia nh", "master""s ph", "rival""i th"
-Kim tra k lng  khng c t ting Anh no lt vo cu chuyn
-Tuyt i khng lp li hnh ng ca NPC  lt trc vo lt ny.

HNG DN S DNG TAG K NNG:
- Khi mt k nng c THAY I/NNG CP/GII PHONG N: S dng [SKILL_UPDATE: oldSkill="tn k nng c" newSkill="tn k nng mi" target="tn nhn vt" description="m t k nng mi"]
- Khi hc k nng HON TON MI (cha tng c): S dng [SKILL_LEARNED: name="tn k nng" learner="tn nhn vt" description="m t"]
- KHNG BAO GI to k nng trng lp - lun dng SKILL_UPDATE  thay th k nng c
- V d: "Thin H Huyn Linh B Php (ang phong n)"  "Thin H Huyn Linh B Php (S Gii)" phi dng SKILL_UPDATE`,m}truncateWithTokenLimit(e,i){if(this.estimateTokens(e)<=i)return e;const a=Math.floor(i/gn.CHARS_PER_TOKEN);if(e.length<=a)return e;const u=e.substring(0,a),f=u.lastIndexOf("."),p=u.lastIndexOf(","),g=u.lastIndexOf(" ");let m=Math.max(f,p,g);return m<a*.8&&(m=a),e.substring(0,m)+"..."}emergencyTruncation(e){const i=this.estimateTokens(e),s=85e3;if(i<=s)return e;console.warn(` EMERGENCY TRUNCATION: ${i} -> ${s}`);const a=e.split(`
`),u=["=== TRI THC QUAN TRNG ===","--- HNH NG CA NGI CHI ---"];let f="",p=!1;for(const g of a)if(u.some(m=>g.includes(m))&&(p=!0),p&&(f+=g+`
`,this.estimateTokens(f)>s))break;return f}enforceTokenLimit(e){const i=this.estimateTokens(e),s=gn.MAX_TOKENS_PER_TURN-gn.TOKEN_BUFFER,a=85e3;return i<=s?(console.log(` Prompt tokens: ${i}/${s} (Safe)`),e):i<=a?(console.warn(` WARNING: Prompt near limit: ${i}/${a}`),e):(console.error(` CRITICAL: Prompt exceeds limit: ${i}/${a}. Emergency truncation applied!`),alert(` TOKEN LIMIT EXCEEDED!
Used: ${i}
Limit: ${a}
Applying emergency truncation.`),this.emergencyTruncation(e))}buildFallbackPrompt(e,i){var u;if(!i)return console.warn(" buildFallbackPrompt: gameState is null/undefined"),`Hnh ng: ${e}
Trng thi: Li h thng, khng th x l.`;const s=(u=i.party)==null?void 0:u.find(f=>f.type==="pc");return`
Nhn vt: ${(s==null?void 0:s.name)||"Nhn vt chnh"}
V tr: ${(s==null?void 0:s.location)||"Khng xc nh"}
Lt: ${i.turnCount}

--- HNH NG CA NGI CHI ---
"${e}"

YU CU: Tip tc cu chuyn da trn hnh ng v tri thc  truy xut.
-Bt buc phi s dng 100% ting vit tr danh t ring.
-Tuyt i khng lp li hnh ng ca NPC  lt trc vo lt ny.

HNG DN S DNG TAG K NNG:
- Khi mt k nng c THAY I/NNG CP/GII PHONG N: S dng [SKILL_UPDATE: oldSkill="tn k nng c" newSkill="tn k nng mi" target="tn nhn vt" description="m t k nng mi"]
- Khi hc k nng HON TON MI (cha tng c): S dng [SKILL_LEARNED: name="tn k nng" learner="tn nhn vt" description="m t"]
- KHNG BAO GI to k nng trng lp - lun dng SKILL_UPDATE  thay th k nng c
- V d: "Thin H Huyn Linh B Php (ang phong n)"  "Thin H Huyn Linh B Php (S Gii)" phi dng SKILL_UPDATE`}analyzePlayerAction(e,i){const s=e.toLowerCase();let a="khc";/ngh|ngi|quan st|xem|nhn|th gin|tn hng/.test(s)?a="th gin/quan st":/th thch|yu cu|nh| ngh/.test(s)?a="tng tc/yu cu":/ni|hi|tr chuyn|tn gu/.test(s)?a="giao tip":/tn cng|chin u|nh/.test(s)?a="chin u":/di chuyn|i|chy|bay/.test(s)&&(a="di chuyn");let u="Khng xc nh";const f=e.match(/\((\d+)\s*(pht|gi|ngy)\)/);f&&(u=`${f[1]} ${f[2]}`);let p="n gin";/th thch|yu cu|nh/.test(s)?p="Trung bnh":/chin u|tn cng|k nng/.test(s)&&(p="Phc tp");const g=[],m=i.knownEntities||{};return Object.keys(m).forEach(y=>{s.includes(y.toLowerCase())&&g.push(y)}),i.party&&i.party.forEach(y=>{s.includes(y.name.toLowerCase())&&g.push(y.name)}),/sakuya/i.test(e)&&g.push("Sakuya Izayoi"),{type:a,description:this.generateActionDescription(e,a),complexity:p,expectedDuration:u,involvedEntities:[...new Set(g)]}}generateActionDescription(e,i){return{"th gin/quan st":"Hnh ng th gin, tp trung vo vic quan st v tn hng","tng tc/yu cu":"Hnh ng tng tc ch ng, yu cu phn hi t ngi khc","giao tip":"Hnh ng giao tip x hi, trao i thng tin","chin u":"Hnh ng chin u, c th c nguy him","di chuyn":"Hnh ng di chuyn t ni ny sang ni khc",khc:"Hnh ng c bit hoc khng thuc loi thng thng"}[i]||"Hnh ng cn c phn tch c th"}formatGameTime(e){if(!e)return"Khng xc nh";try{const{year:i,month:s,day:a,hour:u,minute:f}=e;return`Nm ${i||"?"} Thng ${s||"?"} Ngy ${a||"?"}, ${u||0} gi ${f||0} pht`}catch{return"Li nh dng thi gian"}}}const gw=new pw,xw=(t,e,i="",s="")=>gw.buildEnhancedPrompt(t,e,i,s),gs=class gs{constructor(){if(typeof window<"u"){if(window.__ENTITY_EXPORT_MANAGER_INSTANCE__)return window.__ENTITY_EXPORT_MANAGER_INSTANCE__;window.__ENTITY_EXPORT_MANAGER_INSTANCE__=this}}static configure(e){this.config={...this.config,...e},this.debugLog(" EntityExportManager configured:",this.config)}static shouldExport(e,i){const s=i?`[${i}]`:"";if(!this.config.enabled)return this.debugLog(` ${s} Export disabled in config`),!1;if(this.exportLock.isExporting)return this.debugLog(` ${s} Export already in progress for turn ${this.exportLock.currentTurn} (requested turn: ${e})`),!1;if(i&&this.exportLock.pendingExports.has(i))return this.debugLog(` ${s} Export ID already processed, skipping duplicate`),!1;if(this.exportLock.currentTurn===e){const f=Date.now()-this.exportLock.lastLockTime;if(f<5e3)return this.debugLog(` ${s} Recent export attempt for turn ${e}, skipping (${f}ms ago)`),!1}const a=e-this.metadata.lastExportTurn,u=a>=this.config.exportInterval;return this.debugLog(` ${s} Turn ${e}: ${a} turns since last export (interval: ${this.config.exportInterval})`),this.debugLog(` ${s} Should export: ${u}`),u&&i&&(this.exportLock.pendingExports.add(i),this.debugLog(` ${s} Added to pending exports (total: ${this.exportLock.pendingExports.size})`)),u}static async exportEntities(e,i){const s=i?`[${i}]`:"";if(this.exportLock.isExporting)return this.debugLog(` ${s} Export already in progress for turn ${this.exportLock.currentTurn}, skipping export for turn ${e.turnCount}`),!1;this.exportLock.isExporting=!0,this.exportLock.currentTurn=e.turnCount,this.exportLock.lastLockTime=Date.now();try{const a=new Date().toISOString();this.debugLog(` ${s} [${a}] Starting entity export for turn ${e.turnCount} (LOCKED)`);const u=this.categorizeEntities(e.knownEntities);this.debugLog(` ${s} Entity categorization complete:`,{characters:Object.keys(u.characters).length,locations:Object.keys(u.locations).length,items:Object.keys(u.items).length,factions:Object.keys(u.factions).length,concepts:Object.keys(u.concepts).length,skills:Object.keys(u.skills).length,statusEffects:Object.keys(u.statusEffects).length});const f=this.convertToVietnameseFormat(u),p=await this.createExportFiles(f,e);return this.updateMetadata(e.turnCount,p,Object.keys(e.knownEntities).length),this.debugLog(` ${s} Export completed successfully. Files created: ${p.join(", ")}`),!0}catch(a){return console.error(` ${s} EntityExportManager: Export failed:`,a),this.debugLog(` ${s} Export failed: ${a}`),!1}finally{this.exportLock.isExporting=!1,i&&(this.exportLock.pendingExports.delete(i),this.debugLog(` ${s} Removed from pending exports (remaining: ${this.exportLock.pendingExports.size})`)),this.debugLog(` ${s} Export lock released for turn ${e.turnCount}`)}}static categorizeEntities(e){const i={characters:{},locations:{},items:{},factions:{},concepts:{},skills:{},statusEffects:{}};for(const[s,a]of Object.entries(e)){if(a.archived){this.debugLog(` Skipping archived entity: ${s}`);continue}switch(a.type){case"pc":case"npc":case"companion":i.characters[s]=a;break;case"location":i.locations[s]=a;break;case"item":i.items[s]=a;break;case"faction":i.factions[s]=a;break;case"skill":i.skills[s]=a;break;case"status_effect":i.statusEffects[s]=a;break;case"concept":default:i.concepts[s]=a;break}}return i}static convertToVietnameseFormat(e){const i={characters:{},locations:{},items:{},factions:{},concepts:{},skills:{},statusEffects:{}};for(const[s,a]of Object.entries(e))for(const[u,f]of Object.entries(a)){const p=this.generateReferenceId(f.name,f.type,s),g={...f,originalName:f.name,hanVietName:this.generateHanVietName(f.name,f.type),referenceId:p,exportedAt:Date.now(),exportTurn:this.metadata.lastExportTurn+1};delete g.lastMentioned,delete g.archivedAt,i[s][u]=g,this.debugLog(` Generated reference ID for ${u}: ${p}`)}return i}static generateReferenceId(e,i,s){const a=`${i}_${s}_${e}_${Date.now()}`;let u=0;for(let m=0;m<a.length;m++){const y=a.charCodeAt(m);u=(u<<5)-u+y,u=u&u}const f=Math.abs(u).toString(16).padStart(8,"0"),p=i.substring(0,2).toUpperCase(),g=s.substring(0,3).toUpperCase();return`REF_${p}_${g}_${f}`}static generateHanVietName(e,i){const s={Naruto:"Minh Nhn",Sasuke:"T Tr",Sakura:"Tiu Anh",Kakashi:"K Mc",Konoha:"Mc Dip","Hidden Leaf Village":"Mc Dip n Thn",Academy:"Hc Vin",Forest:"Rng",Mountain:"Sn",Village:"Thn",City:"Thnh",Temple:"T",Palace:"Cung"};return s[e]?s[e]:`${{pc:"Ch Nhn",npc:"Nhn Vt",companion:"ng Hnh",location:"a im",item:"Vt Phm",skill:"K Nng",faction:"Th Lc"}[i]||"Thc Th"} ${e}`}static async createExportFiles(e,i){var f;const s=[],a=new Date().toISOString().replace(/[:.]/g,"-"),u=((f=i.worldData)==null?void 0:f.characterName)||"Unknown";try{for(const[m,y]of Object.entries(e)){if(Object.keys(y).length===0){this.debugLog(` Skipping empty category: ${m}`);continue}const v=`${u}_${m}_turn${i.turnCount}_${a}.json`,C={};for(const[R,L]of Object.entries(y))L.referenceId&&(C[R]=L.referenceId);const N=JSON.stringify({metadata:{exportedAt:a,turn:i.turnCount,category:m,entityCount:Object.keys(y).length,characterName:u,hasReferenceIds:!0},referenceMapping:C,entities:y},null,2);await this.downloadFile(v,N),s.push(v),this.debugLog(` Created file: ${v} (${Object.keys(y).length} entities)`)}const p=`${u}_export_metadata_turn${i.turnCount}_${a}.json`,g=JSON.stringify({...this.metadata,currentTurn:i.turnCount,totalEntities:Object.keys(i.knownEntities).length,exportedAt:a},null,2);return await this.downloadFile(p,g),s.push(p),s}catch(p){throw console.error(" Error creating export files:",p),p}}static async downloadFile(e,i){const s=new Blob([i],{type:"application/json"}),a=URL.createObjectURL(s),u=document.createElement("a");u.download=e,u.href=a,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(a),await new Promise(f=>setTimeout(f,100))}static updateMetadata(e,i,s){this.metadata.lastExportTurn=e,this.metadata.totalExports++,this.metadata.exportHistory.push({turn:e,timestamp:new Date().toISOString(),entitiesExported:s,filesCreated:i}),this.metadata.exportHistory.length>10&&(this.metadata.exportHistory=this.metadata.exportHistory.slice(-10)),this.debugLog(" Metadata updated:",this.metadata)}static getExportStatus(){const e={...this.exportLock,lockDuration:this.exportLock.isExporting?Date.now()-this.exportLock.lastLockTime:void 0};return{config:this.config,metadata:this.metadata,nextExportTurn:this.metadata.lastExportTurn+this.config.exportInterval,lockStatus:e}}static async forceExport(e){if(this.debugLog(" Force export triggered"),this.exportLock.isExporting){const i=Date.now()-this.exportLock.lastLockTime;if(i>3e4)this.debugLog(" Force export: Breaking stale lock (30s timeout)"),this.exportLock.isExporting=!1;else return this.debugLog(` Force export blocked: Export in progress for ${i}ms`),!1}return await this.exportEntities(e)}static async importEntities(e,i){if(!this.config.importEnabled)return{success:!1,entitiesImported:0,entitiesSkipped:0,conflicts:[],error:"Import is disabled in configuration"};this.debugLog(` Starting import from file: ${e.name}`);try{const s=await this.readFileContent(e),a=JSON.parse(s);if(!this.validateImportData(a))return{success:!1,entitiesImported:0,entitiesSkipped:0,conflicts:[],error:"Invalid file format - not a valid entity export file"};this.config.backupBeforeImport&&await this.createBackup(i);const u=await this.processImport(a,i);return this.updateImportMetadata(e.name,u),this.debugLog(` Import completed. Entities imported: ${u.entitiesImported}, Conflicts: ${u.conflicts.length}`),u}catch(s){const a=s instanceof Error?s.message:"Unknown error";return this.debugLog(` Import failed: ${a}`),{success:!1,entitiesImported:0,entitiesSkipped:0,conflicts:[],error:a}}}static async importMultipleFiles(e,i){const s=[];for(let a=0;a<e.length;a++){const u=e[a];if(u.name.endsWith(".json")){const f=await this.importEntities(u,i);s.push(f)}else s.push({success:!1,entitiesImported:0,entitiesSkipped:0,conflicts:[],error:`File ${u.name} is not a JSON file`})}return s}static async readFileContent(e){return new Promise((i,s)=>{const a=new FileReader;a.onload=u=>{var f;return i((f=u.target)==null?void 0:f.result)},a.onerror=()=>s(new Error("Failed to read file")),a.readAsText(e)})}static validateImportData(e){if(!e||typeof e!="object"||!e.metadata||!e.entities||typeof e.metadata!="object"||typeof e.entities!="object")return!1;const i=e.metadata;return!(!i.category||typeof i.category!="string"||!i.entityCount||typeof i.entityCount!="number")}static async processImport(e,i){const s={success:!0,entitiesImported:0,entitiesSkipped:0,conflicts:[]},a=e.entities,u=e.metadata.category;this.debugLog(` Processing ${Object.keys(a).length} entities from category: ${u}`);for(const[f,p]of Object.entries(a))try{const g=await this.importSingleEntity(f,p,i);g.action==="merged"||g.action==="replaced"?s.entitiesImported++:s.entitiesSkipped++,g.conflict&&s.conflicts.push({entityName:f,reason:g.reason||"Unknown conflict",action:g.action})}catch(g){s.entitiesSkipped++,s.conflicts.push({entityName:f,reason:`Import error: ${g instanceof Error?g.message:"Unknown error"}`,action:"skipped"})}return s}static async importSingleEntity(e,i,s){const a=s.knownEntities[e];if(!a){const u={...i};return delete u.exportedAt,delete u.exportTurn,delete u.hanVietName,delete u.originalName,delete u.referenceId,s.knownEntities[e]=u,this.debugLog(` Added new entity: ${e}`),{action:"replaced",conflict:!1}}if(this.config.autoMergeOnImport){const u=this.mergeEntities(a,i);return s.knownEntities[e]=u,this.debugLog(` Merged entity: ${e}`),{action:"merged",conflict:!0,reason:"Entity existed and was merged with imported data"}}else return this.debugLog(` Skipped conflicting entity: ${e}`),{action:"skipped",conflict:!0,reason:"Entity already exists and auto-merge is disabled"}}static mergeEntities(e,i){var a;const s={...i,...e,description:i.description||e.description,tags:[...e.tags||[],...i.tags||[]].filter((u,f,p)=>p.indexOf(u)===f),skills:i.skills&&i.skills.length>(((a=e.skills)==null?void 0:a.length)||0)?i.skills:e.skills,relationship:e.relationship,location:e.location,lastUpdated:Date.now()};return delete s.exportedAt,delete s.exportTurn,delete s.hanVietName,delete s.originalName,delete s.referenceId,s}static async createBackup(e){const i=new Date().toISOString().replace(/[:.]/g,"-"),s=`backup_before_import_${i}.json`,a=JSON.stringify({metadata:{backupCreatedAt:i,totalEntities:Object.keys(e.knownEntities).length,reason:"Pre-import backup"},entities:e.knownEntities},null,2);await this.downloadFile(s,a),this.debugLog(` Backup created: ${s}`)}static updateImportMetadata(e,i){this.metadata.totalImports++,this.metadata.importHistory.push({timestamp:new Date().toISOString(),fileName:e,entitiesImported:i.entitiesImported,conflicts:i.conflicts.length,success:i.success}),this.metadata.importHistory.length>10&&(this.metadata.importHistory=this.metadata.importHistory.slice(-10)),this.debugLog(" Import metadata updated:",this.metadata)}static resetMetadata(){this.metadata={lastExportTurn:0,totalExports:0,totalImports:0,exportHistory:[],importHistory:[]},this.debugLog(" Export metadata reset")}static debugLog(e,i){}};gs.DEFAULT_CONFIG={enabled:!0,exportInterval:7,maxFileSize:1024*1024,exportPath:"/data/game-exports/",enableDebugLogging:!0,importEnabled:!0,autoMergeOnImport:!0,backupBeforeImport:!0},gs.config=gs.DEFAULT_CONFIG,gs.metadata={lastExportTurn:0,totalExports:0,totalImports:0,exportHistory:[],importHistory:[]},gs.exportLock={isExporting:!1,currentTurn:null,lastLockTime:0,pendingExports:new Set};let bs=gs;const ho=50,C0=t=>({update:e=>{t(i=>{const s=e(i);if(s.length>ho){const a=s.slice(-ho);return console.log(` StoryLog auto-trimmed: ${s.length} -> ${a.length} entries (kept ${ho} most recent)`),a}return s})},set:e=>{const i=e.length>ho?e.slice(-ho):e;i.length!==e.length&&console.log(` StoryLog auto-trimmed on set: ${e.length} -> ${i.length} entries (kept ${ho} most recent)`),t(i)}});class Er{constructor(){this.macroContext={}}updateMacroContext(e){this.macroContext={...this.macroContext,...e}}sanitizeRegexMacro(e){return!e||typeof e!="string"?e:e.replace(/[\n\r\t\v\f\0.^$*+?{}[\]\\/|()]/gs,i=>{switch(i){case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\v":return"\\v";case"\f":return"\\f";case"\0":return"\\0";default:return"\\"+i}})}substituteMacros(e,i=!1){let s=e;const a={"{{player}}":this.macroContext.playerName||"Player","{{character}}":this.macroContext.playerName||"Player","{{location}}":this.macroContext.currentLocation||"Unknown Location","{{time}}":this.formatTime(),"{{hp}}":String(this.macroContext.currentHp||0),"{{mana}}":String(this.macroContext.currentMana||0),"{{level}}":this.macroContext.level||"1","{{exp}}":String(this.macroContext.experience||0),"{{action}}":this.macroContext.lastAction||""};for(const[u,f]of Object.entries(a)){const p=i?this.sanitizeRegexMacro(f):f;s=s.replace(new RegExp(u.replace(/[{}]/g,"\\$&"),"gi"),p)}return s}formatTime(){const e=this.macroContext.currentTime;if(!e)return"Unknown Time";const i=e.hour!==void 0?`:${e.hour}`:"";return`${e.day}/${e.month}/${e.year}${i}`}createRegexFromString(e){try{const i=e.match(/^\/(.+)\/([gimuy]*)$/);return i?new RegExp(i[1],i[2]):new RegExp(e,"g")}catch(i){return console.warn("Invalid regex pattern:",e,i),null}}filterTrimStrings(e,i){let s=e;for(const a of i)if(a){const u=this.substituteMacros(a);s=s.replace(new RegExp(u,"g"),"")}return s}runRegexRule(e,i,s={}){if(!e||e.disabled||!e.findRegex||!i||typeof s.depth=="number"&&(e.minDepth!==void 0&&s.depth<e.minDepth||e.maxDepth!==void 0&&s.depth>e.maxDepth)||s.isEdit&&!e.runOnEdit||!(e.markdownOnly&&s.isMarkdown||e.promptOnly&&s.isPrompt||!e.markdownOnly&&!e.promptOnly&&!s.isMarkdown&&!s.isPrompt))return i;try{let u=e.findRegex;switch(e.substituteRegex){case ct.RAW:u=this.substituteMacros(u,!1);break;case ct.ESCAPED:u=this.substituteMacros(u,!0);break;case ct.NONE:default:break}const f=this.createRegexFromString(u);return f?(e.lastUsed=Date.now(),i.replace(f,(...g)=>{const m=g[0],y=g.slice(1,-2);let v=e.replaceString;return v=v.replace(/\{\{match\}\}/gi,m),v=v.replace(/\$(\d+)/g,(C,N)=>{const R=parseInt(N);if(R===0)return m;const L=y[R-1];return L===void 0?"":this.filterTrimStrings(L,e.trimStrings)}),v=this.substituteMacros(v),v})):(console.warn(`Invalid regex in rule "${e.name}":`,u),i)}catch(u){return console.error(`Error executing regex rule "${e.name}":`,u),i}}processText(e,i,s,a={}){if(!e||!s||s.length===0)return e;let u=e;const f=s.filter(p=>!p.disabled&&p.placement.includes(i));f.sort((p,g)=>(p.createdAt||0)-(g.createdAt||0));for(const p of f)u=this.runRegexRule(p,u,a);return u}static getPlacementDescriptions(){return{[Pe.PLAYER_INPUT]:"Player Commands - Process user input before parsing",[Pe.AI_OUTPUT]:"AI Responses - Format AI-generated text",[Pe.MEMORY_PROCESSING]:"Memory Storage - Process memories before saving",[Pe.ENTITY_DETECTION]:"Entity Extraction - Extract entities from text",[Pe.QUEST_PROCESSING]:"Quest Updates - Process quest-related content",[Pe.DIALOGUE_FORMATTING]:"Dialogue - Format conversations and speech",[Pe.STAT_EXTRACTION]:"Statistics - Extract numbers and stat changes",[Pe.COMBAT_FORMATTING]:"Combat - Format battle descriptions"}}static validateRegexPattern(e){try{return new RegExp(e),{isValid:!0}}catch(i){return{isValid:!1,error:i instanceof Error?i.message:"Invalid regex pattern"}}}}const Mr=new Er,yw=t=>{const{ai:e,selectedModel:i,systemInstruction:s,responseSchema:a,isUsingDefaultKey:u,userApiKeyCount:f,rotateKey:p,rehydratedChoices:g,setIsLoading:m,setChoices:y,setCustomAction:v,setStoryLog:C,setGameHistory:N,setTurnCount:R,setCurrentTurnTokens:L,setTotalTokens:O,gameHistory:J,customRules:P,regexRules:$,ruleChanges:ne,setRuleChanges:z,parseStoryAndTags:ae,updateChoiceHistory:de}=t,re=C0(C),se=async(H,k,S,V)=>{var B,X,xe,Ne,Te,Ee,Re;if(!e)return;m(!0),H.customPersonality||H.personalityFromList;const W=H.writingStyle==="first_person"?'Ngi th nht - Nhn vt chnh xng "Ta/Ti"':'Ngi th hai - "Ngi" l nhn vt chnh',I=H.allowNsfw?"Cho php. Kch hot quy tc ni dung 18+ ca Qun Tr. Vit mt cch trn tri, bo lc, tc tu v khng gii hn.":"Khng, AI phi trnh cc ch  v m t 18+.",j=P.filter(ye=>ye.isActive);let F="";j.length>0&&(F=`
--- TRI THC & LUT L TY CHNH (ANG P DNG) ---
${j.map(ye=>`- ${ye.content}`).join(`
`)}
--- KT THC ---
`);const Z=Object.values(k).filter(ye=>ye.type==="concept");let A="";if(Z.length>0&&(A=`
--- CC LORE_CONCEPT  THIT LP ---
${Z.map(ye=>` ${ye.name}: ${ye.description}`).join(`
`)}
--- KT THC ---
`),!S)return;let G="";S.learnedSkills&&S.learnedSkills.length>0&&(G=S.learnedSkills.map(we=>{const Se=k[we];if(Se){const Ce=Se.mastery?` (${Se.mastery})`:"",_e=Se.description?` - ${Se.description}`:"";return`${we}${Ce}${_e}`}return we}).join(`
   `));const D=[{role:"user",parts:[{text:`${F}${A}

BN L QUN TR AI. To cu chuyn m u cho game RPG vi yu cu sau:

--- THNG TIN NHN VT CHNH ---
Tn: ${S.name}
Gii tnh: ${S.gender}
Tiu s: ${S.description}
Tnh cch: ${S.personality}${S.motivation?`
**NG C/MC TIU QUAN TRNG**: ${S.motivation}`:""}${G?`
**K NNG KHI U**:
   ${G}`:""}

--- THNG TIN TH GII ---
Th gii: ${H.worldName}
M t: ${H.worldDescription}
Thi gian: Nm ${((B=H.worldTime)==null?void 0:B.year)||1}, Thng ${((X=H.worldTime)==null?void 0:X.month)||1}, Ngy ${((xe=H.worldTime)==null?void 0:xe.day)||1}
a im bt u: ${H.startLocation==="Tu chn"?H.customStartLocation:H.startLocation||"Khng xc nh"}
Phong cch vit: ${W}
Ni dung 18+: ${I}

--- YU CU VIT STORY ---
1. **NGN NG TUYT I**: BT BUC 100% ting Vit. KHNG dng ting Anh tr tn ring nc ngoi. Quan h nhn vt PHI ting Vit: "friend""bn", "enemy""k th", "ally""ng minh", "lover""ngi yu"
2. **CHIU DI**: Chnh xc 300-400 t, chi tit v sng ng  
3. **S DNG CONCEPT**: Phi tch hp cc LORE_CONCEPT  thit lp vo cu chuyn mt cch t nhin
4. **THIT LP BI CNH**: To tnh hung m u th v, khng qu drama${G?`
5. **NHC N K NNG**: Phi  cp hoc th hin k nng khi u ca nhn vt trong cu chuyn hoc la chn, ch  n mc  thnh tho`:""}${S.motivation?`
${G?"6":"5"}. **PHN NH NG C NHN VT**: Cu chuyn v la chn phi lin quan n ng c/mc tiu ca nhn vt chnh: "${S.motivation}"`:""}
${S.motivation&&G?"7":S.motivation||G?"6":"5"}. **TIME_ELAPSED**: Bt buc s dng [TIME_ELAPSED: hours=0] 
${S.motivation&&G?"8":S.motivation||G?"7":"6"}. **TH LNH**: To t nht 2-3 th lnh ph hp (LORE_LOCATION, LORE_NPC, STATUS_APPLIED_SELF...)
${S.motivation&&G?"9":S.motivation||G?"8":"7"}. **LA CHN**: To 4-6 la chn hnh ng a dng v th v${S.motivation?`, mt s la chn phi hng ti vic thc hin mc tiu: "${S.motivation}"`:""}${G?", v mt s la chn cho php s dng k nng khi u vi mc  thnh tho ph hp":""}

Hy to mt cu chuyn m u cun ht${S.motivation?` v th hin r ng c "${S.motivation}" ca nhn vt`:""}${G?`${S.motivation?", ":" v "}nhc n hoc cho php s dng k nng khi u vi mc  thnh tho`:""}!

**LU  CUI CNG**: Kim tra k lng ton b output  m bo 100% ting Vit, khng c t ting Anh no!`}]}];N(D);try{console.log(" GenerateInitialStory: Making AI request with model:",i),console.log(" GenerateInitialStory: System instruction length:",s.length),console.log(" GenerateInitialStory: Initial history:",D);const ye=await e.models.generateContent({model:i,contents:D,config:{systemInstruction:s,responseMimeType:"application/json",responseSchema:a}});console.log(" GenerateInitialStory: AI response received:",{hasText:!!ye.text,textLength:((Ne=ye.text)==null?void 0:Ne.length)||0,usageMetadata:ye.usageMetadata});const we=((Te=ye.usageMetadata)==null?void 0:Te.totalTokenCount)||0;L(we),O(Ce=>Ce+we);const Se=((Ee=ye.text)==null?void 0:Ee.trim())||"";if(!Se){console.error(" GenerateInitialStory: API returned empty response text",{responseMetadata:ye.usageMetadata,model:i,responseObject:ye});let Ce="Li: AI khng th to cu chuyn khi u.";((Re=ye.usageMetadata)==null?void 0:Re.totalTokenCount)===0?Ce+=" C th do gii hn token hoc ni dung b lc.":ye.usageMetadata||(Ce+=" C th do li kt ni mng."),Ce+=" Vui lng th to li th gii hoc kim tra API key.",re.update(_e=>[..._e,Ce]),y([]);return}console.log(" GenerateInitialStory: Response text received, length:",Se.length),me(Se),N(Ce=>[...Ce,{role:"model",parts:[{text:Se}]}])}catch(ye){console.error(" GenerateInitialStory: Error occurred:",{errorMessage:ye.message,errorString:ye.toString(),errorStack:ye.stack,errorType:typeof ye,isUsingDefaultKey:u,userApiKeyCount:f}),!u&&f>1&&ye.toString().includes("429")?(console.log(" GenerateInitialStory: Rate limit detected, rotating key..."),p(),re.update(we=>[...we,"** Li gii hn yu cu.  t ng chuyn sang API Key tip theo. Vui lng th li hnh ng ca bn. **"]),y(g)):(console.error(" GenerateInitialStory: Non-rate-limit error, showing error message"),re.set(["C li xy ra khi bt u cu chuyn. Vui lng th li.",`Chi tit li: ${ye.message||ye.toString()}`]))}finally{console.log(" GenerateInitialStory: Cleaning up, setting loading false"),m(!1)}},oe=async(H,k)=>{var M,D,B,X,xe,Ne,Te,Ee;let S=H.trim(),V=!1;const W=/\s+nsfw\s*$/i;if(W.test(S)&&(V=!0,S=S.replace(W,"").trim()),!S||!e)return;const I=Mr.processText(S,Pe.PLAYER_INPUT,$||[],{depth:(J==null?void 0:J.length)||0,isEdit:!1});m(!0),y([]),v(""),re.update(Re=>[...Re,`> ${I}`]),de([],I,"Player action executed");let j="";ne&&z(null);let F=V&&k.worldData.allowNsfw?`
LU  C BIT: ...`:"";const Z=xw(S,k,j,F);console.log(` [Turn ${k.turnCount}] Action Handler Debug:`,{originalAction:S,processedAction:I,timestamp:new Date().toISOString(),promptLength:Z.length,promptHash:Z.slice(0,100)+"..."+Z.slice(-100),gameStateHash:`T${k.turnCount}_${(M=k.gameTime)==null?void 0:M.year}_${(D=k.gameTime)==null?void 0:D.month}_${(B=k.gameTime)==null?void 0:B.day}_${(X=k.gameTime)==null?void 0:X.hour}`});const A={role:"user",parts:[{text:Z}]},G=[...J,A];try{const Re=await e.models.generateContent({model:i,contents:G,config:{systemInstruction:s,responseMimeType:"application/json",responseSchema:a,temperature:.9,topP:.95,topK:40}}),ye=((xe=Re.usageMetadata)==null?void 0:xe.totalTokenCount)||0;L(ye),O(Ce=>Ce+ye);const we=((Ne=Re.text)==null?void 0:Ne.trim())||"";if(console.log(` [Turn ${k.turnCount}] AI Response Debug:`,{responseLength:we.length,responseHash:we.length>200?we.slice(0,100)+"..."+we.slice(-100):we,tokenUsage:ye,model:i,timestamp:new Date().toISOString()}),!we){console.error("API returned empty response text in handleAction",{responseMetadata:Re.usageMetadata,model:i,action:S,responseObject:Re});let Ce="Li: AI khng tr v ni dung.";((Te=Re.usageMetadata)==null?void 0:Te.totalTokenCount)===0?Ce+=" C th do gii hn token hoc ni dung b lc.":Re.usageMetadata||(Ce+=" C th do li kt ni mng."),Ce+=" Vui lng th li vi hnh ng khc hoc kim tra API key.",re.update(_e=>[..._e,Ce]);return}if(Y(we,J)){console.warn(` [Turn ${k.turnCount}] Duplicate response detected! Regenerating...`);const Ce=Z+`

**QUAN TRNG**: y l ln th li do phn hi trng lp. Hy to ni dung HON TON KHC vi lt trc. Seed: ${Math.random()}`,_e=[...J,{role:"user",parts:[{text:Ce}]}],Fe=((Ee=(await e.models.generateContent({model:i,contents:_e,config:{systemInstruction:s,responseMimeType:"application/json",responseSchema:a,temperature:1,topP:.9,topK:30}})).text)==null?void 0:Ee.trim())||"";Fe?(N(Q=>[...Q,A,{role:"model",parts:[{text:Fe}]}]),me(Fe),console.log(` [Turn ${k.turnCount}] Successfully generated unique response on retry`)):(N(Q=>[...Q,A,{role:"model",parts:[{text:we}]}]),me(we))}else N(Ce=>[...Ce,A,{role:"model",parts:[{text:we}]}]),me(we);R(Ce=>{const _e=Ce+1,gt=`export_${_e}_${Date.now()}_${Math.random().toString(36)}`;return setTimeout(async()=>{try{if(bs.shouldExport(_e,gt)){const Fe=await bs.exportEntities(k,gt)}}catch(Fe){console.error(` [Turn ${_e}] Entity export error (ID: ${gt}):`,Fe)}},1e3),_e})}catch(Re){console.error("Error continuing story:",Re),C(ye=>ye.slice(0,-1)),!u&&f>1&&Re.toString().includes("429")?(p(),re.update(ye=>[...ye,"** Li gii hn yu cu.  t ng chuyn sang API Key tip theo. Vui lng th li hnh ng ca bn. **"])):re.update(ye=>[...ye,"Li: AI khng th x l yu cu. Vui lng th mt hnh ng khc."])}finally{m(!1)}},_=async(H,k)=>{var S;if(e){m(!0);try{const W=`Bn l AI h tr ngi chi trong game RPG. Da vo bi cnh cu chuyn gn y, hy gi  mt hnh ng th v v sng to cho ngi chi.

=== BI CNH GAN Y ===
${H.slice(-3).join(`

`)}

=== YU CU ===
- Gi  1 hnh ng c th, sng to v ph hp vi bi cnh
- Hnh ng phi ngn gn, di 10-20 t
- Hnh ng phi c th thc hin c trong tnh hung hin ti
- ng gii thch hay thm g khc, ch tr v hnh ng duy nht

V D:
- "Quan st k xung quanh  tm manh mi"
- "Hi ngi a phng v truyn thuyt"
- "Th s dng k nng  gii quyt vn "

Hy gi  hnh ng:`,F=(((S=(await e.models.generateContent({model:i,contents:[{role:"user",parts:[{text:W}]}]})).text)==null?void 0:S.trim())||"Khng th nhn gi  lc ny.").replace(/^["']|["']$/g,"").replace(/^- /,"").trim();v(F)}catch(V){console.error("Error suggesting action:",V),v("Khng th nhn gi  lc ny.")}finally{m(!1)}}},me=H=>{try{if(!H||H.trim().length===0){console.error("Empty AI response received"),re.update(j=>[...j,"Li: AI tr v phn hi trng. Hy th li."]),y([]);return}let k=H.trim();if(k.startsWith("```json")){const j=k.match(/```json\s*([\s\S]*?)\s*```/);j&&(k=j[1].trim())}else if(k.startsWith("```")){const j=k.match(/```\s*([\s\S]*?)\s*```/);j&&(k=j[1].trim())}const S=k.match(/\{[\s\S]*\}/);if(S&&(k=S[0]),!k||k.length===0){console.error("No valid JSON found in response"),re.update(j=>[...j,"Li: Khng tm thy JSON hp l trong phn hi. Hy th li."]),y([]);return}const V=JSON.parse(k);if(!V.story){console.error("Missing story field in JSON response"),re.update(j=>[...j,"Li: Phn hi thiu ni dung cu chuyn. Hy th li."]),y([]);return}let W=ae(V.story,!0);W=Mr.processText(W,Pe.AI_OUTPUT,$||[],{depth:(J==null?void 0:J.length)||0,isEdit:!1,isPrompt:!1}),re.update(j=>[...j,W]);const I=V.choices||[];if(y(I),I.length>0){const j=W.length>100?W.substring(0,100)+"...":W;de(I,void 0,j)}}catch(k){console.error("Failed to parse AI response:",k,"Raw response:",H),re.update(S=>[...S,"Li: AI tr v d liu khng hp l. Hy th li."]),y([])}},Y=(H,k)=>{try{const S=JSON.parse(H),V=S.story||"",W=(S.choices||[]).join("|"),I=k.slice(-6).filter(j=>j.role==="model").slice(-3);for(const j of I)try{const F=JSON.parse(j.parts[0].text),Z=F.story||"",A=(F.choices||[]).join("|"),G=X=>X.replace(/\[([A-Z_]+):\s*([^\]]+)\]/g,"").replace(/\s+/g," ").trim().toLowerCase(),M=G(V),D=G(Z),B=ue(M,D);if(B>.9)return console.log(` High similarity detected: ${(B*100).toFixed(1)}%`),!0;if(W===A&&W.length>0)return console.log(" Identical choices detected"),!0}catch{continue}return!1}catch(S){return console.warn("Error in duplicate detection:",S),!1}},ue=(H,k)=>{if(H===k)return 1;if(H.length===0||k.length===0)return 0;const S=H.split(" "),V=k.split(" ");[...new Set([...S,...V])];let W=0;for(const I of S)V.includes(I)&&W++;return W/Math.max(S.length,V.length)};return{generateInitialStory:se,handleAction:oe,handleSuggestAction:_,detectDuplicateResponse:Y}},vw=t=>{const{knownEntities:e,setKnownEntities:i,setActiveEntity:s,setActiveStatus:a,setActiveQuest:u,handleAction:f,getCurrentGameState:p}=t;return{handleEntityClick:L=>{s(e[L]||null)},handleUseItem:L=>{s(null);const O=e[L];if(O&&O.type==="item"&&(O.owner==="pc"||!O.owner)){const J=O.quantities||O.uses;typeof J=="number"&&J>1?i(P=>{const $={...P},ne=J-1;return O.quantities?$[L]={...O,quantities:ne}:O.uses&&($[L]={...O,uses:ne}),console.log(` Item used locally: ${L} - now has ${ne} remaining`),$}):i(P=>{const $={...P};return delete $[L],console.log(` Item used completely: ${L} - removed from inventory`),$})}setTimeout(()=>f(`S dng vt phm: ${L}`,p()),100)},handleLearnItem:L=>{s(null),setTimeout(()=>f(`Hc cng php: ${L}`,p()),100)},handleEquipItem:L=>{s(null),setTimeout(()=>f(`Trang b ${L}`,p()),100)},handleUnequipItem:L=>{s(null),setTimeout(()=>f(`Tho ${L}`,p()),100)},handleStatusClick:L=>{a(L)},handleQuestClick:L=>{u(L)}}};class sn{static generateReferenceId(e,i,s){const a=Date.now(),u=`${i}_${s||this.getCategoryFromType(i)}_${e}_${a}`;let f=0;for(let y=0;y<u.length;y++){const v=u.charCodeAt(y);f=(f<<5)-f+v,f=f&f}const p=Math.abs(f).toString(16).padStart(8,"0"),g=this.getTypePrefix(i),m=this.getCategoryPrefix(s||this.getCategoryFromType(i));return`REF_${g}_${m}_${p}`}static getTypePrefix(e){return{pc:"PC",npc:"NP",companion:"CO",location:"LO",item:"IT",skill:"SK",faction:"FA",concept:"CN",status_effect:"ST"}[e]||e.substring(0,2).toUpperCase()}static getCategoryPrefix(e){return{characters:"CHA",locations:"LOC",items:"ITE",factions:"FAC",concepts:"CON",skills:"SKI",statusEffects:"STA"}[e]||e.substring(0,3).toUpperCase()}static getCategoryFromType(e){return{pc:"characters",npc:"characters",companion:"characters",location:"locations",item:"items",skill:"skills",faction:"factions",concept:"concepts",status_effect:"statusEffects"}[e]||"concepts"}static validateReferenceId(e){return/^REF_[A-Z]{2}_[A-Z]{3}_[A-F0-9]{8}$/.test(e)}static parseReferenceId(e){const i=/^REF_([A-Z]{2})_([A-Z]{3})_([A-F0-9]{8})$/,s=e.match(i);return s?{valid:!0,typePrefix:s[1],categoryPrefix:s[2],hash:s[3]}:{valid:!1}}}const bw=t=>{const{worldData:e,knownEntities:i,statuses:s,quests:a,gameHistory:u,memories:f,party:p,customRules:g,systemInstruction:m,turnCount:y,totalTokens:v,gameTime:C,chronicle:N,compressedHistory:R,historyStats:L,cleanupStats:O,archivedMemories:J,memoryStats:P,storyLog:$,choices:ne,locationDiscoveryOrder:z,choiceHistory:ae,setShowSaveSuccess:de,setStoryLog:re,setChoices:se,setStatuses:oe,setQuests:_,setMemories:me,setKnownEntities:Y,setParty:ue,setCustomRules:H,setTurnCount:k,setTotalTokens:S,setGameTime:V,setChronicle:W,setRuleChanges:I,setGameHistory:j,setHasGeneratedInitialStory:F,setIsLoading:Z,isGeneratingRef:A,initialGameState:G,previousRulesRef:M}=t;return{handleSaveGame:()=>{var we;de(!0),setTimeout(()=>de(!1),3e3);const Te=JSON.stringify({worldData:e,knownEntities:i,statuses:s,quests:a,gameHistory:u,memories:f,party:p,customRules:g,systemInstruction:m,turnCount:y,totalTokens:v,gameTime:C,chronicle:N,compressedHistory:R,historyStats:L,cleanupStats:O,archivedMemories:J,memoryStats:P,storyLog:$,choices:ne,locationDiscoveryOrder:z,choiceHistory:ae},null,2),Ee=new Blob([Te],{type:"application/json"}),Re=URL.createObjectURL(Ee),ye=document.createElement("a");ye.download=`AI-RolePlay-${((we=e.characterName)==null?void 0:we.replace(/\s+/g,"_"))||"NhanVat"}-${new Date().toISOString().replace(/[:.]/g,"-")}.json`,ye.href=Re,document.body.appendChild(ye),ye.click(),document.body.removeChild(ye),URL.revokeObjectURL(Re)},handleRestartGame:()=>{var Re,ye,we,Se;Z(!0),re([]),se([]),oe([]),_([]),me([]);const Ne={name:e.characterName||"V Danh",type:"pc",description:e.bio,gender:e.gender,age:e.characterAge,appearance:e.characterAppearance||((Re=G.knownEntities[e.characterName||"V Danh"])==null?void 0:Re.appearance)||"",personality:e.customPersonality||e.personalityFromList,learnedSkills:[],referenceId:sn.generateReferenceId(e.characterName||"V Danh","pc")},Te=Object.values(G.knownEntities).filter(Ce=>Ce.type==="concept").reduce((Ce,_e)=>(Ce[_e.name]=_e,Ce),{}),Ee={[Ne.name]:Ne,...Te};Y(Ee),ue([Ne]),k(0),S(0),V({year:((ye=e.worldTime)==null?void 0:ye.year)||1,month:((we=e.worldTime)==null?void 0:we.month)||1,day:((Se=e.worldTime)==null?void 0:Se.day)||1,hour:8}),W({memoir:[],chapter:[],turn:[]}),I(null),M.current=G.customRules,j([]),F(!1),A.current=!1},handleToggleMemoryPin:Ne=>{me(Te=>Te.map((Ee,Re)=>Re===Ne?{...Ee,pinned:!Ee.pinned}:Ee))},handleSaveRules:(Ne,Te)=>{H(Ne),M.current=JSON.parse(JSON.stringify(Ne)),Te(!0),setTimeout(()=>Te(!1),3500)}}},od={maxStoredLogs:50,showStackTrace:!1};class Cw{constructor(){this.logs=[],this.previousPartyState=[],this.previousStatuses=[],this.loadLogsFromStorage(),this.setupGlobalErrorHandler(),this.log("PARTY_COMPOSITION"," Party Debugger initialized")}log(e,i,s,a){const u={timestamp:Date.now(),type:e,message:i,data:s?JSON.parse(JSON.stringify(s)):void 0,turnCount:a,stackTrace:void 0};this.logs.push(u),this.trimLogs(),this.logToConsole(u),this.saveLogsToStorage()}monitorPartyChanges(e,i,s){const a=e.filter(f=>f.type==="companion"&&!this.previousPartyState.some(p=>p.name===f.name));a.forEach(f=>{this.log("COMPANION_JOIN",` New companion joined: ${f.name}`,{companion:{name:f.name,type:f.type,relationship:f.relationship,skills:f.skills,realm:f.realm,personality:f.personality},partySize:e.length},s)});const u=this.previousPartyState.filter(f=>f.type==="companion"&&!e.some(p=>p.name===f.name));u.forEach(f=>{this.log("COMPANION_LEAVE",` Companion left: ${f.name}`,{companion:{name:f.name,relationship:f.relationship,reason:"Unknown"},partySize:e.length},s)}),e.forEach(f=>{const p=this.previousPartyState.find(g=>g.name===f.name);p&&p.relationship!==f.relationship&&this.log("RELATIONSHIP_CHANGE",` Relationship changed: ${f.name}`,{name:f.name,previousRelationship:p.relationship||"Unknown",newRelationship:f.relationship||"Unknown",change:this.getRelationshipChangeDirection(p.relationship,f.relationship)},s),p&&p.realm!==f.realm&&this.log("REALM_CHANGE",` Power level changed: ${f.name}`,{name:f.name,previousRealm:p.realm||"Unknown",newRealm:f.realm||"Unknown",change:"upgrade"},s),p&&JSON.stringify(p.skills)!==JSON.stringify(f.skills)&&this.log("SKILL_CHANGE",` Skills changed: ${f.name}`,{name:f.name,previousSkills:p.skills||[],newSkills:f.skills||[],addedSkills:this.getAddedSkills(p.skills,f.skills),removedSkills:this.getRemovedSkills(p.skills,f.skills)},s)}),this.monitorStatusChanges(e,i,s),this.previousPartyState=JSON.parse(JSON.stringify(e)),this.previousStatuses=JSON.parse(JSON.stringify(i)),(a.length>0||u.length>0)&&this.logPartyComposition(e,s)}monitorStatusChanges(e,i,s){e.forEach(a=>{const u=i.filter(m=>m.owner===a.name||a.type==="pc"&&m.owner==="pc"),f=this.previousStatuses.filter(m=>m.owner===a.name||a.type==="pc"&&m.owner==="pc");u.filter(m=>!f.some(y=>y.name===m.name)).forEach(m=>{this.log("STATUS_CHANGE",` Status applied to ${a.name}: ${m.name}`,{memberName:a.name,memberType:a.type,status:{name:m.name,type:m.type,description:m.description,duration:m.duration,source:m.source},action:"APPLIED"},s)}),f.filter(m=>!u.some(y=>y.name===m.name)).forEach(m=>{this.log("STATUS_CHANGE",` Status removed from ${a.name}: ${m.name}`,{memberName:a.name,memberType:a.type,status:{name:m.name,type:m.type,reason:"Unknown"},action:"REMOVED"},s)})})}logAIContextBuild(e,i,s){var a;this.log("AI_CONTEXT_BUILD"," AI Party Context Built",{companionCount:((a=e.companions)==null?void 0:a.length)||0,tokensUsed:i,contextLength:e.contextLength,includesPersonalities:e.includesPersonalities,includesSkills:e.includesSkills,includesRelationships:e.includesRelationships},s)}logPartyComposition(e,i){const s=e.filter(u=>u.type==="companion"),a=e.find(u=>u.type==="pc");this.log("PARTY_COMPOSITION"," Current Party Composition",{totalMembers:e.length,pc:a?{name:a.name,realm:a.realm,location:a.location}:null,companions:s.map(u=>{var f,p;return{name:u.name,relationship:u.relationship,realm:u.realm,skillCount:((f=u.skills)==null?void 0:f.length)||0,topSkills:((p=u.skills)==null?void 0:p.slice(0,3))||[]}}),partyStrength:this.calculatePartyStrength(e)},i)}logToConsole(e){const i=`[${new Date(e.timestamp).toLocaleTimeString()}]`,s={COMPANION_JOIN:"color: #10B981; font-weight: bold",COMPANION_LEAVE:"color: #EF4444; font-weight: bold",RELATIONSHIP_CHANGE:"color: #EC4899; font-weight: bold",STATUS_CHANGE:"color: #8B5CF6; font-weight: bold",SKILL_CHANGE:"color: #F59E0B; font-weight: bold",REALM_CHANGE:"color: #06B6D4; font-weight: bold",PARTY_COMPOSITION:"color: #6366F1; font-weight: bold",AI_CONTEXT_BUILD:"color: #84CC16; font-weight: bold",ERROR:"color: #DC2626; font-weight: bold"};console.groupCollapsed(`%c PARTY DEBUG ${i} [${e.type}] ${e.message}`,s[e.type]),e.data&&console.log(" Data:",e.data),e.turnCount&&console.log(" Turn:",e.turnCount),e.stackTrace&&od.showStackTrace,console.groupEnd()}saveLogsToStorage(){try{localStorage.setItem("partyDebugLogs",JSON.stringify(this.logs))}catch(e){console.warn("Failed to save party debug logs to storage:",e)}}loadLogsFromStorage(){try{const e=localStorage.getItem("partyDebugLogs");e&&(this.logs=JSON.parse(e))}catch(e){console.warn("Failed to load party debug logs from storage:",e),this.logs=[]}}trimLogs(){this.logs.length>od.maxStoredLogs&&(this.logs=this.logs.slice(-50))}getRelationshipChangeDirection(e,i){const s=["bn","yu","thn","tin cy"],a=["th","ch","ght","nghi ng"],u=this.getRelationshipScore(e,s,a),f=this.getRelationshipScore(i,s,a);return f>u?"IMPROVED":f<u?"DETERIORATED":"CHANGED"}getRelationshipScore(e,i,s){if(!e)return 0;const a=e.toLowerCase();return i.some(u=>a.includes(u))?1:s.some(u=>a.includes(u))?-1:0}getAddedSkills(e,i){return i?e?i.filter(s=>!e.includes(s)):i:[]}getRemovedSkills(e,i){return e?i?e.filter(s=>!i.includes(s)):e:[]}calculatePartyStrength(e){const i=e.filter(s=>s.type==="companion");return i.length===0?"SOLO":i.length<=2?"SMALL_PARTY":i.length<=4?"BALANCED_PARTY":"LARGE_PARTY"}setupGlobalErrorHandler(){const e=console.error;console.error=(...i)=>{i.some(s=>typeof s=="string"&&s.includes("party"))&&this.log("ERROR"," Party-related error detected",{error:i.join(" "),timestamp:Date.now()}),e.apply(console,i)}}getLogs(e){return e?this.logs.filter(i=>i.type===e):this.logs}clearLogs(){this.logs=[],this.saveLogsToStorage(),console.log(" Party debug logs cleared")}exportLogs(){return JSON.stringify(this.logs,null,2)}getDebugSummary(){const e=this.logs.reduce((i,s)=>(i[s.type]=(i[s.type]||0)+1,i),{});return{totalLogs:this.logs.length,logsByType:e,latestLogs:this.logs.slice(-5),currentPartySize:this.previousPartyState.length,companions:this.previousPartyState.filter(i=>i.type==="companion").length}}}const mo=new Cw,Tw=Object.freeze(Object.defineProperty({__proto__:null,PARTY_DEBUG_CONFIG:od,partyDebugger:mo},Symbol.toStringTag,{value:"Module"}));class Gl{static calculateMemoryScore(e,i){let s=0;const a=[],u=[];if(e.source==="chronicle"?(s+=30,a.push("Chronicle origin (+30)")):e.source==="manual"?(s+=20,a.push("Manually created (+20)")):(s+=10,a.push("Auto-generated (+10)")),e.pinned&&(s+=50,a.push("User pinned (+50)")),e.createdAt){const g=i.turnCount-e.createdAt,m=Math.max(0,20-g*.5);m>0&&(s+=m,a.push(`Recent creation (+${m.toFixed(1)})`))}if(e.lastAccessed){const g=i.turnCount-e.lastAccessed,m=Math.max(0,15-g*.3);m>0&&(s+=m,a.push(`Recently accessed (+${m.toFixed(1)})`))}if(e.relatedEntities&&e.relatedEntities.length>0){let g=0;e.relatedEntities.forEach(m=>{const y=i.knownEntities[m];y&&(y.type==="companion"?g+=10:y.type==="pc"||y.owner==="pc"?g+=5:y.type==="npc"&&(g+=3))}),g>0&&(s+=g,a.push(`Related entities (+${g})`))}if(e.emotionalWeight){const g=Math.abs(e.emotionalWeight)*2;s+=g,a.push(`Emotional significance (+${g})`)}if(e.category)switch(e.category){case"story":s+=15,a.push("Story category (+15)");break;case"relationship":s+=10,a.push("Relationship category (+10)");break;case"combat":s+=8,a.push("Combat category (+8)");break;case"discovery":s+=6,a.push("Discovery category (+6)");break;case"social":s+=5,a.push("Social category (+5)");break}const f=this.analyzeContentImportance(e.text);return f>0&&(s+=f,a.push(`Content keywords (+${f})`)),e.createdAt||u.push("Add creation timestamp for recency tracking"),e.category||u.push("Categorize memory for better importance scoring"),(!e.relatedEntities||e.relatedEntities.length===0)&&u.push("Link to related entities for context"),s<30&&!e.pinned&&u.push("Consider pinning if this memory is important to you"),s>80&&!e.pinned&&u.push("High-importance memory - consider auto-pinning"),{score:Math.min(100,Math.max(0,s)),reasons:a,suggestions:u}}static analyzeContentImportance(e){let i=0;const s=e.toLowerCase();return[/cht|t vong|hi sinh|thit mng/g,/ci|kt hn|nh hn/g,/chin thng|thng li|i thng/g,/thua cuc|tht bi|thm bi/g,/yu|phi lng|si m/g].forEach(p=>{const g=s.match(p);g&&(i+=g.length*10)}),[/hc c|nng cp|tin b|thng cp/g,/gp g|kt bn|ng minh|th ch/g,/nhn c|tm thy|thu thp|mua c/g,/b mt|b n|khm ph|pht hin/g].forEach(p=>{const g=s.match(p);g&&(i+=g.length*5)}),[/n|ung|ng|ngh ngi/g,/mua sm|i ch|do ph/g,/tr chuyn|ni chuyn|tm/g].forEach(p=>{const g=s.match(p);g&&(i+=g.length*1)}),Math.min(50,i)}static calculateEntityRelevance(e,i){const s=i.knownEntities[e];if(!s)return 0;let a=0;switch(s.type){case"pc":a+=50;break;case"companion":a+=40;break;case"npc":a+=20;break;case"location":a+=15;break;case"item":s.owner==="pc"?a+=25:a+=5;break;case"skill":a+=30;break;default:a+=10}if(s.lastMentioned){const u=i.turnCount-s.lastMentioned,f=Math.max(0,20-u);a+=f}return i.party&&i.party.some(u=>u.name===e)&&(a+=30),s.archived&&(a*=.3),Math.min(100,a)}static suggestCategory(e,i){const s=e.toLowerCase();return/tn cng|nh|chin u|git|chm|m|phng th|n trnh/.test(s)?"combat":/yu|ght|bn|th|ci|hn|thn thit|xa cch/.test(s)?"relationship":/tm thy|khm ph|pht hin|b mt|b n|tm kim/.test(s)?"discovery":/ni|thuyt phc|giao dch|mua|bn|gp g|tr chuyn/.test(s)?"social":/cht|ci|chin thng|tht bi|kt thc|bt u/.test(s)?"story":"general"}static analyzeEmotionalWeight(e){const i=e.toLowerCase();let s=0;return[/hnh phc|vui mng|phn khch|tuyt vi/g,/yu|phi lng|si m|am m/g,/chin thng|thnh cng|i thng/g].forEach(g=>{const m=i.match(g);m&&(s+=m.length*4)}),[/vui|thoi mi|hi lng|tt/g,/bn b|ng minh|tin tng/g].forEach(g=>{const m=i.match(g);m&&(s+=m.length*1.5)}),[/cht|t vong|thm kch|au kh/g,/ght|cm th|th ch|phn bi/g,/tht bi|thm bi|thua cuc/g].forEach(g=>{const m=i.match(g);m&&(s-=m.length*4)}),[/bun|kh chu|tht|lo lng/g,/k th|i ch|xung t/g].forEach(g=>{const m=i.match(g);m&&(s-=m.length*1.5)}),Math.max(-10,Math.min(10,s))}}class xs{static enhanceMemory(e,i){const s={...e},a=[],u=[];s.createdAt||(s.createdAt=i.turnCount,a.push("Added creation timestamp")),s.lastAccessed||(s.lastAccessed=i.turnCount,a.push("Added last accessed timestamp")),s.source||(s.source=this.detectSource(s.text),a.push(`Detected source: ${s.source}`)),s.category||(s.category=Gl.suggestCategory(s.text,s.relatedEntities),a.push(`Auto-categorized as: ${s.category}`)),(!s.relatedEntities||s.relatedEntities.length===0)&&(s.relatedEntities=this.extractRelatedEntities(s.text,i.knownEntities),s.relatedEntities.length>0&&a.push(`Found related entities: ${s.relatedEntities.join(", ")}`)),s.emotionalWeight===void 0&&(s.emotionalWeight=Gl.analyzeEmotionalWeight(s.text),s.emotionalWeight!==0&&a.push(`Emotional weight: ${s.emotionalWeight}`)),(!s.tags||s.tags.length===0)&&(s.tags=this.generateTags(s.text,s.relatedEntities||[]),s.tags.length>0&&a.push(`Generated tags: ${s.tags.join(", ")}`));const f=Gl.calculateMemoryScore(s,i);return s.importance=f.score,a.push(`Importance score: ${f.score}/100`),u.push(...f.suggestions),{enhanced:s,changes:a,suggestions:u}}static detectSource(e){return e.startsWith("")||e.includes("Bin nin s")||e.includes("Chronicle")?"chronicle":e.includes("t ng")||e.includes("h thng")||e.includes("AI generated")?"auto_generated":"manual"}static extractRelatedEntities(e,i){const s=[],a=e.toLowerCase();return Object.entries(i).forEach(([u,f])=>{if(a.includes(u.toLowerCase())){s.push(u);return}const p=this.generateNameVariations(u);for(const g of p)if(a.includes(g.toLowerCase())){s.push(u);break}if(f.skills){for(const g of f.skills)if(a.includes(g.toLowerCase())){s.push(u);break}}}),Array.from(new Set(s))}static generateNameVariations(e){const i=[],s=e.split(" ").filter(a=>a.length>1);return s.forEach(a=>{a.length>2&&i.push(a)}),s.length>1&&(i.push(s[0]),i.push(s[s.length-1]),i.push(`${s[0]} ${s[s.length-1]}`)),i}static generateTags(e,i){const s=[],a=e.toLowerCase();return[{keywords:["tn cng","nh","chin u"],tag:"combat"},{keywords:["ni","thuyt phc","tr chuyn"],tag:"dialogue"},{keywords:["mua","bn","giao dch"],tag:"trade"},{keywords:["hc","nng cp","tin b"],tag:"progression"},{keywords:["tm","khm ph","pht hin"],tag:"exploration"},{keywords:["yu","ci","hn"],tag:"romance"},{keywords:["cht","t vong","hi sinh"],tag:"death"},{keywords:["b mt","b n","n giu"],tag:"mystery"}].forEach(({keywords:f,tag:p})=>{f.some(g=>a.includes(g))&&s.push(p)}),i.forEach(f=>{s.push(`entity:${f.toLowerCase().replace(/\s+/g,"-")}`)}),(a.includes("vui")||a.includes("hnh phc"))&&s.push("positive"),(a.includes("bun")||a.includes("kh chu"))&&s.push("negative"),(a.includes("quan trng")||a.includes("c bit"))&&s.push("important"),(a.includes("m")||a.includes("ti"))&&s.push("night"),(a.includes("ngy")||a.includes("sng"))&&s.push("day"),Array.from(new Set(s)).slice(0,10)}static trackMemoryAccess(e,i){return{...e,lastAccessed:i}}static batchEnhanceMemories(e,i){return e.map(s=>this.enhanceMemory(s,i).enhanced)}static findRelatedMemories(e,i){const s=[];return e.relatedEntities?(i.forEach(u=>{u!==e&&(u.relatedEntities&&u.relatedEntities.filter(p=>e.relatedEntities.includes(p)).length>0&&s.push(u),u.tags&&e.tags&&u.tags.filter(p=>e.tags.includes(p)).length>=2&&s.push(u))}),Array.from(new Set(s)).sort((u,f)=>(f.importance||0)-(u.importance||0))):s}}const Nw=(t,e)=>{let{year:i,month:s,day:a,hour:u,minute:f}=t;return f+=e.minutes,u+=Math.floor(f/60),f=f%60,u+=e.hours,a+=Math.floor(u/24),u=u%24,a+=e.days,a>30&&(s+=Math.floor((a-1)/30),a=(a-1)%30+1),s+=e.months,s>12&&(i+=Math.floor((s-1)/12),s=(s-1)%12+1),i+=e.years,{year:i,month:s,day:a,hour:u,minute:f}},Tg=(t,e,i)=>{const s=e.type;if(!s)return[...t,{...e,owner:i}];const a=t.filter(N=>!(N.name===e.name&&N.owner===i)),u=a.filter(N=>N.owner!==i),f=a.filter(N=>N.owner===i),p=f.filter(N=>N.type===s),g=f.filter(N=>N.type!==s),m=2;let y=p;p.length>=m&&(y=p.slice(p.length-(m-1)));const v={...e,owner:i},C=[...u,...g,...y,v];return console.log(" Final result:",{totalCount:C.length,newStatusAdded:C.find(N=>N.name===e.name&&N.owner===i),allStatuses:C.map(N=>`${N.name}(${N.owner})`)}),C},gr=(t,e)=>{if(!t||t.type!=="pc"||!(e!=null&&e.realmTiers)||!t.currentExp)return t;const{realmTiers:i}=e,s=t.currentExp;let a=t.realm;for(let u=i.length-1;u>=0;u--){const f=i[u];if(s>=f.requiredExp){a=f.name;break}}return a!==t.realm?(console.log(` Realm progression: ${t.realm}  ${a} (Exp: ${s})`),{...t,realm:a}):t},kw=(t,e)=>{const i={...t};let s=[...e],a=!1;const u=(f,p,g)=>{if(!p)return p;let m=!1;const y=p.map(v=>{if(t[v])return v;const C=v.replace(/\([^)]*\)/g,"").trim(),N=Object.keys(t).find(R=>t[R].type!=="skill"?!1:R.replace(/\([^)]*\)/g,"").trim()===C&&R!==v);return N?(console.log(` Skill sync: ${g} ${f} skill "${v}"  "${N}"`),m=!0,a=!0,N):v});return m?y:p};return s=s.map(f=>{const p={...f};if(f.type==="pc"&&f.learnedSkills){const g=u(f.name,f.learnedSkills,"PC");g!==f.learnedSkills&&(p.learnedSkills=g)}if(f.type==="npc"&&f.skills){const g=u(f.name,f.skills,"NPC");g!==f.skills&&(p.skills=g)}return p}),Object.keys(i).forEach(f=>{const p=i[f];if(p.type==="npc"&&p.skills){const g=u(p.name,p.skills,"NPC");g!==p.skills&&(i[f]={...p,skills:g})}}),{updatedKnownEntities:i,updatedParty:s,changesFound:a}},Sw=t=>{const{setGameTime:e,setChronicle:i,setMemories:s,setStatuses:a,setKnownEntities:u,setQuests:f,setParty:p,setLocationDiscoveryOrder:g,knownEntities:m,statuses:y,party:v,regexRules:C,turnCount:N,worldData:R}=t;return{parseStoryAndTags:(O,J=!0)=>{if(!O)return"";const P=/\[([A-Z_]+):\s*([^\]]+)\]/g;let $=O,ne="";const z=se=>{const oe={},_=/(\w+)=("([^"]*)"|([^\s"\]]+))/g;let me;for(;(me=_.exec(se))!==null;){const Y=me[1];let ue=me[3]!==void 0?me[3]:me[4];if((Y==="isMainQuest"||Y==="equippable"||Y==="usable"||Y==="consumable"||Y==="learnable")&&typeof ue=="string")ue=ue.toLowerCase()==="true";else if(Y==="objectives"&&typeof ue=="string")ue=ue.split(";").map(H=>({description:H.trim(),completed:!1}));else if((Y==="quantities"||Y==="uses"||Y==="durability"||Y==="damage"||Y==="repairedAmount"||Y==="years"||Y==="months"||Y==="days"||Y==="hours"||Y==="minutes"||Y==="currentExp")&&typeof ue=="string"&&!isNaN(Number(ue))){oe[Y]=Number(ue);continue}oe[Y]=ue}return oe};let ae;const de=[];for(;(ae=P.exec(O))!==null;)if($=$.replace(ae[0],""),J){const se=ae[1],oe=ae[2],_=z(oe);if(Object.keys(_).length===0){de.push(ae[0]);continue}switch(se){case"TIME_ELAPSED":const me={years:Number(_.years)||0,months:Number(_.months)||0,days:Number(_.days)||0,hours:Number(_.hours)||0,minutes:Number(_.minutes)||0};e(H=>Nw(H,me));break;case"CHRONICLE_TURN":_.text&&(i(H=>({...H,turn:[...H.turn,_.text]})),ne+=(ne?`

`:"")+_.text,s(H=>{const S={text:Mr.processText(_.text,Pe.MEMORY_PROCESSING,C||[],{depth:N||0,isEdit:!1}),pinned:!1,source:"chronicle",createdAt:N,lastAccessed:N},V={knownEntities:m,turnCount:N||0,statuses:y,party:v,quests:[],gameHistory:[],memories:H,customRules:[],systemInstruction:"",totalTokens:0,gameTime:{},chronicle:{},compressedHistory:[],worldData:{}},W=xs.enhanceMemory(S,V);return[...H,W.enhanced]}));break;case"CHRONICLE_CHAPTER":_.text&&i(H=>({...H,chapter:[...H.chapter,_.text]}));break;case"CHRONICLE_MEMOIR":_.text&&i(H=>({...H,memoir:[...H.memoir,_.text]}));break;case"STATUS_APPLIED_SELF":a(H=>{const k=Tg(H,_,"pc");return N&&!H.some(S=>S.name===_.name&&S.owner==="pc")&&mo.log("STATUS_CHANGE",` Status applied to PC: ${_.name}`,{memberName:"pc",memberType:"pc",status:{name:_.name,type:_.type,description:_.description,duration:_.duration,source:_.source},action:"APPLIED"},N),k});break;case"STATUS_APPLIED_NPC":a(H=>{const k=Tg(H,_,_.npcName);return N&&!H.some(S=>S.name===_.name&&S.owner===_.npcName)&&mo.log("STATUS_CHANGE",` Status applied to ${_.npcName}: ${_.name}`,{memberName:_.npcName,memberType:"npc",status:{name:_.name,type:_.type,description:_.description,duration:_.duration,source:_.source},action:"APPLIED"},N),k});break;case"STATUS_CURED_SELF":a(H=>H.filter(k=>!(k.name===_.name&&k.owner==="pc")));break;case"STATUS_CURED_NPC":a(H=>H.filter(k=>!(k.name===_.name&&k.owner===_.npcName)));break;case"LORE_SKILL":u(H=>{const{name:k,description:S,...V}=_;if(k&&S){const W={type:"skill",name:k,description:S,referenceId:sn.generateReferenceId(k,"skill"),...V};return console.log(` Generated reference ID for skill ${k}: ${W.referenceId}`),{...H,[k]:W}}return H});break;case"SKILL_LEARNED":u(H=>{const k={...H},{name:S,description:V,learner:W,target:I,...j}=_;if(S&&V){const F={type:"skill",name:S,description:V,referenceId:sn.generateReferenceId(S,"skill"),...j};console.log(` Generated reference ID for learned skill ${S}: ${F.referenceId}`),k[S]=F;const Z=S.replace(/\([^)]*\)/g,"").trim(),A=Object.keys(k).find(M=>k[M].type!=="skill"||M===S?!1:M.replace(/\([^)]*\)/g,"").trim()===Z);A&&A!==S&&(console.log(` Detected skill upgrade: ${A}  ${S}`),p(M=>M.map(D=>{const B={...D};if(D.type==="pc"&&D.learnedSkills){const X=D.learnedSkills.indexOf(A);X!==-1&&(B.learnedSkills=[...D.learnedSkills],B.learnedSkills[X]=S,console.log(` Upgraded PC skill: ${A}  ${S}`))}if((D.type==="npc"||D.type==="companion")&&D.skills){const X=D.skills.indexOf(A);X!==-1&&(B.skills=[...D.skills],B.skills[X]=S,console.log(` Upgraded ${D.type.toUpperCase()} ${D.name} skill: ${A}  ${S}`))}return B})),Object.keys(k).forEach(M=>{const D=k[M];(D.type==="npc"||D.type==="companion")&&D.skills&&D.skills.indexOf(A)!==-1&&(k[M]={...D,skills:D.skills.map(X=>X===A?S:X)},console.log(` Upgraded ${D.type.toUpperCase()} ${D.name} skill in knownEntities: ${A}  ${S}`))}),delete k[A],console.log(` Removed old skill entity: ${A}`));const G=W||I;if(G){let M=!1;const D=k[G];if(D&&(D.type==="npc"||D.type==="companion")){const B={...D};B.skills||(B.skills=[]),B.skills.includes(S)||(B.skills.push(S),console.log(` ${D.type.toUpperCase()} ${G} learned skill: ${S}`)),k[G]=B,M=!0}if(p(B=>{const X=B.find(xe=>xe.name===G);return X&&(X.type==="companion"||X.type==="npc")?(M=!0,B.map(xe=>{if(xe.name===G){const Ne={...xe};return Ne.skills||(Ne.skills=[]),Ne.skills.includes(S)||(Ne.skills.push(S),console.log(` Party ${xe.type.toUpperCase()} ${G} learned skill: ${S}`)),Ne}return xe})):B}),!M){const B=Object.values(k).find(X=>X.type==="pc");if(B&&(B.name===G||G.toLowerCase()==="pc")){const X={...k[B.name]};X.learnedSkills||(X.learnedSkills=[]),X.learnedSkills.includes(S)||(X.learnedSkills.push(S),console.log(` PC ${B.name} learned skill: ${S}`)),k[B.name]=X,M=!0}}if(!M){console.warn(` SKILL_LEARNED: Could not find learner "${G}" in knownEntities or party. Defaulting to PC.`);const B=Object.values(k).find(X=>X.type==="pc");if(B){const X={...k[B.name]};X.learnedSkills||(X.learnedSkills=[]),X.learnedSkills.includes(S)||(X.learnedSkills.push(S),console.log(` PC ${B.name} learned skill: ${S} (fallback)`)),k[B.name]=X}}}else{console.warn(` SKILL_LEARNED without learner parameter: ${S}. Attempting intelligent detection...`);const M=`${S} ${V}`.toLowerCase();let D=null;const B=Object.values(k).filter(X=>X.type==="npc"||X.type==="companion");for(const X of B){const xe=X.name.toLowerCase();if(M.includes(xe)){D=X.name,console.log(` Intelligent detection: Skill "${S}" likely belongs to NPC "${X.name}" based on name in context`);break}}if(!D&&S.toLowerCase().includes("haki")){for(const X of B)if(X.skills&&Array.isArray(X.skills)&&X.skills.some(Ne=>Ne.toLowerCase().includes("haki"))){D=X.name,console.log(` Intelligent detection: Skill "${S}" likely belongs to NPC "${X.name}" based on related Haki skills`);break}}if(D){const X=k[D];if(X&&(X.type==="npc"||X.type==="companion")){const xe={...X};xe.skills||(xe.skills=[]),xe.skills.includes(S)||(xe.skills.push(S),console.log(` NPC ${D} learned skill: ${S} (intelligent detection)`)),k[D]=xe}}else{const X=Object.values(k).find(xe=>xe.type==="pc");if(X){const xe=X.name,Ne={...k[xe]};Ne.learnedSkills||(Ne.learnedSkills=[]),Ne.learnedSkills.includes(S)||(Ne.learnedSkills.push(S),console.log(` PC ${X.name} learned skill: ${S} (default target - no NPC detected)`)),k[xe]=Ne}}}}return k});break;case"SKILL_UPDATE":u(H=>{const{oldSkill:k,newSkill:S,target:V,description:W,...I}=_;if(!k||!S)return console.error(" SKILL_UPDATE: oldSkill and newSkill are required"),H;if(k===S)return console.warn(" SKILL_UPDATE: oldSkill and newSkill are the same, skipping"),H;const j={...H};if(W){const A={type:"skill",name:S,description:W,referenceId:sn.generateReferenceId(S,"skill"),...I};console.log(` Generated reference ID for updated skill ${S}: ${A.referenceId}`),j[S]=A}const F=k.includes("C Bn")&&S.includes("S Cp")||k.includes("S Cp")&&S.includes("Trung Cp")||k.includes("Trung Cp")&&S.includes("Cao Cp")||k.includes("Cao Cp")&&S.includes("i Thnh")||k.includes("i Thnh")&&S.includes("Vin Mn")?" Mastery":" Evolved";let Z=0;if(V){const A=Object.values(j).find(G=>G.type==="pc"&&(G.name===V||V.toLowerCase()==="pc"));if(A&&A.learnedSkills){const G=A.learnedSkills.indexOf(k);if(G!==-1){const M={...A};M.learnedSkills=[...A.learnedSkills],M.learnedSkills[G]=S,j[A.name]=M,console.log(`${F} PC ${A.name} skill: ${k}  ${S}`),Z++}}if(j[V]&&(j[V].type==="npc"||j[V].type==="companion")){const G=j[V];G.skills&&G.skills.indexOf(k)!==-1&&(j[V]={...G,skills:G.skills.map(D=>D===k?S:D)},console.log(`${F} ${G.type.toUpperCase()} ${V} skill: ${k}  ${S}`),Z++)}p(G=>G.map(M=>{if(M.name===V){const D={...M};let B=!1;if(M.type==="pc"&&M.learnedSkills){const X=M.learnedSkills.indexOf(k);X!==-1&&(D.learnedSkills=[...M.learnedSkills],D.learnedSkills[X]=S,B=!0)}if((M.type==="npc"||M.type==="companion")&&M.skills){const X=M.skills.indexOf(k);X!==-1&&(D.skills=[...M.skills],D.skills[X]=S,B=!0)}return B&&!Z&&(console.log(`${F} Party ${M.type.toUpperCase()} ${V} skill: ${k}  ${S}`),Z++),D}return M}))}else{console.log(` SKILL_UPDATE: No target specified, updating all characters with skill "${k}"`);const A=Object.values(j).find(G=>G.type==="pc");if(A&&A.learnedSkills){const G=A.learnedSkills.indexOf(k);if(G!==-1){const M={...A};M.learnedSkills=[...A.learnedSkills],M.learnedSkills[G]=S,j[A.name]=M,console.log(`${F} PC ${A.name} skill: ${k}  ${S}`),Z++}}Object.keys(j).forEach(G=>{const M=j[G];(M.type==="npc"||M.type==="companion")&&M.skills&&M.skills.indexOf(k)!==-1&&(j[G]={...M,skills:M.skills.map(B=>B===k?S:B)},console.log(`${F} ${M.type.toUpperCase()} ${M.name} skill: ${k}  ${S}`),Z++)}),p(G=>G.map(M=>{const D={...M};let B=!1;if(M.type==="pc"&&M.learnedSkills){const X=M.learnedSkills.indexOf(k);X!==-1&&(D.learnedSkills=[...M.learnedSkills],D.learnedSkills[X]=S,B=!0)}if((M.type==="npc"||M.type==="companion")&&M.skills){const X=M.skills.indexOf(k);X!==-1&&(D.skills=[...M.skills],D.skills[X]=S,B=!0)}return B&&(console.log(`${F} Party ${M.type.toUpperCase()} ${M.name} skill: ${k}  ${S}`),Z++),D}))}return j[k]&&Z>0&&(delete j[k],console.log(` Removed old skill entity: ${k}`)),Z>0?console.log(` SKILL_UPDATE completed: ${Z} character(s) updated with ${k}  ${S}`):console.warn(` SKILL_UPDATE: No characters found with skill "${k}" to update`),j});break;case"LORE_PC":u(H=>{const k={..._};typeof k.learnedSkills=="string"&&(k.learnedSkills=k.learnedSkills.split(",").map(V=>V.trim()).filter(Boolean));const S=Object.values(H).find(V=>V.type==="pc");if(S){const V={};Object.keys(k).forEach(j=>{if(k[j]!==void 0&&k[j]!==null&&k[j]!==""){if(j==="motivation"&&S.motivation){const F=S.motivation.toLowerCase().trim(),Z=k[j].toLowerCase().trim(),A=F.replace(/[^\w\s]/g,"").split(/\s+/).sort(),G=Z.replace(/[^\w\s]/g,"").split(/\s+/).sort(),M=A.filter(D=>G.includes(D)).length/Math.max(A.length,G.length);if(M>.7){console.log(` MOTIVATION: Keeping user version (${Math.round(M*100)}% similar to AI version)`);return}else{console.log(` MOTIVATION: AI version differs significantly (${Math.round(M*100)}% similar), using AI version: "${k[j]}"`),V[j]=k[j];return}}if(j==="learnedSkills"&&S.learnedSkills&&S.learnedSkills.length>0){const F=S.learnedSkills,Z=Array.isArray(k[j])?k[j]:[],A=["cha c","chua co","none","n/a","khng c","khong co","","null","undefined"],G=Z.filter(xe=>{const Ne=xe.toString().toLowerCase().trim();return Ne&&!A.includes(Ne)}),M=[...F],D=[],B=[];G.forEach(xe=>{const Ne=xe.toLowerCase();let Te=!1;for(const Ee of F){const Re=Ee.toLowerCase(),ye=Ce=>Ce.replace(/\s+/g," ").trim(),we=ye(Ne).replace(/\s*\([^)]*\)\s*/g,"").replace(/\s*(vin mn|i thnh|ti cao|cao cp|nng cao|trung cp|s cp|c bn|cp  \d+)\s*/g,"").replace(/\s*(:\s*[^,]*)/g,"").trim(),Se=ye(Re).replace(/\s*\([^)]*\)\s*/g,"").replace(/\s*(vin mn|i thnh|ti cao|cao cp|nng cao|trung cp|s cp|c bn|cp  \d+)\s*/g,"").replace(/\s*(:\s*[^,]*)/g,"").trim();if(we===Se){Te=!0;const Ce=Fe=>{const Q=Fe.toLowerCase();return Q.includes("(vin mn)")||Q.includes("vin mn")?5:Q.includes("(i thnh)")||Q.includes("i thnh")?4:Q.includes("(cao cp)")||Q.includes("cao cp")||Q.includes("nng cao")?3:Q.includes("(trung cp)")||Q.includes("trung cp")?2:Q.includes("(s cp)")||Q.includes("s cp")||Q.includes("c bn")?1:Q.includes("ti cao")?4:0},_e=Ce(Ne),gt=Ce(Re);if(console.log(` Skill comparison: "${Ee}" (level ${gt}) vs "${xe}" (level ${_e})`),console.log(` Base skills: "${Se}" vs "${we}"`),_e>gt){const Fe=M.indexOf(Ee);Fe!==-1&&(M[Fe]=xe,B.push(`${Ee}  ${xe}`),console.log(` Upgraded: ${Ee}  ${xe}`))}else _e<gt?console.log(` Rejected lower level: ${xe} (existing: ${Ee})`):_e===gt?M.some(Q=>Q.toLowerCase().trim()===xe.toLowerCase().trim())?console.log(` Duplicate skill (case-insensitive): ${xe}`):(M.push(xe),D.push(xe),console.log(` Added same level specialization: ${xe}`)):console.log(` Skill already exists: ${xe}`);break}}Te||(M.some(Re=>Re.toLowerCase().trim()===xe.toLowerCase().trim())?console.log(` Skill already exists (case-insensitive): ${xe}`):(M.push(xe),D.push(xe),console.log(` Added new skill: ${xe}`)))}),V[j]=M;let X=` SKILL MERGE: Starting skills [${F.join(", ")}]`;D.length>0&&(X+=` + Added [${D.join(", ")}]`),B.length>0&&(X+=` + Upgraded [${B.join(", ")}]`),X+=` = [${M.join(", ")}]`,console.log(X);return}V[j]=k[j]}});const W={...S,...V,type:"pc",name:k.name||S.name,referenceId:S.referenceId||sn.generateReferenceId(k.name||S.name,"pc")};console.log(` Updated existing PC ${W.name}, preserved motivation: ${W.motivation}`),console.log(" Applied attributes:",Object.keys(V)),console.log(" Existing motivation was:",S.motivation),console.log(" Final motivation is:",W.motivation);const I={...H};return S.name!==W.name&&delete I[S.name],I[W.name]=W,I}else{const V={type:"pc",referenceId:sn.generateReferenceId(_.name,"pc"),...k};return console.log(` Created new PC ${V.name}: ${V.referenceId}`),{...H,[_.name]:V}}});break;case"LORE_NPC":u(H=>{const k={..._};typeof k.skills=="string"&&(k.skills=k.skills.split(",").map(V=>V.trim()).filter(Boolean));const S={type:"npc",referenceId:sn.generateReferenceId(_.name,"npc"),...k};return console.log(` Generated reference ID for NPC ${_.name}: ${S.referenceId}`),{...H,[_.name]:S}});break;case"LORE_ITEM":u(H=>{const k={type:"item",referenceId:sn.generateReferenceId(_.name,"item"),..._};return console.log(` Generated reference ID for item ${_.name}: ${k.referenceId}`),{...H,[_.name]:k}});break;case"LORE_LOCATION":u(H=>{const k={type:"location",referenceId:sn.generateReferenceId(_.name,"location"),..._};console.log(` Generated reference ID for location ${_.name}: ${k.referenceId}`);const S={...H,[_.name]:k};return g(V=>V.includes(_.name)?V:[...V,_.name]),S});break;case"LORE_FACTION":u(H=>{const k={type:"faction",referenceId:sn.generateReferenceId(_.name,"faction"),..._};return console.log(` Generated reference ID for faction ${_.name}: ${k.referenceId}`),{...H,[_.name]:k}});break;case"LORE_CONCEPT":u(H=>{const k={type:"concept",referenceId:sn.generateReferenceId(_.name,"concept"),..._};return console.log(` Generated reference ID for concept ${_.name}: ${k.referenceId}`),{...H,[_.name]:k}});break;case"ENTITY_UPDATE":u(H=>{const k={...H},S=_.name;if(k[S]){const{name:V,newDescription:W,...I}=_,j={...I};W&&(j.description=W);let F;if(_.newName&&_.newName!==S){const Z=k[S];delete k[S],F={...Z,...j,name:_.newName},j.currentExp!==void 0&&(F=gr(F,R)),k[_.newName]=F,Z.type==="skill"&&(p(A=>A.map(G=>{const M={...G};if(G.type==="pc"&&G.learnedSkills){const D=G.learnedSkills.indexOf(S);D!==-1&&(M.learnedSkills=[...G.learnedSkills],M.learnedSkills[D]=_.newName,console.log(` Updated PC skill name: ${S}  ${_.newName}`))}if(G.type==="npc"&&G.skills){const D=G.skills.indexOf(S);D!==-1&&(M.skills=[...G.skills],M.skills[D]=_.newName,console.log(` Updated NPC ${G.name} skill name: ${S}  ${_.newName}`))}return M})),Object.keys(k).forEach(A=>{const G=k[A];G.type==="npc"&&G.skills&&G.skills.indexOf(S)!==-1&&(k[A]={...G,skills:G.skills.map(D=>D===S?_.newName:D)},console.log(` Updated NPC ${G.name} skill name in knownEntities: ${S}  ${_.newName}`))}))}else F={...k[S],...j},j.currentExp!==void 0&&(F=gr(F,R)),k[S]=F}return k});break;case"ITEM_AQUIRED":u(H=>{const k=H[_.name];if(k&&k.type==="item"&&k.owner==="pc"){const S=_.quantities||1,V=k.quantities||k.uses||1,W=V+S,I={...k,..._,name:_.name,quantities:k.quantities?W:void 0,uses:k.uses?W:void 0};return!k.quantities&&!k.uses&&(I.quantities=W),console.log(` Stacked item: ${_.name} (${V} + ${S} = ${W})`),{...H,[_.name]:I}}else{const S={type:"item",owner:"pc",referenceId:sn.generateReferenceId(_.name,"item"),..._};return console.log(` Generated reference ID for acquired item ${_.name}: ${S.referenceId}`),{...H,[_.name]:S}}});break;case"ITEM_CONSUMED":u(H=>{const k={...H},S=k[_.name];if(S&&S.type==="item"&&S.owner==="pc"){const V=S.quantities||S.uses,W=_.quantity||_.quantities||1;if(typeof V!="number"||V===void 0||V===null)delete k[_.name],console.log(` Single-use item consumed: ${_.name} - removed from inventory (no quantity/uses defined)`);else if(V>W){const I=V-W;I>0?(S.quantities?k[_.name]={...S,quantities:I}:S.uses&&(k[_.name]={...S,uses:I}),console.log(` Item consumed: ${_.name} - consumed ${W}, now has ${I} remaining`)):(delete k[_.name],console.log(` Item completely consumed: ${_.name} - consumed ${W}, removed from inventory (reached 0)`))}else delete k[_.name],console.log(` Item completely consumed: ${_.name} - consumed ${W}, removed from inventory (quantity ${V} <= consume ${W})`)}return k});break;case"ITEM_EQUIPPED":u(H=>{const k={...H},S=k[_.name];return S&&S.owner==="pc"&&S.equippable&&(S.equipped=!0),k});break;case"ITEM_UNEQUIPPED":u(H=>{const k={...H},S=k[_.name];return S&&S.owner==="pc"&&(S.equipped=!1),k});break;case"ITEM_TRANSFORMED":u(H=>{const{oldName:k,newName:S,description:V,...W}=_;if(!k||!S)return H;const I={...H},j=I[k];j&&delete I[k];const F={...W,name:S,type:"item",owner:(j==null?void 0:j.owner)||"pc",description:V||`Vt phm c bin i t ${k}.`};return I[S]=F,I});break;case"ITEM_UPDATED":u(H=>{const k={...H};return k[_.name]&&k[_.name].owner==="pc"&&(k[_.name]={...k[_.name],..._}),k});break;case"ITEM_DAMAGED":u(H=>{const k={...H},S=k[_.name];return S&&typeof S.durability=="number"&&(S.durability=Math.max(0,S.durability-(_.damage||0))),k});break;case"ITEM_REPAIRED":u(H=>{const k={...H},S=k[_.name];return S&&typeof S.durability=="number"&&(S.durability=Math.min(100,S.durability+(_.repairedAmount||0))),k});break;case"ITEM_DISCARDED":case"ITEM_LOST":u(H=>{const k={...H},S=k[_.name];return S&&S.owner==="pc"&&(delete k[_.name],console.log(` Item discarded: ${_.name} has been removed from inventory`)),k});break;case"REALM_UPDATE":u(H=>{const k={...H},S=Object.values(k).find(V=>V.name===_.target);return S&&(k[S.name].realm=_.realm),k});break;case"COMPANION":const Y={type:"companion",referenceId:sn.generateReferenceId(_.name,"companion"),..._};Y.name&&Y.description&&(console.log(` Generated reference ID for companion ${Y.name}: ${Y.referenceId}`),Y.skills&&typeof Y.skills=="string"&&(Y.skills=Y.skills.split(",").map(H=>H.trim())),Y.relationship||(Y.relationship="ng hnh"),p(H=>{const k=[...H.filter(S=>S.name!==Y.name),Y];return N&&!H.some(S=>S.name===Y.name)&&mo.log("COMPANION_JOIN",` New companion joined: ${Y.name}`,{companion:{name:Y.name,type:Y.type,relationship:Y.relationship,skills:Y.skills,realm:Y.realm,personality:Y.personality},partySize:k.length},N),k}),u(H=>({...H,[Y.name]:Y})));break;case"RELATIONSHIP_CHANGED":u(H=>{const k={...H};if(k[_.npcName]){const S=k[_.npcName].relationship;k[_.npcName].relationship=_.relationship,N&&S!==_.relationship&&mo.log("RELATIONSHIP_CHANGE",` Relationship changed: ${_.npcName}`,{name:_.npcName,previousRelationship:S||"Unknown",newRelationship:_.relationship||"Unknown",change:S&&_.relationship&&(_.relationship.includes("yu")||_.relationship.includes("thn"))?"IMPROVED":"CHANGED"},N)}return k});break;case"QUEST_ASSIGNED":const ue={title:_.title,description:_.description,objectives:_.objectives||[],giver:_.giver,reward:_.reward,isMainQuest:_.isMainQuest||!1,status:"active"};f(H=>[...H.filter(k=>k.title!==ue.title),ue]);break;case"QUEST_UPDATED":f(H=>H.map(S=>{if(S.title===_.title){const V={...S,status:_.status};if(_.status==="completed"&&S.reward){const W=S.reward.match(/(\d+)\s*(?:exp|kinh nghim|experience)/i);if(W){const I=parseInt(W[1]);console.log(` Quest completed: ${S.title} - Awarding ${I} experience`),u(j=>{const F={...j},Z=Object.values(F).find(A=>A.type==="pc");if(Z){const A=Z.currentExp||0,G=A+I,M={...Z,currentExp:G},D=gr(M,R);F[Z.name]=D,console.log(` Experience awarded: ${Z.name} gained ${I} exp (${A}  ${G})`)}return F})}}return V}return S}));break;case"QUEST_OBJECTIVE_COMPLETED":f(H=>H.map(k=>{if(k.title===_.questTitle){const S=k.objectives.map(I=>I.description===_.objectiveDescription?{...I,completed:!0}:I),V=S.every(I=>I.completed),W={...k,objectives:S,status:V?"completed":k.status};if(V&&k.reward){const I=k.reward.match(/(\d+)\s*(?:exp|kinh nghim|experience)/i);if(I){const j=parseInt(I[1]);console.log(` Quest completed: ${k.title} - Awarding ${j} experience`),u(F=>{const Z={...F},A=Object.values(Z).find(G=>G.type==="pc");if(A){const G=A.currentExp||0,M=G+j,D={...A,currentExp:M},B=gr(D,R);Z[A.name]=B,console.log(` Experience awarded: ${A.name} gained ${j} exp (${G}  ${M})`)}return Z})}}return W}return k}));break;default:se!=="DEFINE_REALM_SYSTEM"&&de.push(ae[0])}}let re=$.trim();return ne&&J&&(re+=(re?`

`:"")+ne),de.length>0&&J&&console.warn("Unprocessed Tags:",de),re},synchronizeSkillNames:()=>kw(m,v)}},Cd=class Cd{static manageHistory(e,i,s=this.DEFAULT_CONFIG){const a=e.length;if(a<=s.compressionThreshold){const y=new Date().toLocaleTimeString();return console.log(` [${y}] History Check:`,{turnNumber:i,currentEntries:a,threshold:s.compressionThreshold,compressionNeeded:!1,message:`${a}/${s.compressionThreshold} entries - no compression needed`}),{activeHistory:e,shouldCompress:!1,stats:{originalSize:a,newSize:a,savedEntries:0}}}const u=s.maxActiveEntries,f=e.slice(-u),p=e.slice(0,-u),g=this.compressHistorySegment(p,i,s),m=new Date().toLocaleTimeString();return console.log(` [${m}] History Compression:`,{turnNumber:i,originalEntries:a,entriesToCompress:p.length,keptActive:f.length,threshold:s.compressionThreshold,maxActive:s.maxActiveEntries,compressionTriggered:!0}),{activeHistory:f,compressedSegment:g,shouldCompress:!0,stats:{originalSize:a,newSize:f.length,savedEntries:p.length}}}static compressHistorySegment(e,i,s){const a=[],u=[],f=Math.floor(e.length/2),p=Math.max(1,i-f-Math.floor(s.maxActiveEntries/2)),g=i-Math.floor(s.maxActiveEntries/2);e.forEach((v,C)=>{if(v.role==="user"){const N=v.parts[0].text.match(/--- HNH NG CA NGI CHI ---\n"([^"]+)"/);if(N&&N[1]!=="SYSTEM_RULE_UPDATE"){const R=N[1];this.isImportantAction(R)&&a.push(this.summarizeAction(R))}}else if(v.role==="model")try{const N=JSON.parse(v.parts[0].text);if(N.story){const R=this.extractImportantEvents(N.story);u.push(...R)}}catch{}});const m=this.createSummary(a,u,p,g,s.summaryLength),y=this.estimateTokens(m+a.join(" ")+u.join(" "));return console.log(" Compressed Segment Created:",{turnRange:`${p}-${g}`,entriesCompressed:e.length,keyActionsFound:a.length,importantEventsFound:u.length,summaryLength:m.length,estimatedTokens:y}),{turnRange:`${p}-${g}`,summary:m,keyActions:a.slice(0,10),importantEvents:u.slice(0,10),tokenCount:y,compressedAt:i}}static isImportantAction(e){return["tn cng","nh","chin u","git","chm","m","ni vi","hi","thuyt phc","giao dch","mua","bn","i n","di chuyn","ri khi","v","s dng","hc","trang b","ly","cng bc","s m","bp vo","quyt nh","chn","tm kim","khm ph"].some(s=>e.toLowerCase().includes(s))}static summarizeAction(e){return e.length>50?e.substring(0,47)+"...":e}static extractImportantEvents(e){const i=[];return[/nhn c ([^.!?]+)/gi,/tm thy ([^.!?]+)/gi,/thu thp ([^.!?]+)/gi,/(nh bi|chin thng|thua|cht) ([^.!?]+)/gi,/hc c ([^.!?]+)/gi,/nng cp ([^.!?]+)/gi,/pht hin ([^.!?]+)/gi,/gp ([^.!?]+)/gi,/(b|c) ([^.!?]+)/gi].forEach(a=>{const u=e.match(a);u&&u.forEach(f=>{f.length<100&&i.push(f.trim())})}),i.slice(0,5)}static createSummary(e,i,s,a,u){let f=`Lt ${s}-${a}: `;return e.length>0&&(f+=`${e.length} hnh ng quan trng`),i.length>0&&(e.length>0&&(f+=", "),f+=`${i.length} s kin ng ch `),e.length===0&&i.length===0&&(f+="cc hot ng thng ngy"),f+=".",f.length>u&&(f=f.substring(0,u-3)+"..."),f}static estimateTokens(e){return Math.ceil(e.length*.8)}static getHistoryStats(e,i){const s=e.length,a=i.length,u=s+i.reduce((g,m)=>g+(parseInt(m.turnRange.split("-")[1])-parseInt(m.turnRange.split("-")[0])+1)*2,0),f=i.reduce((g,m)=>{const y=(parseInt(m.turnRange.split("-")[1])-parseInt(m.turnRange.split("-")[0])+1)*2*500;return g+(y-m.tokenCount)},0),p=u>0?(s+i.reduce((g,m)=>g+m.tokenCount/500,0))/u:1;return{activeEntries:s,compressedSegments:a,totalOriginalEntries:u,compressionRatio:p,estimatedTokenSaved:f}}};Cd.DEFAULT_CONFIG={maxActiveEntries:20,compressionThreshold:30,summaryLength:200};let ld=Cd;const Td=class Td{static generateMemoriesFromHistory(e,i=this.DEFAULT_CONFIG){const s=new Date().toLocaleTimeString();console.log(` [${s}] Smart Memory Generation Started:`,{turnNumber:e.turnCount,historyEntries:e.gameHistory.length,existingMemories:e.memories.length,config:i});const a=[],u=[],f=new Set,p=this.getRecentEntries(e.gameHistory,i.lookbackTurns);let g=0;for(const C of p)if(C.role==="model"&&a.length<i.maxMemoriesPerTurn)try{const N=JSON.parse(C.parts[0].text);if(N.story){g++;const L=this.analyzeStoryForMemories(N.story,e,i).filter(O=>(O.importance||0)>=i.minImportanceThreshold&&!this.isDuplicateMemory(O,[...e.memories,...a]));a.push(...L),L.forEach(O=>{O.category&&f.add(O.category)})}}catch{}if(i.enableRelationshipMemories){const N=this.generateRelationshipMemories(e,i).filter(R=>!this.isDuplicateMemory(R,[...e.memories,...a]));a.push(...N),N.forEach(R=>{R.category&&f.add(R.category)})}if(i.enableAchievementMemories){const N=this.generateAchievementMemories(e,i).filter(R=>!this.isDuplicateMemory(R,[...e.memories,...a]));a.push(...N),N.forEach(R=>{R.category&&f.add(R.category)})}const y=this.deduplicateMemories(a).sort((C,N)=>(N.importance||0)-(C.importance||0)).slice(0,i.maxMemoriesPerTurn),v=y.filter(C=>(C.importance||0)>=70).length;return y.length>0&&(u.push(`Generated ${y.length} smart memories from recent events`),v>0&&u.push(`${v} high-importance memories created`),f.size>0&&u.push(`Covered categories: ${Array.from(f).join(", ")}`)),console.log(` [${s}] Smart Memory Generation Completed:`,{eventsAnalyzed:g,memoriesGenerated:y.length,highImportanceCount:v,categoriesCovered:Array.from(f)}),{memories:y,insights:u,stats:{eventsAnalyzed:g,memoriesGenerated:y.length,highImportanceCount:v,categoriesCovered:Array.from(f)}}}static isDuplicateMemory(e,i){const s=this.normalizeMemoryText(e.text),a=this.extractKeywords(s);return i.some(u=>{const f=this.normalizeMemoryText(u.text);if(s===f)return!0;const p=this.extractKeywords(f),g=this.calculateTextSimilarity(a,p);if(g>.8)return!0;if(e.category===u.category){const m=this.hasSignificantOverlap(e.relatedEntities||[],u.relatedEntities||[]),y=this.hasSignificantOverlap(e.tags||[],u.tags||[]);if(m&&y&&g>.6)return!0}return!1})}static deduplicateMemories(e){const i=[];for(const s of e)this.isDuplicateMemory(s,i)||i.push(s);return i}static normalizeMemoryText(e){return e.toLowerCase().replace(/[.,!?;:]/g,"").replace(/\s+/g," ").trim()}static extractKeywords(e){const i=["v","vi","ca","trong","","cho","t","c","l","c","mt","ny",""];return e.split(" ").filter(s=>s.length>2&&!i.includes(s)).map(s=>s.toLowerCase())}static calculateTextSimilarity(e,i){if(e.length===0&&i.length===0)return 1;if(e.length===0||i.length===0)return 0;const s=new Set(e),a=new Set(i),u=new Set([...s].filter(p=>a.has(p))),f=new Set([...s,...a]);return u.size/f.size}static hasSignificantOverlap(e,i){if(e.length===0&&i.length===0)return!0;if(e.length===0||i.length===0)return!1;const s=new Set(e.map(p=>p.toLowerCase())),a=new Set(i.map(p=>p.toLowerCase())),u=new Set([...s].filter(p=>a.has(p))),f=Math.min(s.size,a.size);return u.size/f>=.5}static analyzeStoryForMemories(e,i,s){const a=[],u=[{pattern:/(khm ph|tm thy|pht hin) ([^.!?]+)/gi,category:"discovery",importance:60,enabled:s.enableDiscoveryMemories},{pattern:/(chin u|tn cng|nh bi|chin thng|tht bi) ([^.!?]+)/gi,category:"combat",importance:65,enabled:s.enableCombatMemories},{pattern:/(gp g|ni chuyn|thuyt phc|giao dch) ([^.!?]+)/gi,category:"social",importance:55,enabled:s.enableRelationshipMemories},{pattern:/(nhn c|thu thp|hc c) ([^.!?]+)/gi,category:"general",importance:50,enabled:s.enableEventMemories},{pattern:/(hon thnh|t c|thnh cng) ([^.!?]+)/gi,category:"story",importance:70,enabled:s.enableAchievementMemories}];for(const f of u){if(!f.enabled)continue;const p=e.match(f.pattern);if(p)for(const g of p){const m=this.createMemoryFromEvent(g,e);if(m.length>10&&m.length<300){const y={text:m,pinned:!1,source:"auto_generated",category:f.category,createdAt:i.turnCount,lastAccessed:i.turnCount,importance:f.importance,tags:this.extractTags(m,i)},v=xs.enhanceMemory(y,i);a.push(v.enhanced)}}}return a}static generateRelationshipMemories(e,i){var a;const s=[];return(a=e.party)==null||a.forEach(u=>{if(u.relationship&&u.name){const p={text:`Mi quan h vi ${u.name}: ${u.relationship}`,pinned:!1,source:"auto_generated",category:"relationship",createdAt:e.turnCount,lastAccessed:e.turnCount,importance:60,relatedEntities:[u.name],tags:["relationship","party",u.name.toLowerCase()]},g=xs.enhanceMemory(p,e);s.push(g.enhanced)}}),s}static generateAchievementMemories(e,i){var f;const s=[];return(((f=e.quests)==null?void 0:f.filter(p=>p.status==="completed"))||[]).forEach(p=>{const m={text:`Hon thnh nhim v: ${p.title}`,pinned:!1,source:"auto_generated",category:"story",createdAt:e.turnCount,lastAccessed:e.turnCount,importance:p.isMainQuest?80:60,relatedEntities:p.giver?[p.giver]:[],tags:["achievement","quest",p.isMainQuest?"main_quest":"side_quest"]},y=xs.enhanceMemory(m,e);s.push(y.enhanced)}),Object.values(e.knownEntities).filter(p=>p.type==="location"&&(!p.discoveredAt||e.turnCount-p.discoveredAt<=i.lookbackTurns)).forEach(p=>{if(p.name&&p.description){const m={text:`Khm ph ${p.type==="location"?"a im":"thc th"} mi: ${p.name}`,pinned:!1,source:"auto_generated",category:"discovery",createdAt:e.turnCount,lastAccessed:e.turnCount,importance:55,relatedEntities:[p.name],tags:["discovery",p.type,p.name.toLowerCase()]},y=xs.enhanceMemory(m,e);s.push(y.enhanced)}}),s}static getRecentEntries(e,i){const s=Math.min(i*2,e.length);return e.slice(-s)}static createMemoryFromEvent(e,i){const s=e.trim(),u=i.split(/[.!?]+/).find(f=>f.toLowerCase().includes(s.toLowerCase()));return u&&u.length<200?u.trim():s}static extractTags(e,i){const s=[],a=e.toLowerCase();return Object.values(i.knownEntities).forEach(f=>{f.name&&a.includes(f.name.toLowerCase())&&(s.push(f.name.toLowerCase()),s.push(f.type))}),[{keywords:["chin u","tn cng","nh"],tag:"combat"},{keywords:["khm ph","tm thy","pht hin"],tag:"exploration"},{keywords:["hc","k nng","php thut"],tag:"learning"},{keywords:["giao dch","mua","bn"],tag:"commerce"},{keywords:["ni chuyn","thuyt phc"],tag:"dialogue"}].forEach(({keywords:f,tag:p})=>{f.some(g=>a.includes(g))&&s.push(p)}),[...new Set(s)]}static getGenerationStats(e){const i={};let s=0,a=0,u=0,f=0;return e.forEach(p=>{p.category&&(i[p.category]=(i[p.category]||0)+1);const g=p.importance||0;s+=g,g>=70?a++:g>=40?u++:f++}),{totalGenerated:e.length,byCategory:i,byImportance:{high:a,medium:u,low:f},averageImportance:e.length>0?s/e.length:0}}};Td.DEFAULT_CONFIG={enableEventMemories:!0,enableRelationshipMemories:!0,enableDiscoveryMemories:!0,enableCombatMemories:!0,enableAchievementMemories:!0,minImportanceThreshold:50,maxMemoriesPerTurn:1,lookbackTurns:2};let Ar=Td;const Nd=class Nd{static coordinatedCleanup(e,i=this.DEFAULT_CONFIG){var y,v;const s=new Date().toLocaleTimeString();console.log(` [${s}] Starting Unified Memory Cleanup:`,{turnNumber:e.turnCount,currentMemories:((y=e.memories)==null?void 0:y.length)||0,currentHistoryEntries:e.gameHistory.length,memoryThreshold:i.memoryCleanupThreshold,maxActiveMemories:i.maxActiveMemories,historyThreshold:i.historyCompressionThreshold,lowImportanceCount:((v=e.memories)==null?void 0:v.filter(C=>(C.importance||0)<i.lowImportanceThreshold).length)||0,tokenBudget:i.maxTokenBudget});const a=ld.manageHistory(e.gameHistory,e.turnCount,{maxActiveEntries:i.maxActiveHistoryEntries,compressionThreshold:i.historyCompressionThreshold,summaryLength:200});let u;i.enableSmartMemoryGeneration&&(u=Ar.generateMemoriesFromHistory(e,i.smartMemoryConfig),u.memories.length>0&&console.log(` Smart Memory Generation: Added ${u.memories.length} memories`,u.stats));const f=u?[...e.memories,...u.memories]:e.memories,p=this.optimizeMemories(f,e,i),g=this.calculateTokenSavings(a,p),m=a.shouldCompress||p.totalProcessed>0||u&&u.memories.length>0;return m&&console.log(` [${s}] Unified Cleanup Completed:`,{memoriesArchived:p.archived.length,memoriesEnhanced:p.enhanced.length,memoriesKept:p.kept.length,smartMemoriesGenerated:(u==null?void 0:u.memories.length)||0,historyCompressed:a.shouldCompress,tokensSaved:g,newMemoryCount:p.kept.length+p.enhanced.length,newHistoryCount:a.activeHistory.length}),{memoriesProcessed:p,historyProcessed:{compressed:a.compressedSegment,activeEntries:a.activeHistory,originalSize:a.stats.originalSize,newSize:a.stats.newSize},smartMemoriesGenerated:u,tokensSaved:g,cleanupTriggered:m}}static optimizeMemories(e,i,s){if(!(e.length>s.maxActiveMemories||e.length>s.memoryCleanupThreshold||e.filter(v=>(v.importance||0)<s.lowImportanceThreshold).length>10))return console.log(" Memory cleanup skipped:",{memoryCount:e.length,maxActive:s.maxActiveMemories,threshold:s.memoryCleanupThreshold,lowImportanceCount:e.filter(v=>(v.importance||0)<s.lowImportanceThreshold).length,reason:e.length<=s.maxActiveMemories?"below maxActive":e.length<=s.memoryCleanupThreshold?"below threshold":"low-importance count OK"}),{archived:[],enhanced:[],kept:e,totalProcessed:0};const u=[],f=[],p=[],g=[...e].sort((v,C)=>{const N=v.importance||0,R=C.importance||0;if(N!==R)return R-N;const L=v.lastAccessed||v.createdAt||0;return(C.lastAccessed||C.createdAt||0)-L}),m=s.maxTokenBudget*s.memoryTokenRatio;let y=0;for(const v of g){const C=this.estimateMemoryTokens(v),N=v.importance||0;if(v.pinned)if(p.length+f.length<s.maxActiveMemories){p.push(v),y+=C;continue}else{u.push({...v,category:"archived",lastAccessed:i.turnCount});continue}if(N<s.lowImportanceThreshold){u.push({...v,category:"archived",lastAccessed:i.turnCount});continue}if(y+C<=m&&p.length+f.length<s.maxActiveMemories)if(this.shouldEnhanceMemory(v,i)){const R=xs.enhanceMemory(v,i);f.push(R.enhanced),y+=this.estimateMemoryTokens(R.enhanced)}else p.push(v),y+=C;else u.push({...v,category:"archived",lastAccessed:i.turnCount})}return{archived:u,enhanced:f,kept:p,totalProcessed:u.length+f.length}}static shouldEnhanceMemory(e,i){var u;if(!e.category||!e.relatedEntities||!e.tags)return!0;const s=e.lastAccessed||e.createdAt||0;return i.turnCount-s>10?!0:((u=e.relatedEntities)==null?void 0:u.some(f=>this.hasRecentEntityActivity(f,i)))||!1}static hasRecentEntityActivity(e,i){return i.gameHistory.slice(-10).some(a=>a.parts[0].text.toLowerCase().includes(e.toLowerCase()))}static estimateMemoryTokens(e){var s,a;let i=Math.ceil(e.text.length*.8);return(s=e.tags)!=null&&s.length&&(i+=e.tags.length*2),(a=e.relatedEntities)!=null&&a.length&&(i+=e.relatedEntities.length*3),i}static calculateTokenSavings(e,i){let s=0;return e.shouldCompress&&(s+=e.stats.savedEntries*500),s+=i.archived.reduce((a,u)=>a+this.estimateMemoryTokens(u),0),s}static getOptimizationStats(e,i=[]){const s={};let a=0,u=0,f=0;return e.forEach(p=>{p.category&&(s[p.category]=(s[p.category]||0)+1),p.importance&&(a+=p.importance),p.pinned&&u++,f+=this.estimateMemoryTokens(p)}),{activeMemories:e.length,archivedMemories:i.length,averageImportance:e.length>0?a/e.length:0,categoryDistribution:s,pinnedCount:u,estimatedTokenUsage:f}}static restoreRelevantMemories(e,i,s=5){if(!e.length)return[];const a=this.extractRecentActivityTerms(i),u=e.filter(f=>a.some(p=>{var g;return f.text.toLowerCase().includes(p.toLowerCase())||((g=f.relatedEntities)==null?void 0:g.some(m=>m.toLowerCase().includes(p.toLowerCase())))})).sort((f,p)=>(p.importance||0)-(f.importance||0)).slice(0,s);return u.length>0&&console.log(` Restoring ${u.length} relevant archived memories`),u.map(f=>({...f,lastAccessed:i.turnCount,category:f.category==="archived"?"general":f.category}))}static extractRecentActivityTerms(e){var u;const i=[];e.gameHistory.slice(-5).forEach(f=>{try{if(f.role==="model"){const p=JSON.parse(f.parts[0].text);if(p.story){const g=p.story.split(/\s+/).filter(m=>m.length>3).slice(0,10);i.push(...g)}}}catch{}}),(u=e.party)==null||u.forEach(f=>{f.name&&i.push(f.name)});const a=e.locationDiscoveryOrder.slice(-3);return i.push(...a),[...new Set(i)]}static generateSmartMemories(e,i){const s=i||this.DEFAULT_CONFIG.smartMemoryConfig;return Ar.generateMemoriesFromHistory(e,s)}};Nd.DEFAULT_CONFIG={maxActiveMemories:80,memoryCleanupThreshold:100,lowImportanceThreshold:40,maxActiveHistoryEntries:50,historyCompressionThreshold:40,maxTokenBudget:1e4,memoryTokenRatio:.3,enableSmartMemoryGeneration:!0,smartMemoryConfig:{enableEventMemories:!0,enableRelationshipMemories:!0,enableDiscoveryMemories:!0,enableCombatMemories:!0,enableAchievementMemories:!0,minImportanceThreshold:50,maxMemoriesPerTurn:1,lookbackTurns:2}};let Gi=Nd;class Ng{static needsMigration(e){return e.some(i=>i.createdAt===void 0||i.importance===void 0||i.category===void 0)}static migrateMemories(e,i){return e.map((s,a)=>{if(s.createdAt!==void 0&&s.importance!==void 0&&s.category!==void 0)return s;const u={...s,createdAt:s.createdAt||Math.max(1,i.turnCount-(e.length-a-1)),lastAccessed:s.lastAccessed||i.turnCount,source:s.source||this.guessSource(s.text)},f=xs.enhanceMemory(u,i);return console.log(` Migrated memory: "${s.text.substring(0,50)}..." -> Score: ${f.enhanced.importance}/100, Category: ${f.enhanced.category}`),f.enhanced})}static guessSource(e){return e.startsWith("")||e.includes("Bin nin s")||e.includes("Chronicle")?"chronicle":e.length<100&&!e.includes("Ti ")&&!e.includes("Sau khi")?"manual":e.includes("t ng")||e.includes("h thng")||e.length>200?"auto_generated":"manual"}static deduplicateMemories(e){const i=new Set,s=[],a=[...e].sort((u,f)=>(f.importance||0)-(u.importance||0));for(const u of a){const f=u.text.toLowerCase().trim();i.has(f)||(i.add(f),s.push(u))}return s.sort((u,f)=>(u.createdAt||0)-(f.createdAt||0))}static generateMigrationReport(e,i){const s={},a={};let u=0,f=0;return i.forEach(p=>{p.category&&(s[p.category]=(s[p.category]||0)+1),p.source&&(a[p.source]=(a[p.source]||0)+1),p.importance&&(u+=p.importance,p.importance>=70&&f++)}),{totalMigrated:i.length,categoriesFound:s,sourcesDetected:a,averageImportanceScore:i.length>0?u/i.length:0,highImportanceCount:f,duplicatesRemoved:e.length-i.length}}static autoMigrateOnLoad(e){if(!this.needsMigration(e.memories))return e;console.log(" Auto-migrating memories to enhanced format...");const s=this.migrateMemories(e.memories,e),a=this.deduplicateMemories(s),u=this.generateMigrationReport(e.memories,a);console.log(" Memory migration completed:",u);const f={...e,memories:a};console.log(" Applying unified auto cleanup to migrated memories...");const p=Gi.coordinatedCleanup(f,{maxActiveMemories:100,memoryCleanupThreshold:50,lowImportanceThreshold:30,maxActiveHistoryEntries:30,historyCompressionThreshold:30,maxTokenBudget:8e3,memoryTokenRatio:.3,enableSmartMemoryGeneration:!0,smartMemoryConfig:{enableEventMemories:!0,enableRelationshipMemories:!0,enableDiscoveryMemories:!0,enableCombatMemories:!0,enableAchievementMemories:!0,minImportanceThreshold:40,maxMemoriesPerTurn:3,lookbackTurns:5}});return console.log(" Unified auto cleanup applied:",{original:e.memories.length,migrated:a.length,afterCleanup:p.memoriesProcessed.memories.length,memoriesArchived:p.memoriesProcessed.archived.length,memoriesEnhanced:p.memoriesProcessed.enhanced.length,tokensSaved:p.tokensSaved,cleanupTriggered:p.cleanupTriggered}),{...f,memories:p.memoriesProcessed.memories,gameHistory:p.historyProcessed.activeEntries}}static recalculateAllImportanceScores(e,i){return console.log(" Recalculating importance scores for all memories..."),e.map(s=>{const a=Gl.calculateMemoryScore(s,i);return{...s,importance:a.score,lastAccessed:i.turnCount}})}}const ww=(t,e,i,s)=>{const[a,u]=E.useState(t.worldData),[f,p]=E.useState(t.knownEntities),[g,m]=E.useState(t.statuses),[y,v]=E.useState(t.quests),[C,N]=E.useState(t.gameHistory),[R,L]=E.useState(()=>Ng.needsMigration(t.memories)?Ng.autoMigrateOnLoad(t).memories:t.memories),[O,J]=E.useState(t.party),[P,$]=E.useState(t.customRules),[ne,z]=E.useState(t.regexRules||[]),[ae,de]=E.useState(t.systemInstruction),[re,se]=E.useState(t.chronicle),[oe,_]=E.useState(t.gameTime||{year:1,month:1,day:1,hour:8,minute:0}),[me,Y]=E.useState(t.turnCount),[ue,H]=E.useState(0),[k,S]=E.useState(t.totalTokens||0),[V,W]=E.useState(i),[I,j]=E.useState(s),[F,Z]=E.useState(()=>{if(Array.isArray(t.locationDiscoveryOrder)){const Ce=[...t.locationDiscoveryOrder],_e=new Set(Ce);return Object.values(t.knownEntities).filter(Fe=>Fe.type==="location").map(Fe=>Fe.name).forEach(Fe=>{_e.has(Fe)||Ce.push(Fe)}),Ce}const ye=[],we=new Set;return t.gameHistory.forEach(Ce=>{if(Ce.role==="model")try{const gt=JSON.parse(Ce.parts[0].text).story||"",Fe=/\[LORE_LOCATION:\s*name="([^"]+)"[^\]]*\]/g;let Q;for(;(Q=Fe.exec(gt))!==null;){const ve=Q[1];we.has(ve)||(ye.push(ve),we.add(ve))}}catch{}}),Object.values(t.knownEntities).filter(Ce=>Ce.type==="location").map(Ce=>Ce.name).forEach(Ce=>{we.has(Ce)||(ye.push(Ce),we.add(Ce))}),ye}),[A,G]=E.useState(t.choiceHistory||[]),[M,D]=E.useState(t.gameHistory.length===0&&e),[B,X]=E.useState(t.gameHistory.length>0),[xe,Ne]=E.useState("");return[{worldData:a,knownEntities:f,statuses:g,quests:y,gameHistory:C,memories:R,party:O,customRules:P,regexRules:ne,systemInstruction:ae,chronicle:re,gameTime:oe,turnCount:me,currentTurnTokens:ue,totalTokens:k,storyLog:V,choices:I,locationDiscoveryOrder:F,choiceHistory:A,isLoading:M,hasGeneratedInitialStory:B,customAction:xe},{setWorldData:u,setKnownEntities:p,setStatuses:m,setQuests:v,setGameHistory:N,setMemories:L,setParty:J,setCustomRules:$,setRegexRules:z,setSystemInstruction:de,setChronicle:se,setGameTime:_,setTurnCount:Y,setCurrentTurnTokens:H,setTotalTokens:S,setStoryLog:W,setChoices:j,setLocationDiscoveryOrder:Z,updateChoiceHistory:(ye,we,Se)=>{G(Ce=>{const _e={turn:me,choices:[...ye],selectedChoice:we,context:Se};return[...Ce,_e].slice(-20)})},setIsLoading:D,setHasGeneratedInitialStory:X,setCustomAction:Ne}]},Ew=()=>{const[t,e]=E.useState(!1),[i,s]=E.useState(!1),[a,u]=E.useState(!1),[f,p]=E.useState(!1),[g,m]=E.useState(!1),[y,v]=E.useState(!1),[C,N]=E.useState(!1),[R,L]=E.useState(!1),[O,J]=E.useState(!1),[P,$]=E.useState(!1),[ne,z]=E.useState(!1),[ae,de]=E.useState(!1),[re,se]=E.useState(!1),[oe,_]=E.useState(!1),[me,Y]=E.useState(!1),[ue,H]=E.useState(!1),[k,S]=E.useState(!1),[V,W]=E.useState(!1),[I,j]=E.useState(!1),[F,Z]=E.useState(!1),[A,G]=E.useState(!1),[M,D]=E.useState(null),[B,X]=E.useState(null),[xe,Ne]=E.useState(null),[Te,Ee]=E.useState(null),[Re,ye]=E.useState(null),[we,Se]=E.useState(null),[Ce,_e]=E.useState(null),[gt,Fe]=E.useState(null),[Q,ve]=E.useState(!1),[be,Ae]=E.useState(!1),[De,qe]=E.useState(null),ze=E.useMemo(()=>({home:()=>e(!1),restart:()=>s(!1),memory:()=>u(!1),knowledge:()=>p(!1),customRules:()=>m(!1),map:()=>v(!1),pcInfo:()=>N(!1),party:()=>L(!1),questLog:()=>J(!1),choices:()=>z(!1),inventory:()=>_(!1),admin:()=>Y(!1),editItem:()=>{H(!1),Ee(null)},editSkill:()=>{S(!1),ye(null)},editNPC:()=>{W(!1),Se(null)},editPC:()=>{j(!1),_e(null)},editLocation:()=>{Z(!1),Fe(null)},regexManager:()=>G(!1)}),[]);return[{isHomeModalOpen:t,isRestartModalOpen:i,isMemoryModalOpen:a,isKnowledgeModalOpen:f,isCustomRulesModalOpen:g,isMapModalOpen:y,isPcInfoModalOpen:C,isPartyModalOpen:R,isQuestLogModalOpen:O,isSidebarOpen:P,isChoicesModalOpen:ne,isGameSettingsModalOpen:ae,isEntityImportModalOpen:re,isInventoryModalOpen:oe,isAdminModalOpen:me,isEditItemModalOpen:ue,isEditSkillModalOpen:k,isEditNPCModalOpen:V,isEditPCModalOpen:I,isEditLocationModalOpen:F,isRegexManagerModalOpen:A,activeEntity:M,activeStatus:B,activeQuest:xe,activeEditItem:Te,activeEditSkill:Re,activeEditNPC:we,activeEditPC:Ce,activeEditLocation:gt,showSaveSuccess:Q,showRulesSavedSuccess:be,notification:De},{setIsHomeModalOpen:e,setIsRestartModalOpen:s,setIsMemoryModalOpen:u,setIsKnowledgeModalOpen:p,setIsCustomRulesModalOpen:m,setIsMapModalOpen:v,setIsPcInfoModalOpen:N,setIsPartyModalOpen:L,setIsQuestLogModalOpen:J,setIsSidebarOpen:$,setIsChoicesModalOpen:z,setIsGameSettingsModalOpen:de,setIsEntityImportModalOpen:se,setIsInventoryModalOpen:_,setIsAdminModalOpen:Y,setIsEditItemModalOpen:H,setIsEditSkillModalOpen:S,setIsEditNPCModalOpen:W,setIsEditPCModalOpen:j,setIsEditLocationModalOpen:Z,setIsRegexManagerModalOpen:G,setActiveEntity:D,setActiveStatus:X,setActiveQuest:Ne,setActiveEditItem:Ee,setActiveEditSkill:ye,setActiveEditNPC:Se,setActiveEditPC:_e,setActiveEditLocation:Fe,setShowSaveSuccess:ve,setShowRulesSavedSuccess:Ae,setNotification:qe,modalCloseHandlers:ze}]},Mw=t=>{const[e,i]=E.useState(t.compressedHistory||[]),[s,a]=E.useState(t.historyStats||{totalEntriesProcessed:0,totalTokensSaved:0,compressionCount:0}),[u,f]=E.useState(t.cleanupStats||{totalCleanupsPerformed:0,totalTokensSavedFromCleanup:0,lastCleanupTurn:0,cleanupHistory:[]});return[{compressedHistory:e,historyStats:s,cleanupStats:u},{setCompressedHistory:i,setHistoryStats:a,setCleanupStats:f}]},kg=({isOpen:t,onClose:e,onConfirm:i,title:s,message:a})=>t?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:e,children:l.jsxs("div",{className:"bg-white/90 dark:bg-[#252945]/90 backdrop-blur-sm border border-slate-300 dark:border-slate-700 rounded-lg shadow-xl w-full max-w-md text-slate-900 dark:text-white",onClick:u=>u.stopPropagation(),children:[l.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-600",children:l.jsx("h3",{className:"text-lg font-semibold",children:s})}),l.jsx("div",{className:"p-6 text-sm text-slate-700 dark:text-gray-300",children:a}),l.jsxs("div",{className:"p-3 bg-slate-50/80 dark:bg-[#1f2238]/80 rounded-b-lg flex justify-end space-x-3",children:[l.jsx("button",{onClick:e,className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 rounded-md text-white text-sm font-semibold transition-colors duration-200",children:"Hy"}),l.jsx("button",{onClick:i,className:"px-4 py-2 bg-red-600 hover:bg-red-500 rounded-md text-white text-sm font-semibold transition-colors duration-200",children:"Xc nhn"})]})]})}):null,ad=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M7 2L3.44 5.56L2 7L7 12L12 7L7 2M13 6L11 8L16.04 13.04L13.17 15.9L15.29 18.03L18.16 15.16L22 19L23.42 17.58L19 13.17L21.87 10.29L19.75 8.17L16.88 11.04L13 7.17V6Z"})}),Sg=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M17.58,4.42A1,1,0,0,0,16.17,3,1,1,0,0,0,15,4H12.83L11,2H9L10.83,4H6A1,1,0,0,0,5,5V8A1,1,0,0,0,6,9H12.83L11,11H9L10.83,13H6A1,1,0,0,0,5,14V17A1,1,0,0,0,6,18H10.83L9,20H11L12.83,18H15A1,1,0,0,0,16,17.17L19.5,13.67V11.5L16,8Z"})}),Aw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M20.8,4.2C20.4,3.8,20,3.8,19.6,4.2L18.1,5.7L16,3.6L12.5,7.1L14.6,9.2L12.5,11.3L3,1.8L1.8,3L11.3,12.5L9.2,14.6L7.1,12.5L3.6,16L5.7,18.1L4.2,19.6C3.8,20,3.8,20.4,4.2,20.8C4.4,21,4.7,21.1,5,21.1C5.3,21.1,5.6,21,5.8,20.8L12.6,14L20.8,5.8C21.2,5.4,21.2,4.6,20.8,4.2Z"})}),Rw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,2L14.05,5.85L13.3,6.3C13.15,6.4,13.05,6.55,13,6.7V17.5L12,22L11,17.5V6.7C10.95,6.55,10.85,6.4,10.7,6.3L9.95,5.85L12,2M15,9V12H23V9H15M1,9V12H9V9H1Z"})}),Iw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,2L22,8C22,12 18,14 12,14C6,14 2,12 2,8L12,2M12,15C18,15 22,17 22,21V22H2V21C2,17 6,15 12,15Z"})}),_w=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M1,21H12.34C12.14,20.04 12.14,19.04 12.34,18.09L9.46,15.21L13.69,11L18.41,15.73L17,17.14L15.27,15.41L11,19.69C11.96,19.89 12.96,19.89 14,19.69L21.5,12.2L12.2,2.9L2.9,12.2L1,21Z"})}),Lw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M19.3,4.7C19.3,4.7 19.3,4.7 19.3,4.7C18.4,5.6 18.4,7.1 19.3,8L15,12.3L11.7,9L16,4.7C16.9,3.8 18.4,3.8 19.3,4.7M10.3,10.4L13.6,13.7L12.8,14.5C11.9,15.4 10.4,15.4 9.5,14.5C9.5,14.5 9.5,14.5 9.5,14.5L2.3,21.7L2.1,21.5C2,21.3 2,21.2 2,21C2,20.4 2.4,20 3,20C3.2,20 3.3,20 3.5,20.1L4,20.6L10.3,14.3C10.3,14.3 10.3,14.3 10.3,14.3C11.2,13.4 12.7,13.4 13.6,14.3L14.3,13.6L4.7,4C3.8,3.1 3.8,1.6 4.7,0.7C4.7,0.7 4.7,0.7 4.7,0.7C5.6,-0.2 7.1,-0.2 8,0.7L12.3,5L15.6,1.7L18.5,4.6L10.3,12.8L10.3,10.4Z"})}),jw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1Z"})}),Dw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,1C12,1 12,1 12,1L3,5V11C3,16.5 6.8,21.7 12,23C17.2,21.7 21,16.5 21,11V5L12,1M12,6A3,3 0 0,1 15,9C15,10.3 14.1,11.4 12.9,11.8L15,19H9L11.1,11.8C9.9,11.4 9,10.3 9,9A3,3 0 0,1 12,6Z"})}),Pw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,21.8C12.3,21.9 12.5,22 12.8,22H13C18,22 22,18 22,13V6.7C22,6.7 21.3,4.8 18.5,4.1C18.5,4.1 16.5,2 12,2C7.5,2 5.5,4.1 5.5,4.1C2.7,4.8 2,6.7 2,6.7V13C2,18 6,22 11,22H11.2C11.5,22 11.7,21.9 12,21.8M15,9.5L13,11.1V14H11V11.1L9,9.5L12,7.5L15,9.5Z"})}),Uw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M20,18.5C20.8,18.5 21.5,19.2 21.5,20C21.5,20.8 20.8,21.5 20,21.5H12C12,21.5 12,20.8 12,20C12,19.2 12.7,18.5 13.5,18.5H14.5V14L10,12V10L14.5,12V7.5C14.5,6.7 13.8,6 13,6H4C3.2,6 2.5,6.7 2.5,7.5V18.5H3.5C4.3,18.5 5,19.2 5,20C5,20.8 5,21.5 5,21.5H8.5L10,18.5H11.5V14.8L12.5,15.2V18.5H13.5C13.5,18.5 13.5,18.5 13.5,18.5H14.5C14.5,18.5 14.5,18.5 14.5,18.5Z"})}),Hw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M13,3C13,3 15,5 15,7C15,9 13.5,10.6 13.5,12.4C13.5,14.3 15,15.9 15,18C15,20.2 11.5,22 11.5,22C11.5,22 8,20.2 8,18C8,15.9 9.5,14.3 9.5,12.4C9.5,10.6 8,9 8,7C8,5 10,3 10,3M10.5,3.5C10.5,3.5 10.5,3.5 10.5,3.5C10.5,3.5 10.5,3.5 10.5,3.5C10.5,4.3 10,5 10,5.8C10,6.6 10.5,7.3 10.5,8.1C10.5,8.9 10,9.6 10,10.4C10,11.2 10.5,11.9 10.5,12.7C10.5,13.5 10,14.2 10,15C10,15.8 10.5,16.5 10.5,17.3C10.5,18.1 10,18.8 10,19.6L10.5,20.5"})}),Ow=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M15.5,13.5L18.3,10.7C19.1,9.9 19.1,8.6 18.3,7.8L16.2,5.7C15.4,4.9 14.1,4.9 13.3,5.7L10.5,8.5L15.5,13.5M10,9L5,14L9,18L14,13L10,9Z"})}),zn=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M9,2C7.9,2 7,2.9 7,4V5C5.9,5 5,5.9 5,7V9C3.9,9 3,9.9 3,11V17C3,18.1 3.9,19 5,19V20C6.1,20 7,19.1 7,18V17H17V18C17,19.1 17.9,20 19,20V19C20.1,19 21,18.1 21,17V11C21,9.9 20.1,9 19,9V7C19,5.9 18.1,5 17,5V4C17,2.9 16.1,2 15,2H9M9,4H15V5H9V4M7,7H17V9H7V7M5,11H19V17H5V11Z"})}),wg=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M18,2H6C4.9,2 4,2.9 4,4V20C4,21.1 4.9,22 6,22H18C19.1,22 20,21.1 20,20V4C20,2.9 19.1,2 18,2M9,4H11V12L10,11L9,12V4M18,20H6V4H8V13L10,12L12,13V4H18V20Z"})}),Gw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6Z"})}),Vw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M6,3L4,5L12,13L20,5L18,3H6M12,15L3,6V16A2,2 0 0,0 5,18H19A2,2 0 0,0 21,16V6L12,15Z"})}),$w=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,2L2,8.5L12,22L22,8.5L12,2M12,10.3L17.6,8.5L12,5L6.4,8.5L12,10.3M12,12.6L5,9.6V15.4L12,19.2V12.6M12,12.6V19.2L19,15.4V9.6L12,12.6Z"})}),Bw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8C12.8,8 13.5,8.7 13.5,9.5C13.5,10.1 13.1,10.6 12.6,10.9L13,14H11L11.4,11.1C10.9,10.8 10.5,10.2 10.5,9.5C10.5,8.7 11.2,8 12,8Z"})}),qw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M16.5,8A2.5,2.5 0 0,0 19,5.5A2.5,2.5 0 0,0 16.5,3A2.5,2.5 0 0,0 14,5.5A2.5,2.5 0 0,0 16.5,8M9,11C9,11 9,11 9,11C7.3,11 6,9.7 6,8C6,6.3 7.3,5 9,5V3H11V5C12.7,5 14,6.3 14,8C14,9.7 12.7,11 11,11V13H13V15H11V21H9V11Z"})}),T0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M3,3V9H21V3H3M3,11V21H21V11H3M12,13A1,1 0 0,1 13,14A1,1 0 0,1 12,15A1,1 0 0,1 11,14A1,1 0 0,1 12,13Z"})}),zw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,12.3C12,12.3 12,12.3 12,12.3C12,11.2 12.4,10.1 13.2,9.3C14,8.5 15.1,8 16.2,8C17.3,8 18.4,8.5 19.2,9.3C20,10.1 20.5,11.2 20.5,12.3C20.5,13.4 20,14.5 19.2,15.3C18.4,16.1 17.3,16.5 16.2,16.5C15.1,16.5 14,16.1 13.2,15.3C12.4,14.5 12,13.4 12,12.3M9.8,11.5L6.5,8.2L5.1,9.6L8.4,12.9L5.1,16.2L6.5,17.6L9.8,14.3C10.4,15.4 11.4,16.2 12.6,16.6L12.1,22H14.1L14.6,16.6C15.8,16.2 16.8,15.4 17.4,14.3L20.7,17.6L22.1,16.2L18.8,12.9L22.1,9.6L20.7,8.2L17.4,11.5C16.8,10.4 15.8,9.6 14.6,9.2L14.1,3H12.1L12.6,9.2C11.4,9.6 10.4,10.4 9.8,11.5Z"})}),Dr=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,2C14.21,2 16,3.79 16,6C16,8.21 14.21,10 12,10C9.79,10 8,8.21 8,6C8,3.79 9.79,2 12,2M12,12C16.42,12 20,13.79 20,16V18H4V16C4,13.79 7.58,12 12,12Z"})}),Fw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,4C14.2,4 16,5.8 16,8C16,11.1 12.4,15.9 12,15.9C11.6,15.9 8,11.1 8,8C8,5.8 9.8,4 12,4M12,2A6,6 0 0,0 6,8C6,12.2 11,18.1 11.5,18.8L12,19.3L12.5,18.8C13,18.1 18,12.2 18,8A6,6 0 0,0 12,2M12,6A2,2 0 0,1 14,8A2,2 0 0,1 12,10A2,2 0 0,1 10,8A2,2 0 0,1 12,6M3,21V23H21V21H3Z"})}),Kw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M14.4,6L14,4H5V21H7V14H12.6L13,16H20V6H14.4Z"})}),N0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"})}),Yw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35M16.5,5C15.36,5 14.32,5.55 13.63,6.4L12,8.27L10.37,6.4C9.68,5.55 8.64,5 7.5,5C5.5,5 4,6.5 4,8.5C4,11.23 7,13.91 12,18.17C17,13.91 20,11.23 20,8.5C20,6.5 18.5,5 16.5,5Z"})}),Eg=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35M17,8H21V10H17V8M17,12H19V14H17V12M3,12H5V14H3V12M7,16H5V18H7V16M13,16H11V18H13V16Z"})}),k0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M13,9H11V7H13V9M12,2C11.4,2 11,2.4 11,3V6.2C8.3,6.6 6.2,8.8 6.2,11.5L6,11.6C5.5,11.8 5.2,12.2 5.2,12.8C5.2,13.4 5.7,14 6.3,14H7.2C7.6,16.7 9.9,18.8 12.5,18.8L12.4,19C12.2,19.5 12.6,20 13.2,20C13.8,20 14.3,19.5 14.5,19L14.6,18.8C17.1,18.8 19.4,16.7 19.8,14H20.7C21.3,14 21.8,13.4 21.8,12.8C21.8,12.2 21.5,11.8 21,11.6L20.8,11.5C20.8,8.8 18.7,6.6 16,6.2V3C16,2.4 15.6,2 15,2H12M13,13H11V11H13V13M17,13H15V11H17V13M9,13H7V11H9V13Z"})}),S0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,2C12,2 12,2.3 12,2.6C12,3.8 11.2,4.8 10.1,5.1C9,5.4 7.9,5.2 6.9,4.6C5.9,4 5.2,3 5.2,1.8C5.2,1.8 5.2,1.8 5.2,1.8C5.2,0.8 4.4,0 3.4,0C2.4,0 1.6,0.8 1.6,1.8C1.6,2.9 2.3,3.9 3.3,4.5C4.3,5.1 5.4,5.3 6.5,5C7.6,4.7 8.5,3.9 8.9,2.8C9.3,1.7 10.1,0.8 11.1,0.5C12.1,0.2 13.2,0.4 14.2,1C15.2,1.6 15.9,2.6 15.9,3.8C15.9,3.8 15.9,3.8 15.9,3.8C15.9,4.8 16.7,5.6 17.7,5.6C18.7,5.6 19.5,4.8 19.5,3.8C19.5,2.7 18.8,1.7 17.8,1.1C16.8,0.5 15.7,0.3 14.6,0.6C13.5,0.9 12.6,1.7 12.2,2.8C11.8,3.9 11,4.8 10,5.1C9,5.4 7.9,5.2 6.9,4.6C5.9,4 5.2,3 5.2,1.8C5.2,1.8 5.2,1.8 5.2,1.8C5.2,0.8 4.4,0 3.4,0C2.4,0 1.6,0.8 1.6,1.8C1.6,2.9 2.3,3.9 3.3,4.5C4.3,5.1 5.4,5.3 6.5,5C7.6,4.7 8.5,3.9 8.9,2.8C9.3,1.7 10.1,0.8 11.1,0.5C12.1,0.2 13.2,0.4 14.2,1C15.2,1.6 15.9,2.6 15.9,3.8C15.9,3.8 15.9,3.8 15.9,3.8C15.9,4.8 16.7,5.6 17.7,5.6C18.7,5.6 19.5,4.8 19.5,3.8C19.5,2.7 18.8,1.7 17.8,1.1L18.9,13.9C18.9,13.9 18.9,13.9 18.9,13.9C18.9,14.9 18.1,15.7 17.1,15.7C16.1,15.7 15.3,14.9 15.3,13.9C15.3,12.8 16,11.8 17,11.2C18,10.6 19.1,10.4 20.2,10.7C21.3,11 22.2,11.8 22.6,12.9C23,14 22.8,15.1 22.2,16.1C21.6,17.1 20.6,17.8 19.5,17.8C19.5,17.8 19.5,17.8 19.5,17.8C18.5,17.8 17.7,17 17.7,16L16.6,2.2C15.5,1.6 14.3,1.5 13.2,1.8C12.1,2.1 11,2.9 10.5,4C9.4,4.6 8.3,4.5 7.2,4.2C6.1,3.9 5,3.1 4.5,2C3.4,1.4 2.2,1.5 1.1,1.8L2.2,15.6C2.2,15.6 2.2,15.6 2.2,15.6C2.2,16.6 3,17.4 4,17.4C5,17.4 5.8,16.6 5.8,15.6C5.8,14.5 5.1,13.5 4.1,12.9C3.1,12.3 2,12.1 0.9,12.4C-0.2,12.7 -1.1,13.5 -1.5,14.6C-1.9,15.7 -1.7,16.8 -1.1,17.8C-0.5,18.8 0.5,19.5 1.6,19.5C1.6,19.5 1.6,19.5 1.6,19.5C2.6,19.5 3.4,18.7 3.4,17.7L4.5,4C5.6,3.4 6.8,3.3 7.9,3.6C9,3.9 10.1,4.7 10.6,5.8C11.7,5.2 12.9,5.3 14,5.6C15.1,5.9 16.2,6.7 16.7,7.8L15.6,21.6C15.6,21.6 15.6,21.6 15.6,21.6C15.6,22.6 14.8,23.4 13.8,23.4C12.8,23.4 12,22.6 12,21.6C12,20.5 12.7,19.5 13.7,18.9C14.7,18.3 15.8,18.1 16.9,18.4C18,18.7 18.9,19.5 19.3,20.6C19.7,21.7 19.5,22.8 18.9,23.8C18.3,24.8 17.3,25.5 16.2,25.5C16.2,25.5 16.2,25.5 16.2,25.5C15.2,25.5 14.4,24.7 14.4,23.7L13.3,10C12.2,9.4 11,9.5 9.9,9.8C8.8,10.1 7.7,10.9 7.2,12L6.1,25.8C6.1,25.8 6.1,25.8 6.1,25.8C6.1,26.8 6.9,27.6 7.9,27.6C8.9,27.6 9.7,26.8 9.7,25.8C9.7,24.7 9,23.7 8,23.1C7,22.5 5.9,22.3 4.8,22.6C3.7,22.9 2.8,23.7 2.4,24.8C2,25.9 2.2,27 2.8,28C3.4,29 4.4,29.7 5.5,29.7C5.5,29.7 5.5,29.7 5.5,29.7C6.5,29.7 7.3,28.9 7.3,28L8.4,14.2C9.5,13.6 10.7,13.5 11.8,13.8C12.9,14.1 14,14.9 14.5,16L15.6,29.8C15.6,29.8 15.6,29.8 15.6,29.8C15.6,30.8 16.4,31.6 17.4,31.6C18.4,31.6 19.2,30.8 19.2,29.8C19.2,28.7 18.5,27.7 17.5,27.1C16.5,26.5 15.4,26.3 14.3,26.6C13.2,26.9 12.3,27.7 11.9,28.8L12,2C12,2 12,2 12,2Z"})}),w0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M11,15H6L13,1V9H18L11,23V15Z"})}),Jw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,2A7.5,7.5 0 0,0 4.5,9.5C4.5,14.33 12,22 12,22C12,22 19.5,14.33 19.5,9.5A7.5,7.5 0 0,0 12,2Z"})}),Mg=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",className:t,children:l.jsx("path",{d:"M12,2L9.5,8.5L3,11L9.5,13.5L12,20L14.5,13.5L21,11L14.5,8.5L12,2Z"})}),Qw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12C20,13.4 19.6,14.7 18.8,15.8L8.2,5.2C9.3,4.4 10.6,4 12,4M5.2,8.2L15.8,18.8C14.7,19.6 13.4,20 12,20A8,8 0 0,1 4,12C4,10.6 4.4,9.3 5.2,8.2Z"})}),Xw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M20.5,12C21.3,12 22,12.7 22,13.5V20C22,20.8 21.3,21.5 20.5,21.5H19V20H20.5V13.5H19V12H20.5M12.5,12C13.3,12 14,12.7 14,13.5V20C14,20.8 13.3,21.5 12.5,21.5H4C3.2,21.5 2.5,20.8 2.5,20V13.5C2.5,12.7 3.2,12 4,12H12.5M4,13.5V20H12.5V13.5H4Z"})}),Ww=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M9.6,3.1C10.7,3.6 11.6,4.6 12,5.8L16,4L18,6L13.8,10.2C13.8,10.2 13.8,10.2 13.8,10.2C13.4,11.3 12.4,12.2 11.2,12.6C10,13 8.8,12.9 7.7,12.4L3.5,16.6C3.1,17 2.5,17 2.1,16.6C1.7,16.2 1.7,15.6 2.1,15.2L6.3,11C5.8,9.9 5.9,8.7 6.4,7.5C6.8,6.3 7.7,5.3 8.9,4.9C9.1,4.8 9.3,4.8 9.5,4.8C9.6,4.8 9.6,4.8 9.7,4.8L9.6,3.1M18,11L20,9L22,11L20,13L18,11Z"})}),Zw=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,2C12,2 12,2 12,2C6.5,2 2,6.5 2,12C2,17.5 6.5,22 12,22C17.5,22 22,17.5 22,12C22,6.5 17.5,2 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z"})}),eE=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z"})}),Ag=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z"})}),E0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2M10,17L5,12L6.41,10.59L10,14.17L17.59,6.58L19,8L10,17Z"})}),Pr=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"})}),M0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12 12c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm0-10c-4.2 0-8 3.22-8 8.2 0 3.32 2.67 7.25 8 11.8 5.33-4.55 8-8.48 8-11.8C20 5.22 16.2 2 12 2z"})}),A0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"})}),R0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M15 11V5l-3-3-3 3v2H3v14h18V11h-6zm-8 8H5v-2h2v2zm0-4H5v-2h2v2zm0-4H5V9h2v2zm6 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V9h2v2zm0-4h-2V5h2v2zm6 12h-2v-2h2v2zm0-4h-2v-2h2v2z"})}),I0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M1 21h22L12 2 1 21zM12 6l7 12H5l7-12z"})}),_0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V6h16v12zM8 11h8v2H8z"})}),L0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zm-1.45-5c.75 0 1.41-.41 1.75-1.03l3.58-6.49A.996.996 0 0020.01 4H5.21l-.94-2H1v2h2l3.6 7.59L3.62 17H19v-2H7l1.1-2h8.35z"})}),j0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M7 14c1.66 0 3-1.34 3-3S8.66 8 7 8s-3 1.34-3 3 1.34 3 3 3zm0-4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm12-3H9v2h10V7zm0 4H9v2h10v-2zm-2 4h-8v2h8v-2z"})}),D0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12 2L2 22h20L12 2zm-2 16h-2v-4h2v4zm4 0h-2v-4h2v4z"})}),P0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"m14 6-3.75 5 2.85 3.8-1.6 1.2-4.2-5.6-3.3 4.4L1 18h22L14 6z"})}),U0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M11 4h2v12l5.5-5.5 1.42 1.42L12 19.84l-7.92-7.92L5.5 10.5 11 16V4z"})}),H0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v2.14c1.72.45 3 2 3 3.86 0 2.21-1.79 4-4 4s-4-1.79-4-4c0-1.86 1.28-3.41 3-3.86V7z"})}),O0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M10 9h4V5h-4v4zm-6 8h4v-4H4v4zm0-6h4V7H4v4zm0-6h4V3H4v4zm6 14h4v-4h-4v4zm-6-2h4v-4H4v4zm6 0h4v-4h-4v4zm6-14h4V3h-4v4zm0 6h4V7h-4v4zm0 8h4v-4h-4v4zm-6-8h4v-4h-4v4zm6-6h4V3h-4v4z"})}),G0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM12 5c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zm0 10c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})}),V0=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),rd=({className:t})=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,children:l.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})}),Cs=t=>{if(!t)return Me.createElement(Mg);const e=t.name.toLowerCase(),i=t.type;return i==="item"?e.includes("kim")?Me.createElement(ad):e.includes("ao")?Me.createElement(Sg):e.includes("thng")?Me.createElement(Aw):e.includes("cung")?Me.createElement(_w):e.includes("trng")?Me.createElement(Lw):e.includes("ba")?Me.createElement(Iw):e.includes("chy th")||e.includes("dao gm")?Me.createElement(Rw):e.includes("khin")?Me.createElement(jw):e.includes("gip")?Me.createElement(Pw):e.includes("nn")||e.includes("m")?Me.createElement(Dw):e.includes("ng")||e.includes("giy")?Me.createElement(Uw):e.includes("thuc")?Me.createElement(Hw):e.includes("an")?Me.createElement(Ow):e.includes("sch")||e.includes("php")||e.includes("quyn")?Me.createElement(wg):e.includes("cun")||e.includes("ch")?Me.createElement(zn):e.includes("nhn")?Me.createElement(Gw):e.includes("dy chuyn")?Me.createElement(Vw):e.includes("cha kha")?Me.createElement(qw):e.includes("tin")||e.includes("vng")||e.includes("bc")?Me.createElement(Bw):e.includes("")||e.includes("ngc")?Me.createElement($w):e.includes("tht")||e.includes("thc")?Me.createElement(zw):Me.createElement(T0):i==="skill"?e.includes("kim")?Me.createElement(ad):e.includes("ao")?Me.createElement(Sg):e.includes("quyn")||e.includes("chng")?Me.createElement(Qw):e.includes("cc")?Me.createElement(Xw):e.includes("thn php")?Me.createElement(Ww):e.includes("ha")||e.includes("la")?Me.createElement(S0):e.includes("li")||e.includes("st")?Me.createElement(w0):e.includes("thy")||e.includes("nc")?Me.createElement(Jw):e.includes("c")?Me.createElement(k0):e.includes("tm php")||e.includes("cng php")||e.includes("quyt")?Me.createElement(wg):Me.createElement(zn):i==="npc"||i==="companion"?Me.createElement(Dr):i==="location"?Me.createElement(Fw):i==="faction"?Me.createElement(Kw):i==="concept"?Me.createElement(jr):Me.createElement(Mg)},tE=(t,e)=>{if(e)return Me.createElement(M0);if(!t)return Me.createElement(rd);const i=t.name.toLowerCase();return i.includes("lng")?Me.createElement(ql):i.includes("th trn")?Me.createElement(A0):i.includes("thnh ph")?Me.createElement(R0):i.includes("th ")?Me.createElement(I0):i.includes("tng")||i.includes("gia tc")||i.includes("mn phi")?Me.createElement(_0):i.includes("ca hng")||i.includes("tim")?Me.createElement(L0):i.includes("qun tr")||i.includes("tu im")||i.includes("nh tr")?Me.createElement(j0):i.includes("rng")?Me.createElement(D0):i.includes("ni")||i.includes("nh")||i.includes("sn")?Me.createElement(P0):i.includes("hang")||i.includes("ng")?Me.createElement(U0):i.includes("hm ngc")||i.includes("b cnh")?Me.createElement(H0):i.includes("tn tch")||i.includes("ph tch")?Me.createElement(O0):i.includes("sng")||i.includes("h")||i.includes("sui")?Me.createElement(G0):i.includes("a danh c bit")?Me.createElement(V0):Me.createElement(rd)},gd=t=>{if(!t)return Me.createElement(g0);const e=t.name.toLowerCase(),i=t.type;return i==="buff"?Me.createElement(eE):e.includes("c")?Me.createElement(k0):e.includes("chy mu")?Me.createElement(Zw):e.includes("bng")||e.includes("ha")?Me.createElement(S0):e.includes("t lit")||e.includes("chong")?Me.createElement(w0):e.includes("gy")||e.includes("trng thng")||e.includes("thng tch")?Me.createElement(Eg):e.includes("tan v")||e.includes("au kh")?Me.createElement(Yw):e.includes("yu")||e.includes("suy nhc")?Me.createElement(Ag):i==="injury"?Me.createElement(Eg):i==="debuff"?Me.createElement(Ag):Me.createElement(N0)},xd=t=>t.type==="buff"?"text-green-600 dark:text-green-400":t.type==="debuff"||t.type==="injury"?/\b(nng|trng|vnh vin)\b/i.test(t.name)||t.duration==="Vnh vin"?"text-red-700 dark:text-red-500":/\b(nh)\b/i.test(t.name)?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400":"text-slate-600 dark:text-slate-400",$0=t=>(t.type==="debuff"||t.type==="injury")&&(/\b(nng|trng|vnh vin)\b/i.test(t.name)||t.duration==="Vnh vin")?"font-bold":t.type==="buff"||t.type==="debuff"||t.type==="injury"?"font-semibold":"font-normal",Rr=t=>t.type==="buff"?"border-green-400/50":t.type==="debuff"||t.type==="injury"?/\b(nng|trng|vnh vin)\b/i.test(t.name)||t.duration==="Vnh vin"?"border-red-500/50":/\b(nh)\b/i.test(t.name)?"border-yellow-400/50":"border-red-400/50":"border-slate-400 dark:border-slate-600/50",nE=t=>{if(t===0||typeof t!="number"||isNaN(t))return"0";try{return t.toLocaleString("vi-VN")}catch{return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}},iE=({entity:t,onClose:e,onUseItem:i,onLearnItem:s,onEquipItem:a,onUnequipItem:u,statuses:f,onStatusClick:p,onLocationAction:g,worldData:m,onEditSkill:y,onEditNPC:v,onEditPC:C,onEditLocation:N,onDeleteStatus:R})=>{var se;if(!t)return null;const L={pc:"text-yellow-600 dark:text-yellow-400",npc:"text-blue-600 dark:text-blue-400",companion:"text-blue-600 dark:text-blue-400",location:"text-green-600 dark:text-green-400",faction:"text-red-700 dark:text-red-500",item:"text-amber-700 dark:text-amber-300",skill:"text-amber-700 dark:text-amber-300",concept:"text-purple-600 dark:text-purple-400"},O={pc:"border-yellow-400",npc:"border-blue-400",companion:"border-blue-400",location:"border-green-400",faction:"border-red-500",item:"border-amber-400",skill:"border-amber-400",concept:"border-purple-400"},J=t.type==="item"&&t.owner==="pc",P=J&&t.learnable,$=J&&t.usable,ne=J&&t.equippable,z=f.filter(oe=>{const _=oe.owner===t.name,me=t.type==="pc"&&oe.owner==="pc";return _||me}),ae=oe=>{if(!oe)return"Cha xc nh";const _=oe.toLowerCase(),me=[{keywords:["ngi yu","tnh nhn","v","chng","lover","wife","husband","romantic"],result:"Ngi yu"},{keywords:["devoted","loyal","love","adoring","yu thng","tn ty","tn hin"],result:"Tn ty"},{keywords:["hostile","enemy","th ch","th ght","k th"],result:"Th ch"},{keywords:["gia nh","anh em","ch em","family","sibling","brother","sister"],result:"Gia nh"},{keywords:["ng i","teammate","partner","ally"],result:"ng i"},{keywords:["bn thn","best friend","close friend"],result:"Bn thn"},{keywords:["friendly","friend","warm","bn b","thn thin"],result:"Thn thin"},{keywords:["respect","admire","reverent","tn knh","ngng m"],result:"Tn knh"},{keywords:["trust","confident","tin tng","tin cy"],result:"Tin tng"},{keywords:["grateful","thankful","bit n","cm kch"],result:"Bit n"},{keywords:["suspicious","doubt","nghi ng","hoi nghi"],result:"Nghi ng"},{keywords:["competitive","rival","cnh tranh","i th"],result:"Cnh tranh"},{keywords:["fear","afraid","s hi","e ngi"],result:"S hi"},{keywords:["curious","interested","t m","quan tm"],result:"T m"},{keywords:["cautious","careful","cn thn","thn trng"],result:"Thn trng"},{keywords:["neutral","trung lp","bnh thng"],result:"Trung lp"}];for(const ue of me)for(const H of ue.keywords)if(_.includes(H))return ue.result;const Y=oe.split(/\s*(?:v|and|,|;|\||\s-\s)\s*/)[0].trim();return Y.length>0&&Y.length<20?Y:"Cha r"},de=oe=>{const me=ae(oe).toLowerCase();return me.includes("ngi yu")||me.includes("tnh nhn")||me.includes("v")||me.includes("chng")?"text-pink-600 dark:text-pink-400":me.includes("th")||me.includes("ch")||me.includes("ght")||me.includes("s")?"text-red-600 dark:text-red-400":me.includes("tn ty")||me.includes("thn thin")||me.includes("tin")||me.includes("tn knh")||me.includes("bit n")||me.includes("gia nh")||me.includes("ng i")||me.includes("bn thn")?"text-green-600 dark:text-green-400":me.includes("trung lp")||me.includes("t m")||me.includes("thn trng")||me.includes("cnh tranh")?"text-yellow-600 dark:text-yellow-400":"text-slate-700 dark:text-gray-300"},re=oe=>{const _=oe.toLowerCase();return _.includes("ni ting")||_.includes("danh gia")||_.includes("huyn thoi")?"text-purple-600 dark:text-purple-400 font-semibold":_.includes("kht ting")||_.includes("c danh")?"text-red-600 dark:text-red-400 font-semibold":_.includes("tt")||_.includes("cao")?"text-green-600 dark:text-green-400 font-semibold":"text-slate-700 dark:text-gray-300"};return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[100] p-4",onClick:e,children:l.jsxs("div",{className:`bg-white/90 dark:bg-[#2a2f4c]/90 backdrop-blur-sm border-2 ${O[t.type]||"border-slate-600"} rounded-lg shadow-2xl w-full ${t.type==="location"?"max-w-2xl":"max-w-lg"} text-slate-900 dark:text-white`,onClick:oe=>oe.stopPropagation(),children:[l.jsxs("div",{className:`p-4 border-b-2 ${O[t.type]||"border-slate-600"} flex justify-between items-center`,children:[l.jsxs("h3",{className:`text-xl font-bold ${L[t.type]||"text-slate-900 dark:text-white"} flex items-center gap-2`,children:[l.jsx("span",{className:"w-6 h-6",children:Cs(t)}),t.name,t.type==="pc"&&l.jsx("span",{className:"text-xs text-yellow-400 dark:text-yellow-500 font-normal italic",children:"(Nhn vt chnh)"}),t.equipped&&l.jsx("span",{className:"text-xs text-green-400 dark:text-green-500 font-normal italic",children:"(ang trang b)"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[t.type==="skill"&&y&&l.jsx("button",{onClick:()=>y(t),className:"text-amber-500 hover:text-amber-400 transition-colors p-1",title:"Chnh sa k nng",children:""}),(t.type==="npc"||t.type==="companion")&&v&&l.jsx("button",{onClick:()=>v(t),className:"text-blue-500 hover:text-blue-400 transition-colors p-1",title:"Chnh sa NPC",children:""}),t.type==="pc"&&C&&l.jsx("button",{onClick:()=>C(t),className:"text-yellow-500 hover:text-yellow-400 transition-colors p-1",title:"Chnh sa nhn vt chnh",children:""}),t.type==="location"&&N&&l.jsx("button",{onClick:()=>N(t),className:"text-green-500 hover:text-green-400 transition-colors p-1",title:"Chnh sa a im",children:""}),l.jsx("button",{onClick:e,className:"text-gray-500 dark:text-gray-400 hover:text-slate-900 dark:hover:text-white text-3xl leading-none",children:l.jsx(An,{className:"w-6 h-6"})})]})]}),l.jsxs("div",{className:"p-5 space-y-3 text-slate-700 dark:text-gray-300 max-h-[70vh] overflow-y-auto",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Loi:"})," ",l.jsx("span",{className:"capitalize",children:t.type==="pc"?"Nhn vt chnh":t.type==="location"?"a im":t.type})]}),(t.type==="pc"||t.type==="npc"||t.type==="companion")&&l.jsxs(l.Fragment,{children:[t.gender&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Gii tnh:"})," ",t.gender]}),t.age&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Tui:"})," ",t.age]}),t.appearance&&l.jsxs("div",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Dung mo:"}),l.jsx("p",{className:"pl-2 mt-1 text-sm",children:t.appearance})]}),t.location&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"V tr:"})," ",t.location]}),t.realm&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Cnh gii:"})," ",l.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-medium",children:t.realm})]}),t.currentExp!==void 0&&l.jsxs("p",{children:[l.jsxs("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:[(m==null?void 0:m.expName)||"Kinh nghim",":"]})," ",l.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:nE(t.currentExp)})]}),l.jsxs("div",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Danh vng:"}),t.fame?l.jsx("span",{className:`ml-2 ${re(t.fame)}`,children:t.fame}):l.jsx("span",{className:"ml-2 text-gray-500 dark:text-gray-400 italic",children:t.type==="pc"?"Cha c danh ting":"Cha xc nh"})]}),t.personality&&l.jsxs("div",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Tnh cch (B ngoi):"}),l.jsx("p",{className:"pl-2 mt-1 text-sm",children:t.personality})]}),t.motivation&&l.jsxs("div",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"ng c:"}),l.jsx("p",{className:"pl-2 mt-1 text-sm",children:t.motivation})]}),t.type!=="pc"&&t.personalityMbti&&Mn[t.personalityMbti]&&l.jsxs("div",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Tnh cch (Ct li):"}),l.jsxs("p",{className:"pl-2 mt-1 text-sm",children:[` ${Mn[t.personalityMbti].title} (${t.personalityMbti}) - `,l.jsx("span",{className:"italic",children:`"${Mn[t.personalityMbti].description}"`})]})]})]}),t.type==="location"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Tnh trng an ton:"}),(se=t.description)!=null&&se.toLowerCase().includes("an ton")?l.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 text-sm font-medium rounded-full border border-green-300 dark:border-green-700",children:" An ton"}):l.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 text-sm font-medium rounded-full border border-yellow-300 dark:border-yellow-700",children:" Cha r"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Trng thi khm ph:"}),l.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 text-sm font-medium rounded-full border border-blue-300 dark:border-blue-700",children:"  khm ph"})]}),t.location&&l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Thuc khu vc:"}),l.jsx("span",{className:"text-slate-600 dark:text-gray-400",children:t.location})]})]}),t.mastery&&t.type==="skill"&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Mc  thnh tho:"})," ",l.jsx("span",{className:"text-cyan-600 dark:text-cyan-400 font-semibold",children:t.mastery})]})]}),t.type==="pc"&&t.learnedSkills&&Array.isArray(t.learnedSkills)&&t.learnedSkills.length>0&&l.jsxs("div",{className:"pt-3 mt-3 border-t border-slate-200 dark:border-slate-700/60",children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"K nng  hc:"}),l.jsx("ul",{className:"list-disc list-inside pl-2 mt-1 space-y-1",children:t.learnedSkills.map(oe=>l.jsx("li",{className:"text-sm text-slate-600 dark:text-gray-400",children:oe},oe))})]}),(t.type==="npc"||t.type==="companion")&&l.jsxs("div",{className:"pt-3 mt-3 border-t border-slate-200 dark:border-slate-700/60 space-y-3",children:[l.jsxs("div",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Quan h:"}),t.relationship?l.jsx("span",{className:`ml-2 ${de(t.relationship)}`,children:ae(t.relationship)}):l.jsx("span",{className:"ml-2 text-gray-500 dark:text-gray-400 italic",children:"Cha xc nh"})]}),Array.isArray(t.skills)&&t.skills.length>0&&l.jsxs("div",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"K nng:"}),l.jsx("ul",{className:"list-disc list-inside pl-2 mt-1 space-y-1",children:t.skills.map(oe=>l.jsx("li",{className:"text-sm text-slate-600 dark:text-gray-400",children:oe},oe))})]})]}),(t.type==="pc"||t.type==="npc"||t.type==="companion")&&l.jsxs("div",{className:"pt-3 mt-3 border-t border-slate-200 dark:border-slate-700/60",children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Trng thi hin ti:"}),z.length>0?l.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:z.map(oe=>l.jsxs("div",{className:"relative group",children:[l.jsxs("button",{onClick:()=>p(oe),className:`px-3 py-1.5 border rounded-lg transition-all duration-200 flex items-center gap-2 hover:scale-105 ${Rr(oe)} hover:bg-slate-200 dark:hover:bg-slate-700/50 focus:outline-none focus:ring-2 ${Rr(oe).replace("border-","ring-").replace("/50","")} shadow-sm`,children:[l.jsx("span",{className:"w-4 h-4",children:gd(oe)}),l.jsx("span",{className:`${xd(oe)} ${$0(oe)} text-sm`,children:oe.name}),oe.duration&&oe.duration!=="permanent"&&l.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:["(",oe.duration,")"]})]}),(t.type==="pc"||t.type==="npc"||t.type==="companion")&&R&&l.jsx("button",{onClick:_=>{_.stopPropagation(),window.confirm(`Bn c chc chn mun xa trng thi "${oe.name}"?`)&&R(oe.name,t.name)},className:"absolute -top-2 -right-2 w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-full text-xs flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 shadow-lg z-10",title:`Xa trng thi: ${oe.name}`,children:""})]},oe.name))}):l.jsx("div",{className:"mt-2 p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700",children:l.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic text-center",children:t.type==="pc"?"ang trong tnh trng bnh thng":"Khng c trng thi c bit"})})]}),t.type==="item"&&l.jsxs("div",{className:"pt-3 mt-3 border-t border-slate-200 dark:border-slate-700/60 space-y-2",children:[typeof t.durability=="number"&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:" bn:"}),l.jsxs("span",{className:t.durability<=0?"text-red-600 dark:text-red-400 font-bold":t.durability<=20?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400",children:[` ${t.durability} / 100 `,t.durability<=0&&l.jsx("span",{className:"ml-2",children:"(Hng)"}),t.durability>0&&t.durability<=20&&l.jsx("span",{className:"ml-2",children:"(Sp hng)"})]})]}),typeof t.uses=="number"&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"S ln dng:"}),l.jsxs("span",{className:t.uses<=0?"text-red-600 dark:text-red-400":t.uses<=2?"text-yellow-600 dark:text-yellow-400":"",children:[t.uses,t.uses<=0&&l.jsx("span",{className:"ml-2",children:"( ht)"}),t.uses>0&&t.uses<=2&&l.jsx("span",{className:"ml-2",children:"(Sp ht)"})]})]}),t.owner&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Ch s hu:"})," ",t.owner]})]}),l.jsxs("div",{className:"pt-3 mt-3 border-t border-slate-200 dark:border-slate-700/60",children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"M t:"}),l.jsx("p",{className:"mt-2 text-sm leading-relaxed bg-slate-50 dark:bg-slate-800/30 p-3 rounded-lg border border-slate-200 dark:border-slate-700",children:t.description||"Cha c m t."})]}),t.type==="location"&&l.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-700/60",children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 mb-3 block",children:"Hnh ng nhanh:"}),l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsx("button",{onClick:()=>{e()},className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-medium transition-colors duration-200 flex items-center justify-center gap-2 text-sm",children:" Xem trn bn "}),l.jsx("button",{onClick:()=>{g&&g(`i ti ${t.name}`),e()},className:"px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md font-medium transition-colors duration-200 flex items-center justify-center gap-2 text-sm",children:" i ti y"}),l.jsx("button",{onClick:()=>{g&&g(`Khm ph ${t.name}`),e()},className:"px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md font-medium transition-colors duration-200 flex items-center justify-center gap-2 text-sm",children:" Khm ph"}),l.jsx("button",{onClick:()=>{g&&g(`Ghi ch v ${t.name}`),e()},className:"px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-md font-medium transition-colors duration-200 flex items-center justify-center gap-2 text-sm",children:" Ghi ch"})]})]}),t.type==="item"&&J&&l.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-700/60 flex flex-col space-y-2",children:[ne&&(t.equipped?l.jsx("button",{onClick:()=>u(t.name),className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-md font-semibold transition-colors duration-200 flex items-center justify-center gap-2",children:" G trang b"}):l.jsx("button",{onClick:()=>a(t.name),className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md font-semibold transition-colors duration-200 flex items-center justify-center gap-2",children:" Trang b"})),$&&(t.quantities===void 0||t.quantities>0||t.uses===void 0||t.uses>0)&&l.jsxs("button",{onClick:()=>i(t.name),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-semibold transition-colors duration-200 flex items-center justify-center gap-2",children:[" S dng ",t.quantities&&`(${t.quantities} ln)`||t.uses&&`(${t.uses} ln)`]}),P&&l.jsx("button",{onClick:()=>s(t.name),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md font-semibold transition-colors duration-200 flex items-center justify-center gap-2",children:" Hc cng php"})]})]})]})})},sE=({status:t,onClose:e})=>{if(!t)return null;const i=xd(t),s=Rr(t).replace("/50","/80");return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[110] p-4",onClick:e,children:l.jsxs("div",{className:`bg-white/90 dark:bg-[#2a2f4c]/90 backdrop-blur-sm border-2 ${s} rounded-lg shadow-2xl w-full max-w-md text-slate-900 dark:text-white`,onClick:a=>a.stopPropagation(),children:[l.jsxs("div",{className:`p-4 border-b-2 ${s} flex justify-between items-center`,children:[l.jsxs("h3",{className:`text-xl font-bold ${i} flex items-center gap-2`,children:[l.jsx("span",{className:"w-6 h-6",children:gd(t)}),t.name]}),l.jsx("button",{onClick:e,className:"text-gray-500 dark:text-gray-400 hover:text-slate-900 dark:hover:text-white text-3xl leading-none",children:""})]}),l.jsxs("div",{className:"p-6 space-y-4 text-slate-700 dark:text-gray-300",children:[l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-slate-800 dark:text-gray-100 text-sm uppercase tracking-wider mb-1",children:"M t"}),l.jsxs("p",{className:"italic text-base",children:['"',t.description||"Khng c m t chi tit.",'"']})]}),l.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700/60 mt-4 pt-4 space-y-3",children:[t.effects&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 w-32 inline-block",children:"Hiu ng:"})," ",t.effects]}),t.duration&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 w-32 inline-block",children:"Thi gian:"})," ",t.duration]}),t.cureConditions&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 w-32 inline-block",children:"Cch cha tr:"})," ",t.cureConditions]}),t.source&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 w-32 inline-block",children:"Ngun gc:"})," ",t.source]})]})]})]})})},oE=t=>t?t.status==="completed"?l.jsx(E0,{}):t.status==="failed"?l.jsx(An,{}):l.jsx(zn,{}):l.jsx(zn,{}),lE=({quest:t,onClose:e})=>t?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[105] p-4",onClick:e,children:l.jsxs("div",{className:"bg-white/90 dark:bg-[#2a2f4c]/90 backdrop-blur-sm border-2 border-yellow-400/80 rounded-lg shadow-2xl w-full max-w-lg text-slate-900 dark:text-white",onClick:i=>i.stopPropagation(),children:[l.jsxs("div",{className:"p-4 border-b-2 border-yellow-400/80 flex justify-between items-center",children:[l.jsxs("h3",{className:"text-xl font-bold text-yellow-700 dark:text-yellow-300 flex items-center gap-2",children:[l.jsx("span",{className:"w-6 h-6",children:oE(t)}),t.title]}),l.jsx("button",{onClick:e,className:"text-gray-500 dark:text-gray-400 hover:text-slate-900 dark:hover:text-white text-3xl leading-none",children:""})]}),l.jsxs("div",{className:"p-5 space-y-4 text-slate-700 dark:text-gray-300 max-h-[60vh] overflow-y-auto",children:[l.jsx("p",{className:"italic",children:t.description}),l.jsxs("div",{className:"mt-4 pt-4 border-t border-yellow-500/30",children:[l.jsx("h4",{className:"font-semibold text-slate-800 dark:text-gray-100 mb-2",children:"Mc tiu:"}),l.jsx("ul",{className:"space-y-1.5 list-inside",children:t.objectives.map((i,s)=>l.jsxs("li",{className:`flex items-center ${i.completed?"text-gray-500 line-through":"text-yellow-800 dark:text-yellow-100"}`,children:[l.jsx("span",{className:"mr-3",children:i.completed?"":""}),l.jsx("span",{children:i.description})]},s))})]}),l.jsxs("div",{className:"mt-4 pt-4 border-t border-yellow-500/30 grid grid-cols-2 gap-4 text-sm",children:[t.giver&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 block",children:"Ngi giao:"})," ",t.giver]}),l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 block",children:"Trng thi:"})," ",l.jsx("span",{className:"capitalize",children:t.status})]}),t.reward&&l.jsxs("p",{className:"col-span-2",children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 block",children:"Phn thng:"})," ",t.reward]})]})]})]})}):null,aE=({isOpen:t,onClose:e,memories:i,onTogglePin:s,gameState:a})=>{if(!t)return null;const u=50,f=E.useMemo(()=>a?i.map((v,C)=>{const N=Gl.calculateMemoryScore(v,a);return{...v,originalIndex:C,importanceScore:N.score,importanceReasons:N.reasons}}):i.map((v,C)=>({...v,originalIndex:C,importanceScore:v.importance||0,importanceReasons:[]})),[i,a]),p=f.filter(v=>v.pinned),g=f.filter(v=>!v.pinned),y=g.sort((v,C)=>C.importanceScore!==v.importanceScore?C.importanceScore-v.importanceScore:C.originalIndex-v.originalIndex).slice(0,u);return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:e,children:l.jsxs("div",{className:"bg-white/90 dark:bg-[#252945]/90 backdrop-blur-sm border border-slate-300 dark:border-slate-700 rounded-lg shadow-xl w-full max-w-lg text-slate-900 dark:text-white",onClick:v=>v.stopPropagation(),children:[l.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-600",children:[l.jsxs("div",{className:"flex justify-between items-center mb-2",children:[l.jsx("h3",{className:"text-lg font-semibold",children:"Dng K c"}),l.jsx("button",{onClick:e,className:"text-gray-500 dark:text-gray-400 hover:text-slate-900 dark:hover:text-white text-2xl leading-none",children:""})]}),l.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-600 dark:text-slate-400",children:[l.jsxs("span",{children:[" ",p.length,"  ghim"]}),l.jsxs("span",{children:[" ",i.length," tng cng"]}),a&&l.jsx("span",{children:" Sp xp theo  quan trng"})]})]}),l.jsx("div",{className:"p-4 max-h-96 overflow-y-auto",children:p.length>0||y.length>0?l.jsxs("ul",{className:"space-y-3",children:[p.map(v=>l.jsx("li",{className:"flex flex-col gap-2 text-sm text-slate-700 dark:text-gray-300 border-l-4 border-yellow-400 pl-3 py-2 bg-yellow-400/10 rounded-r-md",children:l.jsxs("div",{className:"flex items-start justify-between gap-3",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("span",{className:"text-xs font-medium text-yellow-700 dark:text-yellow-300",children:" PINNED"}),a&&l.jsxs("span",{className:"text-xs px-1.5 py-0.5 bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200 rounded",children:[v.importanceScore,"/100"]}),v.category&&l.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded",children:v.category})]}),l.jsx("span",{className:"leading-relaxed",children:v.text}),v.relatedEntities&&v.relatedEntities.length>0&&l.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[v.relatedEntities.slice(0,3).map(C=>l.jsx("span",{className:"text-xs px-1 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded",children:C},C)),v.relatedEntities.length>3&&l.jsxs("span",{className:"text-xs text-slate-500",children:["+",v.relatedEntities.length-3," more"]})]})]}),l.jsx("button",{onClick:()=>s(v.originalIndex),className:"p-1 rounded-full transition-colors bg-yellow-400 text-slate-800 hover:bg-yellow-500 flex-shrink-0","aria-label":"B ghim",children:l.jsx(yg,{className:"w-4 h-4"})})]})},v.originalIndex)),p.length>0&&y.length>0&&l.jsx("hr",{className:"my-3 border-slate-300 dark:border-slate-600"}),y.map(v=>{const C=R=>R>=80?"border-red-500 bg-red-50 dark:bg-red-900/20":R>=60?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":R>=40?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-400 bg-slate-50 dark:bg-slate-800/20",N=R=>R>=80?"text-red-700 dark:text-red-300 bg-red-200 dark:bg-red-800":R>=60?"text-orange-700 dark:text-orange-300 bg-orange-200 dark:bg-orange-800":R>=40?"text-blue-700 dark:text-blue-300 bg-blue-200 dark:bg-blue-800":"text-slate-700 dark:text-slate-300 bg-slate-200 dark:bg-slate-700";return l.jsx("li",{className:`flex flex-col gap-2 text-sm text-slate-700 dark:text-gray-300 border-l-2 pl-3 py-2 rounded-r-md ${C(v.importanceScore)}`,children:l.jsxs("div",{className:"flex items-start justify-between gap-3",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a&&l.jsxs("span",{className:`text-xs px-1.5 py-0.5 rounded font-medium ${N(v.importanceScore)}`,children:[v.importanceScore,"/100"]}),v.category&&l.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded",children:v.category}),v.source&&l.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 rounded",children:v.source})]}),l.jsx("span",{className:"leading-relaxed",children:v.text}),v.relatedEntities&&v.relatedEntities.length>0&&l.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[v.relatedEntities.slice(0,3).map(R=>l.jsx("span",{className:"text-xs px-1 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded",children:R},R)),v.relatedEntities.length>3&&l.jsxs("span",{className:"text-xs text-slate-500",children:["+",v.relatedEntities.length-3," more"]})]}),v.tags&&v.tags.length>0&&l.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:v.tags.slice(0,4).map(R=>l.jsxs("span",{className:"text-xs px-1 py-0.5 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded",children:["#",R]},R))})]}),l.jsx("button",{onClick:()=>s(v.originalIndex),className:"p-1 rounded-full transition-colors bg-slate-500 dark:bg-slate-600 hover:bg-slate-400 dark:hover:bg-slate-500 text-white flex-shrink-0","aria-label":"Ghim",children:l.jsx(yg,{className:"w-4 h-4"})})]})},v.originalIndex)}),g.length>u&&l.jsxs("p",{className:"text-xs text-center text-slate-500 dark:text-slate-400 pt-2",children:["...v ",g.length-u," k c c hn  b n. Ghim li k c quan trng  chng lun hin th."]})]}):l.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:"Cha c k c mi."})})]})})};function rE(t,e){const[i,s]=E.useState(t);return E.useEffect(()=>{const a=setTimeout(()=>{s(t)},e);return()=>{clearTimeout(a)}},[t,e]),i}function cE(t,e,i=[]){const s=E.useRef(null),a=E.useRef(t);E.useEffect(()=>{a.current=t},[t,...i]);const u=E.useCallback((...f)=>{s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{a.current.apply(void 0,f)},e)},[e]);return E.useEffect(()=>()=>{s.current&&clearTimeout(s.current)},[]),u}function uE(t,e){const{itemHeight:i,containerHeight:s,overscan:a=5,threshold:u=50}=e,[f,p]=E.useState(0),g=E.useRef(null),m=t.length>u,y=E.useMemo(()=>{if(!m)return{start:0,end:t.length};const J=Math.ceil(s/i),P=Math.floor(f/i),$=Math.min(P+J+a,t.length);return{start:Math.max(0,P-a),end:$}},[f,i,s,a,t.length,m]),v=E.useMemo(()=>m?t.slice(y.start,y.end).map((J,P)=>({item:J,index:y.start+P})):t.map((J,P)=>({item:J,index:P})),[t,y,m]),C=m?t.length*i:"auto",N=m?y.start*i:0,R=E.useCallback(J=>{m&&p(J.currentTarget.scrollTop)},[m]),L=E.useCallback(()=>{const J=g.current;J&&(J.scrollTop=J.scrollHeight)},[]),O=E.useCallback(J=>{const P=g.current;if(P&&m){const $=J*i;P.scrollTop=$}},[i,m]);return{containerRef:g,visibleItems:v,totalHeight:C,offsetY:N,handleScroll:R,scrollToBottom:L,scrollToItem:O,shouldVirtualize:m,visibleRange:y}}const dE=({isOpen:t,onClose:e,pc:i,knownEntities:s,onEntityClick:a,turnCount:u})=>{if(!t)return null;const[f,p]=E.useState(""),[g,m]=E.useState("all"),[y,v]=E.useState({}),[C,N]=E.useState({}),[R,L]=E.useState({}),O=rE(f,300),J=E.useCallback(Y=>{L(ue=>{const H=ue[Y]||{count:0};return{...ue,[Y]:{count:H.count+1,lastAccessed:Date.now()}}})},[]),P=E.useCallback(Y=>{v(ue=>({...ue,[Y]:!ue[Y]}))},[]),$=E.useCallback(Y=>{N(ue=>({...ue,[Y]:!ue[Y]}))},[]),ne=E.useMemo(()=>{const Y={};Object.values(s).forEach(k=>{var S;if(k.type==="item")k.owner==="pc"&&(Y.inventory||(Y.inventory=[]),Y.inventory.push(k)),Y.item_encyclopedia||(Y.item_encyclopedia=[]),Y.item_encyclopedia.push(k);else{if(k.type==="npc"&&k.name===(i==null?void 0:i.name))return;Y[k.type]||(Y[k.type]=[]),(S=Y[k.type])==null||S.push(k)}});const ue=Object.values(s).filter(k=>y[k.name]&&k.name!==(i==null?void 0:i.name));ue.length>0&&(Y.bookmarked=ue);const H=Object.values(s).filter(k=>R[k.name]&&k.name!==(i==null?void 0:i.name)).sort((k,S)=>{var V,W;return(((V=R[S.name])==null?void 0:V.lastAccessed)||0)-(((W=R[k.name])==null?void 0:W.lastAccessed)||0)}).slice(0,10);return H.length>0&&(Y.recent=H),Y},[s,i==null?void 0:i.name,y,R]),z={bookmarked:"  nh Du",recent:" Gn y",skill:"K nng & Cng php",inventory:"Hnh Trang Nhn Vt",npc:"Nhn vt  gp",location:"a im  bit",item_encyclopedia:"Bch Khoa Vt Phm",faction:"Th lc & T chc",companion:"ng hnh",concept:"Khi Nim & Quy Tc"},ae=["bookmarked","recent","skill","inventory","npc","companion","location","faction","item_encyclopedia","concept"],de=E.useMemo(()=>{const Y=[{key:"all",title:"Tt c"}];return ae.forEach(ue=>{ne[ue]&&ne[ue].length>0&&Y.push({key:ue,title:z[ue]})}),Y},[ne]),re=E.useMemo(()=>{if(g==="all"&&!O)return ne;const Y=O.toLowerCase(),ue={};return Object.keys(ne).forEach(H=>{if(g!=="all"&&H!==g)return;const S=ne[H].filter(V=>V.name.toLowerCase().includes(Y)||V.description.toLowerCase().includes(Y));S.length>0&&(ue[H]=S.sort((V,W)=>{var F,Z;if(y[V.name]&&!y[W.name])return-1;if(!y[V.name]&&y[W.name])return 1;const I=((F=R[V.name])==null?void 0:F.count)||0,j=((Z=R[W.name])==null?void 0:Z.count)||0;return I!==j?j-I:V.name.localeCompare(W.name)}))}),ue},[O,g,ne,y,R]),se=E.useMemo(()=>Object.keys(re).length>0,[re]),oe=Y=>{J(Y),a(Y)};E.useEffect(()=>{if(!t)return;const Y=ue=>{if(ue.ctrlKey||ue.metaKey)switch(ue.key){case"k":case"f":ue.preventDefault();const H=document.querySelector("#knowledge-search");H==null||H.focus();break}ue.key==="Escape"&&e()};return document.addEventListener("keydown",Y),()=>document.removeEventListener("keydown",Y)},[t,e]);const _=32,me=240;return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[60] p-4",onClick:e,children:l.jsxs("div",{className:"bg-white/90 dark:bg-[#2a2f4c]/90 backdrop-blur-sm border-2 border-slate-300 dark:border-slate-600 rounded-lg shadow-2xl w-full max-w-4xl h-full max-h-[85vh] text-slate-900 dark:text-white flex flex-col",onClick:Y=>Y.stopPropagation(),children:[l.jsxs("div",{className:"p-4 border-b-2 border-slate-200 dark:border-slate-600 flex justify-between items-center flex-shrink-0",children:[l.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-200 flex items-center gap-3",children:[l.jsx(jr,{className:"w-6 h-6"}),"Tri Thc Th Gii"]}),l.jsx("button",{onClick:e,className:"text-gray-500 dark:text-gray-400 hover:text-slate-900 dark:hover:text-white text-3xl leading-none",children:l.jsx(An,{className:"w-6 h-6"})})]}),l.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-600 flex-shrink-0 space-y-3",children:[l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:l.jsx(ow,{className:"w-5 h-5 text-gray-400"})}),l.jsx("input",{id:"knowledge-search",type:"text",placeholder:"Tm kim thc th... (Ctrl+K)",value:f,onChange:Y=>p(Y.target.value),className:"w-full bg-slate-100 dark:bg-slate-900/50 border border-slate-300 dark:border-slate-500 rounded-md py-2 pl-10 pr-4 text-sm text-slate-800 dark:text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"}),f!==O&&l.jsx("div",{className:"absolute right-3 top-2",children:l.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full"})})]}),l.jsx("div",{className:"flex flex-wrap gap-2",children:de.map(Y=>l.jsx("button",{onClick:()=>m(Y.key),className:`px-3 py-1 text-xs font-semibold rounded-full transition-colors duration-200 border ${g===Y.key?"bg-purple-600 border-purple-600 text-white":"bg-slate-200 dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-300 dark:hover:bg-slate-600"}`,children:Y.title},Y.key))})]}),l.jsxs("div",{className:"p-5 flex-grow overflow-y-auto",children:[i&&l.jsxs("div",{className:"bg-slate-200/50 dark:bg-slate-800/50 p-4 rounded-lg mb-6",children:[l.jsxs("h4",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-400 flex items-center gap-2",children:[l.jsx("span",{className:"w-5 h-5",children:Cs(i)}),i.name," - Lt: ",u]}),l.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300 italic mt-1",children:['"',i.description,'"']}),l.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-2",children:[l.jsx("b",{children:"Tnh cch:"})," ",i.personality]}),i.realm&&l.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:[l.jsx("b",{children:"Cnh gii:"})," ",i.realm]})]}),se?l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:ae.map(Y=>{const ue=re[Y];if(!ue||ue.length===0)return null;const H=C[Y],k=ue.length>15;return l.jsxs("div",{children:[l.jsxs("button",{onClick:()=>$(Y),className:"w-full text-left font-semibold text-purple-700 dark:text-purple-300 mb-2 border-b border-purple-400/20 pb-1 flex items-center gap-2 hover:text-purple-600 dark:hover:text-purple-200 transition-colors",children:[l.jsx("span",{className:`transform transition-transform duration-200 ${H?"-rotate-90":"rotate-0"}`,children:""}),z[Y],l.jsxs("span",{className:"text-xs text-gray-500",children:["(",ue.length,")"]})]}),!H&&(k?l.jsx(q0,{entities:ue,category:Y,knownEntities:s,bookmarkedEntities:y,entityAccess:R,onEntityClick:oe,onToggleBookmark:P,containerHeight:me,itemHeight:_}):l.jsx("ul",{className:"space-y-1.5 max-h-60 overflow-y-auto pr-2",children:ue.map(S=>{var V;return l.jsx(yd,{entity:S,category:Y,knownEntities:s,isBookmarked:y[S.name],accessCount:(V=R[S.name])==null?void 0:V.count,onEntityClick:oe,onToggleBookmark:P},S.name)})}))]},Y)})}):l.jsx("div",{className:"text-center py-10 text-slate-500 dark:text-slate-400",children:l.jsx("p",{children:"Khng tm thy kt qu no."})})]})]})})},B0=E.memo(dE);B0.displayName="KnowledgeBaseModal";const hE=({entity:t,category:e,knownEntities:i,isBookmarked:s,accessCount:a,onEntityClick:u,onToggleBookmark:f})=>l.jsxs("li",{className:"group",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("button",{onClick:()=>u(t.name),className:"text-left flex-1 text-cyan-700 dark:text-cyan-300 hover:text-cyan-800 dark:hover:text-cyan-100 hover:underline text-sm flex items-center gap-2",children:[l.jsx("span",{className:"w-4 h-4 flex-shrink-0",children:Cs(t)}),l.jsxs("span",{children:[t.name,e==="inventory"&&t.equipped&&l.jsx("span",{className:"text-xs text-green-400 dark:text-green-500 ml-2 font-normal italic",children:"(ang trang b)"}),(t.type==="skill"||t.type==="npc")&&t.realm?` (${t.realm})`:"",a&&a>1&&l.jsxs("span",{className:"text-xs text-gray-400 ml-2",children:["(",a,")"]})]})]}),l.jsx("button",{onClick:()=>f(t.name),className:`opacity-0 group-hover:opacity-100 transition-opacity text-sm ${s?"text-yellow-500":"text-gray-400 hover:text-yellow-500"}`,title:s?"B nh du":"nh du",children:""})]}),t.type==="npc"&&Array.isArray(t.skills)&&t.skills.length>0&&l.jsx("div",{className:"pl-6 text-xs text-slate-600 dark:text-slate-400 space-y-0.5 mt-1",children:t.skills.map(p=>{const g=i[p],m=Cs(g||{name:p,type:"skill"});return l.jsxs("div",{className:"flex items-center gap-1.5",children:[l.jsx("span",{className:"w-3 h-3",children:m}),l.jsxs("span",{children:[p," ",g!=null&&g.realm?`(${g.realm})`:""]})]},p)})})]}),yd=E.memo(hE);yd.displayName="EntityListItem";const fE=({entities:t,category:e,knownEntities:i,bookmarkedEntities:s,entityAccess:a,onEntityClick:u,onToggleBookmark:f,containerHeight:p,itemHeight:g})=>{const{containerRef:m,visibleItems:y,totalHeight:v,offsetY:C,handleScroll:N,shouldVirtualize:R}=uE(t,{itemHeight:g,containerHeight:p,overscan:5,threshold:15});return l.jsx("div",{ref:m,className:"max-h-60 overflow-y-auto pr-2",style:{height:p},onScroll:N,children:l.jsx("div",{style:{height:v,position:"relative"},children:l.jsx("div",{style:{transform:`translateY(${C}px)`},children:(R?y:t.map((L,O)=>({item:L,index:O}))).map(({item:L,index:O})=>{var J;return l.jsx("div",{style:{height:g},children:l.jsx(yd,{entity:L,category:e,knownEntities:i,isBookmarked:s[L.name],accessCount:(J=a[L.name])==null?void 0:J.count,onEntityClick:u,onToggleBookmark:f})},L.name)})})})})},q0=E.memo(fE);q0.displayName="VirtualizedEntityList";const mE=({isOpen:t,onClose:e,onSave:i,currentRules:s})=>{if(!t)return null;const[a,u]=E.useState(s.map(A=>!A.keywords&&!A.title&&!A.order?Zt.migrateLegacyRule(A):A)),[f,p]=E.useState("simple"),[g,m]=E.useState("priority"),[y,v]=E.useState("all"),[C,N]=E.useState(""),[R,L]=E.useState(null),O=E.useRef(null),J=E.useRef(null),P=E.useRef(null),$=E.useMemo(()=>{let A=a;if(C.trim()){const G=C.toLowerCase();A=A.filter(M=>{var D,B,X;return((D=M.title)==null?void 0:D.toLowerCase().includes(G))||M.content.toLowerCase().includes(G)||((B=M.keywords)==null?void 0:B.some(xe=>xe.toLowerCase().includes(G)))||((X=M.category)==null?void 0:X.toLowerCase().includes(G))})}switch(y!=="all"&&(A=A.filter(G=>G.category===y)),g){case"priority":return Zt.sortByPriority(A);case"alphabetical":return A.sort((G,M)=>(G.title||G.id).localeCompare(M.title||M.id));case"category":return A.sort((G,M)=>(G.category||"general").localeCompare(M.category||"general"));case"recent":return A.sort((G,M)=>(M.createdAt||0)-(G.createdAt||0));default:return A}},[a,C,y,g]),ne=()=>{const A=[];if(a.forEach((G,M)=>{const D=Zt.validateRule(G);D.isValid||A.push(`Lut ${M+1}: ${D.errors.join(", ")}`)}),A.length>0){alert(`C li trong cu hnh lut:
`+A.join(`
`));return}i(a),e()},z=()=>{const A=Zt.createDefaultRule();u(G=>[...G,A]),L(A.id)},ae=A=>{u(G=>G.filter(M=>M.id!==A)),R===A&&L(null)},de=A=>{const G={...A,id:Date.now().toString(),title:`${A.title||"Lut"} (Sao chp)`,createdAt:Date.now(),activationCount:0,lastActivated:void 0};u(M=>[...M,G])},re=(A,G)=>{u(M=>M.map(D=>{if(D.id===A){const B={...D,...G};return G.content!==void 0&&(B.tokenWeight=Zt.estimateTokenWeight(B.content)),B}return D}))},se=A=>{if(!A.trim())return[];const G=[];let M="",D=!1,B=!1;for(let X=0;X<A.length;X++){const xe=A[X];if(A[X+1],(xe==='"'||xe==="'"||xe==="`")&&!B){D=!D;continue}if(xe==="["&&!D){B=!0;continue}if(xe==="]"&&!D){B=!1,M.trim()&&(G.push(M.trim()),M="");continue}if((xe===","||xe===";")&&!D&&!B){M.trim()&&(G.push(M.trim()),M="");continue}if(/\s/.test(xe)&&!D&&!B){M.trim()&&(G.push(M.trim()),M="");continue}M+=xe}return M.trim()&&G.push(M.trim()),G.filter(X=>X.length>0).filter(X=>X.length<=100).slice(0,20)},oe=A=>!A||A.length===0?"":A.map(G=>G.includes(" ")?`"${G}"`:G).join(", "),[_,me]=E.useState({}),[Y,ue]=E.useState({});Me.useEffect(()=>{const A={},G={};a.forEach(M=>{_[M.id]||(A[M.id]=oe(M.keywords)),Y[M.id]||(G[M.id]=oe(M.secondaryKeywords))}),Object.keys(A).length>0&&me(M=>({...M,...A})),Object.keys(G).length>0&&ue(M=>({...M,...G}))},[a.length]);const H=(A,G)=>{re(A,{isActive:G})},k=()=>{if(a.length===0){alert("Khng c lut no  lu.");return}const A=Zt.exportRulesToJSON(a),G=new Blob([A],{type:"application/json"}),M=URL.createObjectURL(G),D=document.createElement("a"),B=new Date().toISOString().replace(/[:.]/g,"-");D.download=`AI-RolePlay-EnhancedRules-${B}.json`,D.href=M,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(M)},S=()=>{var A;(A=O.current)==null||A.click()},V=()=>{var A;(A=P.current)==null||A.click()},W=A=>{const G=Zt.createDefaultRule();return G.id=`worldinfo-${A.uid||Date.now()}-${Math.random()}`,G.title=A.comment||`World Info Entry ${A.uid||""}`,G.content=A.content||"",G.isActive=!A.disable,G.keywords=Array.isArray(A.key)?A.key:[],G.secondaryKeywords=Array.isArray(A.keysecondary)?A.keysecondary:[],A.selectiveLogic!==void 0&&(G.logic=A.selectiveLogic),G.order=A.order||100,G.probability=A.useProbability&&A.probability||100,G.scanDepth=A.depth||A.scanDepth||5,G.caseSensitive=A.caseSensitive===!0,G.matchWholeWords=A.matchWholeWords===!0,G.maxActivationsPerTurn=A.sticky>0?void 0:1,G.createdAt=Date.now(),G.category=A.group||"worldinfo",G.tokenWeight=Zt.estimateTokenWeight(G.content),G},I=A=>{var D;const G=(D=A.target.files)==null?void 0:D[0];if(!G)return;const M=new FileReader;M.onload=B=>{var X;try{const xe=(X=B.target)==null?void 0:X.result;if(typeof xe=="string"){const{rules:Ne,errors:Te}=Zt.importRulesFromJSON(xe);if(Te.length>0&&alert(`Cnh bo khi nhp file:
`+Te.join(`
`)),Ne.length>0){const Ee=new Set(a.map(ye=>ye.id)),Re=Ne.map(ye=>Ee.has(ye.id)?{...ye,id:`${Date.now()}-${Math.random()}`}:ye);u(ye=>[...ye,...Re]),alert(` nhp thnh cng ${Re.length} lut.`)}}}catch(xe){console.error("Li khi ti file lut:",xe),alert("Khng th c file lut. File c th b hng hoc khng ng nh dng.")}},M.readAsText(G),A.target&&(A.target.value="")},j=A=>{var D;const G=(D=A.target.files)==null?void 0:D[0];if(!G)return;const M=new FileReader;M.onload=B=>{var X;try{const xe=(X=B.target)==null?void 0:X.result;if(typeof xe=="string"){const Ne=JSON.parse(xe);if(!Ne.entries||typeof Ne.entries!="object"){alert('Khng phi file WorldInfo hp l ca SillyTavern. File cn c nh dng: {"entries": {...}}');return}const Te=[],Ee=[];if(Object.values(Ne.entries).forEach((Re,ye)=>{try{if(Re&&typeof Re=="object"){const we=W(Re);we.content.trim()&&Te.push(we)}}catch(we){Ee.push(`Entry ${ye+1}: ${we instanceof Error?we.message:"Unknown error"}`)}}),Ee.length>0&&(console.warn("Errors during WorldInfo conversion:",Ee),alert(` convert thnh cng ${Te.length} rules, c ${Ee.length} li. Xem console  bit chi tit.`)),Te.length>0){const Re=new Set(a.map(we=>we.id)),ye=Te.map(we=>Re.has(we.id)?{...we,id:`${Date.now()}-${Math.random()}`}:we);u(we=>[...we,...ye]),alert(` nhp thnh cng ${ye.length} WorldInfo entries t SillyTavern!`)}else alert("Khng tm thy WorldInfo entries hp l no trong file.")}}catch(xe){console.error("Li khi c file WorldInfo:",xe),alert("Khng th c file WorldInfo. File c th b hng hoc khng ng nh dng JSON.")}},M.readAsText(G),A.target&&(A.target.value="")},F=(A,G)=>l.jsxs("div",{className:"bg-slate-200/50 dark:bg-[#373c5a]/50 p-3 rounded-lg border border-slate-300 dark:border-slate-600 space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("input",{type:"text",value:A.title||"",onChange:M=>re(A.id,{title:M.target.value}),placeholder:`Tiu  lut #${G+1}...`,className:"flex-1 bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-1 px-2 text-sm text-slate-800 dark:text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"}),l.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[l.jsxs("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:["u tin: ",A.order||100]}),l.jsx("button",{onClick:()=>L(R===A.id?null:A.id),className:"text-blue-600 hover:text-blue-500 text-xs px-2 py-1 rounded",children:R===A.id?"Thu gn":"Chi tit"})]})]}),l.jsx("textarea",{value:A.content,onChange:M=>re(A.id,{content:M.target.value}),placeholder:`Ni dung lut #${G+1}...`,className:"w-full h-24 bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-2 px-3 text-sm text-slate-800 dark:text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-y"}),l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsxs("label",{className:"flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:A.isActive,onChange:M=>H(A.id,M.target.checked),className:"h-4 w-4 rounded border-gray-400 bg-gray-700 text-purple-600 focus:ring-purple-500"}),l.jsx("span",{className:"ml-2 text-sm text-slate-700 dark:text-gray-300",children:"Hot ng"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("button",{onClick:()=>de(A),className:"px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded text-xs",children:"Sao chp"}),l.jsx("button",{onClick:()=>ae(A.id),className:"px-2 py-1 bg-red-700 hover:bg-red-600 text-white rounded text-xs",children:"Xa"})]})]})]},A.id),Z=(A,G)=>l.jsxs("div",{className:"bg-slate-200/50 dark:bg-[#373c5a]/50 p-4 rounded-lg border border-slate-300 dark:border-slate-600 space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between border-b border-slate-300 dark:border-slate-600 pb-2",children:[l.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[l.jsx("input",{type:"text",value:A.title||"",onChange:M=>re(A.id,{title:M.target.value}),placeholder:`Tiu  lut #${G+1}...`,className:"flex-1 bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-1 px-2 text-sm font-medium text-slate-800 dark:text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"}),l.jsx("select",{value:A.category||"general",onChange:M=>re(A.id,{category:M.target.value}),className:"bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-1 px-2 text-sm text-slate-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500",children:Zt.getAvailableCategories().map(M=>l.jsx("option",{value:M.value,children:M.label},M.value))})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("label",{className:"flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:A.isActive,onChange:M=>H(A.id,M.target.checked),className:"h-4 w-4 rounded border-gray-400 bg-gray-700 text-purple-600 focus:ring-purple-500"}),l.jsx("span",{className:"ml-1 text-sm text-slate-700 dark:text-gray-300",children:"Hot ng"})]}),l.jsx("button",{onClick:()=>de(A),className:"px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded text-xs",children:"Sao chp"}),l.jsx("button",{onClick:()=>ae(A.id),className:"px-2 py-1 bg-red-700 hover:bg-red-600 text-white rounded text-xs",children:"Xa"})]})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-1",children:"Ni dung lut:"}),l.jsx("textarea",{value:A.content,onChange:M=>re(A.id,{content:M.target.value}),placeholder:`Ni dung lut #${G+1}...`,className:"w-full h-20 bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-2 px-3 text-sm text-slate-800 dark:text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-y"})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-1",children:['T kha chnh (h tr cm t vi [du ngoc] hoc "du nhy"):',A.keywords&&A.keywords.length>0&&l.jsxs("span",{className:"ml-2 text-xs text-blue-600 dark:text-blue-400",children:["(",A.keywords.length," t kha)"]})]}),l.jsx("input",{type:"text",value:_[A.id]??oe(A.keywords),onChange:M=>{const D=M.target.value;me(X=>({...X,[A.id]:D}));const B=se(D);re(A.id,{keywords:B})},onBlur:M=>{const D=M.target.value,B=se(D);me(X=>({...X,[A.id]:oe(B)}))},placeholder:'rng [gi in thoi] "ni trong in thoi" la...',className:"w-full bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-1 px-2 text-sm text-slate-800 dark:text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-1",children:['T kha ph (h tr cm t vi [du ngoc] hoc "du nhy"):',A.secondaryKeywords&&A.secondaryKeywords.length>0&&l.jsxs("span",{className:"ml-2 text-xs text-green-600 dark:text-green-400",children:["(",A.secondaryKeywords.length," t kha)"]})]}),l.jsx("input",{type:"text",value:Y[A.id]??oe(A.secondaryKeywords),onChange:M=>{const D=M.target.value;ue(X=>({...X,[A.id]:D}));const B=se(D);re(A.id,{secondaryKeywords:B})},onBlur:M=>{const D=M.target.value,B=se(D);ue(X=>({...X,[A.id]:oe(B)}))},placeholder:'[hi th la] "thi la" bng-gi...',className:"w-full bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-1 px-2 text-sm text-slate-800 dark:text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-1",children:" u tin:"}),l.jsx("input",{type:"number",value:A.order||100,onChange:M=>re(A.id,{order:parseInt(M.target.value)||100}),min:"0",max:"1000",className:"w-full bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-1 px-2 text-sm text-slate-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-1",children:"Xc sut (%):"}),l.jsx("input",{type:"number",value:A.probability||100,onChange:M=>re(A.id,{probability:parseInt(M.target.value)||100}),min:"0",max:"100",className:"w-full bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-1 px-2 text-sm text-slate-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:A.alwaysActive||!1,onChange:M=>re(A.id,{alwaysActive:M.target.checked}),className:"h-4 w-4 rounded border-gray-400 bg-gray-700 text-purple-600 focus:ring-purple-500"}),l.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-gray-300",children:"Lun hot ng (b qua t kha)"})]}),l.jsx("p",{className:"text-xs text-slate-500 dark:text-gray-400 mt-1",children:"Khi bt, lut ny s lun c bao gm trong prompt m khng cn t kha"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-1",children:"Logic t kha:"}),l.jsxs("select",{value:A.logic||Ft.AND_ANY,onChange:M=>re(A.id,{logic:parseInt(M.target.value)}),className:"w-full bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-1 px-2 text-sm text-slate-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500",children:[l.jsx("option",{value:Ft.AND_ANY,children:"ANY"}),l.jsx("option",{value:Ft.AND_ALL,children:"ALL"}),l.jsx("option",{value:Ft.NOT_ALL,children:"NOT ALL"}),l.jsx("option",{value:Ft.NOT_ANY,children:"NOT ANY"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-1",children:" su qut:"}),l.jsx("input",{type:"number",value:A.scanDepth||5,onChange:M=>re(A.id,{scanDepth:parseInt(M.target.value)||5}),min:"1",max:"20",className:"w-full bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded-md py-1 px-2 text-sm text-slate-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-2",children:"Ty chn qut:"}),l.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[l.jsxs("label",{className:"flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:A.scanPlayerInput!==!1,onChange:M=>re(A.id,{scanPlayerInput:M.target.checked}),className:"h-3 w-3 rounded border-gray-400 text-purple-600 focus:ring-purple-500"}),l.jsx("span",{className:"ml-2 text-xs text-slate-700 dark:text-gray-300",children:"Lnh ngi chi"})]}),l.jsxs("label",{className:"flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:A.scanAIOutput!==!1,onChange:M=>re(A.id,{scanAIOutput:M.target.checked}),className:"h-3 w-3 rounded border-gray-400 text-purple-600 focus:ring-purple-500"}),l.jsx("span",{className:"ml-2 text-xs text-slate-700 dark:text-gray-300",children:"Phn hi AI"})]}),l.jsxs("label",{className:"flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:A.scanMemories!==!1,onChange:M=>re(A.id,{scanMemories:M.target.checked}),className:"h-3 w-3 rounded border-gray-400 text-purple-600 focus:ring-purple-500"}),l.jsx("span",{className:"ml-2 text-xs text-slate-700 dark:text-gray-300",children:"K c"})]})]}),l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-2",children:"Ty chn khp t kha:"}),l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsxs("label",{className:"flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:A.caseSensitive===!0,onChange:M=>re(A.id,{caseSensitive:M.target.checked}),className:"h-3 w-3 rounded border-gray-400 text-orange-600 focus:ring-orange-500"}),l.jsx("span",{className:"ml-2 text-xs text-slate-700 dark:text-gray-300",children:"Phn bit hoa thng"})]}),l.jsxs("label",{className:"flex items-center cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:A.matchWholeWords===!0,onChange:M=>re(A.id,{matchWholeWords:M.target.checked}),className:"h-3 w-3 rounded border-gray-400 text-orange-600 focus:ring-orange-500"}),l.jsx("span",{className:"ml-2 text-xs text-slate-700 dark:text-gray-300",children:"Ch t nguyn vn"})]})]})]}),(A.activationCount||0)>0&&l.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-400 border-t border-slate-300 dark:border-slate-600 pt-2",children:[" kch hot: ",A.activationCount," ln",A.lastActivated&&`  Ln cui: Lt ${A.lastActivated}`,A.tokenWeight&&`  Tokens c tnh: ${A.tokenWeight}`]})]})]},A.id);return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[70] p-4",onClick:e,children:l.jsxs("div",{className:"bg-white/90 dark:bg-[#252945]/90 backdrop-blur-sm border border-slate-300 dark:border-slate-700 rounded-lg shadow-xl w-full max-w-6xl h-full max-h-[90vh] flex flex-col text-slate-900 dark:text-white",onClick:A=>A.stopPropagation(),children:[l.jsx("input",{type:"file",ref:O,onChange:I,accept:".json",className:"hidden"}),l.jsx("input",{type:"file",ref:J,accept:".json",className:"hidden"}),l.jsx("input",{type:"file",ref:P,onChange:j,accept:".json",className:"hidden"}),l.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-600 flex-shrink-0",children:[l.jsxs("div",{className:"flex justify-between items-center mb-3",children:[l.jsxs("h3",{className:"text-xl font-semibold flex items-center gap-2",children:[l.jsx(Co,{className:"w-6 h-6"}),"Qun L Lut L Nng Cao"]}),l.jsx("button",{onClick:e,className:"text-gray-500 dark:text-gray-400 hover:text-slate-900 dark:hover:text-white text-3xl leading-none",children:""})]}),l.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("label",{className:"text-sm font-medium",children:"Ch :"}),l.jsx("button",{onClick:()=>p(f==="simple"?"advanced":"simple"),className:`px-3 py-1 rounded text-sm font-medium transition-colors ${f==="advanced"?"bg-purple-600 text-white":"bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300"}`,children:f==="advanced"?"Nng cao":"n gin"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("label",{className:"text-sm font-medium",children:"Sp xp:"}),l.jsxs("select",{value:g,onChange:A=>m(A.target.value),className:"bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded px-2 py-1 text-sm",children:[l.jsx("option",{value:"priority",children:" u tin"}),l.jsx("option",{value:"alphabetical",children:"Tn A-Z"}),l.jsx("option",{value:"category",children:"Danh mc"}),l.jsx("option",{value:"recent",children:"Mi nht"})]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("label",{className:"text-sm font-medium",children:"Danh mc:"}),l.jsxs("select",{value:y,onChange:A=>v(A.target.value),className:"bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded px-2 py-1 text-sm",children:[l.jsx("option",{value:"all",children:"Tt c"}),Zt.getAvailableCategories().map(A=>l.jsx("option",{value:A.value,children:A.label},A.value))]})]}),l.jsx("div",{className:"flex-1",children:l.jsx("input",{type:"text",value:C,onChange:A=>N(A.target.value),placeholder:"Tm kim lut...",className:"w-full bg-white dark:bg-[#1f2238] border border-slate-300 dark:border-slate-500 rounded px-2 py-1 text-sm"})})]}),l.jsxs("div",{className:"mt-2 text-sm text-slate-600 dark:text-slate-400",children:["Hin th ",$.length,"/",a.length," lut ",a.filter(A=>A.isActive).length," hot ng  Tng c tnh: ",a.reduce((A,G)=>A+(G.tokenWeight||0),0)," tokens",a.some(A=>A.category==="worldinfo")&&l.jsxs("span",{className:"ml-2 text-purple-600 dark:text-purple-400",children:[" ",a.filter(A=>A.category==="worldinfo").length," t WorldInfo"]})]})]}),l.jsxs("div",{className:"flex-grow overflow-y-auto p-4 space-y-4",children:[$.map((A,G)=>f==="simple"?F(A,G):Z(A,G)),$.length===0&&l.jsx("p",{className:"text-center text-slate-600 dark:text-slate-400 italic py-8",children:C||y!=="all"?"Khng tm thy lut no ph hp vi b lc.":"Cha c lut l ty chnh no."}),l.jsxs("button",{onClick:z,className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-500 rounded-md text-white text-sm font-semibold transition-colors duration-200 flex items-center justify-center gap-2",children:[l.jsx(bo,{className:"w-5 h-5"})," Thm Lut Mi"]})]}),l.jsxs("div",{className:"p-4 bg-slate-50/80 dark:bg-[#1f2238]/80 rounded-b-lg flex justify-between items-center flex-shrink-0",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsxs("button",{onClick:k,className:"px-3 py-2 bg-green-700 hover:bg-green-600 rounded-md text-white text-sm font-semibold transition-colors duration-200 flex items-center gap-2",children:[l.jsx(vs,{className:"w-4 h-4"})," Xut File"]}),l.jsxs("button",{onClick:S,className:"px-3 py-2 bg-sky-600 hover:bg-sky-500 rounded-md text-white text-sm font-semibold transition-colors duration-200 flex items-center gap-2",children:[l.jsx($l,{className:"w-4 h-4"})," Nhp File"]}),l.jsxs("button",{onClick:V,className:"px-3 py-2 bg-purple-700 hover:bg-purple-600 rounded-md text-white text-sm font-semibold transition-colors duration-200 flex items-center gap-2",children:[l.jsx(Co,{className:"w-4 h-4"})," Nhp WorldInfo"]})]}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("button",{onClick:e,className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 rounded-md text-white text-sm font-semibold transition-colors duration-200",children:"Hy"}),l.jsxs("button",{onClick:ne,className:"px-4 py-2 bg-purple-600 hover:bg-purple-500 rounded-md text-white text-sm font-semibold transition-colors duration-200",children:["Lu Thay i (",a.filter(A=>A.isActive).length," hot ng)"]})]})]})]})})},pE=({isCollapsed:t,onToggle:e})=>{const i=[{icon:l.jsx(M0,{}),label:"V tr hin ti"},{icon:l.jsx(ql,{}),label:"Lng mc"},{icon:l.jsx(A0,{}),label:"Th trn"},{icon:l.jsx(R0,{}),label:"Thnh ph"},{icon:l.jsx(I0,{}),label:"Th "},{icon:l.jsx(_0,{}),label:"Tng mn/Gia tc"},{icon:l.jsx(L0,{}),label:"Ca hng"},{icon:l.jsx(j0,{}),label:"Qun tr/Tu im"},{icon:l.jsx(D0,{}),label:"Rng rm"},{icon:l.jsx(P0,{}),label:"Ni non"},{icon:l.jsx(U0,{}),label:"Hang ng"},{icon:l.jsx(H0,{}),label:"Hm ngc/B cnh"},{icon:l.jsx(O0,{}),label:"Tn tch"},{icon:l.jsx(G0,{}),label:"Sng/H"},{icon:l.jsx(V0,{}),label:"a danh c bit"},{icon:l.jsx(rd,{}),label:"Mc nh"}],s=[{color:"rgb(249, 115, 22)",label:"V tr hin ti"},{color:"rgb(34, 197, 94)",label:"Khu Vc An Ton"},{color:"rgb(14, 165, 233)",label:"a im  Khm Ph"},{color:"rgb(107, 114, 128)",label:"a im Cha n"},{color:"rgb(156, 163, 175)",label:"ng i  Bit"}];return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"md:hidden absolute top-4 left-4 z-10",children:[l.jsx("button",{onClick:e,className:"bg-slate-800/90 backdrop-blur-sm text-white p-2 rounded-lg border border-slate-600 shadow-lg",children:l.jsx(Pr,{className:"w-5 h-5"})}),!t&&l.jsxs("div",{className:"absolute top-12 left-0 bg-slate-800/95 backdrop-blur-sm p-3 rounded-lg border border-slate-600 shadow-xl max-w-[250px] max-h-[60vh] overflow-y-auto",children:[l.jsx("h4",{className:"font-bold text-sm text-purple-300 mb-2",children:"Ch gii"}),l.jsx("div",{className:"space-y-1 mb-3",children:i.slice(0,8).map(a=>l.jsxs("div",{className:"flex items-center text-xs",children:[l.jsx("span",{className:"w-4 h-4 mr-2 text-purple-300",children:a.icon}),l.jsx("span",{className:"text-white truncate",children:a.label})]},a.label))}),l.jsx("div",{className:"space-y-1",children:s.map(a=>l.jsxs("div",{className:`flex items-center text-xs ${a.label==="V tr hin ti"?"font-bold text-orange-300":""}`,children:[l.jsx("span",{className:`w-3 h-3 mr-2 rounded-full border ${a.label==="V tr hin ti"?"border-orange-300":"border-white/20"}`,style:{backgroundColor:a.color}}),l.jsx("span",{className:"text-white truncate",children:a.label==="V tr hin ti"?" V tr hin ti":a.label})]},a.label))})]})]}),l.jsxs("div",{className:"hidden md:block w-64 flex-shrink-0 bg-slate-800/50 p-4 overflow-y-auto rounded-r-lg",children:[l.jsx("h3",{className:"font-bold text-lg text-purple-300 mb-4",children:"Ch gii Icon"}),l.jsx("ul",{className:"space-y-2 mb-6",children:i.map(a=>l.jsxs("li",{className:"flex items-center text-sm",children:[l.jsx("span",{className:"w-5 h-5 mr-3 text-purple-300",children:a.icon}),l.jsx("span",{children:a.label})]},a.label))}),l.jsx("h3",{className:"font-bold text-lg text-purple-300 mb-4",children:"Ch gii Mu sc"}),l.jsx("ul",{className:"space-y-2",children:s.map(a=>l.jsxs("li",{className:`flex items-center text-sm ${a.label==="V tr hin ti"?"font-bold text-orange-300 animate-pulse":""}`,children:[l.jsx("span",{className:`w-4 h-4 mr-3 rounded-full border ${a.label==="V tr hin ti"?"border-orange-300 shadow-lg":"border-white/20"}`,style:{backgroundColor:a.color}}),l.jsx("span",{children:a.label==="V tr hin ti"?" V tr hin ti":a.label})]},a.label))})]})]})},gE=({isOpen:t,onClose:e,locations:i,currentLocationName:s,discoveryOrder:a,onLocationClick:u})=>{if(!t)return null;const f=E.useRef(null),p=E.useRef(null),[g,m]=E.useState({x:0,y:0,scale:.5}),[y,v]=E.useState(!1),[C,N]=E.useState({x:0,y:0}),R=E.useRef(!1),L=E.useRef({x:0,y:0}),[O,J]=E.useState(null),P=5,[$,ne]=E.useState(!0),[z,ae]=E.useState([]),[de,re]=E.useState(null),[se,oe]=E.useState(0),[_,me]=E.useState(null),Y=E.useMemo(()=>{const M={},D=window.innerWidth<768?150:180,B=window.innerWidth<768?100:120;let X=0,xe=0,Ne=1,Te=0;const Ee=window.innerWidth<768?2:3;return a.forEach(Re=>{M[Re]={x:X,y:xe},Te++,Te<Ee?X+=D*Ne:(xe+=B,Ne*=-1,X+=D*Ne,Te=1)}),M},[a]),ue=(M,D)=>Math.sqrt(Math.pow(M.x-D.x,2)+Math.pow(M.y-D.y,2)),H=M=>Array.from(M.touches).map(D=>({x:D.clientX,y:D.clientY,id:D.identifier})),k=E.useCallback(M=>{const D=H(M.nativeEvent);if(ae(D),D.length===1)v(!0),N({x:D[0].x-g.x,y:D[0].y-g.y});else if(D.length===2){v(!1);const B=ue(D[0],D[1]);re({initialDistance:B,initialScale:g.scale})}},[g]),S=E.useCallback(M=>{const D=H(M.nativeEvent);if(D.length===1&&y)m(B=>({...B,x:D[0].x-C.x,y:D[0].y-C.y}));else if(D.length===2&&de){const X=ue(D[0],D[1])/de.initialDistance,xe=Math.min(Math.max(.1,de.initialScale*X),3);m(Ne=>({...Ne,scale:xe}))}},[y,C,de]),V=E.useCallback(M=>{const D=Date.now(),B=H(M.nativeEvent);if(B.length===0&&D-se<300){const X=g.scale<1.5?g.scale*1.5:.5;m(xe=>({...xe,scale:X}))}oe(D),v(!1),re(null),ae(B)},[se,g.scale]),W=E.useCallback(M=>{var xe,Ne;M.stopPropagation();const D=-M.deltaY*.001,B=Math.min(Math.max(.1,g.scale+D),3),X=(xe=f.current)==null?void 0:xe.createSVGPoint();if(X&&f.current){const Te=f.current.getBoundingClientRect();X.x=M.clientX-Te.left,X.y=M.clientY-Te.top;const Ee=X.matrixTransform((Ne=f.current.getScreenCTM())==null?void 0:Ne.inverse());m({scale:B,x:g.x-Ee.x*(B-g.scale),y:g.y-Ee.y*(B-g.scale)})}},[g]),I=E.useCallback(M=>{if(!(M.target.tagName==="rect"))return;const B={x:M.clientX,y:M.clientY},X={x:M.clientX-g.x,y:M.clientY-g.y};J(B),N(X),L.current=X;const xe=Te=>{if(Math.sqrt(Math.pow(Te.clientX-B.x,2)+Math.pow(Te.clientY-B.y,2))>P&&!R.current&&(R.current=!0,v(!0)),R.current){const Re=Te.clientX-X.x,ye=Te.clientY-X.y;m(we=>({...we,x:Re,y:ye}))}},Ne=()=>{document.removeEventListener("mousemove",xe),document.removeEventListener("mouseup",Ne),J(null),R.current=!1,v(!1)};document.addEventListener("mousemove",xe),document.addEventListener("mouseup",Ne)},[g,P]),j=E.useCallback(M=>{m(D=>({...D,scale:Math.min(Math.max(.1,D.scale*M),3)}))},[]),F=E.useCallback(()=>{const M=Y[s];if(M&&f.current){const{width:D,height:B}=f.current.getBoundingClientRect();m({scale:window.innerWidth<768?.7:.5,x:-M.x*(window.innerWidth<768?.7:.5)+D/2,y:-M.y*(window.innerWidth<768?.7:.5)+B/2})}},[Y,s]),Z=E.useCallback(M=>{const D=Y[M];if(D&&f.current){const{width:B,height:X}=f.current.getBoundingClientRect();m(xe=>({...xe,x:-D.x*xe.scale+B/2,y:-D.y*xe.scale+X/2}))}},[Y]);E.useEffect(()=>{t&&(F(),ne(!0),me(null))},[t,F]),E.useEffect(()=>()=>{(()=>{R.current=!1,v(!1),J(null)})()},[]);const A=new Set(a),G=E.useCallback((M,D)=>{D&&D.stopPropagation(),window.innerWidth<768?me(M):u&&u(M.name)},[u]);return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[70] p-2 md:p-4",onClick:e,children:l.jsxs("div",{ref:p,className:"bg-[#1f2238] border-2 border-slate-700 rounded-lg shadow-2xl w-full h-full max-w-7xl max-h-[95vh] md:max-h-[90vh] text-white flex flex-col",onClick:M=>M.stopPropagation(),children:[l.jsxs("div",{className:"p-2 md:p-3 border-b-2 border-slate-700 flex justify-between items-center flex-shrink-0",children:[l.jsxs("h3",{className:"text-lg md:text-xl font-bold text-purple-300 flex items-center gap-2",children:[l.jsx(Pr,{className:"w-5 h-5 md:w-6 md:h-6"})," Bn  Th Gii"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("div",{className:"md:hidden text-xs bg-orange-500/20 text-orange-300 px-2 py-1 rounded-md border border-orange-400/30 truncate max-w-[120px] animate-pulse",children:[" ",s]}),l.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:l.jsx(An,{className:"w-5 h-5 md:w-6 md:h-6"})})]})]}),l.jsxs("div",{className:"flex-grow flex overflow-hidden relative",style:{overflowX:"hidden",overflowY:"hidden"},children:[l.jsxs("div",{className:"flex-grow relative bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-slate-900 to-slate-950",style:{touchAction:"none"},children:[l.jsxs("svg",{ref:f,className:"w-full h-full select-none",onWheel:W,onTouchStart:k,onTouchMove:S,onTouchEnd:V,style:{touchAction:"none",overflow:"hidden"},children:[l.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"transparent",onMouseDown:I,style:{cursor:y?"grabbing":"grab"}}),l.jsxs("g",{style:{transform:`translate(${g.x}px, ${g.y}px) scale(${g.scale})`},children:[a.slice(0,-1).map((M,D)=>{const B=Y[M],X=Y[a[D+1]];return!B||!X?null:l.jsx("line",{x1:B.x,y1:B.y,x2:X.x,y2:X.y,stroke:"rgb(156, 163, 175)",strokeWidth:"2",strokeDasharray:"5,5"},`line-${D}`)}),i.map(M=>{var Re;const D=Y[M.name];if(!D)return null;const B=M.name===s,X=A.has(M.name),xe=(Re=M.description)==null?void 0:Re.toLowerCase().includes("an ton");let Ne=X?"rgb(14, 165, 233)":"rgb(107, 114, 128)";xe&&(Ne="rgb(34, 197, 94)"),B&&(Ne="rgb(249, 115, 22)");const Te=window.innerWidth<768?20:25,Ee=window.innerWidth<768?24:32;return l.jsxs("g",{transform:`translate(${D.x}, ${D.y})`,className:"transition-transform",onClick:ye=>G(M,ye),style:{cursor:"pointer"},children:[B&&l.jsxs(l.Fragment,{children:[l.jsx("circle",{r:Te+8,fill:"none",stroke:"rgb(249, 115, 22)",strokeWidth:"3",opacity:"0.6",className:"animate-pulse"}),l.jsx("circle",{r:Te+4,fill:"none",stroke:"rgb(255, 255, 255)",strokeWidth:"2",opacity:"0.8"})]}),l.jsx("circle",{r:Te,fill:Ne,stroke:B?"rgba(255,255,255,0.9)":"rgba(255,255,255,0.4)",strokeWidth:B?"3":"2",className:B?"drop-shadow-2xl":"drop-shadow-lg"}),l.jsx("foreignObject",{x:-Ee/2,y:-Ee/2,width:Ee,height:Ee,style:{pointerEvents:"none"},children:l.jsx("div",{className:"w-full h-full flex items-center justify-center text-white",children:tE(M,B)})}),l.jsx("text",{y:Te+15,textAnchor:"middle",fill:B?"rgb(255, 204, 102)":"white",fontSize:B?window.innerWidth<768?"13":"15":window.innerWidth<768?"12":"14",className:`${B?"font-bold":"font-semibold"} pointer-events-none`,style:{paintOrder:"stroke",stroke:B?"rgb(139, 69, 19)":"black",strokeWidth:B?"4px":"3px",strokeLinejoin:"round"},children:B?` ${M.name}`:M.name})]},M.name)})]})]}),l.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col space-y-2",children:[l.jsx("button",{onClick:()=>j(1.2),className:"w-10 h-10 md:w-12 md:h-12 bg-slate-700/90 hover:bg-slate-600 rounded-lg flex items-center justify-center border border-slate-600 backdrop-blur-sm shadow-lg transition-colors",children:l.jsx(bo,{className:"w-5 h-5 md:w-6 md:h-6"})}),l.jsx("button",{onClick:()=>j(.8),className:"w-10 h-10 md:w-12 md:h-12 bg-slate-700/90 hover:bg-slate-600 rounded-lg flex items-center justify-center border border-slate-600 backdrop-blur-sm shadow-lg transition-colors",children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 md:w-6 md:h-6",fill:"currentColor",viewBox:"0 0 16 16",children:l.jsx("path",{d:"M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"})})}),l.jsx("button",{onClick:F,className:"w-10 h-10 md:w-12 md:h-12 bg-slate-700/90 hover:bg-slate-600 rounded-lg flex items-center justify-center border border-slate-600 backdrop-blur-sm shadow-lg transition-colors",children:l.jsx(ql,{className:"w-5 h-5 md:w-6 md:h-6"})})]}),l.jsx("div",{className:"md:hidden absolute bottom-4 left-4",children:l.jsx("select",{value:s,onChange:M=>Z(M.target.value),className:"bg-slate-800/90 backdrop-blur-sm text-white text-sm border border-slate-600 rounded-lg px-3 py-2 max-w-[150px]",children:a.map(M=>l.jsx("option",{value:M,className:M===s?"bg-orange-600 text-white":"bg-slate-800",children:M===s?` ${M} (Hin ti)`:M},M))})})]}),l.jsx(pE,{isCollapsed:$,onToggle:()=>ne(!$)})]}),_&&l.jsxs("div",{className:"md:hidden absolute bottom-0 left-0 right-0 bg-slate-800/95 backdrop-blur-sm border-t-2 border-slate-600 p-4 rounded-t-xl max-h-[40%] overflow-y-auto",children:[l.jsxs("div",{className:"flex justify-between items-start mb-3",children:[l.jsx("h4",{className:"text-lg font-bold text-purple-300",children:_.name}),l.jsx("button",{onClick:()=>me(null),className:"text-gray-400 hover:text-white",children:l.jsx(An,{className:"w-5 h-5"})})]}),l.jsxs("p",{className:"text-sm text-gray-300 mb-2",children:[l.jsx("span",{className:"font-semibold",children:"Loi:"})," ",_.type]}),_.description&&l.jsxs("p",{className:"text-sm text-gray-300 mb-3",children:[l.jsx("span",{className:"font-semibold",children:"M t:"})," ",_.description]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("button",{onClick:()=>Z(_.name),className:"px-3 py-1 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded-md transition-colors",children:"i n"}),l.jsx("button",{onClick:()=>me(null),className:"px-3 py-1 bg-slate-600 hover:bg-slate-700 text-white text-sm rounded-md transition-colors",children:"ng"})]})]}),l.jsx("div",{className:"md:hidden absolute top-16 left-4 right-4 text-center",children:l.jsx("div",{className:"bg-slate-800/80 backdrop-blur-sm text-xs text-gray-300 px-3 py-2 rounded-lg border border-slate-600 max-w-fit mx-auto",children:" Chm  ko   Vo  zoom   Chm i  phng to"})})]})})},xE=({isOpen:t,onClose:e,choices:i,onAction:s})=>t?l.jsxs("div",{className:"md:hidden fixed inset-0 bg-black/60 z-[70] flex items-end",onClick:e,children:[l.jsxs("div",{className:"w-full bg-white/95 dark:bg-[#1f2238]/95 backdrop-blur-sm p-4 pt-3 rounded-t-2xl shadow-2xl transition-transform transform translate-y-0",style:{animation:"slideUp 0.3s ease-out"},onClick:a=>a.stopPropagation(),children:[l.jsx("div",{className:"w-12 h-1.5 bg-slate-300 dark:bg-slate-600 rounded-full mx-auto mb-3"}),l.jsx("h3",{className:"text-lg font-semibold mb-3 text-cyan-600 dark:text-cyan-400 text-center",children:"La chn hnh ng"}),l.jsxs("div",{className:"max-h-[50vh] overflow-y-auto pr-2 space-y-2",children:[i.map((a,u)=>l.jsx("button",{onClick:()=>{s(a),e()},className:"w-full text-left p-3 bg-slate-200 dark:bg-slate-700 hover:bg-purple-600 dark:hover:bg-purple-600 text-slate-800 dark:text-gray-200 hover:text-white rounded-md transition-colors duration-200 shadow-sm border border-slate-300 dark:border-slate-600",children:a.match(/^\d+\.\s/)?a:`${u+1}. ${a}`},u)),i.length>4&&l.jsx("div",{className:"text-center py-2",children:l.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:" Cun  xem thm la chn"})})]}),l.jsx("button",{onClick:e,className:"w-full mt-4 py-2.5 bg-slate-600 text-white rounded-md font-semibold",children:"ng"})]}),l.jsx("style",{children:`
                @keyframes slideUp {
                    from { transform: translateY(100%); }
                    to { transform: translateY(0); }
                }
            `})]}):null,yE=({party:t,statuses:e,onMemberClick:i})=>{const s=f=>{const p=e.filter(v=>v.owner===f.name||f.type==="pc"&&v.owner==="pc");if(p.length===0)return null;const g=p.filter(v=>v.type==="buff").length,m=p.filter(v=>v.type==="debuff").length,y=p.filter(v=>v.type==="injury").length;return l.jsxs("div",{className:"flex gap-1 text-xs",children:[g>0&&l.jsxs("span",{className:"text-green-500",children:["",g]}),m>0&&l.jsxs("span",{className:"text-red-500",children:["",m]}),y>0&&l.jsxs("span",{className:"text-orange-500",children:["",y]})]})},a=f=>{if(!f)return"Cha xc nh";const p=f.toLowerCase(),g=[{keywords:["ngi yu","tnh nhn","v","chng","lover","wife","husband","romantic"],result:"Ngi yu"},{keywords:["devoted","loyal","love","adoring","yu thng","tn ty","tn hin"],result:"Tn ty"},{keywords:["hostile","enemy","th ch","th ght","k th"],result:"Th ch"},{keywords:["gia nh","anh em","ch em","family","sibling","brother","sister"],result:"Gia nh"},{keywords:["ng i","teammate","partner","ally"],result:"ng i"},{keywords:["bn thn","best friend","close friend"],result:"Bn thn"},{keywords:["friendly","friend","warm","bn b","thn thin"],result:"Thn thin"},{keywords:["respect","admire","reverent","tn knh","ngng m"],result:"Tn knh"},{keywords:["trust","confident","tin tng","tin cy"],result:"Tin tng"},{keywords:["grateful","thankful","bit n","cm kch"],result:"Bit n"},{keywords:["suspicious","doubt","nghi ng","hoi nghi"],result:"Nghi ng"},{keywords:["competitive","rival","cnh tranh","i th"],result:"Cnh tranh"},{keywords:["fear","afraid","s hi","e ngi"],result:"S hi"},{keywords:["curious","interested","t m","quan tm"],result:"T m"},{keywords:["cautious","careful","cn thn","thn trng"],result:"Thn trng"},{keywords:["neutral","trung lp","bnh thng"],result:"Trung lp"}];for(const y of g)for(const v of y.keywords)if(p.includes(v))return y.result;const m=f.split(/\s*(?:v|and|,|;|\||\s-\s)\s*/)[0].trim();return m.length>0&&m.length<20?m:"Cha r"},u=f=>{if(!f)return"text-gray-500";const g=a(f).toLowerCase();return g.includes("ngi yu")||g.includes("tnh nhn")||g.includes("v")||g.includes("chng")?"text-pink-400":g.includes("th")||g.includes("ch")||g.includes("ght")||g.includes("s")?"text-red-400":g.includes("tn ty")||g.includes("thn thin")||g.includes("tin")||g.includes("tn knh")||g.includes("bit n")||g.includes("gia nh")||g.includes("ng i")||g.includes("bn thn")?"text-green-400":g.includes("trung lp")||g.includes("t m")||g.includes("thn trng")||g.includes("cnh tranh")?"text-yellow-400":"text-blue-400"};return l.jsxs("div",{className:"p-4 h-full flex flex-col",children:[l.jsx("h3",{className:"font-semibold mb-2 flex-shrink-0 text-slate-800 dark:text-white",children:"Thnh vin t i:"}),l.jsx("div",{className:"flex-grow overflow-y-auto pr-2",children:t.length>0?l.jsx("div",{className:"space-y-3",children:t.map(f=>l.jsx("div",{className:"bg-slate-100 dark:bg-slate-800/50 rounded-lg p-3 border border-slate-200 dark:border-slate-700",children:l.jsxs("button",{onClick:()=>i(f.name),className:"w-full text-left hover:bg-slate-200 dark:hover:bg-slate-700/50 transition-colors rounded p-2",children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-5 h-5",children:Cs(f)}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-slate-800 dark:text-white",children:f.name}),l.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:[f.type==="pc"?"Nhn vt chnh":"ng hnh",f.realm&&`  ${f.realm}`]})]})]}),s(f)]}),f.type==="companion"&&l.jsxs("div",{className:"mt-2 space-y-1",children:[f.relationship&&l.jsxs("p",{className:`text-xs ${u(f.relationship)}`,children:[" ",a(f.relationship)]}),f.skills&&Array.isArray(f.skills)&&f.skills.length>0&&l.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:[" ",f.skills.slice(0,2).join(", "),f.skills.length>2&&"..."]})]})]})},f.name))}):l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"T i trng."})})]})},Rg=t=>t?t.status==="completed"?l.jsx(E0,{}):t.status==="failed"?l.jsx(An,{}):l.jsx(zn,{}):l.jsx(zn,{}),vE=({quests:t,onQuestClick:e})=>{const i=t||[],s=i.filter(u=>u.status==="active"),a=i.filter(u=>u.status!=="active");return l.jsx("div",{className:"p-4 h-full flex flex-col",children:l.jsxs("div",{className:"flex-grow overflow-y-auto pr-2 space-y-4",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"text-sm font-semibold text-yellow-700 dark:text-yellow-300 mb-2 border-b border-yellow-400/20 pb-1",children:"ang Thc Hin"}),s.length>0?l.jsx("ul",{className:"space-y-2",children:s.map(u=>{var f;return l.jsxs("li",{onClick:()=>e(u),className:"text-sm p-2 bg-yellow-400/10 dark:bg-yellow-500/10 border-l-4 border-yellow-600 dark:border-yellow-400 rounded-r-md hover:bg-yellow-400/20 dark:hover:bg-yellow-500/20 transition-colors cursor-pointer",children:[l.jsxs("p",{className:"font-semibold text-yellow-800 dark:text-yellow-300 flex items-center gap-2",children:[l.jsx("span",{className:"w-4 h-4",children:Rg(u)}),u.title]}),l.jsxs("p",{className:"text-xs text-yellow-800/80 dark:text-yellow-200/80 pl-6 mt-1",children:["- ",((f=u.objectives.find(p=>!p.completed))==null?void 0:f.description)||"Hon thnh cc mc tiu."]})]},u.title)})}):l.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 pl-2 italic",children:"Khng c nhim v no ang hot ng."})]}),a.length>0&&l.jsxs("div",{className:"pt-2",children:[l.jsx("h4",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2 border-b border-slate-300 dark:border-slate-600 pb-1",children:" Kt Thc"}),l.jsx("ul",{className:"space-y-2",children:a.sort((u,f)=>u.title.localeCompare(f.title)).map(u=>l.jsx("li",{onClick:()=>e(u),className:"text-sm p-2 bg-slate-200/50 dark:bg-slate-700/50 border-l-4 border-slate-400 dark:border-slate-500 rounded-r-md hover:bg-slate-300/50 dark:hover:bg-slate-600/50 transition-colors cursor-pointer opacity-70",children:l.jsxs("p",{className:`font-semibold ${u.status==="completed"?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"} flex items-center gap-2`,children:[l.jsx("span",{className:"w-4 h-4",children:Rg(u)}),l.jsx("span",{className:"line-through",children:u.title})]})},u.title))})]})]})})},bE=({isOpen:t,onClose:e,playerInventory:i,onUseItem:s,onEquipItem:a,onUnequipItem:u,onDiscardItem:f,onEditItem:p})=>{const[g,m]=E.useState(null);if(E.useEffect(()=>{t||m(null)},[t]),E.useEffect(()=>{g&&!i.find(R=>R.name===g.name)&&(console.log(` Inventory cleanup: Selected item "${g.name}" no longer in inventory, clearing selection`),m(null))},[i,g]),!t)return null;const y=i,v=R=>R.name.includes("kim")?"":R.name.includes("dao")?"":R.name.includes("cung")?"":R.name.includes("thng")?"":R.name.includes("gip")?"":R.name.includes("o")?"":R.name.includes("m")?"":R.name.includes("ng")?"":"",C=R=>{var L,O,J,P,$,ne;return(L=R.description)!=null&&L.includes("thn")||(O=R.description)!=null&&O.includes("huyn thoi")?"legendary":(J=R.description)!=null&&J.includes("him")||(P=R.description)!=null&&P.includes("qu")?"rare":($=R.description)!=null&&$.includes("ph thng")||(ne=R.description)!=null&&ne.includes("thng")?"common":"uncommon"},N=R=>{switch(R){case"legendary":return"border-purple-500 bg-purple-500/10";case"rare":return"border-blue-500 bg-blue-500/10";case"uncommon":return"border-green-500 bg-green-500/10";default:return"border-gray-500 bg-gray-500/10"}};return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[90] p-4",onClick:e,children:l.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-sm border-2 border-slate-600/80 rounded-lg shadow-2xl w-full max-w-sm sm:max-w-2xl lg:max-w-4xl h-[85vh] sm:h-[80vh] text-white flex flex-col",onClick:R=>R.stopPropagation(),children:[l.jsxs("div",{className:"p-3 sm:p-4 border-b-2 border-slate-600/80 flex justify-between items-center flex-shrink-0",children:[l.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[l.jsxs("h3",{className:"text-lg sm:text-xl font-bold text-white flex items-center gap-2",children:[l.jsx("span",{className:"w-5 h-5 sm:w-6 sm:h-6",children:""}),"TI "]}),l.jsxs("div",{className:"text-xs sm:text-sm text-gray-400",children:[y.length," vt phm"]})]}),l.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white text-2xl sm:text-3xl leading-none p-1",children:""})]}),l.jsx("div",{className:"p-2 sm:p-4 flex-1 overflow-y-auto",children:l.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 lg:grid-cols-8 gap-2 w-full",children:Array.from({length:48},(R,L)=>{const O=y[L];if(!O)return l.jsx("div",{className:"aspect-square border-2 border-slate-700/60 bg-slate-800/30 rounded-md min-h-[60px] sm:min-h-[70px] lg:min-h-[80px]"},L);const J=C(O),P=N(J);return l.jsxs("div",{className:`aspect-square border-2 ${P} rounded-md p-1 sm:p-2 relative cursor-pointer hover:scale-105 transition-transform group min-h-[60px] sm:min-h-[70px] lg:min-h-[80px] ${(g==null?void 0:g.name)===O.name?"ring-2 ring-blue-400 bg-blue-500/20":""}`,title:O.description,onClick:()=>m((g==null?void 0:g.name)===O.name?null:O),children:[l.jsx("div",{className:"text-lg sm:text-xl lg:text-2xl mb-1 text-center",children:v(O)}),(O.quantities||O.uses)&&l.jsx("div",{className:"absolute bottom-1 right-1 bg-slate-900/80 text-xs px-1 rounded text-white",children:String(O.quantities||O.uses).replace(/,/g,"")}),O.equipped&&l.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 bg-green-500 rounded-full border border-white"}),l.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-slate-900/95 text-white text-xs p-2 rounded opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none min-w-max max-w-xs",children:[l.jsx("div",{className:"font-semibold",children:O.name}),O.description&&l.jsx("div",{className:"mt-1 text-gray-300",children:O.description}),O.durability&&l.jsxs("div",{className:"mt-1 text-blue-300",children:[" bn: ",O.durability]})]})]},O.name)})})}),l.jsx("div",{className:"p-4 border-t-2 border-slate-600/80 flex-shrink-0",children:g?l.jsxs("div",{className:"space-y-3",children:[l.jsx("div",{className:"bg-slate-800/50 rounded-md p-3 border border-slate-600",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("span",{className:"text-2xl",children:v(g)}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold text-white",children:g.name}),g.description&&l.jsx("p",{className:"text-sm text-gray-400",children:g.description})]})]})}),l.jsxs("div",{className:"flex flex-wrap justify-center gap-2 sm:gap-3",children:[g.usable&&s&&(g.quantities===void 0||g.quantities>0||g.uses===void 0||g.uses>0)&&l.jsxs("button",{className:"px-3 py-2 sm:px-4 bg-green-600 hover:bg-green-500 text-white rounded-md font-semibold transition-colors text-sm sm:text-base",onClick:()=>{s(g),m(null)},children:["S DNG ",g.quantities&&`(${String(g.quantities).replace(/,/g,"")} ln)`||g.uses&&`(${String(g.uses).replace(/,/g,"")} ln)`]}),g.equippable&&l.jsx(l.Fragment,{children:g.equipped?u&&l.jsx("button",{className:"px-3 py-2 sm:px-4 bg-orange-600 hover:bg-orange-500 text-white rounded-md font-semibold transition-colors text-sm sm:text-base",onClick:()=>{u(g),m(null)},children:"TA B"}):a&&l.jsx("button",{className:"px-3 py-2 sm:px-4 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-semibold transition-colors text-sm sm:text-base",onClick:()=>{a(g),m(null)},children:"TRANG B"})}),p&&l.jsx("button",{className:"px-3 py-2 sm:px-4 bg-purple-600 hover:bg-purple-500 text-white rounded-md font-semibold transition-colors text-sm sm:text-base",onClick:()=>{p(g),m(null)},children:"CHNH SA"}),f&&l.jsx("button",{className:"px-3 py-2 sm:px-4 bg-red-600 hover:bg-red-500 text-white rounded-md font-semibold transition-colors text-sm sm:text-base",onClick:()=>{if(window.confirm(`Bn c chc mun vt b "${g.name}"?`)){console.log(` Inventory Modal: Discarding item "${g.name}"`);const R=g;m(null),f(R)}},children:"VT B"}),l.jsx("button",{className:"px-3 py-2 sm:px-4 bg-slate-600 hover:bg-slate-500 text-white rounded-md font-semibold transition-colors text-sm sm:text-base",onClick:()=>m(null),children:"HY"})]})]}):l.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-2 sm:gap-4",children:[l.jsx("button",{className:"px-4 py-2 sm:px-6 bg-slate-700 hover:bg-slate-600 text-white rounded-md font-semibold transition-colors text-sm sm:text-base",onClick:e,children:"NG"}),l.jsx("div",{className:"text-xs sm:text-sm text-gray-400 text-center",children:"Chn mt vt phm  thc hin hnh ng"})]})})]})})},xr=t=>t===0?"0":t.toLocaleString().replace(/,$/,""),CE=({isOpen:t,onClose:e,onAddExp:i,onAddItem:s,onAddSkill:a,currentPlayerExp:u=0})=>{const[f,p]=E.useState("EXP"),[g,m]=E.useState(""),[y,v]=E.useState(""),[C,N]=E.useState(""),[R,L]=E.useState("other"),[O,J]=E.useState(""),[P,$]=E.useState(""),[ne,z]=E.useState(""),[ae,de]=E.useState(""),[re,se]=E.useState("combat"),[oe,_]=E.useState(""),[me,Y]=E.useState(""),[ue,H]=E.useState(""),[k,S]=E.useState("");if(!t)return null;const V=()=>{const F=parseInt(g);if(isNaN(F)||F<=0){alert("Vui lng nhp s kinh nghim hp l (s dng)");return}i==null||i(F),m(""),alert(` thm ${xr(F)} kinh nghim!`)},W=()=>{if(!y.trim()){alert("Vui lng nhp tn vt phm");return}const F={name:y.trim(),type:"item",description:C.trim()||"Vt phm c to bi Admin",owner:"pc",usable:R==="usable",equippable:R==="equippable"};O&&!isNaN(parseInt(O))&&(F.quantities=parseInt(O)),P&&!isNaN(parseInt(P))&&(F.durability=parseInt(P)),s==null||s(F),v(""),N(""),L("other"),J(""),$(""),alert(` thm vt phm "${F.name}" vo ti !`)},I=()=>{if(!ne.trim()){alert("Vui lng nhp tn k nng");return}const F={name:ne.trim(),type:"skill",description:ae.trim()||"K nng c to bi Admin",mastery:oe.trim()||void 0,element:me.trim()||void 0};ue&&!isNaN(parseInt(ue))&&(F.cooldown=ue),k&&!isNaN(parseInt(k))&&(F.manaCost=parseInt(k)),F.skillType=re,a==null||a(F),z(""),de(""),se("combat"),_(""),Y(""),H(""),S(""),alert(` to k nng "${F.name}" v thm vo danh sch k nng  hc!`)},j=[100,500,1e3,5e3,1e4,5e4];return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[100] p-4",onClick:e,children:l.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-sm border-2 border-red-600/80 rounded-lg shadow-2xl w-full max-w-2xl text-white flex flex-col max-h-[90vh] md:max-h-[80vh]",onClick:F=>F.stopPropagation(),children:[l.jsxs("div",{className:"p-4 border-b-2 border-red-600/80 flex justify-between items-center flex-shrink-0",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsxs("h3",{className:"text-xl font-bold text-red-400 flex items-center gap-2",children:[l.jsx("span",{className:"w-6 h-6",children:""}),"ADMIN PANEL"]}),l.jsxs("div",{className:"flex gap-1 md:gap-2",children:[l.jsx("button",{onClick:()=>p("EXP"),className:`px-2 md:px-3 py-2 rounded-md font-semibold transition-colors text-xs md:text-sm ${f==="EXP"?"bg-red-600 text-white":"bg-slate-700 text-gray-300 hover:bg-slate-600"}`,children:"EXP"}),l.jsx("button",{onClick:()=>p("ITEM"),className:`px-2 md:px-3 py-2 rounded-md font-semibold transition-colors text-xs md:text-sm ${f==="ITEM"?"bg-red-600 text-white":"bg-slate-700 text-gray-300 hover:bg-slate-600"}`,children:"ITEM"}),l.jsx("button",{onClick:()=>p("SKILL"),className:`px-2 md:px-3 py-2 rounded-md font-semibold transition-colors text-xs md:text-sm ${f==="SKILL"?"bg-red-600 text-white":"bg-slate-700 text-gray-300 hover:bg-slate-600"}`,children:"SKILL"})]})]}),l.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white text-3xl leading-none",children:""})]}),l.jsxs("div",{className:"p-4 md:p-6 flex-1 overflow-y-auto min-h-0",children:[f==="EXP"&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-600",children:[l.jsx("h4",{className:"text-lg font-semibold text-blue-400 mb-2",children:"Kinh nghim hin ti"}),l.jsx("p",{className:"text-2xl font-bold text-green-400",children:xr(u)})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h4",{className:"text-lg font-semibold text-white",children:"Thm kinh nghim"}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Nhanh chng:"}),l.jsx("div",{className:"grid grid-cols-3 gap-2",children:j.map(F=>l.jsxs("button",{onClick:()=>{i==null||i(F),alert(` thm ${xr(F)} kinh nghim!`)},className:"px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-semibold transition-colors",children:["+",xr(F)]},F))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"S lng ty chnh:"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"number",value:g,onChange:F=>m(F.target.value),placeholder:"Nhp s kinh nghim...",className:"flex-1 px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"}),l.jsx("button",{onClick:V,className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-md font-semibold transition-colors",children:"THM"})]})]})]})]}),f==="ITEM"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h4",{className:"text-lg font-semibold text-white",children:"To vt phm mi"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Tn vt phm *"}),l.jsx("input",{type:"text",value:y,onChange:F=>v(F.target.value),placeholder:"Nhp tn vt phm...",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Loi vt phm"}),l.jsxs("select",{value:R,onChange:F=>L(F.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[l.jsx("option",{value:"other",children:"Khc"}),l.jsx("option",{value:"usable",children:"C th s dng"}),l.jsx("option",{value:"equippable",children:"C th trang b"})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"M t"}),l.jsx("textarea",{value:C,onChange:F=>N(F.target.value),placeholder:"Nhp m t vt phm...",rows:3,className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"S lng"}),l.jsx("input",{type:"number",value:O,onChange:F=>J(F.target.value),placeholder:" trng nu khng gii hn",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:" bn"}),l.jsx("input",{type:"number",value:P,onChange:F=>$(F.target.value),placeholder:" trng nu khng c",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})]})]})]}),f==="SKILL"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h4",{className:"text-lg font-semibold text-white",children:"To k nng mi"}),l.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Tn k nng *"}),l.jsx("input",{type:"text",value:ne,onChange:F=>z(F.target.value),placeholder:"Nhp tn k nng...",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Loi k nng"}),l.jsxs("select",{value:re,onChange:F=>se(F.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[l.jsx("option",{value:"combat",children:"Chin u"}),l.jsx("option",{value:"movement",children:"Di chuyn"}),l.jsx("option",{value:"cultivation",children:"Tu luyn"}),l.jsx("option",{value:"utility",children:"H tr"}),l.jsx("option",{value:"passive",children:"B ng"})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"M t k nng"}),l.jsx("textarea",{value:ae,onChange:F=>de(F.target.value),placeholder:"Nhp m t chi tit v k nng...",rows:3,className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),l.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Mc  thnh tho"}),l.jsx("input",{type:"text",value:oe,onChange:F=>_(F.target.value),placeholder:"VD: S cp, Trung cp, Cao cp...",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Thuc tnh"}),l.jsx("input",{type:"text",value:me,onChange:F=>Y(F.target.value),placeholder:"VD: Ha, Thy, Phong...",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Thi gian hi chiu"}),l.jsx("input",{type:"text",value:ue,onChange:F=>H(F.target.value),placeholder:"VD: 10 giy, 1 pht...",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Tiu hao ni lc"}),l.jsx("input",{type:"number",value:k,onChange:F=>S(F.target.value),placeholder:"Lng ni lc cn dng",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]})]})]})]}),l.jsxs("div",{className:"p-4 border-t-2 border-red-600/80 flex justify-end gap-3 flex-shrink-0",children:[l.jsx("button",{onClick:e,className:"px-6 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-md font-semibold transition-colors",children:"NG"}),f==="ITEM"&&l.jsx("button",{onClick:W,className:"px-6 py-2 bg-green-600 hover:bg-green-500 text-white rounded-md font-semibold transition-colors",children:"TO VT PHM"}),f==="SKILL"&&l.jsx("button",{onClick:I,className:"px-6 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-md font-semibold transition-colors",children:"TO K NNG"})]})]})})},TE=({isOpen:t,onClose:e,item:i,onSaveItem:s})=>{const[a,u]=E.useState(null);if(E.useEffect(()=>{i&&t&&u({...i})},[i,t]),!t||!a)return null;const f=(m,y)=>{u(v=>v?{...v,[m]:y}:null)},p=()=>{a&&i&&(s(i,a),e())},g=()=>{u(null),e()};return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[110] p-4",onClick:g,children:l.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-sm border-2 border-amber-400 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] text-white flex flex-col",onClick:m=>m.stopPropagation(),children:[l.jsxs("div",{className:"p-4 border-b-2 border-slate-600/80 flex justify-between items-center flex-shrink-0",children:[l.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[l.jsx("span",{className:"text-purple-400",children:""}),"CHNH SA VT PHM"]}),l.jsx("button",{onClick:g,className:"text-gray-400 hover:text-white text-3xl leading-none p-1",children:""})]}),l.jsxs("div",{className:"p-4 flex-1 overflow-y-auto space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Tn vt phm"}),l.jsx("input",{type:"text",value:a.name,onChange:m=>f("name",m.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent",placeholder:"Nhp tn vt phm..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"M t"}),l.jsx("textarea",{value:a.description,onChange:m=>f("description",m.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-none",placeholder:"Nhp m t vt phm..."})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"S lng/Ln s dng"}),l.jsx("input",{type:"number",min:"0",value:(()=>{const m=a.quantities||a.uses||0;return typeof m=="string"?parseInt(m.replace(/,/g,""))||0:m})(),onChange:m=>{const y=parseInt(m.target.value)||0;a.quantities!==void 0?f("quantities",y):f("uses",y)},className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:" bn"}),l.jsx("input",{type:"number",min:"0",max:"100",value:(()=>{const m=a.durability||100;return typeof m=="string"?parseInt(m.replace(/,/g,""))||100:m})(),onChange:m=>f("durability",parseInt(m.target.value)||100),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Loi vt phm"}),l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx("input",{type:"radio",id:"usable",name:"itemType",checked:a.usable||!1,onChange:()=>{f("usable",!0),f("equippable",!1),f("learnable",!1),f("equipped",!1)},className:"w-4 h-4 text-amber-600 bg-slate-800 border-slate-600 focus:ring-amber-500 focus:ring-2"}),l.jsx("label",{htmlFor:"usable",className:"text-sm font-semibold text-gray-300",children:"C th s dng"})]}),l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx("input",{type:"radio",id:"equippable",name:"itemType",checked:a.equippable||!1,onChange:()=>{f("usable",!1),f("equippable",!0),f("learnable",!1)},className:"w-4 h-4 text-amber-600 bg-slate-800 border-slate-600 focus:ring-amber-500 focus:ring-2"}),l.jsx("label",{htmlFor:"equippable",className:"text-sm font-semibold text-gray-300",children:"C th trang b"})]}),l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx("input",{type:"radio",id:"other",name:"itemType",checked:a.learnable||!1,onChange:()=>{f("usable",!1),f("equippable",!1),f("learnable",!0),f("equipped",!1)},className:"w-4 h-4 text-amber-600 bg-slate-800 border-slate-600 focus:ring-amber-500 focus:ring-2"}),l.jsx("label",{htmlFor:"other",className:"text-sm font-semibold text-gray-300",children:"Khc"})]}),a.equippable&&l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx("input",{type:"checkbox",id:"equipped",checked:a.equipped||!1,onChange:m=>f("equipped",m.target.checked),className:"w-4 h-4 text-amber-600 bg-slate-800 border-slate-600 rounded focus:ring-amber-500 focus:ring-2"}),l.jsx("label",{htmlFor:"equipped",className:"text-sm font-semibold text-gray-300",children:"ang c trang b"})]})]})]}),l.jsxs("div",{className:"p-4 border-t-2 border-slate-600/80 flex justify-end gap-3 flex-shrink-0",children:[l.jsx("button",{onClick:g,className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-md font-semibold transition-colors",children:"HY"}),l.jsx("button",{onClick:p,className:"px-4 py-2 bg-amber-600 hover:bg-amber-500 text-white rounded-md font-semibold transition-colors",children:"LU"})]})]})})},NE=({isOpen:t,onClose:e,skill:i,onSaveSkill:s})=>{const[a,u]=E.useState(null);if(E.useEffect(()=>{i&&t&&u({...i})},[i,t]),!t||!a)return null;const f=(m,y)=>{u(v=>v?{...v,[m]:y}:null)},p=()=>{a&&i&&(s(i,a),e())},g=()=>{u(null),e()};return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[110] p-4",onClick:g,children:l.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-sm border-2 border-amber-400 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] text-white flex flex-col",onClick:m=>m.stopPropagation(),children:[l.jsxs("div",{className:"p-4 border-b-2 border-slate-600/80 flex justify-between items-center flex-shrink-0",children:[l.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[l.jsx("span",{className:"text-amber-400",children:""}),"CHNH SA K NNG"]}),l.jsx("button",{onClick:g,className:"text-gray-400 hover:text-white text-3xl leading-none p-1",children:""})]}),l.jsxs("div",{className:"p-4 flex-1 overflow-y-auto space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Tn k nng"}),l.jsx("input",{type:"text",value:a.name,onChange:m=>f("name",m.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent",placeholder:"Nhp tn k nng..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"M t"}),l.jsx("textarea",{value:a.description,onChange:m=>f("description",m.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-none",placeholder:"Nhp m t k nng..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Mc  thnh tho"}),l.jsxs("select",{value:a.mastery||"",onChange:m=>f("mastery",m.target.value||void 0),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"-- Chn mc  thnh tho --"}),l.jsx("option",{value:"Mi hc",children:"Mi hc"}),l.jsx("option",{value:"Bc nhp mn",children:"Bc nhp mn"}),l.jsx("option",{value:"Bc tiu thnh",children:"Bc tiu thnh"}),l.jsx("option",{value:"Bc tinh thng",children:"Bc tinh thng"}),l.jsx("option",{value:"Bc i thnh",children:"Bc i thnh"}),l.jsx("option",{value:"Bc vin mn",children:"Bc vin mn"}),l.jsx("option",{value:"Bc thn thng",children:"Bc thn thng"}),l.jsx("option",{value:"Bc huyn diu",children:"Bc huyn diu"})]})]})]}),l.jsxs("div",{className:"p-4 border-t-2 border-slate-600/80 flex justify-end gap-3 flex-shrink-0",children:[l.jsx("button",{onClick:g,className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-md font-semibold transition-colors",children:"HY"}),l.jsx("button",{onClick:p,className:"px-4 py-2 bg-amber-600 hover:bg-amber-500 text-white rounded-md font-semibold transition-colors",children:"LU"})]})]})})},kE=({isOpen:t,onClose:e,npc:i,onSaveNPC:s})=>{const[a,u]=E.useState(null);if(E.useEffect(()=>{if(i&&t){const v={...i};Array.isArray(i.skills)&&(v.skillsText=i.skills.join(", ")),u(v)}},[i,t]),!t||!a)return null;const f=(v,C)=>{u(N=>N?{...N,[v]:C}:null)},p=()=>{if(a&&i){const v={...a};if(v.skillsText){const C=v.skillsText.split(",").map(N=>N.trim()).filter(N=>N.length>0);v.skills=C,delete v.skillsText,console.log(` NPC Skills Debug - Converting skillsText: "${a.skillsText}" to skills array:`,C)}else v.skills||(v.skills=[],console.log(` NPC Skills Debug - No skillsText found, setting skills to empty array for "${v.name}"`));console.log(` NPC Edit Save Debug - Final NPC "${v.name}" skills:`,v.skills),s(i,v),e()}},g=()=>{u(null),e()},m=v=>{f("skillsText",v);const C=v.split(",").map(N=>N.trim()).filter(N=>N.length>0);f("skills",C)},y=Object.keys(Mn);return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[110] p-4",onClick:g,children:l.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-sm border-2 border-blue-400 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] text-white flex flex-col",onClick:v=>v.stopPropagation(),children:[l.jsxs("div",{className:"p-4 border-b-2 border-slate-600/80 flex justify-between items-center flex-shrink-0",children:[l.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"CHNH SA NPC"]}),l.jsx("button",{onClick:g,className:"text-gray-400 hover:text-white text-3xl leading-none p-1",children:""})]}),l.jsxs("div",{className:"p-4 flex-1 overflow-y-auto space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Tn NPC"}),l.jsx("input",{type:"text",value:a.name,onChange:v=>f("name",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nhp tn NPC..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Gii tnh"}),l.jsx("input",{type:"text",value:a.gender||"",onChange:v=>f("gender",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nam, N, Khc..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Tui"}),l.jsx("input",{type:"text",value:a.age||"",onChange:v=>f("age",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"V d: 25, Trung nin, Gi..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"V tr"}),l.jsx("input",{type:"text",value:a.location||"",onChange:v=>f("location",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"V tr hin ti ca NPC..."})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Dung mo"}),l.jsx("textarea",{value:a.appearance||"",onChange:v=>f("appearance",v.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"M t ngoi hnh ca NPC..."})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Cnh gii"}),l.jsx("input",{type:"text",value:a.realm||"",onChange:v=>f("realm",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Cnh gii tu luyn..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Kinh nghim"}),l.jsx("input",{type:"number",value:a.currentExp||0,onChange:v=>f("currentExp",parseInt(v.target.value)||0),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Danh vng"}),l.jsx("input",{type:"text",value:a.fame||"",onChange:v=>f("fame",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Mc  ni ting ca NPC..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Tnh cch (B ngoi)"}),l.jsx("textarea",{value:a.personality||"",onChange:v=>f("personality",v.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"M t tnh cch b ngoi ca NPC..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Tnh cch (Ct li - MBTI)"}),l.jsxs("select",{value:a.personalityMbti||"",onChange:v=>f("personalityMbti",v.target.value||void 0),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"-- Chn loi tnh cch --"}),y.map(v=>l.jsxs("option",{value:v,children:[v," - ",Mn[v].title]},v))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"ng c"}),l.jsx("textarea",{value:a.motivation||"",onChange:v=>f("motivation",v.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"ng c v mc tiu ca NPC..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Quan h"}),l.jsxs("select",{value:a.relationship||"",onChange:v=>f("relationship",v.target.value||void 0),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"-- Chn quan h --"}),l.jsx("option",{value:"Ngi yu",children:"Ngi yu"}),l.jsx("option",{value:"Tn ty",children:"Tn ty"}),l.jsx("option",{value:"Th ch",children:"Th ch"}),l.jsx("option",{value:"Gia nh",children:"Gia nh"}),l.jsx("option",{value:"ng i",children:"ng i"}),l.jsx("option",{value:"Bn thn",children:"Bn thn"}),l.jsx("option",{value:"Thn thin",children:"Thn thin"}),l.jsx("option",{value:"Tn knh",children:"Tn knh"}),l.jsx("option",{value:"Tin tng",children:"Tin tng"}),l.jsx("option",{value:"Bit n",children:"Bit n"}),l.jsx("option",{value:"Nghi ng",children:"Nghi ng"}),l.jsx("option",{value:"Cnh tranh",children:"Cnh tranh"}),l.jsx("option",{value:"S hi",children:"S hi"}),l.jsx("option",{value:"T m",children:"T m"}),l.jsx("option",{value:"Thn trng",children:"Thn trng"}),l.jsx("option",{value:"Trung lp",children:"Trung lp"}),l.jsx("option",{value:"Cha xc nh",children:"Cha xc nh"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"K nng"}),l.jsx("input",{type:"text",value:a.skillsText||(Array.isArray(a.skills)?a.skills.join(", "):""),onChange:v=>m(v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Cc k nng, cch nhau bng du phy..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"M t"}),l.jsx("textarea",{value:a.description,onChange:v=>f("description",v.target.value),rows:4,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"M t chi tit v NPC..."})]})]}),l.jsxs("div",{className:"p-4 border-t-2 border-slate-600/80 flex justify-end gap-3 flex-shrink-0",children:[l.jsx("button",{onClick:g,className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-md font-semibold transition-colors",children:"HY"}),l.jsx("button",{onClick:p,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-semibold transition-colors",children:"LU"})]})]})})},SE=({isOpen:t,onClose:e,pc:i,onSavePC:s})=>{const[a,u]=E.useState(null);if(E.useEffect(()=>{if(i&&t){const v={...i};Array.isArray(i.learnedSkills)&&(v.learnedSkillsText=i.learnedSkills.join(", ")),u(v)}},[i,t]),!t||!a)return null;const f=(v,C)=>{u(N=>N?{...N,[v]:C}:null)},p=()=>{if(a&&i){const v={...a};if(v.learnedSkillsText){const C=v.learnedSkillsText.split(",").map(N=>N.trim()).filter(N=>N.length>0);v.learnedSkills=C,delete v.learnedSkillsText}s(i,v),e()}},g=()=>{u(null),e()},m=v=>{f("learnedSkillsText",v);const C=v.split(",").map(N=>N.trim()).filter(N=>N.length>0);f("learnedSkills",C)},y=Object.keys(Mn);return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[110] p-4",onClick:g,children:l.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-sm border-2 border-yellow-400 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] text-white flex flex-col",onClick:v=>v.stopPropagation(),children:[l.jsxs("div",{className:"p-4 border-b-2 border-slate-600/80 flex justify-between items-center flex-shrink-0",children:[l.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[l.jsx("span",{className:"text-yellow-400",children:""}),"CHNH SA NHN VT CHNH"]}),l.jsx("button",{onClick:g,className:"text-gray-400 hover:text-white text-3xl leading-none p-1",children:""})]}),l.jsxs("div",{className:"p-4 flex-1 overflow-y-auto space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Tn nhn vt"}),l.jsx("input",{type:"text",value:a.name,onChange:v=>f("name",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",placeholder:"Nhp tn nhn vt..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Gii tnh"}),l.jsx("input",{type:"text",value:a.gender||"",onChange:v=>f("gender",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",placeholder:"Nam, N, Khc..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Tui"}),l.jsx("input",{type:"text",value:a.age||"",onChange:v=>f("age",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",placeholder:"V d: 25, Trung nin..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"V tr"}),l.jsx("input",{type:"text",value:a.location||"",onChange:v=>f("location",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",placeholder:"V tr hin ti..."})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Dung mo"}),l.jsx("textarea",{value:a.appearance||"",onChange:v=>f("appearance",v.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent resize-none",placeholder:"M t ngoi hnh nhn vt..."})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Cnh gii"}),l.jsx("input",{type:"text",value:a.realm||"",onChange:v=>f("realm",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",placeholder:"Cnh gii tu luyn..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Kinh nghim"}),l.jsx("input",{type:"number",value:a.currentExp||0,onChange:v=>f("currentExp",parseInt(v.target.value)||0),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Danh vng"}),l.jsx("input",{type:"text",value:a.fame||"",onChange:v=>f("fame",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",placeholder:"Mc  ni ting..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Tnh cch (B ngoi)"}),l.jsx("textarea",{value:a.personality||"",onChange:v=>f("personality",v.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent resize-none",placeholder:"M t tnh cch b ngoi..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Tnh cch (Ct li - MBTI)"}),l.jsxs("select",{value:a.personalityMbti||"",onChange:v=>f("personalityMbti",v.target.value||void 0),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"-- Chn loi tnh cch --"}),y.map(v=>l.jsxs("option",{value:v,children:[v," - ",Mn[v].title]},v))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"ng c"}),l.jsx("textarea",{value:a.motivation||"",onChange:v=>f("motivation",v.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent resize-none",placeholder:"ng c v mc tiu..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"K nng  hc"}),l.jsx("input",{type:"text",value:a.learnedSkillsText||(Array.isArray(a.learnedSkills)?a.learnedSkills.join(", "):""),onChange:v=>m(v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",placeholder:"Cc k nng  hc, cch nhau bng du phy..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"M t"}),l.jsx("textarea",{value:a.description,onChange:v=>f("description",v.target.value),rows:4,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent resize-none",placeholder:"M t chi tit v nhn vt..."})]})]}),l.jsxs("div",{className:"p-4 border-t-2 border-slate-600/80 flex justify-end gap-3 flex-shrink-0",children:[l.jsx("button",{onClick:g,className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-md font-semibold transition-colors",children:"HY"}),l.jsx("button",{onClick:p,className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-500 text-white rounded-md font-semibold transition-colors",children:"LU"})]})]})})},wE=({isOpen:t,onClose:e,location:i,onSaveLocation:s})=>{const[a,u]=E.useState(null);if(E.useEffect(()=>{i&&t&&u({...i})},[i,t]),!t||!a)return null;const f=(v,C)=>{u(N=>N?{...N,[v]:C}:null)},p=()=>{a&&i&&(s(i,a),e())},g=()=>{u(null),e()},m=()=>a.description?a.description.toLowerCase().includes("an ton")?"safe":"unknown":"",y=v=>{let C=a.description||"";C=C.replace(/\b(an ton|khng an ton|nguy him)\b/gi,"").trim(),v==="safe"?C=C?`${C}. Khu vc ny an ton.`:"Khu vc ny an ton.":v==="dangerous"&&(C=C?`${C}. Khu vc ny khng an ton.`:"Khu vc ny khng an ton."),f("description",C)};return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[110] p-4",onClick:g,children:l.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-sm border-2 border-green-400 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] text-white flex flex-col",onClick:v=>v.stopPropagation(),children:[l.jsxs("div",{className:"p-4 border-b-2 border-slate-600/80 flex justify-between items-center flex-shrink-0",children:[l.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[l.jsx("span",{className:"text-green-400",children:""}),"CHNH SA A IM"]}),l.jsx("button",{onClick:g,className:"text-gray-400 hover:text-white text-3xl leading-none p-1",children:""})]}),l.jsxs("div",{className:"p-4 flex-1 overflow-y-auto space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{className:"md:col-span-2",children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Tn a im"}),l.jsx("input",{type:"text",value:a.name,onChange:v=>f("name",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Nhp tn a im..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Thuc khu vc"}),l.jsx("input",{type:"text",value:a.location||"",onChange:v=>f("location",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Khu vc ln hn cha a im ny..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Trng thi khm ph"}),l.jsx("div",{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-gray-400 cursor-not-allowed",children:"  khm ph"}),l.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Trng thi ny c t ng qun l bi h thng"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Tnh trng an ton"}),l.jsxs("select",{value:m(),onChange:v=>y(v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"-- Cha r --"}),l.jsx("option",{value:"safe",children:" An ton"}),l.jsx("option",{value:"dangerous",children:" Nguy him"})]}),l.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Thng tin ny s c thm vo m t a im"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"M t"}),l.jsx("textarea",{value:a.description,onChange:v=>f("description",v.target.value),rows:6,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",placeholder:"M t chi tit v a im, bao gm cnh quan, c im, tnh trng an ton..."})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Kh hu/Mi trng"}),l.jsx("input",{type:"text",value:a.climate||"",onChange:v=>f("climate",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"V d: n i, Sa mc, Nhit i..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"c im ni bt"}),l.jsx("input",{type:"text",value:a.features||"",onChange:v=>f("features",v.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"V d: Ni cao, H ln, Thnh ph c..."})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Ti nguyn/Kinh t"}),l.jsx("textarea",{value:a.resources||"",onChange:v=>f("resources",v.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",placeholder:"Cc ti nguyn, hot ng kinh t chnh ca a im..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"C dn"}),l.jsx("textarea",{value:a.inhabitants||"",onChange:v=>f("inhabitants",v.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",placeholder:"Thng tin v nhng ai sng ti y, dn s, vn ha..."})]})]}),l.jsxs("div",{className:"p-4 border-t-2 border-slate-600/80 flex justify-end gap-3 flex-shrink-0",children:[l.jsx("button",{onClick:g,className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-md font-semibold transition-colors",children:"HY"}),l.jsx("button",{onClick:p,className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-md font-semibold transition-colors",children:"LU"})]})]})})},EE=[{name:"Combat & Action Formatting",description:"Format combat descriptions and action text",category:"Combat",rules:[{name:"Bold Actions",findRegex:"/\\*([^*]+)\\*/g",replaceString:"**$1**",trimStrings:[],placement:[Pe.AI_OUTPUT],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Combat",description:"Convert *action* to **action** for bold formatting",createdAt:Date.now()},{name:"Damage Numbers",findRegex:"/\\b(\\d+)\\s*(damage|hp|health|points?)\\b/gi",replaceString:"**$1** $2",trimStrings:[],placement:[Pe.AI_OUTPUT,Pe.MEMORY_PROCESSING],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Combat",description:"Highlight damage numbers in combat descriptions",createdAt:Date.now()},{name:"Critical Hits",findRegex:"/\\b(critical|crit|devastating|massive)\\s+(hit|strike|blow|attack)\\b/gi",replaceString:"***$1 $2***",trimStrings:[],placement:[Pe.AI_OUTPUT],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Combat",description:"Emphasize critical hits with triple asterisks",createdAt:Date.now()}]},{name:"Dialogue & Speech",description:"Format dialogue and character speech",category:"Dialogue",rules:[{name:"Quote Formatting",findRegex:'/"([^"]+)"/g',replaceString:'"*$1*"',trimStrings:[],placement:[Pe.AI_OUTPUT],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Dialogue",description:"Italicize text within quotes for dialogue emphasis",createdAt:Date.now()},{name:"Thoughts",findRegex:"/\\(([^)]+)\\)/g",replaceString:"(*$1*)",trimStrings:[],placement:[Pe.AI_OUTPUT],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Dialogue",description:"Italicize thoughts in parentheses",createdAt:Date.now()},{name:"Character Names",findRegex:"/^([A-Z][a-zA-Z]+):/gm",replaceString:"**$1:**",trimStrings:[],placement:[Pe.AI_OUTPUT],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Dialogue",description:"Bold character names in dialogue",createdAt:Date.now()}]},{name:"Stats & Experience",description:"Format statistics and experience gains",category:"Stats",rules:[{name:"Level Up",findRegex:"/\\b(level\\s+up|leveled\\s+up|reached\\s+level)\\s*(\\d+)?/gi",replaceString:" **$1** $2",trimStrings:[],placement:[Pe.AI_OUTPUT,Pe.MEMORY_PROCESSING],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Stats",description:"Highlight level up notifications with emoji and bold",createdAt:Date.now()},{name:"Experience Gained",findRegex:"/\\b(gained|earned|received)\\s+(\\d+)\\s+(exp|experience|xp)\\b/gi",replaceString:" $1 **$2** $3",trimStrings:[],placement:[Pe.AI_OUTPUT],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Stats",description:"Highlight experience gains with sparkle emoji",createdAt:Date.now()},{name:"Stat Changes",findRegex:"/\\b(strength|dexterity|intelligence|wisdom|constitution|charisma|agility|stamina)\\s*(increased|decreased|improved|reduced)\\s*(?:by\\s*)?(\\d+)?/gi",replaceString:" **$1** $2 $3",trimStrings:[],placement:[Pe.AI_OUTPUT,Pe.MEMORY_PROCESSING],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Stats",description:"Highlight stat changes with chart emoji",createdAt:Date.now()}]},{name:"Items & Loot",description:"Format item discoveries and loot",category:"Items",rules:[{name:"Item Found",findRegex:"/\\b(found|discovered|obtained|acquired|received)\\s+(?:a\\s+|an\\s+|the\\s+)?([^.!?]+?)\\s*[.!]?$/gim",replaceString:" $1 **$2**",trimStrings:[],placement:[Pe.AI_OUTPUT],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Items",description:"Highlight item discoveries with money bag emoji",createdAt:Date.now()},{name:"Rare Items",findRegex:"/\\b(legendary|epic|rare|magical|enchanted|mystical)\\s+([^.!?]+?)\\b/gi",replaceString:" **$1 $2** ",trimStrings:[],placement:[Pe.AI_OUTPUT,Pe.MEMORY_PROCESSING],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Items",description:"Emphasize rare/magical items with sparkles",createdAt:Date.now()},{name:"Gold/Currency",findRegex:"/\\b(\\d+)\\s*(gold|coins?|silver|copper|money|currency)\\b/gi",replaceString:"**$1** $2",trimStrings:[],placement:[Pe.AI_OUTPUT],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Items",description:"Highlight currency amounts",createdAt:Date.now()}]},{name:"Location & Environment",description:"Format location descriptions and environmental text",category:"Environment",rules:[{name:"Location Names",findRegex:"/\\b(entered|arrived at|reached|found)\\s+(?:the\\s+)?([A-Z][a-zA-Z\\s]+?)(?:\\s*[.!]|$)/g",replaceString:"$1 **$2**",trimStrings:[],placement:[Pe.AI_OUTPUT,Pe.MEMORY_PROCESSING],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Environment",description:"Bold location names when entered or discovered",createdAt:Date.now()},{name:"Weather & Atmosphere",findRegex:"/\\b(stormy|sunny|rainy|foggy|misty|windy|snowy|cloudy|clear)\\s+(weather|sky|atmosphere|air)/gi",replaceString:" *$1 $2*",trimStrings:[],placement:[Pe.AI_OUTPUT],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Environment",description:"Add weather emoji to atmospheric descriptions",createdAt:Date.now()}]},{name:"Player Input Cleanup",description:"Clean and format player input commands",category:"Input Processing",rules:[{name:"Remove Extra Spaces",findRegex:"/\\s+/g",replaceString:" ",trimStrings:[],placement:[Pe.PLAYER_INPUT],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Input Processing",description:"Remove multiple spaces from player input",createdAt:Date.now()},{name:"Capitalize First Letter",findRegex:"/^([a-z])/",replaceString:"$1",trimStrings:[],placement:[Pe.PLAYER_INPUT],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Input Processing",description:"Capitalize first letter of player input",createdAt:Date.now()},{name:"Action Shorthand",findRegex:"/^(atk|att)\\s+(.+)/i",replaceString:"Attack $2",trimStrings:[],placement:[Pe.PLAYER_INPUT],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Input Processing",description:"Convert 'atk' shorthand to 'Attack'",createdAt:Date.now()}]},{name:"Memory Enhancement",description:"Enhance and categorize memory entries",category:"Memory",rules:[{name:"Combat Memory Tags",findRegex:"/\\b(fought|defeated|killed|slain|battle|combat|attack)\\b/gi",replaceString:"[COMBAT] $1",trimStrings:[],placement:[Pe.MEMORY_PROCESSING],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Memory",description:"Tag combat-related memories",createdAt:Date.now()},{name:"Social Memory Tags",findRegex:"/\\b(met|spoke|talked|conversation|dialogue|said)\\b/gi",replaceString:"[SOCIAL] $1",trimStrings:[],placement:[Pe.MEMORY_PROCESSING],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Memory",description:"Tag social interaction memories",createdAt:Date.now()},{name:"Discovery Memory Tags",findRegex:"/\\b(found|discovered|explored|learned|revealed)\\b/gi",replaceString:"[DISCOVERY] $1",trimStrings:[],placement:[Pe.MEMORY_PROCESSING],disabled:!1,isScoped:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!0,substituteRegex:ct.NONE,category:"Memory",description:"Tag discovery and exploration memories",createdAt:Date.now()}]}],ME=t=>{const e=[];return t.forEach(i=>{i.rules.forEach(s=>{e.push({...s,id:`template_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:Date.now()})})}),e},AE=({isOpen:t,onClose:e,onSave:i,rule:s,existingRuleNames:a})=>{const[u,f]=E.useState(()=>({id:(s==null?void 0:s.id)||Date.now().toString(),name:(s==null?void 0:s.name)||"",findRegex:(s==null?void 0:s.findRegex)||"",replaceString:(s==null?void 0:s.replaceString)||"",trimStrings:(s==null?void 0:s.trimStrings)||[],placement:(s==null?void 0:s.placement)||[Pe.AI_OUTPUT],disabled:(s==null?void 0:s.disabled)||!1,isScoped:(s==null?void 0:s.isScoped)||!1,markdownOnly:(s==null?void 0:s.markdownOnly)||!1,promptOnly:(s==null?void 0:s.promptOnly)||!1,runOnEdit:(s==null?void 0:s.runOnEdit)||!0,substituteRegex:(s==null?void 0:s.substituteRegex)||ct.NONE,minDepth:s==null?void 0:s.minDepth,maxDepth:s==null?void 0:s.maxDepth,category:(s==null?void 0:s.category)||"General",description:(s==null?void 0:s.description)||"",createdAt:(s==null?void 0:s.createdAt)||Date.now(),lastUsed:s==null?void 0:s.lastUsed})),[p,g]=E.useState(""),[m,y]=E.useState(""),[v,C]=E.useState(!1),[N,R]=E.useState("");E.useEffect(()=>{t&&(f({id:(s==null?void 0:s.id)||Date.now().toString(),name:(s==null?void 0:s.name)||"",findRegex:(s==null?void 0:s.findRegex)||"",replaceString:(s==null?void 0:s.replaceString)||"",trimStrings:(s==null?void 0:s.trimStrings)||[],placement:(s==null?void 0:s.placement)||[Pe.AI_OUTPUT],disabled:(s==null?void 0:s.disabled)||!1,isScoped:(s==null?void 0:s.isScoped)||!1,markdownOnly:(s==null?void 0:s.markdownOnly)||!1,promptOnly:(s==null?void 0:s.promptOnly)||!1,runOnEdit:(s==null?void 0:s.runOnEdit)||!0,substituteRegex:(s==null?void 0:s.substituteRegex)||ct.NONE,minDepth:s==null?void 0:s.minDepth,maxDepth:s==null?void 0:s.maxDepth,category:(s==null?void 0:s.category)||"General",description:(s==null?void 0:s.description)||"",createdAt:(s==null?void 0:s.createdAt)||Date.now(),lastUsed:s==null?void 0:s.lastUsed}),g(""),y(""),R(""))},[t,s]),E.useEffect(()=>{if(u.findRegex){const P=Er.validateRegexPattern(u.findRegex);R(P.isValid?"":P.error||"Invalid pattern")}else R("")},[u.findRegex]),E.useEffect(()=>{if(v&&p&&u.findRegex&&!N)try{const P=Mr.runRegexRule(u,p);y(P)}catch(P){y("Error: "+(P instanceof Error?P.message:"Unknown error"))}},[v,p,u,N]);const L=()=>{if(!u.name.trim()){alert("Rule name is required.");return}if(a.includes(u.name)&&u.name!==(s==null?void 0:s.name)){alert("A rule with this name already exists.");return}if(!u.findRegex.trim()){alert("Find regex pattern is required.");return}if(N){alert("Please fix the regex pattern error: "+N);return}if(u.placement.length===0){alert("At least one placement must be selected.");return}i(u),e()},O=(P,$)=>{f(ne=>({...ne,placement:$?[...ne.placement,P]:ne.placement.filter(z=>z!==P)}))},J=P=>{const $=P.split(`
`).filter(ne=>ne.trim().length>0);f(ne=>({...ne,trimStrings:$}))};return t?(Er.getPlacementDescriptions(),l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:l.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:l.jsxs("div",{className:"p-6",children:[l.jsxs("div",{className:"flex justify-between items-center mb-6",children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:s?"Edit Regex Rule":"Create Regex Rule"}),l.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:""})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rule Name *"}),l.jsx("input",{type:"text",value:u.name,onChange:P=>f($=>({...$,name:P.target.value})),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black",placeholder:"Enter rule name..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),l.jsx("textarea",{value:u.description,onChange:P=>f($=>({...$,description:P.target.value})),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black",rows:2,placeholder:"Describe what this rule does..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),l.jsx("input",{type:"text",value:u.category,onChange:P=>f($=>({...$,category:P.target.value})),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black",placeholder:"e.g., Formatting, Combat, Dialogue..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Find Regex Pattern *"}),l.jsx("textarea",{value:u.findRegex,onChange:P=>f($=>({...$,findRegex:P.target.value})),className:`w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm text-black ${N?"border-red-500":"border-gray-300"}`,rows:3,placeholder:"Enter regex pattern... e.g., /\\\\*([^*]+)\\\\*/g"}),N&&l.jsx("p",{className:"text-red-500 text-xs mt-1",children:N})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Replace With"}),l.jsx("textarea",{value:u.replaceString,onChange:P=>f($=>({...$,replaceString:P.target.value})),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm text-black",rows:3,placeholder:"Replacement text... Use $1, $2 for groups, {{match}} for full match"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trim Strings (one per line)"}),l.jsx("textarea",{value:u.trimStrings.join(`
`),onChange:P=>J(P.target.value),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black",rows:2,placeholder:"Strings to remove from matches..."})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Apply To (Placement) *"}),l.jsxs("div",{className:"space-y-2 max-h-40 overflow-y-auto border border-gray-200 rounded p-2",children:[l.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.placement.includes(Pe.PLAYER_INPUT),onChange:P=>O(Pe.PLAYER_INPUT,P.target.checked),className:"mt-0.5"}),l.jsx("span",{className:"flex-1 text-black font-semibold",children:"Player Commands"})]}),l.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.placement.includes(Pe.AI_OUTPUT),onChange:P=>O(Pe.AI_OUTPUT,P.target.checked),className:"mt-0.5"}),l.jsx("span",{className:"flex-1 text-black font-semibold",children:"AI Responses"})]}),l.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.placement.includes(Pe.MEMORY_PROCESSING),onChange:P=>O(Pe.MEMORY_PROCESSING,P.target.checked),className:"mt-0.5"}),l.jsx("span",{className:"flex-1 text-black font-semibold",children:"Memory Storage"})]}),l.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.placement.includes(Pe.ENTITY_DETECTION),onChange:P=>O(Pe.ENTITY_DETECTION,P.target.checked),className:"mt-0.5"}),l.jsx("span",{className:"flex-1 text-black font-semibold",children:"Entity Extraction"})]}),l.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.placement.includes(Pe.QUEST_PROCESSING),onChange:P=>O(Pe.QUEST_PROCESSING,P.target.checked),className:"mt-0.5"}),l.jsx("span",{className:"flex-1 text-black font-semibold",children:"Quest Updates"})]}),l.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.placement.includes(Pe.DIALOGUE_FORMATTING),onChange:P=>O(Pe.DIALOGUE_FORMATTING,P.target.checked),className:"mt-0.5"}),l.jsx("span",{className:"flex-1 text-black font-semibold",children:"Dialogue Formatting"})]}),l.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.placement.includes(Pe.STAT_EXTRACTION),onChange:P=>O(Pe.STAT_EXTRACTION,P.target.checked),className:"mt-0.5"}),l.jsx("span",{className:"flex-1 text-black font-semibold",children:"Statistics Extraction"})]}),l.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.placement.includes(Pe.COMBAT_FORMATTING),onChange:P=>O(Pe.COMBAT_FORMATTING,P.target.checked),className:"mt-0.5"}),l.jsx("span",{className:"flex-1 text-black font-semibold",children:"Combat Formatting"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Options"}),l.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.disabled,onChange:P=>f($=>({...$,disabled:P.target.checked}))}),l.jsx("span",{className:"text-black font-semibold",children:"Disabled"})]}),l.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.markdownOnly,onChange:P=>f($=>({...$,markdownOnly:P.target.checked}))}),l.jsx("span",{className:"text-black font-semibold",children:"Markdown display only"})]}),l.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.promptOnly,onChange:P=>f($=>({...$,promptOnly:P.target.checked}))}),l.jsx("span",{className:"text-black font-semibold",children:"Prompt generation only"})]}),l.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.runOnEdit,onChange:P=>f($=>({...$,runOnEdit:P.target.checked}))}),l.jsx("span",{className:"text-black font-semibold",children:"Run when editing content"})]}),l.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[l.jsx("input",{type:"checkbox",checked:u.isScoped,onChange:P=>f($=>({...$,isScoped:P.target.checked}))}),l.jsx("span",{className:"text-black font-semibold",children:"Character/World specific"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Macro Substitution"}),l.jsxs("select",{value:u.substituteRegex,onChange:P=>f($=>({...$,substituteRegex:parseInt(P.target.value)})),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black",children:[l.jsx("option",{value:ct.NONE,className:"text-black",children:"None - Use pattern as-is"}),l.jsx("option",{value:ct.RAW,className:"text-black",children:"Raw - Substitute macros"}),l.jsx("option",{value:ct.ESCAPED,className:"text-black",children:"Escaped - Substitute and escape"})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Depth"}),l.jsx("input",{type:"number",value:u.minDepth||"",onChange:P=>f($=>({...$,minDepth:P.target.value?parseInt(P.target.value):void 0})),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black",placeholder:"0",min:"0"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Depth"}),l.jsx("input",{type:"number",value:u.maxDepth||"",onChange:P=>f($=>({...$,maxDepth:P.target.value?parseInt(P.target.value):void 0})),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black",placeholder:"",min:"0"})]})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Test Pattern"}),l.jsxs("button",{onClick:()=>C(!v),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-800",children:[v?l.jsx(tw,{}):l.jsx(ew,{}),l.jsx("span",{className:"text-sm",children:v?"Hide":"Show"})]})]}),v&&l.jsxs("div",{className:"space-y-2",children:[l.jsx("textarea",{value:p,onChange:P=>g(P.target.value),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm text-black",rows:3,placeholder:"Enter test text here..."}),l.jsxs("div",{className:"bg-gray-50 p-2 rounded border text-sm",children:[l.jsx("div",{className:"font-medium text-gray-600 mb-1",children:"Output:"}),l.jsx("div",{className:"whitespace-pre-wrap break-words",children:m||(p?"No changes":"Enter test input above")})]})]})]})]})]}),l.jsxs("div",{className:"flex justify-end space-x-3 mt-6 pt-4 border-t",children:[l.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-50",children:"Cancel"}),l.jsxs("button",{onClick:L,disabled:!!N||!u.name.trim()||!u.findRegex.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center space-x-2",children:[l.jsx(vs,{}),l.jsx("span",{children:"Save Rule"})]})]})]})})})):null},RE=({isOpen:t,onClose:e,onSave:i,currentRules:s=[]})=>{const[a,u]=E.useState(s||[]),[f,p]=E.useState(!1),[g,m]=E.useState(),[y,v]=E.useState(new Set),[C,N]=E.useState(""),R=E.useRef(null);E.useEffect(()=>{t&&(u(s||[]),v(new Set))},[t,s]);const L=()=>{i(a),e()},O=()=>{m(void 0),p(!0)},J=S=>{m(S),p(!0)},P=S=>{u(g?V=>V.map(W=>W.id===S.id?S:W):V=>[...V,S])},$=S=>{confirm("Are you sure you want to delete this rule?")&&(u(V=>V.filter(W=>W.id!==S)),v(V=>{const W=new Set(V);return W.delete(S),W}))},ne=S=>{u(V=>V.map(W=>W.id===S?{...W,disabled:!W.disabled}:W))},z=(S,V)=>{v(W=>{const I=new Set(W);return V?I.add(S):I.delete(S),I})},ae=()=>{const S=Y(),V=S.every(W=>y.has(W.id));v(V?W=>{const I=new Set(W);return S.forEach(j=>I.delete(j.id)),I}:W=>{const I=new Set(W);return S.forEach(j=>I.add(j.id)),I})},de=()=>{u(S=>S.map(V=>y.has(V.id)?{...V,disabled:!1}:V))},re=()=>{u(S=>S.map(V=>y.has(V.id)?{...V,disabled:!0}:V))},se=()=>{y.size!==0&&confirm(`Are you sure you want to delete ${y.size} selected rule(s)?`)&&(u(S=>S.filter(V=>!y.has(V.id))),v(new Set))},oe=()=>{const S=y.size>0?a.filter(Z=>y.has(Z.id)):a;if(S.length===0){alert("No rules to export.");return}const V=JSON.stringify(S,null,2),W=new Blob([V],{type:"application/json"}),I=URL.createObjectURL(W),j=document.createElement("a"),F=new Date().toISOString().replace(/[:.]/g,"-");j.download=`RPG-Regex-Rules-${F}.json`,j.href=I,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(I)},_=async S=>{var W;const V=(W=S.target.files)==null?void 0:W[0];if(V){try{const I=await V.text(),j=JSON.parse(I);if(!Array.isArray(j))throw new Error("Invalid file format");const F=j.map(Z=>({...Z,id:Date.now().toString()+Math.random().toString(36),createdAt:Date.now()}));u(Z=>[...Z,...F]),alert(`Successfully imported ${F.length} rule(s).`)}catch(I){alert("Error importing rules: "+(I instanceof Error?I.message:"Unknown error"))}R.current&&(R.current.value="")}},me=()=>{if(confirm("This will add default RPG regex templates to your rules. Continue?")){const S=ME(EE);u(V=>[...V,...S]),alert(`Successfully loaded ${S.length} template rule(s)!`)}},Y=()=>a.filter(S=>!C||S.category===C),ue=()=>{const S=new Set(a.map(V=>V.category).filter(Boolean));return Array.from(S).sort()};if(!t)return null;const H=Y(),k=ue();return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[l.jsxs("div",{className:"p-6 border-b",children:[l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Regex Rules Manager"}),l.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:""})]}),l.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[l.jsxs("button",{onClick:O,className:"flex items-center space-x-2 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[l.jsx(bo,{}),l.jsx("span",{children:"New Rule"})]}),l.jsxs("select",{value:C,onChange:S=>N(S.target.value),className:"px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black",children:[l.jsx("option",{value:"",className:"text-black",children:"All Categories"}),k.map(S=>l.jsx("option",{value:S,className:"text-black",children:S},S))]}),l.jsxs("div",{className:"flex items-center space-x-2 border-l pl-3",children:[l.jsx("button",{onClick:ae,className:"px-3 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-50",children:H.length>0&&H.every(S=>y.has(S.id))?"Deselect All":"Select All"}),y.size>0&&l.jsxs(l.Fragment,{children:[l.jsxs("button",{onClick:de,className:"flex items-center space-x-1 px-3 py-2 text-green-600 border border-green-300 rounded hover:bg-green-50",children:[l.jsx(kr,{}),l.jsx("span",{children:"Enable"})]}),l.jsxs("button",{onClick:re,className:"flex items-center space-x-1 px-3 py-2 text-orange-600 border border-orange-300 rounded hover:bg-orange-50",children:[l.jsx(gg,{}),l.jsx("span",{children:"Disable"})]}),l.jsxs("button",{onClick:se,className:"flex items-center space-x-1 px-3 py-2 text-red-600 border border-red-300 rounded hover:bg-red-50",children:[l.jsx(pg,{}),l.jsx("span",{children:"Delete"})]})]})]}),l.jsxs("div",{className:"flex items-center space-x-2 border-l pl-3",children:[l.jsx("input",{ref:R,type:"file",accept:".json",onChange:_,className:"hidden"}),l.jsxs("button",{onClick:()=>{var S;return(S=R.current)==null?void 0:S.click()},className:"flex items-center space-x-1 px-3 py-2 text-blue-600 border border-blue-300 rounded hover:bg-blue-50",children:[l.jsx($l,{}),l.jsx("span",{children:"Import"})]}),l.jsxs("button",{onClick:me,className:"flex items-center space-x-1 px-3 py-2 text-green-600 border border-green-300 rounded hover:bg-green-50",children:[l.jsx(bo,{}),l.jsx("span",{children:"Load Templates"})]}),l.jsxs("button",{onClick:oe,className:"flex items-center space-x-1 px-3 py-2 text-blue-600 border border-blue-300 rounded hover:bg-blue-50",children:[l.jsx(vs,{}),l.jsxs("span",{children:["Export ",y.size>0?`(${y.size})`:"All"]})]})]})]})]}),l.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:H.length===0?l.jsxs("div",{className:"text-center text-gray-500 py-12",children:[l.jsx("p",{className:"text-lg mb-2",children:"No regex rules found"}),l.jsx("p",{className:"text-sm",children:"Create your first rule to get started with text processing automation."})]}):l.jsx("div",{className:"space-y-3",children:H.map(S=>l.jsx("div",{className:`border rounded-lg p-4 ${S.disabled?"bg-gray-50":"bg-white"} ${y.has(S.id)?"ring-2 ring-blue-500":""}`,children:l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[l.jsx("input",{type:"checkbox",checked:y.has(S.id),onChange:V=>z(S.id,V.target.checked),className:"mt-1"}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[l.jsx("h3",{className:`font-medium ${S.disabled?"text-gray-500":"text-gray-900"}`,children:S.name}),S.category&&l.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:S.category}),S.disabled&&l.jsx("span",{className:"px-2 py-1 text-xs bg-red-100 text-red-800 rounded",children:"Disabled"}),S.isScoped&&l.jsx("span",{className:"px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded",children:"Scoped"})]}),S.description&&l.jsx("p",{className:"text-sm text-gray-600 mb-2",children:S.description}),l.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[l.jsxs("div",{children:[l.jsx("span",{className:"font-medium",children:"Pattern:"})," ",l.jsx("code",{className:"bg-gray-100 px-1 rounded",children:S.findRegex.length>50?S.findRegex.substring(0,50)+"...":S.findRegex})]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-medium",children:"Applies to:"})," ",S.placement.map(V=>Er.getPlacementDescriptions()[V].split(" - ")[0]).join(", ")]})]})]})]}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("button",{onClick:()=>ne(S.id),className:`p-2 rounded ${S.disabled?"text-green-600 hover:bg-green-50":"text-orange-600 hover:bg-orange-50"}`,title:S.disabled?"Enable rule":"Disable rule",children:S.disabled?l.jsx(kr,{}):l.jsx(gg,{})}),l.jsx("button",{onClick:()=>J(S),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",title:"Edit rule",children:""}),l.jsx("button",{onClick:()=>$(S.id),className:"p-2 text-red-600 hover:bg-red-50 rounded",title:"Delete rule",children:l.jsx(pg,{})})]})]})},S.id))})}),l.jsx("div",{className:"p-6 border-t bg-gray-50",children:l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsxs("div",{className:"text-sm text-gray-600",children:[H.length," rule(s)  ",y.size," selected"]}),l.jsxs("div",{className:"flex space-x-3",children:[l.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-50",children:"Cancel"}),l.jsxs("button",{onClick:L,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center space-x-2",children:[l.jsx(vs,{}),l.jsx("span",{children:"Save All Rules"})]})]})]})})]})}),l.jsx(AE,{isOpen:f,onClose:()=>p(!1),onSave:P,rule:g,existingRuleNames:a.map(S=>S.name)})]})},IE=t=>t===0?"0":t.toLocaleString().replace(/,$/,""),Cr=E.memo(({isOpen:t,onClose:e,title:i,children:s,icon:a})=>t?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[65] p-4",onClick:e,children:l.jsxs("div",{className:"bg-white/90 dark:bg-[#2a2f4c]/90 backdrop-blur-sm border border-slate-300 dark:border-slate-600 rounded-lg shadow-2xl w-full max-w-lg text-slate-900 dark:text-white flex flex-col",onClick:u=>u.stopPropagation(),style:{maxHeight:"70vh"},children:[l.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-600 flex justify-between items-center flex-shrink-0",children:[l.jsxs("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-200 flex items-center gap-3",children:[a,i]}),l.jsx("button",{onClick:e,className:"text-gray-500 dark:text-gray-400 hover:text-slate-900 dark:hover:text-white text-3xl leading-none",children:l.jsx(An,{className:"w-6 h-6"})})]}),l.jsx("div",{className:"flex-grow overflow-y-auto",children:s})]})}):null);Cr.displayName="MemoizedInfoPanelModal";const z0=E.memo(({pc:t,statuses:e,knownEntities:i,onStatusClick:s,onEntityClick:a,onEditPC:u,worldData:f})=>{const p=v=>{const C=v.toLowerCase();return C.includes("ni ting")||C.includes("danh gia")||C.includes("huyn thoi")?"text-purple-600 dark:text-purple-400 font-semibold":C.includes("kht ting")||C.includes("c danh")?"text-red-600 dark:text-red-400 font-semibold":C.includes("tt")||C.includes("cao")?"text-green-600 dark:text-green-400 font-semibold":"text-slate-700 dark:text-gray-300"},g=E.useMemo(()=>(t==null?void 0:t.learnedSkills)||[],[t==null?void 0:t.learnedSkills]),m=E.useCallback(v=>{s(v)},[s]),y=E.useCallback(v=>{a(v)},[a]);return t?l.jsxs("div",{className:"p-4 h-full flex flex-col space-y-4 text-slate-700 dark:text-gray-300",children:[l.jsxs("div",{children:[l.jsxs("h4",{className:"font-semibold text-lg text-slate-800 dark:text-white mb-2 border-b border-slate-300 dark:border-slate-600 pb-1 flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(vo,{className:"w-5 h-5"}),"Thng tin c bn"]}),u&&t&&l.jsx("button",{onClick:()=>u(t),className:"text-yellow-500 hover:text-yellow-400 transition-colors p-1",title:"Chnh sa thng tin nhn vt",children:""})]}),l.jsxs("div",{className:"space-y-2 text-sm pl-2",children:[l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 w-20 inline-block",children:"Tn:"})," ",t.name]}),t.gender&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 w-20 inline-block",children:"Gii tnh:"})," ",t.gender]}),t.age&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 w-20 inline-block",children:"Tui:"})," ",t.age]}),t.location&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 w-20 inline-block",children:"V tr:"})," ",t.location]}),t.appearance&&l.jsxs("div",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Dung mo:"}),l.jsx("p",{className:"pl-2 mt-1 text-sm text-slate-600 dark:text-gray-400",children:t.appearance})]}),t.realm&&l.jsxs("p",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 w-20 inline-block",children:"Thc lc:"}),l.jsx("span",{className:"text-cyan-600 dark:text-cyan-400 font-semibold",children:t.realm})]}),t.currentExp!==void 0&&l.jsxs("p",{children:[l.jsxs("strong",{className:"font-semibold text-slate-800 dark:text-gray-100 w-20 inline-block",children:[(f==null?void 0:f.expName)||"Kinh nghim",":"]}),l.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-semibold",children:IE(t.currentExp)})]}),l.jsxs("div",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Danh vng:"}),t.fame?l.jsx("span",{className:`ml-2 ${p(t.fame)}`,children:t.fame}):l.jsx("span",{className:"ml-2 text-gray-500 dark:text-gray-400 italic",children:"Cha c danh ting"})]}),t.personality&&l.jsxs("div",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Tnh cch (B ngoi):"}),l.jsx("p",{className:"pl-2 mt-1 text-sm text-slate-600 dark:text-gray-400",children:t.personality})]}),t.personalityMbti&&Mn[t.personalityMbti]&&l.jsxs("div",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"Tnh cch (Ct li):"}),l.jsxs("p",{className:"pl-2 mt-1 text-sm text-slate-600 dark:text-gray-400",children:[` ${Mn[t.personalityMbti].title} (${t.personalityMbti}) - `,l.jsx("span",{className:"italic",children:`"${Mn[t.personalityMbti].description}"`})]})]}),t.motivation&&l.jsxs("div",{children:[l.jsx("strong",{className:"font-semibold text-slate-800 dark:text-gray-100",children:"ng c:"}),l.jsx("p",{className:"pl-2 mt-1 text-sm text-slate-600 dark:text-gray-400",children:t.motivation})]})]})]}),l.jsx(F0,{learnedSkills:g,knownEntities:i,onEntityClick:y}),l.jsx(Y0,{statuses:e,onStatusClick:m})]}):l.jsx("div",{className:"p-4 text-center text-slate-500",children:"Khng tm thy thng tin nhn vt."})});z0.displayName="MemoizedPlayerCharacterSheet";const F0=E.memo(({learnedSkills:t,knownEntities:e,onEntityClick:i})=>{const s=E.useMemo(()=>t.map(a=>{const u=e[a];return{name:a,entity:u}}),[t,e]);return l.jsxs("div",{children:[l.jsxs("h4",{className:"font-semibold text-lg text-slate-800 dark:text-white mb-2 border-b border-slate-300 dark:border-slate-600 pb-1 flex items-center gap-2",children:[l.jsx(zn,{className:"w-5 h-5"}),"K nng & Cng php"]}),s.length>0?l.jsx("ul",{className:"space-y-2 pl-2",children:s.map(a=>l.jsx(K0,{skill:a,onEntityClick:i},a.name))}):l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 italic pl-2",children:"Cha hc c k nng no."})]})});F0.displayName="MemoizedSkillsSection";const K0=E.memo(({skill:t,onEntityClick:e})=>{var s,a;const i=E.useCallback(()=>{e(t.name)},[t.name,e]);return l.jsx("li",{children:l.jsxs("button",{onClick:i,className:"text-left w-full p-2 bg-slate-200/50 dark:bg-slate-800/50 rounded-md hover:bg-slate-300/50 dark:hover:bg-slate-700/50 transition-colors",children:[l.jsxs("p",{className:"font-semibold text-cyan-700 dark:text-cyan-300 flex items-center gap-2",children:[l.jsx("span",{className:"w-4 h-4",children:Cs(t.entity||{name:t.name,type:"skill"})}),t.name," ",(s=t.entity)!=null&&s.mastery?`(${t.entity.mastery})`:""]}),((a=t.entity)==null?void 0:a.description)&&l.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1 pl-6",children:t.entity.description})]})})});K0.displayName="SkillListItem";const Y0=E.memo(({statuses:t,onStatusClick:e})=>{const i=E.useMemo(()=>t.map(s=>({...s,borderColor:Rr(s),textColor:xd(s),fontWeight:$0(s)})),[t]);return l.jsxs("div",{children:[l.jsxs("h4",{className:"font-semibold text-lg text-slate-800 dark:text-white mb-2 border-b border-slate-300 dark:border-slate-600 pb-1 flex items-center gap-2",children:[l.jsx(N0,{className:"w-5 h-5"}),"Trng thi hin ti"]}),i.length>0?l.jsx("div",{className:"flex flex-wrap gap-2 pl-2",children:i.map(s=>l.jsx(J0,{status:s,onStatusClick:e},s.name))}):l.jsx("div",{className:"mt-2 p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700 ml-2",children:l.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic text-center",children:"ang trong tnh trng bnh thng"})})]})});Y0.displayName="MemoizedEnhancedStatusesSection";const J0=E.memo(({status:t,onStatusClick:e})=>{const i=E.useCallback(()=>{e(t)},[t,e]);return l.jsxs("button",{onClick:i,className:`px-3 py-1.5 border rounded-lg transition-all duration-200 flex items-center gap-2 hover:scale-105 ${t.borderColor} hover:bg-slate-200 dark:hover:bg-slate-700/50 focus:outline-none focus:ring-2 ${t.borderColor.replace("border-","ring-").replace("/50","")} shadow-sm`,children:[l.jsx("span",{className:"w-4 h-4",children:gd(t)}),l.jsx("span",{className:`${t.textColor} ${t.fontWeight} text-sm`,children:t.name}),t.duration&&t.duration!=="permanent"&&l.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:["(",t.duration,")"]})]})});J0.displayName="EnhancedStatusButton";const _E=({isHomeModalOpen:t,isRestartModalOpen:e,isMemoryModalOpen:i,isKnowledgeModalOpen:s,isCustomRulesModalOpen:a,isMapModalOpen:u,isPcInfoModalOpen:f,isPartyModalOpen:p,isQuestLogModalOpen:g,isChoicesModalOpen:m,isInventoryModalOpen:y,isAdminModalOpen:v,isEditItemModalOpen:C,isEditSkillModalOpen:N,isEditNPCModalOpen:R,isEditPCModalOpen:L,isEditLocationModalOpen:O,isRegexManagerModalOpen:J,activeEntity:P,activeStatus:$,activeQuest:ne,activeEditItem:z,activeEditSkill:ae,activeEditNPC:de,activeEditPC:re,activeEditLocation:se,onBackToMenu:oe,handleRestartGame:_,setActiveEntity:me,handleUseItem:Y,handleLearnItem:ue,handleEquipItem:H,handleUnequipItem:k,handleDiscardItem:S,setActiveStatus:V,handleStatusClick:W,handleDeleteStatus:I,setActiveQuest:j,handleToggleMemoryPin:F,handleEntityClick:Z,handleSaveRules:A,handleSaveRegexRules:G,handleAction:M,setActiveEditItem:D,handleSaveEditedItem:B,setIsEditItemModalOpen:X,setActiveEditSkill:xe,handleSaveEditedSkill:Ne,setIsEditSkillModalOpen:Te,setActiveEditNPC:Ee,handleSaveEditedNPC:Re,setIsEditNPCModalOpen:ye,setActiveEditPC:we,handleSaveEditedPC:Se,setIsEditPCModalOpen:Ce,setActiveEditLocation:_e,handleSaveEditedLocation:gt,setIsEditLocationModalOpen:Fe,modalCloseHandlers:Q,memories:ve,knownEntities:be,statuses:Ae,quests:De,customRules:qe,regexRules:ze,choices:Ke,turnCount:Ye,locationDiscoveryOrder:Et,worldData:Kt,entityComputations:it})=>{var tn,Ot;return l.jsxs(l.Fragment,{children:[l.jsx(kg,{isOpen:t,onClose:Q.home,onConfirm:oe,title:"V Trang Ch?",message:"Bn c chc mun thot? Mi tin trnh cha lu s b mt."}),l.jsx(kg,{isOpen:e,onClose:Q.restart,onConfirm:_,title:"Bt u Li?",message:"Bn c chc mun bt u li cuc phiu lu? Ton b tin trnh hin ti s c khi to li t u vi cng thit lp th gii."}),l.jsx(iE,{entity:P?be[P.name]||P:null,onClose:()=>me(null),onUseItem:Y,onLearnItem:ue,onEquipItem:H,onUnequipItem:k,statuses:Ae,onStatusClick:W,onLocationAction:M,worldData:Kt,onEditSkill:Ue=>{xe(Ue),Te(!0)},onEditNPC:Ue=>{Ee(Ue),ye(!0)},onEditPC:Ue=>{we(Ue),Ce(!0)},onEditLocation:Ue=>{_e(Ue),Fe(!0)},onDeleteStatus:I}),l.jsx(sE,{status:$,onClose:()=>V(null)}),l.jsx(lE,{quest:ne,onClose:()=>j(null)}),l.jsx(aE,{isOpen:i,onClose:Q.memory,memories:ve,onTogglePin:F,gameState:{knownEntities:be,turnCount:Ye,statuses:Ae,party:it.displayParty,quests:De}}),l.jsx(B0,{isOpen:s,onClose:Q.knowledge,pc:it.pcEntity,knownEntities:be,onEntityClick:Z,turnCount:Ye}),l.jsx(mE,{isOpen:a,onClose:Q.customRules,onSave:A,currentRules:qe}),l.jsx(gE,{isOpen:u,onClose:Q.map,locations:Object.values(be).filter(Ue=>Ue.type==="location"),currentLocationName:((tn=it.pcEntity)==null?void 0:tn.location)||"",discoveryOrder:Et,onLocationClick:Z}),l.jsx(Cr,{isOpen:f,onClose:Q.pcInfo,title:"Thng Tin Nhn Vt",icon:l.jsx(vo,{className:"w-6 h-6"}),children:l.jsx(z0,{pc:it.pcEntity,statuses:it.pcStatuses,knownEntities:be,onStatusClick:W,onEntityClick:Z,onEditPC:Ue=>{we(Ue),Ce(!0)},worldData:Kt})}),l.jsx(Cr,{isOpen:p,onClose:Q.party,title:"T i",icon:l.jsx(Dr,{className:"w-6 h-6"}),children:l.jsx(yE,{party:it.displayParty,statuses:Ae,onMemberClick:Z})}),l.jsx(Cr,{isOpen:g,onClose:Q.questLog,title:"Nht K Nhim V",icon:l.jsx(zn,{className:"w-6 h-6"}),children:l.jsx(vE,{quests:De,onQuestClick:j})}),l.jsx(xE,{isOpen:m,onClose:Q.choices,choices:Ke,onAction:M}),l.jsx(bE,{isOpen:y,onClose:Q.inventory,playerInventory:it.playerInventory,onUseItem:Ue=>Y(Ue.name),onEquipItem:Ue=>H(Ue.name),onUnequipItem:Ue=>k(Ue.name),onDiscardItem:S,onEditItem:Ue=>{D(Ue),X(!0)}},`inventory-${it.playerInventory.length}`),l.jsx(CE,{isOpen:v,onClose:Q.admin,currentPlayerExp:((Ot=it.pcEntity)==null?void 0:Ot.currentExp)||0,onAddExp:Ue=>{const xn=it.pcEntity;if(xn){const wo=(xn.currentExp||0)+Ue;M(`ADMIN: [ENTITY_UPDATE: name="${xn.name}", currentExp=${wo}] Thm ${Ue} kinh nghim cho ${xn.name}`)}},onAddItem:Ue=>M(`ADMIN: [ITEM_AQUIRED: name="${Ue.name}", description="${Ue.description}", type="item", owner="pc", usable="${Ue.usable}", equippable="${Ue.equippable}"${Ue.quantities?`, quantities="${Ue.quantities}"`:""}${Ue.durability?`, durability="${Ue.durability}"`:""}] To vt phm ${Ue.name}`),onAddSkill:Ue=>M(`ADMIN: [LORE_SKILL: name="${Ue.name}", description="${Ue.description}", realm="${Ue.realm||""}", element="${Ue.element||""}", skillType="${Ue.skillType||"combat"}"] [SKILL_LEARNED: name="${Ue.name}"] To v hc k nng ${Ue.name}`)}),l.jsx(TE,{isOpen:C,onClose:Q.editItem,item:z,onSaveItem:B}),l.jsx(NE,{isOpen:N,onClose:Q.editSkill,skill:ae,onSaveSkill:Ne}),l.jsx(kE,{isOpen:R,onClose:Q.editNPC,npc:de,onSaveNPC:Re}),l.jsx(SE,{isOpen:L,onClose:Q.editPC,pc:re,onSavePC:Se}),l.jsx(wE,{isOpen:O,onClose:Q.editLocation,location:se,onSaveLocation:gt}),(Q==null?void 0:Q.regexManager)&&G&&(()=>{try{return l.jsx(RE,{isOpen:J||!1,onClose:Q.regexManager,currentRules:ze||[],onSave:G})}catch(Ue){return console.error("Error loading RegexManager:",Ue),null}})()]})},Q0=E.memo(_E);Q0.displayName="MemoizedModals";const LE=({isOpen:t,onClose:e,gameState:i,onImportSuccess:s})=>{const[a,u]=E.useState(!1),[f,p]=E.useState(!1),[g,m]=E.useState([]),[y,v]=E.useState([]),C=E.useRef(null);if(!t)return null;const N=z=>{if(!z)return;const ae=Array.from(z).filter(de=>de.name.endsWith(".json")&&de.type==="application/json");v(ae)},R=z=>{z.preventDefault(),u(!0)},L=z=>{z.preventDefault(),u(!1)},O=z=>{z.preventDefault(),u(!1),N(z.dataTransfer.files)},J=async()=>{if(y.length!==0){p(!0),m([]);try{const z=[];for(const ae of y){const de=await bs.importEntities(ae,i);z.push(de)}m(z),s(z)}catch(z){console.error("Import error:",z);const ae={success:!1,entitiesImported:0,entitiesSkipped:0,conflicts:[],error:z instanceof Error?z.message:"Unknown error"};m([ae])}finally{p(!1)}}},P=()=>{v([]),m([]),C.current&&(C.current.value="")},$=()=>g.reduce((z,ae)=>({imported:z.imported+ae.entitiesImported,skipped:z.skipped+ae.entitiesSkipped,conflicts:z.conflicts+ae.conflicts.length}),{imported:0,skipped:0,conflicts:0}),ne=bs.getExportStatus();return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4",onClick:e,children:l.jsxs("div",{className:"bg-white/95 dark:bg-[#2a2f4c]/95 backdrop-blur-sm border-2 border-green-400 rounded-lg shadow-2xl w-full max-w-3xl text-slate-900 dark:text-white max-h-[90vh] overflow-y-auto",onClick:z=>z.stopPropagation(),children:[l.jsxs("div",{className:"p-6 border-b-2 border-green-400 flex justify-between items-center",children:[l.jsxs("h3",{className:"text-2xl font-bold text-green-600 dark:text-green-400 flex items-center gap-3",children:[l.jsx("span",{className:"text-3xl",children:""}),"Nhp Entity t File"]}),l.jsx("button",{onClick:e,className:"text-gray-500 dark:text-gray-400 hover:text-slate-900 dark:hover:text-white text-3xl leading-none",children:l.jsx(An,{className:"w-6 h-6"})})]}),l.jsxs("div",{className:"p-6 space-y-6",children:[l.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[l.jsxs("h5",{className:"font-semibold text-blue-800 dark:text-blue-200 flex items-center gap-2 mb-2",children:[l.jsx("span",{children:""}),"Trng thi Import"]}),l.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[l.jsxs("div",{children:["Import c bt: ",ne.config.importEnabled?" C":" Khng"]}),l.jsxs("div",{children:["T ng merge: ",ne.config.autoMergeOnImport?" C":" Khng"]}),l.jsxs("div",{children:["To backup: ",ne.config.backupBeforeImport?" C":" Khng"]}),l.jsxs("div",{children:["Tng s ln import: ",ne.metadata.totalImports]})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h4",{className:"text-lg font-semibold text-slate-800 dark:text-gray-100 border-b border-slate-300 dark:border-slate-600 pb-2",children:" Chn File JSON"}),l.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-all duration-300 ${a?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-slate-300 dark:border-slate-600 hover:border-green-400"}`,onDragOver:R,onDragLeave:L,onDrop:O,children:l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"text-4xl",children:""}),l.jsxs("div",{children:[l.jsx("p",{className:"text-lg font-semibold text-slate-700 dark:text-gray-300",children:"Ko th file JSON vo y"}),l.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"hoc click  chn file"})]}),l.jsx("button",{type:"button",onClick:()=>{var z;return(z=C.current)==null?void 0:z.click()},className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md font-semibold transition-colors duration-200",children:"Chn File"}),l.jsx("input",{ref:C,type:"file",multiple:!0,accept:".json,application/json",onChange:z=>N(z.target.files),className:"hidden"})]})}),y.length>0&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("h5",{className:"font-semibold text-slate-700 dark:text-gray-300",children:["File  chn (",y.length,"):"]}),l.jsx("div",{className:"space-y-2",children:y.map((z,ae)=>l.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-100 dark:bg-slate-800 rounded border",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("span",{className:"text-green-600",children:""}),l.jsxs("div",{children:[l.jsx("div",{className:"font-medium text-slate-800 dark:text-gray-100",children:z.name}),l.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:[(z.size/1024).toFixed(1)," KB"]})]})]}),l.jsx("button",{onClick:()=>v(de=>de.filter((re,se)=>se!==ae)),className:"text-red-500 hover:text-red-700 text-xl",children:""})]},ae))})]})]}),g.length>0&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h4",{className:"text-lg font-semibold text-slate-800 dark:text-gray-100 border-b border-slate-300 dark:border-slate-600 pb-2",children:" Kt Qu Import"}),l.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-700",children:[l.jsx("h5",{className:"font-semibold text-green-800 dark:text-green-200 mb-2",children:" Tng Kt"}),l.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-2xl font-bold text-green-600",children:$().imported}),l.jsx("div",{className:"text-green-700 dark:text-green-300",children:" import"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:$().skipped}),l.jsx("div",{className:"text-yellow-700 dark:text-yellow-300",children:" b qua"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-2xl font-bold text-orange-600",children:$().conflicts}),l.jsx("div",{className:"text-orange-700 dark:text-orange-300",children:"Conflict"})]})]})]}),l.jsx("div",{className:"space-y-3",children:g.map((z,ae)=>{var de;return l.jsxs("div",{className:`p-4 rounded-lg border ${z.success?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-700":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-700"}`,children:[l.jsx("div",{className:"flex items-center justify-between mb-2",children:l.jsxs("h6",{className:`font-semibold ${z.success?"text-green-800 dark:text-green-200":"text-red-800 dark:text-red-200"}`,children:[z.success?"":""," File ",ae+1,": ",(de=y[ae])==null?void 0:de.name]})}),z.success?l.jsxs("div",{className:"text-sm space-y-1",children:[l.jsxs("div",{children:[" Imported: ",z.entitiesImported," entities"]}),l.jsxs("div",{children:[" Skipped: ",z.entitiesSkipped," entities"]}),z.conflicts.length>0&&l.jsxs("div",{children:[l.jsxs("div",{children:[" Conflicts: ",z.conflicts.length]}),l.jsxs("div",{className:"ml-4 mt-1 space-y-1",children:[z.conflicts.slice(0,3).map((re,se)=>l.jsxs("div",{className:"text-xs",children:[" ",re.entityName,": ",re.reason," (",re.action,")"]},se)),z.conflicts.length>3&&l.jsxs("div",{className:"text-xs",children:["... v ",z.conflicts.length-3," conflict khc"]})]})]})]}):l.jsxs("div",{className:"text-sm text-red-700 dark:text-red-300",children:[" Li: ",z.error]})]},ae)})})]}),l.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700",children:[l.jsx("h5",{className:"font-semibold text-slate-700 dark:text-gray-300 mb-2",children:" Hng Dn"}),l.jsxs("ul",{className:"text-sm text-slate-600 dark:text-slate-400 space-y-1",children:[l.jsx("li",{children:" Chn file JSON  c xut t h thng"}),l.jsx("li",{children:" H thng s t ng to backup trc khi import"}),l.jsx("li",{children:" Entity trng tn s c merge t ng"}),l.jsx("li",{children:" Kim tra kt qu import  xem chi tit"})]})]})]}),l.jsxs("div",{className:"p-6 border-t border-slate-200 dark:border-slate-700 flex justify-between",children:[l.jsx("button",{onClick:P,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md font-semibold transition-colors duration-200 flex items-center gap-2",disabled:f,children:" Reset"}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md font-semibold transition-colors duration-200",disabled:f,children:"ng"}),l.jsx("button",{onClick:J,disabled:y.length===0||f,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-md font-semibold transition-colors duration-200 flex items-center gap-2",children:f?l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"animate-spin",children:""}),"ang import..."]}):l.jsx(l.Fragment,{children:" Import Entity"})})]})]})]})})};var Ig=Dg();const jE=t=>t>8e4?"text-red-500 bg-red-100 dark:bg-red-900/30":t>7e4?"text-orange-500 bg-orange-100 dark:bg-orange-900/30":t>6e4?"text-yellow-500 bg-yellow-100 dark:bg-yellow-900/30":"text-green-500 bg-green-100 dark:bg-green-900/30",DE=({onHome:t,onSettings:e,onImport:i,onSave:s,onExportWorldSetup:a,onMap:u,onRules:f,onRegexManager:p,onKnowledge:g,onMemory:m,onRestart:y,onPCInfo:v,onParty:C,onQuests:N,onInventory:R,onAdmin:L,hasActiveQuests:O,onManualCleanup:J,worldData:P,gameTime:$,turnCount:ne,currentTurnTokens:z,totalTokens:ae})=>{const[de,re]=Me.useState(!1),[se,oe]=Me.useState(!1),_=Me.useRef(null),me=Me.useRef(null);Me.useEffect(()=>{const ue=()=>{re(!1),oe(!1)};if(de||se)return document.addEventListener("click",ue),()=>document.removeEventListener("click",ue)},[de,se]);const Y=(ue,H=!1)=>{if(!ue.current)return{top:64,left:16};const k=ue.current.getBoundingClientRect();return{top:k.bottom+4,[H?"right":"left"]:H?window.innerWidth-k.right:k.left}};return l.jsxs("div",{className:"hidden md:block",children:[l.jsxs("div",{className:"flex justify-between items-center bg-white/90 dark:bg-[#252945]/90 backdrop-blur-sm px-4 py-3 shadow-sm border-b border-slate-200/50 dark:border-slate-600/30",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("button",{onClick:t,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors text-slate-600 dark:text-slate-300",title:"Home",children:l.jsx(ql,{className:"w-5 h-5"})}),l.jsx("div",{className:"relative",children:l.jsxs("button",{ref:_,onClick:ue=>{ue.stopPropagation(),re(!de)},className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors border ${de?"bg-slate-100 dark:bg-slate-700 border-slate-300 dark:border-slate-600":"hover:bg-slate-100 dark:hover:bg-slate-700 border-transparent hover:border-slate-300 dark:hover:border-slate-600"} text-slate-600 dark:text-slate-300`,children:[l.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})}),l.jsx("span",{className:"text-sm font-medium",children:"Game"}),l.jsx("svg",{className:`w-4 h-4 transition-transform ${de?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]}),l.jsxs("div",{className:"flex items-center gap-6",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-lg font-semibold text-slate-800 dark:text-slate-200 truncate max-w-[200px]",title:P.storyName||"Phiu Lu K",children:P.storyName||"Phiu Lu K"}),l.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 truncate max-w-[200px]",title:P.genre||"Cha xc nh",children:P.genre||"Cha xc nh"})]}),l.jsxs("div",{className:`font-mono px-4 py-2 rounded-lg border-2 transition-all ${jE(z)} shadow-sm`,children:[l.jsxs("div",{className:"flex items-center gap-3 text-sm font-semibold",children:[l.jsxs("span",{children:["Lt: ",z.toLocaleString()]}),l.jsx("div",{className:"w-px h-4 bg-current opacity-40"}),l.jsxs("span",{children:["Tng: ",ae.toLocaleString()]})]}),l.jsx("div",{className:"mt-1.5 w-full bg-current opacity-20 rounded-full h-1.5",children:l.jsx("div",{className:"bg-current h-1.5 rounded-full transition-all duration-500",style:{width:`${Math.min(100,z/8e4*100)}%`}})})]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mr-2",children:["Nm ",Number.isFinite($.year)?$.year:1,", Thng ",Number.isFinite($.month)?$.month:1,", Ngy ",Number.isFinite($.day)?$.day:1,", ",Number.isFinite($.hour)?$.hour:0,":",(Number.isFinite($.minute)?$.minute:0).toString().padStart(2,"0")]}),l.jsx("div",{className:"relative",children:l.jsxs("button",{ref:me,onClick:ue=>{ue.stopPropagation(),oe(!se)},className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors border ${se?"bg-slate-100 dark:bg-slate-700 border-slate-300 dark:border-slate-600":"hover:bg-slate-100 dark:hover:bg-slate-700 border-transparent hover:border-slate-300 dark:hover:border-slate-600"} text-slate-600 dark:text-slate-300`,children:[l.jsx(vo,{className:"w-4 h-4"}),l.jsx("span",{className:"text-sm font-medium",children:"Player"}),O&&l.jsx("span",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),l.jsx("svg",{className:`w-4 h-4 transition-transform ${se?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]})]}),de&&Ig.createPortal(l.jsxs("div",{onClick:ue=>ue.stopPropagation(),className:"bg-white dark:bg-slate-800 rounded-lg shadow-2xl border border-slate-200 dark:border-slate-600 py-1 min-w-[180px]",style:{position:"fixed",zIndex:2147483647,...Y(_)},children:[l.jsx("button",{onClick:()=>{e(),re(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200",children:" Ci t"}),l.jsx("button",{onClick:()=>{i(),re(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200",children:" Nhp Entity"}),l.jsx("div",{className:"border-t border-slate-200 dark:border-slate-600 my-1"}),l.jsxs("button",{onClick:()=>{s(),re(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200",children:[l.jsx(m0,{className:"w-4 h-4"})," Lu Tr"]}),l.jsx("button",{onClick:()=>{a(),re(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200",children:" Xut WorldSetup"}),l.jsxs("button",{onClick:()=>{u(),re(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200",children:[l.jsx(Pr,{className:"w-4 h-4"})," Bn "]}),l.jsxs("button",{onClick:()=>{f(),re(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200",children:[l.jsx(Co,{className:"w-4 h-4"})," Np Tri Thc"]}),l.jsx("button",{onClick:()=>{p(),re(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200",children:" Regex Manager"}),l.jsxs("button",{onClick:()=>{g(),re(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200",children:[l.jsx(jr,{className:"w-4 h-4"})," Tri Thc",l.jsx("span",{className:"ml-auto text-xs text-slate-400",children:"K"})]}),l.jsxs("button",{onClick:()=>{m(),re(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200",children:[l.jsx(p0,{className:"w-4 h-4"})," K c"]}),l.jsx("div",{className:"border-t border-slate-200 dark:border-slate-600 my-1"}),l.jsx("button",{onClick:()=>{J(),re(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-orange-600 dark:text-orange-400",children:" Cleanup"}),l.jsx("div",{className:"border-t border-slate-200 dark:border-slate-600 my-1"}),l.jsx("button",{onClick:()=>{L(),re(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-purple-600 dark:text-purple-400",children:" Admin Panel"}),l.jsxs("button",{onClick:()=>{y(),re(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-red-600 dark:text-red-400",children:[l.jsx(x0,{className:"w-4 h-4"})," Bt u Li"]})]}),document.body),se&&Ig.createPortal(l.jsxs("div",{onClick:ue=>ue.stopPropagation(),className:"bg-white dark:bg-slate-800 rounded-lg shadow-2xl border border-slate-200 dark:border-slate-600 py-1 min-w-[150px]",style:{position:"fixed",zIndex:2147483647,...Y(me,!0)},children:[l.jsxs("button",{onClick:()=>{v(),oe(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200",children:[l.jsx(vo,{className:"w-4 h-4"})," Thng tin"]}),l.jsx("button",{onClick:()=>{R(),oe(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200",children:" Ti "}),l.jsxs("button",{onClick:()=>{C(),oe(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200",children:[l.jsx(Dr,{className:"w-4 h-4"})," T i"]}),l.jsxs("button",{onClick:()=>{N(),oe(!1)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex items-center gap-2 relative text-slate-700 dark:text-slate-200",children:[l.jsx(zn,{className:"w-4 h-4"})," Nhim v",O&&l.jsx("span",{className:"w-2 h-2 bg-yellow-500 rounded-full"})]})]}),document.body)]})},PE=({onOpenSidebar:t,worldData:e})=>l.jsxs("div",{className:"flex md:hidden justify-between items-center bg-white/70 dark:bg-[#252945]/80 backdrop-blur-sm p-3 rounded-b-lg shadow-lg flex-shrink-0 border-b border-slate-300/20 dark:border-slate-600/20",children:[l.jsx("button",{onClick:t,className:"p-2 -ml-2",children:l.jsx(lw,{className:"w-6 h-6"})}),l.jsx("h1",{className:"text-lg font-bold text-purple-700 dark:text-purple-300 uppercase tracking-wider truncate mx-2",children:e.storyName||"MANH MUONG TAM QUC"}),l.jsx("div",{className:"w-6 h-6 p-2 -mr-2"})]}),UE={pc:"text-yellow-700 dark:text-yellow-400 font-bold",npc:"text-blue-700 dark:text-blue-400 font-semibold",companion:"text-blue-700 dark:text-blue-400 font-semibold",location:"text-green-700 dark:text-green-400 font-semibold",faction:"text-red-700 dark:text-red-500 font-semibold",item:"am-kim",skill:"am-kim",concept:"text-purple-700 dark:text-purple-400 font-semibold"},X0=E.memo(({text:t})=>l.jsx("div",{className:"my-2 p-3 bg-yellow-400/10 dark:bg-yellow-500/10 border-l-4 border-yellow-500 dark:border-yellow-400 rounded-r-md",children:l.jsxs("p",{className:"font-semibold text-yellow-700 dark:text-yellow-200",children:[l.jsx("span",{className:"mr-2",children:""}),t.slice(3,-3).trim()]})}));X0.displayName="AnnouncementPart";const W0=E.memo(({text:t,entity:e,onClick:i})=>{const s=E.useCallback(()=>{i(t)},[t,i]),a=UE[e.type]||"text-slate-900 dark:text-white font-semibold";return l.jsxs("span",{onClick:s,className:`${a} cursor-pointer hover:underline transition-all`,children:[l.jsx("span",{className:"inline-block w-[1em] h-[1em] align-middle -mt-px mr-1.5",children:Cs(e)}),t]})});W0.displayName="EntityPart";const Z0=E.memo(({text:t})=>l.jsx("i",{className:"text-slate-600 dark:text-slate-400",children:t.slice(1,-1)}));Z0.displayName="ThoughtPart";const ex=E.memo(({text:t})=>l.jsx("span",{children:t}));ex.displayName="RegularTextPart";const tx=E.memo(({part:t,onEntityClick:e})=>t.isAnnouncement?l.jsx(X0,{text:t.text}):t.isEntity&&t.entity?l.jsx(W0,{text:t.text,entity:t.entity,onClick:e}):t.isThought?l.jsx(Z0,{text:t.text}):l.jsx(ex,{text:t.text}));tx.displayName="InteractiveTextPart";const yo=E.memo(({text:t,onEntityClick:e,knownEntities:i})=>{if(t.startsWith("> "))return l.jsx("div",{className:"font-semibold text-transparent bg-clip-text bg-gradient-to-r from-blue-500 via-cyan-500 to-blue-600 leading-relaxed whitespace-pre-wrap",children:t});const s=E.useMemo(()=>Object.keys(i).sort((p,g)=>g.length-p.length),[i]),a=E.useMemo(()=>{if(s.length===0)return/(\`.*?\`|\*\*.*?\*\*\*)/g;const p=s.map(g=>g.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"));return new RegExp(`(${p.join("|")}|\`.*?\`|\\*\\*.*?\\*\\*)`,"g")},[s]),u=E.useMemo(()=>t.split(a).map((g,m)=>{if(!g)return{text:g,isEntity:!1,isThought:!1,isAnnouncement:!1,index:m};const y=!!i[g],v=g.startsWith("`")&&g.endsWith("`"),C=g.startsWith("**")&&g.endsWith("**");return{text:g,isEntity:y,isThought:v,isAnnouncement:C,entity:y?i[g]:void 0,index:m}}).filter(g=>g.text),[t,a,i]),f=E.useCallback(p=>{e(p)},[e]);return l.jsx("div",{className:"text-slate-900 dark:text-gray-200 leading-relaxed whitespace-pre-wrap",children:u.map(p=>l.jsx(tx,{part:p,onEntityClick:f},p.index))})});yo.displayName="OptimizedInteractiveText";function nx(t){return t.includes('<div class="status-panel-dl">')&&t.includes("</div>")}function HE(t){const e=t.indexOf('<div class="status-panel-dl">'),i=t.lastIndexOf("</div>")+6;return e===-1||i===-1?{beforeHTML:t,htmlContent:"",afterHTML:""}:{beforeHTML:t.substring(0,e).trim(),htmlContent:t.substring(e,i).trim(),afterHTML:t.substring(i).trim()}}function OE(t){if(!nx(t))return{isHTML:!1,rawContent:t};try{const e=[],i=document.createElement("div");return i.innerHTML=t,i.querySelectorAll("details").forEach((a,u)=>{var g;const f=a.querySelector("summary"),p=a.querySelector(".content-box");f&&p&&e.push({id:`section-${u}`,title:((g=f.textContent)==null?void 0:g.trim())||`Section ${u+1}`,content:p.innerHTML.trim(),isOpen:a.hasAttribute("open")})}),{isHTML:!0,sections:e}}catch(e){return console.warn("Failed to parse HTML content:",e),{isHTML:!1,rawContent:t}}}function _g(t){return t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/on\w+="[^"]*"/gi,"").replace(/javascript:/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"")}const ix=E.memo(({section:t,knownEntities:e,onEntityClick:i})=>{const[s,a]=E.useState(t.isOpen),u=E.useCallback(()=>{a(y=>!y)},[]),f=y=>{const v=document.createElement("div");return v.innerHTML=_g(y),v.textContent||v.innerText||""},p=y=>{const v=y.toLowerCase().trim();return v.includes("th gii")||v.includes("thi gian")||v.includes("world")||v.includes("clock")?"section-world-clock":v.includes("thng tin")||v.includes("c bn")||v.includes("basic")||v.includes("info")?"section-basic-info":v.includes("trng thi")||v.includes("nhim v")||v.includes("status")||v.includes("mission")?"section-status-mission":v.includes("kho ")||v.includes("inventory")||v.includes("items")?"section-inventory":v.includes("s kin")||v.includes("parallel")||v.includes("events")?"section-parallel-events":v.includes("thnh vin club")||v.includes("club members")?"section-club-members":v.includes("n l ca bn")||v.includes("your slaves")?"section-your-slaves":v.includes("hon cnh n l")||v.includes("slave circumstance")?"section-slave-circumstance":v.includes("n l thnh vin khc")||v.includes("other members slaves")?"section-other-members-slaves":v.includes("hon cnh n l thnh vin khc")||v.includes("other members slaves circumstance")?"section-other-members-slaves-circumstance":v.includes("quan h")||v.includes("relations")?"section-relations":v.includes("nsfw")||v.includes("adult")?"section-nsfw-relations":v.includes("quan st")||v.includes("observation")?"section-observation":""},g=f(t.content),m=p(t.title);return l.jsxs("details",{open:s,className:`transition-all duration-300 ${m}`,children:[l.jsx("summary",{onClick:u,className:"list-none",children:t.title}),l.jsx("div",{className:"content-box",children:t.content.includes("<")?l.jsx("div",{dangerouslySetInnerHTML:{__html:_g(t.content)}}):l.jsx(yo,{text:g,onEntityClick:i,knownEntities:e})})]})});ix.displayName="CollapsibleSection";const sx=E.memo(({htmlContent:t,knownEntities:e,onEntityClick:i})=>{const{beforeHTML:s,htmlContent:a,afterHTML:u}=HE(t),f=OE(a);return!f.isHTML||!f.sections?l.jsx(yo,{text:f.rawContent||t,onEntityClick:i,knownEntities:e}):l.jsxs("div",{className:"space-y-4",children:[s&&l.jsx(yo,{text:s,onEntityClick:i,knownEntities:e}),l.jsx("div",{className:"status-panel-dl",children:f.sections.map(p=>l.jsx(ix,{section:p,knownEntities:e,onEntityClick:i},p.id))}),u&&l.jsx(yo,{text:u,onEntityClick:i,knownEntities:e})]})});sx.displayName="StatusPanelContent";function GE(t,e){let i;return function(...s){i||(t.apply(this,s),i=!0,setTimeout(()=>i=!1,e))}}function VE(t,e=100){const i=E.useRef(null),s=E.useCallback(GE(f=>{const p=f.currentTarget,g={scrollTop:p.scrollTop,scrollHeight:p.scrollHeight,clientHeight:p.clientHeight};t&&t(g)},e),[t,e]),a=E.useCallback(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},[]),u=E.useCallback(()=>{i.current&&(i.current.scrollTop=0)},[]);return{scrollElementRef:i,onScroll:s,scrollToBottom:a,scrollToTop:u}}const $E=t=>{const a=(t.match(/\n/g)||[]).length+1,u=Math.ceil(t.length/80),f=Math.max(a,u);return Math.max(60,60+(f-1)*24)},ox=E.memo(({item:t,knownEntities:e,onEntityClick:i,onHeightMeasured:s})=>{const a=E.useRef(null);E.useEffect(()=>{a.current&&!t.actualHeight&&requestAnimationFrame(()=>{if(a.current){const f=a.current.getBoundingClientRect().height;f!==t.actualHeight&&s(t.id,f)}})},[t.content,t.id,t.actualHeight,s]);const u=nx(t.content);return l.jsx("div",{ref:a,className:"story-item bg-white/5 backdrop-blur-sm border border-white/10 rounded-xl p-4 hover:bg-white/10 transition-all duration-300",children:u?l.jsx(sx,{htmlContent:t.content,onEntityClick:i,knownEntities:e}):l.jsx(yo,{text:t.content,onEntityClick:i,knownEntities:e})})});ox.displayName="VirtualStoryItem";const lx=E.memo(({storyLog:t,isLoading:e,isAiReady:i,knownEntities:s,onEntityClick:a,className:u=""})=>{const f=E.useRef(null),[p,g]=E.useState({scrollTop:0,containerHeight:window.innerHeight*.6,isScrolling:!1,shouldAutoScroll:!1}),[m,y]=E.useState(new Map),v=E.useRef(null),C=E.useMemo(()=>t.map((ae,de)=>({id:`story-${de}-${ae.substring(0,10)}`,index:de,content:ae,estimatedHeight:$E(ae),actualHeight:m.get(`story-${de}-${ae.substring(0,10)}`)})),[t,m]),N=E.useMemo(()=>{const ae=[];let de=0;return C.forEach(re=>{const se=re.actualHeight||re.estimatedHeight;ae.push({start:de,height:se}),de+=se}),ae},[C]),R=E.useMemo(()=>N.length>0?N[N.length-1].start+N[N.length-1].height:0,[N]),L=E.useMemo(()=>({startIndex:0,endIndex:Math.max(0,C.length-1)}),[C.length]),O=E.useMemo(()=>L.endIndex<L.startIndex?[]:C.slice(L.startIndex,L.endIndex+1),[C,L]),J=E.useCallback((ae,de)=>{y(re=>{const se=new Map(re);return se.set(ae,de),se})},[]),P=E.useCallback(ae=>{const{scrollTop:de}=ae;g(re=>({...re,scrollTop:de,isScrolling:!0,shouldAutoScroll:!1})),v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{g(re=>({...re,isScrolling:!1}))},150)},[]),{scrollElementRef:$,onScroll:ne}=VE(P,16),z=E.useCallback(()=>{$.current&&($.current.scrollTop=$.current.scrollHeight)},[]);return E.useEffect(()=>{let ae=null;const de=()=>{ae&&clearTimeout(ae),ae=setTimeout(()=>{f.current&&requestAnimationFrame(()=>{if(f.current){const re=f.current.getBoundingClientRect();g(se=>({...se,containerHeight:re.height}))}})},150)};return de(),window.addEventListener("resize",de),()=>{window.removeEventListener("resize",de),ae&&clearTimeout(ae)}},[]),L.startIndex>0&&N[L.startIndex].start,E.useEffect(()=>()=>{v.current&&clearTimeout(v.current)},[]),l.jsxs("div",{ref:f,className:`md:col-span-1 flex flex-col bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl overflow-hidden ${u}`,children:[l.jsx("div",{className:"flex-shrink-0 p-6 border-b border-white/10",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-purple-200 via-pink-200 to-purple-200 bg-clip-text text-transparent",children:" Din Bin Cu Chuyn"}),l.jsxs("div",{className:"flex items-center gap-3 text-sm text-white/70",children:[l.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl px-3 py-1",children:l.jsxs("span",{children:[t.length," dng"]})}),p.isScrolling&&l.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-pink-400 to-purple-400 rounded-full animate-pulse"})]})]})}),l.jsxs("div",{className:"flex-grow min-h-0 relative",children:[i?t.length===0?l.jsx("div",{className:"flex items-center justify-center h-full p-6",children:l.jsxs("div",{className:"text-center bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-8",children:[l.jsx("div",{className:"text-purple-300 mb-4 text-4xl",children:""}),l.jsx("p",{className:"text-white/80 text-lg font-medium",children:"Cu chuyn s bt u  y..."}),l.jsx("p",{className:"text-white/60 text-sm mt-2",children:"Hy chn mt hnh ng  bt u cuc phiu lu"})]})}):l.jsx("div",{ref:$,className:"h-full overflow-y-auto pr-2 p-4 md:pb-4 pb-40",onScroll:ne,children:l.jsx("div",{className:"space-y-4",children:O.map(ae=>l.jsx(ox,{item:ae,knownEntities:s,onEntityClick:a,onHeightMeasured:J},ae.id))})}):l.jsx("div",{className:"flex items-center justify-center h-full p-6",children:l.jsxs("div",{className:"text-center bg-red-500/10 backdrop-blur-sm border border-red-400/20 rounded-2xl p-8",children:[l.jsx("div",{className:"text-red-300 mb-4 text-4xl",children:""}),l.jsx("p",{className:"text-white/80 text-lg font-medium",children:"AI cha sn sng"}),l.jsx("p",{className:"text-white/60 text-sm mt-2",children:"Vui lng kim tra API Key v quay v trang ch"})]})}),e&&i&&t.length>0&&l.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2",children:l.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-purple-500/20 to-pink-500/20 backdrop-blur-xl border border-purple-400/30 px-4 py-3 rounded-2xl shadow-2xl",children:[l.jsx(Hl,{className:"w-5 h-5 text-purple-300"}),l.jsx("span",{className:"text-sm text-white font-medium",children:"ang to cu chuyn..."})]})}),t.length>5&&l.jsx("div",{className:"absolute top-4 right-4 flex flex-col gap-2",children:l.jsx("button",{onClick:z,className:"bg-gradient-to-r from-purple-500/30 to-pink-500/30 hover:from-purple-500/40 hover:to-pink-500/40 backdrop-blur-xl border border-purple-400/40 text-white p-3 rounded-2xl shadow-2xl transition-all hover:scale-110 group",title:"Cun xung cui",children:l.jsx("svg",{className:"w-4 h-4 group-hover:animate-bounce",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})})}),t.length>10&&l.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white/10 backdrop-blur-sm rounded-r-2xl",children:l.jsx("div",{className:"bg-gradient-to-b from-purple-400 to-pink-400 w-full transition-all duration-200 rounded-r-2xl",style:{height:`${Math.min(100,p.scrollTop/(R-p.containerHeight)*100)}%`}})})]})]})});lx.displayName="StoryPanel";const BE=({isAiReady:t,apiKeyError:e,isLoading:i,choices:s,handleAction:a,debouncedHandleAction:u,customAction:f,setCustomAction:p,handleSuggestAction:g,isCustomActionLocked:m})=>{const[y,v]=E.useState(f),[C,N]=E.useState(!1);E.useEffect(()=>{!C&&f!==y&&v(f)},[f]);const R=E.useRef();E.useEffect(()=>{if(!C)return R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{p(y)},300),()=>{R.current&&clearTimeout(R.current)}},[y,C,p]);const L=E.useCallback(()=>{N(!0)},[]),O=E.useCallback(ne=>{N(!1),v(ne.currentTarget.value)},[]),J=E.useCallback(ne=>{const z=ne.target.value;C||v(z),C&&v(z)},[C]),P=E.useCallback(ne=>{ne.key==="Enter"&&!C&&u(y)},[y,u,C]),$=E.useCallback(()=>{a(y)},[y,a]);return l.jsxs("div",{className:"hidden md:flex flex-col bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl overflow-hidden h-full",children:[l.jsx("div",{className:"flex-shrink-0 p-6 border-b border-white/10",children:l.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-cyan-200 via-blue-200 to-cyan-200 bg-clip-text text-transparent",children:" La Chn Ca Ngi"})}),l.jsx("div",{className:"flex-grow overflow-hidden flex flex-col",children:l.jsx("div",{className:"flex-grow overflow-y-auto px-6 py-4",children:t?i&&s.length===0?l.jsx("div",{className:"flex items-center justify-center h-full",children:l.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 backdrop-blur-xl border border-cyan-400/30 px-6 py-4 rounded-2xl",children:[l.jsx(Hl,{className:"w-8 h-8 text-cyan-300"}),l.jsx("span",{className:"text-white font-medium",children:"ang ti la chn..."})]})}):l.jsxs("div",{className:"space-y-3",children:[s.map((ne,z)=>l.jsx("button",{onClick:()=>a(ne),className:"group w-full text-left p-4 bg-white/5 hover:bg-gradient-to-r hover:from-cyan-500/20 hover:to-blue-500/20 backdrop-blur-sm border border-white/20 hover:border-cyan-400/40 rounded-2xl transition-all duration-300 shadow-lg hover:shadow-2xl transform hover:scale-[1.02]",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-gradient-to-r from-cyan-500/30 to-blue-500/30 rounded-xl flex items-center justify-center text-white font-bold text-sm group-hover:from-cyan-500/50 group-hover:to-blue-500/50 transition-all duration-300",children:z+1}),l.jsx("div",{className:"flex-grow",children:l.jsx("p",{className:"text-white/90 group-hover:text-white transition-colors duration-300",children:ne.match(/^\d+\.\s/)?ne.replace(/^\d+\.\s/,""):ne})})]})},z)),s.length>4&&l.jsx("div",{className:"text-center py-2",children:l.jsx("p",{className:"text-xs text-white/40",children:" Cun  xem thm la chn"})})]}):l.jsx("div",{className:"flex items-center justify-center h-full",children:l.jsxs("div",{className:"text-center bg-red-500/10 backdrop-blur-sm border border-red-400/20 rounded-2xl p-8",children:[l.jsx("div",{className:"text-red-300 mb-4 text-4xl",children:""}),l.jsx("p",{className:"text-white/80 text-lg font-medium",children:"AI cha sn sng"}),l.jsx("p",{className:"text-white/60 text-sm mt-2",children:e||"Vui lng kim tra API Key v quay v trang ch"})]})})})}),l.jsxs("div",{className:"flex-shrink-0 p-6 border-t border-white/10",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("p",{className:"text-sm text-white/70 font-medium mb-2",children:" Hnh ng ty "}),l.jsx("p",{className:"text-xs text-white/50",children:'Nhp hnh ng ca ring bn (thm "nsfw"  cui  c ni dung 18+)'})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:y,onChange:J,onKeyPress:P,onCompositionStart:L,onCompositionEnd:O,disabled:i||!t||m,placeholder:m?"Hnh ng ty   b kha bi mt lut l":"V d: nht hn  ln...",className:"flex-1 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl py-3 px-4 text-white placeholder-white/50 focus:outline-none focus:border-cyan-400/50 focus:ring-2 focus:ring-cyan-400/20 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,inputMode:"text"}),l.jsx("button",{onClick:g,disabled:i||!t,className:"px-4 py-3 bg-gradient-to-r from-yellow-500/30 to-orange-500/30 hover:from-yellow-500/40 hover:to-orange-500/40 border border-yellow-400/40 rounded-xl text-yellow-200 hover:text-white transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed backdrop-blur-sm","aria-label":"Gi  hnh ng",children:l.jsx(Oi,{className:"w-5 h-5"})}),l.jsx("button",{onClick:$,disabled:i||!t||m,className:"px-6 py-3 bg-gradient-to-r from-cyan-500/30 to-blue-500/30 hover:from-cyan-500/40 hover:to-blue-500/40 border border-cyan-400/40 rounded-xl text-white font-semibold transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed backdrop-blur-sm","aria-label":"Gi hnh ng",children:"Gi"})]})]})]})},qE=({isOpen:t,onClose:e,onHome:i,onSettings:s,onImport:a,onSave:u,onExportWorldSetup:f,onMap:p,onRules:g,onRegexManager:m,onKnowledge:y,onMemory:v,onRestart:C,onPCInfo:N,onParty:R,onQuests:L,onAdmin:O,hasActiveQuests:J,currentTurnTokens:P,totalTokens:$,historyStats:ne,compressedSegments:z,gameHistory:ae,cleanupStats:de,onManualCleanup:re})=>{const se=oe=>{oe(),e()};return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:`fixed inset-0 bg-black/60 z-[80] transition-opacity md:hidden ${t?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:e}),l.jsxs("div",{className:`fixed top-0 left-0 bottom-0 w-64 bg-slate-100 dark:bg-[#1f2238] shadow-2xl z-[90] p-4 flex flex-col transform transition-transform md:hidden ${t?"translate-x-0":"-translate-x-full"}`,children:[l.jsxs("div",{className:"flex justify-between items-center mb-4 flex-shrink-0",children:[l.jsx("h3",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:"Menu"}),l.jsx("button",{onClick:e,children:l.jsx(An,{className:"w-6 h-6"})})]}),l.jsxs("nav",{className:"flex-grow overflow-y-auto pr-2 flex flex-col space-y-3",children:[l.jsxs("button",{onClick:()=>se(i),className:"flex items-center text-left w-full px-3 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 rounded",children:[l.jsx(ql,{className:"w-5 h-5 mr-3"})," Home"]}),l.jsxs("button",{onClick:()=>se(s),className:"flex items-center text-left w-full px-3 py-2 bg-blue-600 dark:bg-blue-700 hover:bg-blue-500 dark:hover:bg-blue-600 rounded text-white",children:[" ",l.jsx("span",{className:"ml-3",children:"Ci t"})]}),l.jsxs("button",{onClick:()=>se(a),className:"flex items-center text-left w-full px-3 py-2 bg-green-600 dark:bg-green-700 hover:bg-green-500 dark:hover:bg-green-600 rounded text-white",children:[" ",l.jsx("span",{className:"ml-3",children:"Nhp Entity"})]}),l.jsxs("button",{onClick:()=>se(u),className:"flex items-center text-left w-full px-3 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 rounded",children:[l.jsx(m0,{className:"w-5 h-5 mr-3"})," Lu Tr"]}),l.jsxs("button",{onClick:()=>se(f),className:"flex items-center text-left w-full px-3 py-2 bg-blue-600 dark:bg-blue-700 hover:bg-blue-500 dark:hover:bg-blue-600 rounded text-white",children:[" ",l.jsx("span",{className:"ml-3",children:"Xut WorldSetup"})]}),l.jsxs("button",{onClick:()=>se(p),className:"flex items-center text-left w-full px-3 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 rounded",children:[l.jsx(Pr,{className:"w-5 h-5 mr-3"})," Bn "]}),l.jsxs("button",{onClick:()=>se(g),className:"flex items-center text-left w-full px-3 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 rounded",children:[l.jsx(Co,{className:"w-5 h-5 mr-3"})," Np Tri Thc"]}),l.jsxs("button",{onClick:()=>se(m),className:"flex items-center text-left w-full px-3 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 rounded",children:[l.jsx(f0,{className:"w-5 h-5 mr-3"})," Regex Manager"]}),l.jsxs("button",{onClick:()=>se(y),className:"flex items-center text-left w-full px-3 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 rounded",children:[l.jsx(jr,{className:"w-5 h-5 mr-3"})," Tri Thc ",l.jsx("span",{className:"ml-auto text-xs text-slate-400",children:"K"})]}),l.jsxs("button",{onClick:()=>se(v),className:"flex items-center text-left w-full px-3 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 rounded",children:[l.jsx(p0,{className:"w-5 h-5 mr-3"})," K c"]}),l.jsxs("button",{onClick:()=>se(O),className:"flex items-center text-left w-full px-3 py-2 bg-purple-600/80 hover:bg-purple-500 rounded text-white",children:[" ",l.jsx("span",{className:"ml-3",children:"Admin Panel"})]}),l.jsxs("button",{onClick:()=>se(C),className:"flex items-center text-left w-full px-3 py-2 bg-red-600/80 hover:bg-red-500 rounded text-white",children:[l.jsx(x0,{className:"w-5 h-5 mr-3"})," Bt u Li"]}),l.jsxs("div",{className:"border-t border-slate-300 dark:border-slate-700 pt-4 mt-4 space-y-3",children:[l.jsxs("button",{onClick:()=>se(N),className:"flex items-center text-left w-full px-3 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 rounded",children:[l.jsx(vo,{className:"w-5 h-5 mr-3"})," Thng tin"]}),l.jsxs("button",{onClick:()=>se(R),className:"flex items-center text-left w-full px-3 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 rounded",children:[l.jsx(Dr,{className:"w-5 h-5 mr-3"})," T i"]}),l.jsxs("button",{onClick:()=>se(L),className:"relative flex items-center text-left w-full px-3 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 rounded",children:[l.jsx(zn,{className:"w-5 h-5 mr-3"})," Nhim v",J&&l.jsx("span",{className:"absolute top-1 right-1 w-4 h-4 flex items-center justify-center rounded-full bg-yellow-500 text-white",children:l.jsx(y0,{className:"w-3 h-3"})})]})]})]}),l.jsx("div",{className:"mt-2 pt-2 border-t border-slate-400 dark:border-slate-600",children:l.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 space-y-1",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Cleanup:"}),l.jsxs("span",{className:"font-mono text-green-400",children:[de.totalCleanupsPerformed,"x"]})]}),de.totalTokensSavedFromCleanup>0&&l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Saved:"}),l.jsxs("span",{className:"font-mono text-green-400",children:[Math.round(de.totalTokensSavedFromCleanup/1e3),"k"]})]}),re&&l.jsx("button",{onClick:re,className:"w-full mt-1 px-2 py-1 bg-orange-600 hover:bg-orange-500 text-white text-xs rounded",children:" Manual Cleanup"})]})}),l.jsxs("div",{className:"flex-shrink-0 text-center space-y-2 mt-auto pt-4 border-t border-slate-300 dark:border-slate-700",children:[l.jsxs("div",{className:"flex justify-between items-center text-xs",children:[l.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Lt:"}),l.jsx("span",{className:`font-mono font-semibold ${P>8e4?"text-red-400":P>7e4?"text-orange-400":P>6e4?"text-yellow-400":"text-green-400"}`,children:P.toLocaleString()})]}),l.jsx("div",{className:"w-full bg-slate-600 rounded-full h-1.5",children:l.jsx("div",{className:`h-1.5 rounded-full transition-all duration-500 ${P>8e4?"bg-red-400":P>7e4?"bg-orange-400":P>6e4?"bg-yellow-400":"bg-green-400"}`,style:{width:`${Math.min(100,P/8e4*100)}%`}})}),l.jsx("div",{className:"mt-2 pt-2 border-t border-slate-400 dark:border-slate-600",children:l.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 space-y-1",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"History:"}),l.jsxs("span",{className:"font-mono",children:[ae.length," entries"]})]}),z>0&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Compressed:"}),l.jsxs("span",{className:"font-mono text-green-400",children:[z," segments"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Saved:"}),l.jsxs("span",{className:"font-mono text-green-400",children:[Math.round(ne.totalTokensSaved/1e3),"k tokens"]})]})]})]})})]})]})]})},zE=({notification:t,showSaveSuccess:e,showRulesSavedSuccess:i})=>l.jsxs(l.Fragment,{children:[t&&l.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 bg-yellow-500 text-black px-4 py-2 rounded-lg shadow-lg z-[100] animate-pulse flex items-center gap-2",children:[l.jsx(g0,{className:"w-5 h-5"}),t]}),e&&l.jsx("div",{className:"absolute top-20 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-pulse",children:"Lu tr thnh cng!"}),i&&l.jsx("div",{className:"absolute top-20 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-pulse",children:"Lu lut l thnh cng! S c hiu lc  lt sau."})]}),FE=({onChoicesClick:t,onInventoryClick:e,customAction:i,setCustomAction:s,handleAction:a,debouncedHandleAction:u,handleSuggestAction:f,isLoading:p,isAiReady:g,isCustomActionLocked:m})=>{const[y,v]=E.useState(i),[C,N]=E.useState(!1);E.useEffect(()=>{!C&&i!==y&&v(i)},[i]);const R=E.useRef();E.useEffect(()=>{if(!C)return R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{s(y)},300),()=>{R.current&&clearTimeout(R.current)}},[y,C,s]);const L=E.useCallback(()=>{N(!0)},[]),O=E.useCallback(ne=>{N(!1),v(ne.currentTarget.value)},[]),J=E.useCallback(ne=>{const z=ne.target.value;C||v(z),C&&v(z)},[C]),P=E.useCallback(ne=>{ne.key==="Enter"&&!C&&u(y)},[y,u,C]),$=E.useCallback(()=>{a(y)},[y,a]);return l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:t,className:"md:hidden fixed bottom-20 right-4 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-full shadow-lg z-40","aria-label":"La chn hnh ng",children:l.jsx(ad,{className:"w-6 h-6"})}),l.jsx("button",{onClick:e,className:"md:hidden fixed bottom-36 right-4 bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-4 rounded-full shadow-lg z-40","aria-label":"Ti ",children:l.jsx(T0,{className:"w-6 h-6"})}),l.jsx("div",{className:"md:hidden fixed bottom-0 left-0 right-0 bg-white/95 dark:bg-[#1f2238]/95 backdrop-blur-sm p-3 border-t border-slate-300 dark:border-slate-700 shadow-lg z-30",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"text",value:y,onChange:J,onKeyPress:P,onCompositionStart:L,onCompositionEnd:O,disabled:p||!g||m,placeholder:m?"Hnh ng ty   b kha.":"Nhp hnh ng...",className:"flex-1 bg-slate-100 dark:bg-[#373c5a] border border-slate-300 dark:border-slate-600 rounded-md py-2 px-3 text-sm text-slate-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:bg-slate-500",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,inputMode:"text"}),f&&l.jsx("button",{onClick:f,disabled:p||!g,className:"px-3 py-2 bg-gradient-to-r from-yellow-500/80 to-orange-500/80 hover:from-yellow-500 hover:to-orange-500 border border-yellow-400/60 rounded-md text-yellow-100 hover:text-white transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Gi  hnh ng",children:l.jsx(Oi,{className:"w-4 h-4"})}),l.jsx("button",{onClick:$,disabled:p||!g||m,className:"px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white font-semibold rounded-md transition-colors disabled:bg-slate-500",children:"Gi"})]})})]})},KE=({gameTime:t,className:e=""})=>{const[i,s]=E.useState(()=>{const P=localStorage.getItem("floatingTimePosition");return P?JSON.parse(P):{x:20,y:100}}),[a,u]=E.useState(!1),[f,p]=E.useState({x:0,y:0}),g=E.useRef(null);E.useEffect(()=>{localStorage.setItem("floatingTimePosition",JSON.stringify(i))},[i]);const m=E.useCallback(()=>{const P=["Thng 1","Thng 2","Thng 3","Thng 4","Thng 5","Thng 6","Thng 7","Thng 8","Thng 9","Thng 10","Thng 11","Thng 12"],$=Number.isFinite(t==null?void 0:t.hour)?t.hour:0,ne=Number.isFinite(t==null?void 0:t.minute)?t.minute:0,z=Number.isFinite(t==null?void 0:t.day)?t.day:1,ae=Number.isFinite(t==null?void 0:t.month)?t.month:1,de=Number.isFinite(t==null?void 0:t.year)?t.year:1,re=$>=6&&$<12?"Sng":$>=12&&$<18?"Chiu":$>=18&&$<22?"Ti":"m";return{date:`${P[ae-1]||P[0]} ${z}, Nm ${de}`,time:`${$}:${ne.toString().padStart(2,"0")} ${re}`}},[t]),y=E.useCallback(P=>{var z;const $=P.touches[0],ne=(z=g.current)==null?void 0:z.getBoundingClientRect();ne&&(u(!0),p({x:$.clientX-ne.left,y:$.clientY-ne.top}))},[]),v=E.useCallback(P=>{if(!a)return;const $=P.touches[0],ne=$.clientX-f.x,z=$.clientY-f.y,ae=window.innerWidth-200,de=window.innerHeight-100;s({x:Math.max(0,Math.min(ae,ne)),y:Math.max(0,Math.min(de,z))})},[a,f]),C=E.useCallback(()=>{u(!1)},[]),N=E.useCallback(P=>{var ne;P.preventDefault();const $=(ne=g.current)==null?void 0:ne.getBoundingClientRect();$&&(u(!0),p({x:P.clientX-$.left,y:P.clientY-$.top}))},[]),R=E.useCallback(P=>{if(!a)return;const $=P.clientX-f.x,ne=P.clientY-f.y,z=window.innerWidth-200,ae=window.innerHeight-100;s({x:Math.max(0,Math.min(z,$)),y:Math.max(0,Math.min(ae,ne))})},[a,f]),L=E.useCallback(()=>{u(!1)},[]);E.useEffect(()=>{if(a)return document.addEventListener("mousemove",R),document.addEventListener("mouseup",L),()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",L)}},[a,R,L]);const{date:O,time:J}=m();return l.jsx("div",{ref:g,className:`fixed z-50 select-none cursor-move ${a?"scale-105 shadow-2xl transition-all duration-100 md:duration-200":"shadow-lg transition-all duration-150 md:duration-200 md:hover:scale-102"} ${e}`,style:{left:`${i.x}px`,top:`${i.y}px`,touchAction:"none",WebkitUserSelect:"none",userSelect:"none",transform:a?"scale(1.05) translateZ(0)":"translateZ(0)",willChange:a?"transform":"auto"},onTouchStart:y,onTouchMove:v,onTouchEnd:C,onMouseDown:N,children:l.jsxs("div",{className:"bg-black/20 dark:bg-black/40 backdrop-blur-md border border-white/10 rounded-lg p-3 min-w-[180px]",children:[l.jsx("div",{className:"flex justify-center mb-1",children:l.jsx("div",{className:"w-8 h-1 bg-white/30 rounded-full"})}),l.jsxs("div",{className:"text-white text-center",children:[l.jsx("div",{className:"text-xs font-medium opacity-90 leading-tight",children:O}),l.jsx("div",{className:"text-sm font-bold mt-1 text-yellow-300",children:J})]})]})})},kd=class kd{static performCleanup(e,i=this.DEFAULT_CONFIG){return e.turnCount%i.cleanupInterval===0&&e.turnCount>0?{...this._runCleanupLogic(e,i),shouldRunCleanup:!0}:{optimizedState:e,stats:this.getEmptyStats(),shouldRunCleanup:!1}}static _runCleanupLogic(e,i){console.log(` Running cleanup logic at turn ${e.turnCount}...`);const s=performance.now();let a=JSON.parse(JSON.stringify(e));const u={memoriesRemoved:0,chronicleEntriesRemoved:0,questsArchived:0,statusesRemoved:0,entitiesArchived:0,totalTokensSaved:0,lastCleanupTurn:e.turnCount},f=this.cleanupMemories(a.memories,i);a.memories=f.cleaned,u.memoriesRemoved=f.removed,u.totalTokensSaved+=f.tokensSaved;const p=this.cleanupChronicle(a.chronicle,i);a.chronicle=p.cleaned,u.chronicleEntriesRemoved=p.removed,u.totalTokensSaved+=p.tokensSaved;const g=this.cleanupQuests(a.quests,e.turnCount,i);a.quests=g.cleaned,u.questsArchived=g.archived,u.totalTokensSaved+=g.tokensSaved;const m=this.cleanupStatuses(a.statuses,i);a.statuses=m.cleaned,u.statusesRemoved=m.removed,u.totalTokensSaved+=m.tokensSaved;const y=this.cleanupInactiveEntities(a.knownEntities,e.gameHistory,e.turnCount,i);a.knownEntities=y.cleaned,u.entitiesArchived=y.archived,u.totalTokensSaved+=y.tokensSaved;const v=performance.now()-s;return console.log(` Cleanup completed in ${v.toFixed(2)}ms:`,u),{optimizedState:a,stats:u}}static cleanupMemories(e,i){const s=e.filter(y=>y.pinned),a=e.filter(y=>!y.pinned);s.length>i.maxTotalMemories*.7&&console.warn(` Too many pinned memories (${s.length}). Consider unpinning some.`);const u=a.slice(-i.maxUnpinnedMemories),f=s.length+u.length;let p;if(f>i.maxTotalMemories){const y=i.maxTotalMemories-u.length,v=s.slice(-Math.max(0,y));p=[...v,...u],console.warn(` Removed ${s.length-v.length} oldest pinned memories due to limit`)}else p=[...s,...u];const g=e.length-p.length,m=g*50;return{cleaned:p,removed:g,tokensSaved:m}}static cleanupChronicle(e,i){const s=e.memoir.length+e.chapter.length+e.turn.length,a={memoir:e.memoir.slice(-i.maxMemoirEntries),chapter:e.chapter.slice(-i.maxChapterEntries),turn:e.turn.slice(-i.maxTurnEntries)},u=a.memoir.length+a.chapter.length+a.turn.length,f=s-u,p=f*100;return{cleaned:a,removed:f,tokensSaved:p}}static cleanupQuests(e,i,s){const a=e.filter(y=>y.status==="active"),f=e.filter(y=>y.status!=="active").map(y=>({...y,completedTurn:y.completedTurn||i})).filter(y=>i-y.completedTurn<=s.questRetentionTurns).slice(-s.maxCompletedQuests),p=[...a,...f],g=e.length-p.length,m=g*200;return{cleaned:p,archived:g,tokensSaved:m}}static cleanupStatuses(e,i){let s=[...e];i.removeExpiredStatuses&&(s=s.filter(g=>{var m,y;return!((m=g.duration)!=null&&m.toLowerCase().includes("ht"))&&!((y=g.duration)!=null&&y.toLowerCase().includes("kt thc"))&&g.duration!=="0"}));const a={};s.forEach(g=>{a[g.owner]||(a[g.owner]=[]),a[g.owner].push(g)});const u=[];Object.entries(a).forEach(([g,m])=>{if(m.length>i.maxStatusesPerEntity){const y=m.slice(-i.maxStatusesPerEntity);u.push(...y),console.log(` Removed ${m.length-y.length} old statuses from ${g}`)}else u.push(...m)});const f=e.length-u.length,p=f*80;return{cleaned:u,removed:f,tokensSaved:p}}static cleanupInactiveEntities(e,i,s,a){const u=i.slice(-a.entityInactivityThreshold*2),f={};u.forEach(C=>{var R,L,O;const N=((O=(L=(R=C.parts)==null?void 0:R[0])==null?void 0:L.text)==null?void 0:O.toLowerCase())||"";Object.keys(e).forEach(J=>{N.includes(J.toLowerCase())&&(f[J]=(f[J]||0)+1)})});const p=new Set;Object.values(e).forEach(C=>{(C.type==="pc"||C.type==="companion"||C.owner==="pc"||C.type==="location"&&f[C.name]>0)&&p.add(C.name)});const g={};let m=0;Object.entries(e).forEach(([C,N])=>{const R=f[C]||0,L=p.has(C),O=R>0;L||O?g[C]=N:(g[C]={...N,archived:!0,archivedAt:s},m++)});const y=Object.entries(g).filter(([C,N])=>N.archived);if(y.length>a.maxInactiveEntities){const C=y.sort((N,R)=>(N[1].archivedAt||0)-(R[1].archivedAt||0)).slice(0,y.length-a.maxInactiveEntities);C.forEach(([N])=>{delete g[N]}),console.log(` Permanently removed ${C.length} oldest archived entities`)}const v=m*150;return{cleaned:g,archived:m,tokensSaved:v}}static getCleanupStatistics(e){const i={memoryUsage:{pinned:e.memories.filter(s=>s.pinned).length,unpinned:e.memories.filter(s=>!s.pinned).length,total:e.memories.length},chronicleSize:{memoir:e.chronicle.memoir.length,chapter:e.chronicle.chapter.length,turn:e.chronicle.turn.length,total:e.chronicle.memoir.length+e.chronicle.chapter.length+e.chronicle.turn.length},questStatus:{active:e.quests.filter(s=>s.status==="active").length,completed:e.quests.filter(s=>s.status==="completed").length,failed:e.quests.filter(s=>s.status==="failed").length,total:e.quests.length},statusDistribution:{},entityTypes:{},archivedEntities:0};return e.statuses.forEach(s=>{i.statusDistribution[s.owner]=(i.statusDistribution[s.owner]||0)+1}),Object.values(e.knownEntities).forEach(s=>{i.entityTypes[s.type]=(i.entityTypes[s.type]||0)+1,s.archived&&i.archivedEntities++}),i}static getEmptyStats(){return{memoriesRemoved:0,chronicleEntriesRemoved:0,questsArchived:0,statusesRemoved:0,entitiesArchived:0,totalTokensSaved:0,lastCleanupTurn:0}}static forceCleanup(e,i=!1){const s=i?{...this.DEFAULT_CONFIG,maxUnpinnedMemories:15,maxMemoirEntries:10,maxChapterEntries:15,maxTurnEntries:20,maxCompletedQuests:5,questRetentionTurns:30,maxStatusesPerEntity:2,maxInactiveEntities:50}:this.DEFAULT_CONFIG;return this._runCleanupLogic(e,s)}};kd.DEFAULT_CONFIG={maxUnpinnedMemories:25,maxTotalMemories:30,maxMemoirEntries:15,maxChapterEntries:20,maxTurnEntries:30,maxCompletedQuests:10,questRetentionTurns:50,maxStatusesPerEntity:3,removeExpiredStatuses:!0,maxInactiveEntities:100,entityInactivityThreshold:25,cleanupInterval:10};let po=kd;class YE{static analyzeMemories(e){const i=e.memories,s=e.turnCount;console.log(` Memory Analytics: Analyzing ${i.length} memories at turn ${s}`);const a=this.calculateOverview(i,s),u=this.analyzeTrends(i,s),f=this.generateInsights(i,u,a,e),p=this.calculatePerformance(i,s),g=this.generateRecommendations(a,p,f);return{overview:a,trends:u,insights:f,recommendations:g,performance:p}}static calculateOverview(e,i){if(e.length===0)return{totalMemories:0,averageImportance:0,memoryGrowthRate:0,topCategories:[],memoryHealth:"poor"};const a=e.reduce((v,C)=>v+(C.importance||0),0)/e.length,u=Math.min(...e.map(v=>v.createdAt||i)),f=Math.max(1,i-u),p=e.length/f,g={};e.forEach(v=>{v.category&&(g[v.category]=(g[v.category]||0)+1)});const m=Object.entries(g).sort((v,C)=>C[1]-v[1]).slice(0,5).map(([v])=>v);let y;return a>=70&&p>.5?y="excellent":a>=50&&p>.2?y="good":a>=30?y="fair":y="poor",{totalMemories:e.length,averageImportance:a,memoryGrowthRate:p,topCategories:m,memoryHealth:y}}static analyzeTrends(e,i){const s={};e.forEach(u=>{const f=u.category||"uncategorized";s[f]||(s[f]=[]),s[f].push(u)});const a=[];for(const[u,f]of Object.entries(s)){const p=f.length,g=f.reduce((L,O)=>L+(O.importance||0),0),m=p>0?g/p:0,y=f.map(L=>L.createdAt||i),v=Math.min(...y),C=Math.max(...y),R=f.filter(L=>(L.createdAt||i)>i-10).length;a.push({category:u,count:p,averageImportance:m,recentGrowth:R,oldestMemory:v,newestMemory:C})}return a.sort((u,f)=>f.count-u.count)}static generateInsights(e,i,s,a){const u=[],f=a.turnCount;s.memoryHealth==="excellent"?u.push({type:"achievement",title:"Excellent Memory Quality",description:`Your memories have an average importance of ${s.averageImportance.toFixed(1)}. Great storytelling!`,actionable:!1,priority:"low"}):s.memoryHealth==="poor"&&u.push({type:"warning",title:"Low Memory Quality",description:"Many memories have low importance scores. Consider focusing on more significant events.",actionable:!0,priority:"high"}),s.memoryGrowthRate>2?u.push({type:"warning",title:"High Memory Growth Rate",description:`Creating ${s.memoryGrowthRate.toFixed(1)} memories per turn. Consider enabling auto-cleanup.`,actionable:!0,priority:"medium"}):s.memoryGrowthRate<.1&&u.push({type:"recommendation",title:"Low Memory Activity",description:"Very few memories being created. Enable smart memory generation for richer experiences.",actionable:!0,priority:"medium"}),i.forEach(m=>{m.recentGrowth>5&&u.push({type:"trend",title:`Active ${m.category} Events`,description:`${m.recentGrowth} new ${m.category} memories in recent turns.`,actionable:!1,priority:"low",data:{category:m.category,growth:m.recentGrowth}}),m.averageImportance>80&&u.push({type:"achievement",title:`High-Impact ${m.category}`,description:`Your ${m.category} memories are exceptionally important (${m.averageImportance.toFixed(1)} avg).`,actionable:!1,priority:"low"})});const p=this.detectDuplicateRisk(e);p>.3&&u.push({type:"warning",title:"Potential Duplicate Memories",description:`${Math.round(p*100)}% of memories might be duplicates. Consider cleanup.`,actionable:!0,priority:"medium"});const g=e.filter(m=>f-(m.createdAt||f)>50);return g.length>20&&u.push({type:"recommendation",title:"Archive Old Memories",description:`${g.length} memories are over 50 turns old. Consider archival to improve performance.`,actionable:!0,priority:"low"}),u.sort((m,y)=>{const v={high:3,medium:2,low:1};return v[y.priority]-v[m.priority]})}static calculatePerformance(e,i){if(e.length===0)return{memoriesPerTurn:0,averageMemoryAge:0,duplicateRisk:0,tokenUsageEstimate:0};const s=Math.min(...e.map(y=>y.createdAt||i)),a=Math.max(1,i-s),u=e.length/a,p=e.reduce((y,v)=>y+(i-(v.createdAt||i)),0)/e.length,g=this.detectDuplicateRisk(e),m=e.reduce((y,v)=>y+this.estimateMemoryTokens(v),0);return{memoriesPerTurn:u,averageMemoryAge:p,duplicateRisk:g,tokenUsageEstimate:m}}static generateRecommendations(e,i,s){return{cleanup:e.totalMemories>100||i.duplicateRisk>.2,enhancement:e.averageImportance<40,archival:i.averageMemoryAge>30,backup:e.totalMemories>50&&e.memoryHealth!=="poor"}}static detectDuplicateRisk(e){if(e.length<2)return 0;let i=0;const s=.8;for(let u=0;u<e.length-1;u++)for(let f=u+1;f<e.length;f++)this.calculateTextSimilarity(e[u].text,e[f].text)>s&&i++;const a=e.length*(e.length-1)/2;return a>0?i/a:0}static calculateTextSimilarity(e,i){const s=e.toLowerCase().split(/\s+/),a=i.toLowerCase().split(/\s+/),u=new Set(s),f=new Set(a),p=new Set([...u].filter(m=>f.has(m))),g=new Set([...u,...f]);return g.size>0?p.size/g.size:0}static estimateMemoryTokens(e){var s,a;let i=Math.ceil(e.text.length*.8);return(s=e.tags)!=null&&s.length&&(i+=e.tags.length*2),(a=e.relatedEntities)!=null&&a.length&&(i+=e.relatedEntities.length*3),i}static generateQualityReport(e){const i=e.filter(p=>(p.importance||0)>=70),s=e.filter(p=>{const g=p.importance||0;return g>=40&&g<70}),a=e.filter(p=>(p.importance||0)<40),u=e.filter(p=>{var g,m;return!p.category||!((g=p.tags)!=null&&g.length)||!((m=p.relatedEntities)!=null&&m.length)}),f=`Quality Analysis: ${i.length} high-quality, ${s.length} medium-quality, ${a.length} low-quality memories. ${u.length} need enhancement.`;return{highQuality:i,mediumQuality:s,lowQuality:a,needsEnhancement:u,summary:f}}}const JE=({initialGameState:t,onBackToMenu:e,keyRotationNotification:i,onClearNotification:s})=>{const{ai:a,isAiReady:u,apiKeyError:f,rotateKey:p,isUsingDefaultKey:g,userApiKeyCount:m,selectedModel:y}=E.useContext(vd),v=E.useRef(!1),C=E.useRef(t.customRules),[N,R]=E.useState(null),{rehydratedLog:L,rehydratedChoices:O}=E.useMemo(()=>{if(Array.isArray(t.storyLog)&&Array.isArray(t.choices))return{rehydratedLog:t.storyLog,rehydratedChoices:t.choices};const fe=[];let ce=[];return(t.gameHistory||[]).forEach(ke=>{if(ke.role==="user"){const tt=ke.parts[0].text.match(/--- HNH NG CA NGI CHI ---\n"([^"]+)"/),Je=tt?tt[1]:null;Je&&Je!=="SYSTEM_RULE_UPDATE"&&fe.push(`> ${Je}`)}else try{const He=JSON.parse(ke.parts[0].text),Je=(He.story||"").replace(/\[([A-Z_]+):\s*([^\]]+)\]/g,"").trim();Je&&fe.push(Je),ce=He.choices||[]}catch{const tt=ke.parts[0].text.replace(/\[([A-Z_]+):\s*([^\]]+)\]/g,"").trim();fe.push(tt)}}),{rehydratedLog:fe,rehydratedChoices:ce}},[t]),[J,P]=v0(),[$,ne]=Mw(t),[z,ae]=ww(t,u,L,O),[de,re]=Ew(),{worldData:se,knownEntities:oe,statuses:_,quests:me,gameHistory:Y,memories:ue,party:H,customRules:k,regexRules:S,systemInstruction:V,chronicle:W,gameTime:I,turnCount:j,currentTurnTokens:F,totalTokens:Z,storyLog:A,choices:G,locationDiscoveryOrder:M,choiceHistory:D,isLoading:B,hasGeneratedInitialStory:X,customAction:xe}=z,{setWorldData:Ne,setKnownEntities:Te,setStatuses:Ee,setQuests:Re,setGameHistory:ye,setMemories:we,setParty:Se,setCustomRules:Ce,setRegexRules:_e,setSystemInstruction:gt,setChronicle:Fe,setGameTime:Q,setTurnCount:ve,setCurrentTurnTokens:be,setTotalTokens:Ae,setStoryLog:De,setChoices:qe,setLocationDiscoveryOrder:ze,updateChoiceHistory:Ke,setIsLoading:Ye,setHasGeneratedInitialStory:Et,setCustomAction:Kt}=ae,it=E.useMemo(()=>C0(De),[De]),{isHomeModalOpen:tn,isRestartModalOpen:Ot,isMemoryModalOpen:Ue,isKnowledgeModalOpen:xn,isCustomRulesModalOpen:wo,isMapModalOpen:zl,isPcInfoModalOpen:Fl,isPartyModalOpen:Eo,isQuestLogModalOpen:Vi,isSidebarOpen:Ur,isChoicesModalOpen:Kl,isGameSettingsModalOpen:Yl,isEntityImportModalOpen:Mo,isInventoryModalOpen:Ao,isAdminModalOpen:Jl,isEditItemModalOpen:Hr,isEditSkillModalOpen:Un,isEditNPCModalOpen:Dt,isEditPCModalOpen:Yt,isEditLocationModalOpen:hi,isRegexManagerModalOpen:Ro,activeEntity:Or,activeStatus:Gr,activeQuest:Ql,activeEditItem:$i,activeEditSkill:Io,activeEditNPC:fi,activeEditPC:mi,activeEditLocation:Bi,showSaveSuccess:pi,showRulesSavedSuccess:Mt,notification:Xl}=de,{setIsHomeModalOpen:_o,setIsRestartModalOpen:Rn,setIsMemoryModalOpen:Fn,setIsKnowledgeModalOpen:Lo,setIsCustomRulesModalOpen:jo,setIsMapModalOpen:Do,setIsPcInfoModalOpen:Wl,setIsPartyModalOpen:qi,setIsQuestLogModalOpen:zi,setIsSidebarOpen:yn,setIsChoicesModalOpen:Po,setIsGameSettingsModalOpen:Ns,setIsEntityImportModalOpen:Hn,setIsInventoryModalOpen:ks,setIsAdminModalOpen:Ss,setIsEditItemModalOpen:Uo,setIsEditSkillModalOpen:ws,setIsEditNPCModalOpen:Jt,setIsEditPCModalOpen:Es,setIsEditLocationModalOpen:Ho,setIsRegexManagerModalOpen:Fi,setActiveEntity:Oo,setActiveStatus:Ki,setActiveQuest:Zl,setActiveEditItem:Qt,setActiveEditSkill:Yi,setActiveEditNPC:Ms,setActiveEditPC:Ji,setActiveEditLocation:On,setShowSaveSuccess:ea,setShowRulesSavedSuccess:ta,setNotification:$e,modalCloseHandlers:Vr}=re,{gameSettings:xt}=J,{handleSettingsChange:na}=P,{compressedHistory:Nt,historyStats:kt,cleanupStats:lt}=$,{setCompressedHistory:Qi,setHistoryStats:As,setCleanupStats:Xi}=ne,[At,Kn]=E.useState(t.archivedMemories||[]),[on,Rs]=E.useState(t.memoryStats||{totalMemoriesArchived:0,totalMemoriesEnhanced:0,averageImportanceScore:0,lastMemoryCleanupTurn:0}),In=E.useMemo(()=>Object.values(oe).find(fe=>fe.type==="pc"),[oe]),Yn=In==null?void 0:In.name,vn=E.useMemo(()=>Sw({setGameTime:Q,setChronicle:Fe,setMemories:we,setStatuses:Ee,setKnownEntities:Te,setQuests:Re,setParty:Se,setLocationDiscoveryOrder:ze,knownEntities:oe,statuses:_,party:H,regexRules:S,turnCount:j,worldData:se}),[oe,_,H,S,j,se]),gi=E.useCallback((fe,ce=!0)=>vn.parseStoryAndTags(fe,ce),[vn]),xi={type:_t.OBJECT,properties:{story:{type:_t.STRING,description:"Phn vn bn tng thut ca cu chuyn, bao gm cc nh dng c bit v cc th lnh n."},choices:{type:_t.ARRAY,items:{type:_t.STRING},description:"Mt mng gm 4-6 la chn cho ngi chi."}},required:["story","choices"]},Gt=E.useMemo(()=>yw({ai:a,selectedModel:y,systemInstruction:V,responseSchema:xi,isUsingDefaultKey:g,userApiKeyCount:m,rotateKey:p,rehydratedChoices:O,setIsLoading:Ye,setChoices:qe,setCustomAction:Kt,setStoryLog:De,setGameHistory:ye,setTurnCount:ve,setCurrentTurnTokens:be,setTotalTokens:Ae,gameHistory:Y,customRules:k,regexRules:S,ruleChanges:N,setRuleChanges:R,parseStoryAndTags:gi,updateChoiceHistory:Ke}),[a,y,V,xi,g,m,p,O,Y,k,S,N,gi,Ke]),Is=E.useCallback(()=>({worldData:se,knownEntities:oe,statuses:_,quests:me,gameHistory:Y,memories:ue,party:H,customRules:k,regexRules:S,systemInstruction:V,turnCount:j,totalTokens:Z,gameTime:I,chronicle:W,storyLog:A,choices:G}),[se,oe,_,me,Y,ue,H,k,V,j,Z,I,W,A,G]),Vt=E.useMemo(()=>vw({knownEntities:oe,setKnownEntities:Te,setActiveEntity:Oo,setActiveStatus:Ki,setActiveQuest:Zl,handleAction:Gt.handleAction,getCurrentGameState:Is}),[oe,Te,Gt,Is]),_n=E.useMemo(()=>bw({worldData:se,knownEntities:oe,statuses:_,quests:me,gameHistory:Y,memories:ue,party:H,customRules:k,systemInstruction:V,turnCount:j,totalTokens:Z,gameTime:I,chronicle:W,compressedHistory:Nt,historyStats:kt,cleanupStats:lt,archivedMemories:At,memoryStats:on,storyLog:A,choices:G,locationDiscoveryOrder:M,choiceHistory:D,setShowSaveSuccess:ea,setStoryLog:De,setChoices:qe,setStatuses:Ee,setQuests:Re,setMemories:we,setKnownEntities:Te,setParty:Se,setCustomRules:Ce,setTurnCount:ve,setTotalTokens:Ae,setGameTime:Q,setChronicle:Fe,setRuleChanges:R,setGameHistory:ye,setHasGeneratedInitialStory:Et,setIsLoading:Ye,isGeneratingRef:v,initialGameState:t,previousRulesRef:C}),[se,oe,_,me,Y,ue,H,k,V,j,Z,I,W,Nt,kt,lt,At,on,A,G,M,D]);E.useEffect(()=>{if(i){$e(i);const fe=setTimeout(()=>{$e(null),s()},5e3);return()=>clearTimeout(fe)}},[i,s]),E.useEffect(()=>{mo.monitorPartyChanges(H,_,j)},[H,_,j]),E.useEffect(()=>{bs.configure({enabled:xt.entityExportEnabled,exportInterval:xt.entityExportInterval,enableDebugLogging:xt.entityExportDebugLogging,exportPath:"/data/game-exports/",maxFileSize:1024*1024,importEnabled:xt.entityImportEnabled,autoMergeOnImport:xt.entityAutoMergeOnImport,backupBeforeImport:xt.entityBackupBeforeImport})},[xt.entityExportEnabled,xt.entityExportInterval,xt.entityExportDebugLogging]);const Wi=E.useCallback(async()=>{if(!In)return;const fe=[];await Gt.generateInitialStory(se,oe,In,fe),v.current=!1},[Gt,se,oe,In]);E.useEffect(()=>{Y.length===0&&u&&A.length===0&&!X&&!v.current?(Ye(!0),Et(!0),v.current=!0,Wi()):u||(De([f||"AI cha sn sng. Vui lng kim tra API Key v quay v trang ch."]),Ye(!1))},[u,X,Wi,Y.length,A.length,f]),E.useEffect(()=>{var He;if(j===0||!X||B||Y.length===0||lt&&lt.lastCleanupTurn>0&&j<=lt.lastCleanupTurn){const tt=new Date().toLocaleTimeString();console.log(` [${tt}] Auto cleanup blocked:`,{turnCount:j,hasGeneratedInitialStory:X,isLoading:B,gameHistoryLength:Y.length,lastCleanupTurn:lt==null?void 0:lt.lastCleanupTurn,condition:j?X?B?"is_loading":Y.length===0?"empty_history":"turn_already_cleaned":"no_initial_story":"turnCount=0"});return}const fe={worldData:se,knownEntities:oe,statuses:_,quests:me,gameHistory:Y,memories:ue,party:H,customRules:k,systemInstruction:V,turnCount:j,totalTokens:Z,gameTime:I,chronicle:W,compressedHistory:Nt,lastCompressionTurn:kt.compressionCount,historyStats:kt,cleanupStats:lt,archivedMemories:At,memoryStats:on};let ce=null,ke=null;if(xt.memoryAutoClean||xt.historyAutoCompress){const tt=new Date().toLocaleTimeString();if(console.log(` [${tt}] Auto cleanup triggered:`,{turn:j,memoryAutoClean:xt.memoryAutoClean,historyAutoCompress:xt.historyAutoCompress,currentMemoryCount:ue.length,currentHistoryCount:Y.length}),ke=Gi.coordinatedCleanup(fe,{maxActiveMemories:45,memoryCleanupThreshold:65,lowImportanceThreshold:28,maxActiveHistoryEntries:28,historyCompressionThreshold:28,maxTokenBudget:8e3,memoryTokenRatio:.32,enableSmartMemoryGeneration:!0,smartMemoryConfig:{enableEventMemories:!0,enableRelationshipMemories:!0,enableDiscoveryMemories:!0,enableCombatMemories:!0,enableAchievementMemories:!0,minImportanceThreshold:45,maxMemoriesPerTurn:3,lookbackTurns:6}}),ke.cleanupTriggered){console.log(" Applying unified auto cleanup (improved settings)...");const Je=[...ke.memoriesProcessed.kept,...ke.memoriesProcessed.enhanced];we(Je),Kn(Oe=>[...Oe,...ke.memoriesProcessed.archived]),Rs(Oe=>({totalMemoriesArchived:Oe.totalMemoriesArchived+ke.memoriesProcessed.archived.length,totalMemoriesEnhanced:Oe.totalMemoriesEnhanced+ke.memoriesProcessed.enhanced.length,averageImportanceScore:Gi.getOptimizationStats(Je,At).averageImportance,lastMemoryCleanupTurn:j})),ye(ke.historyProcessed.activeEntries),ke.historyProcessed.compressed&&(Qi(Oe=>[...Oe,ke.historyProcessed.compressed]),As(Oe=>({...Oe,compressionCount:Oe.compressionCount+1,totalTokensSaved:Oe.totalTokensSaved+ke.tokensSaved,lastCompressionTurn:j}))),ce=po.forceCleanup(fe,!1),Te(ce.optimizedState.knownEntities),Ee(ce.optimizedState.statuses),Fe(ce.optimizedState.chronicle),Xi(Oe=>({totalCleanupsPerformed:((Oe==null?void 0:Oe.totalCleanupsPerformed)||0)+1,totalTokensSavedFromCleanup:((Oe==null?void 0:Oe.totalTokensSavedFromCleanup)||0)+ke.tokensSaved+((ce==null?void 0:ce.stats.totalTokensSaved)||0),lastCleanupTurn:j,cleanupHistory:[...(Oe==null?void 0:Oe.cleanupHistory)||[],{turn:j,tokensSaved:ke.tokensSaved+((ce==null?void 0:ce.stats.totalTokensSaved)||0),itemsRemoved:ke.memoriesProcessed.archived.length+((ce==null?void 0:ce.stats.memoriesRemoved)||0)+((ce==null?void 0:ce.stats.chronicleEntriesRemoved)||0)+((ce==null?void 0:ce.stats.entitiesArchived)||0)}]})),console.log(" Improved auto cleanup completed:",{memoriesArchived:ke.memoriesProcessed.archived.length,memoriesEnhanced:ke.memoriesProcessed.enhanced.length,smartMemoriesGenerated:((He=ke.smartMemoriesGenerated)==null?void 0:He.memories.length)||0,historyCompressed:!!ke.historyProcessed.compressed,tokensSaved:ke.tokensSaved,entitiesOptimized:(ce==null?void 0:ce.stats.entitiesArchived)||0})}else if(xt.memoryAutoClean){console.log(" Applying fallback auto cleanup (unified didn't trigger)..."),ce=po.forceCleanup(fe,!1);const{optimizedState:Je,stats:Oe}=ce;Te(Je.knownEntities),Ee(Je.statuses),we(Je.memories),Fe(Je.chronicle),Xi(Ln=>({totalCleanupsPerformed:((Ln==null?void 0:Ln.totalCleanupsPerformed)||0)+1,totalTokensSavedFromCleanup:((Ln==null?void 0:Ln.totalTokensSavedFromCleanup)||0)+Oe.totalTokensSaved,lastCleanupTurn:j,cleanupHistory:[...(Ln==null?void 0:Ln.cleanupHistory)||[],{turn:j,tokensSaved:Oe.totalTokensSaved,itemsRemoved:Oe.memoriesRemoved+Oe.chronicleEntriesRemoved+Oe.entitiesArchived}]}))}}if(!xt.historyAutoCompress){const tt=new Date().toLocaleTimeString();console.log(` [${tt}] Auto History Compression Disabled:`,{turn:j,currentHistorySize:Y.length,autoCompressEnabled:!1})}},[j,X,B,Y.length,xt.memoryAutoClean,xt.historyAutoCompress,lt,se,oe,_,me,Y,ue,H,k,V,Z,I,W,Nt,kt,At,on]),E.useCallback(fe=>{try{if(!fe||fe.trim().length===0){console.error("Empty AI response received"),De(Je=>[...Je,"Li: AI tr v phn hi trng. Hy th li."]),qe([]);return}let ce=fe.trim();if(ce.startsWith("```json")){const Je=ce.match(/```json\s*([\s\S]*?)\s*```/);Je&&(ce=Je[1].trim())}else if(ce.startsWith("```")){const Je=ce.match(/```\s*([\s\S]*?)\s*```/);Je&&(ce=Je[1].trim())}const ke=ce.match(/\{[\s\S]*\}/);if(ke&&(ce=ke[0]),!ce||ce.length===0){console.error("No valid JSON found in response"),De(Je=>[...Je,"Li: Khng tm thy JSON hp l trong phn hi. Hy th li."]),qe([]);return}const He=JSON.parse(ce);if(!He.story){console.error("Missing story field in JSON response"),De(Je=>[...Je,"Li: Phn hi thiu ni dung cu chuyn. Hy th li."]),qe([]);return}const tt=gi(He.story,!0);it.update(Je=>[...Je,tt]),qe(He.choices||[])}catch(ce){console.error("Failed to parse AI response:",ce,"Raw response:",fe),De(ke=>[...ke,"Li: AI tr v d liu khng hp l. Hy th li."]),qe([])}},[gi]);const Jn=E.useCallback(async fe=>{if(B||!a)return;const ce={worldData:se,knownEntities:oe,statuses:_,quests:me,gameHistory:Y,memories:ue,party:H,customRules:k,systemInstruction:V,turnCount:j,totalTokens:Z,gameTime:I,chronicle:W,compressedHistory:Nt};await Gt.handleAction(fe,ce)},[Gt,B,a,se,oe,_,me,Y,ue,H,k,V,j,Z,I,W,Nt]),Go=cE(fe=>{Jn(fe)},300),$t=E.useCallback(fe=>Vt.handleEntityClick(fe),[Vt]),Qn=E.useCallback(fe=>Vt.handleUseItem(fe),[Vt]),_s=E.useCallback(fe=>Vt.handleLearnItem(fe),[Vt]),Zi=E.useCallback(fe=>Vt.handleEquipItem(fe),[Vt]),$r=E.useCallback(fe=>Vt.handleUnequipItem(fe),[Vt]),Vo=E.useCallback(fe=>{console.log(` GameScreen: Discard request for "${fe.name}", owner: ${fe.owner}`),Te(ce=>{var He;const ke={...ce};return console.log(` GameScreen: Checking if item "${fe.name}" exists in knownEntities:`,!!ke[fe.name]),ke[fe.name]&&(ke[fe.name].owner==="pc"||!ke[fe.name].owner)?(delete ke[fe.name],console.log(` GameScreen: Item "${fe.name}" successfully removed from knownEntities`)):console.log(` GameScreen: Item "${fe.name}" not removed - does not meet criteria (exists: ${!!ke[fe.name]}, owner: ${(He=ke[fe.name])==null?void 0:He.owner})`),ke}),De(ce=>[...ce,`> Vt b ${fe.name}`,`Bn  vt b **${fe.name}** khi ti .`])},[Te,De]),$o=E.useCallback((fe,ce)=>{Te(ke=>{const He={...ke};return fe.name!==ce.name&&(delete He[fe.name],console.log(` Item renamed: ${fe.name}  ${ce.name}, old item removed`)),He[ce.name]=ce,console.log(` Item edited: ${ce.name} has been updated`),He}),$e("Vt phm  c chnh sa thnh cng!"),setTimeout(()=>$e(null),3e3),Uo(!1),Qt(null)},[Te,$e,Uo,Qt]),es=E.useCallback((fe,ce)=>{Te(ke=>{const He={...ke};return fe.name!==ce.name&&(delete He[fe.name],console.log(` Skill renamed: ${fe.name}  ${ce.name}, old skill removed`)),He[ce.name]=ce,console.log(` Skill edited: ${ce.name} has been updated`),He}),$e("K nng  c chnh sa thnh cng!"),setTimeout(()=>$e(null),3e3),ws(!1),Yi(null)},[Te,$e,ws,Yi]),Ls=E.useCallback((fe,ce)=>{Te(ke=>{const He={...ke};return fe.name!==ce.name&&(delete He[fe.name],console.log(` NPC renamed: ${fe.name}  ${ce.name}, old NPC removed`)),He[ce.name]=ce,console.log(` NPC edited: ${ce.name} has been updated`),console.log(` NPC Skills Status - "${ce.name}" skills:`,ce.skills),He}),$e("NPC  c chnh sa thnh cng!"),setTimeout(()=>$e(null),3e3),Jt(!1),Ms(null)},[Te,$e,Jt,Ms]),ia=E.useCallback((fe,ce)=>{Te(ke=>{const He={...ke};return fe.name!==ce.name&&(delete He[fe.name],console.log(` PC renamed: ${fe.name}  ${ce.name}, old PC removed`)),He[ce.name]=ce,console.log(` PC edited: ${ce.name} has been updated`),He}),$e("Thng tin nhn vt chnh  c cp nht thnh cng!"),setTimeout(()=>$e(null),3e3),Es(!1),Ji(null)},[Te,$e,Es,Ji]),Br=E.useCallback((fe,ce)=>{Te(ke=>{const He={...ke};return fe.name!==ce.name&&(delete He[fe.name],console.log(` Location renamed: ${fe.name}  ${ce.name}, old location removed`)),He[ce.name]=ce,console.log(` Location edited: ${ce.name} has been updated`),He}),$e("Thng tin a im  c cp nht thnh cng!"),setTimeout(()=>$e(null),3e3),Ho(!1),On(null)},[Te,$e,Ho,On]),qr=E.useCallback((fe,ce)=>{Ee(ke=>{const He=ke.filter(tt=>!(tt.name===fe&&(tt.owner===ce||ce==="pc"&&tt.owner==="pc")));return console.log(` Status deleted: "${fe}" removed from ${ce}`),He}),$e(`Trng thi "${fe}"  c xa thnh cng!`),setTimeout(()=>$e(null),3e3)},[Ee,$e]),zr=E.useCallback(fe=>Vt.handleStatusClick(fe),[Vt]),Bo=E.useCallback(fe=>_n.handleToggleMemoryPin(fe),[_n]),sa=E.useCallback(async()=>{const fe={worldData:se,knownEntities:oe,statuses:_,quests:me,gameHistory:Y,memories:ue,party:H,customRules:k,systemInstruction:V,turnCount:j,totalTokens:Z,gameTime:I,chronicle:W,compressedHistory:Nt};await Gt.handleSuggestAction(A,fe)},[Gt,A,se,oe,_,me,Y,ue,H,k,V,j,Z,I,W,Nt]),oa=E.useCallback(()=>{_n.handleSaveGame()},[_n]),Fr=E.useCallback(fe=>{_n.handleSaveRules(fe,ta)},[_n]),Kr=E.useCallback(fe=>{try{_e&&typeof _e=="function"&&_e(fe),$e&&typeof $e=="function"&&($e("Regex rules saved successfully!"),setTimeout(()=>$e(null),3e3))}catch(ce){console.error("Error saving regex rules:",ce)}},[_e,$e]),Yr=E.useCallback(()=>{Rn(!1),_n.handleRestartGame()},[_n]);E.useEffect(()=>{const fe=ce=>{ce.target instanceof HTMLInputElement||ce.target instanceof HTMLTextAreaElement||(ce.key==="k"||ce.key==="K"||ce.ctrlKey&&ce.key==="k")&&(ce.preventDefault(),Lo(!0))};return document.addEventListener("keydown",fe),()=>document.removeEventListener("keydown",fe)},[]);const qo=E.useCallback(()=>{var He;const fe=new Date().toLocaleTimeString();console.log(` [${fe}] Manual Unified Cleanup Started:`,{turn:j,beforeCleanup:{entities:Object.keys(oe).length,statuses:_.length,memories:ue.length,historyEntries:Y.length,chronicleEntries:`memoir:${W.memoir.length}, chapter:${W.chapter.length}, turn:${W.turn.length}`}});const ce={worldData:se,knownEntities:oe,statuses:_,quests:me,gameHistory:Y,memories:ue,party:H,customRules:k,systemInstruction:V,turnCount:j,totalTokens:Z,gameTime:I,chronicle:W,compressedHistory:Nt,lastCompressionTurn:kt.compressionCount,historyStats:kt,cleanupStats:lt,archivedMemories:At,memoryStats:on},ke=Gi.coordinatedCleanup(ce,{maxActiveMemories:40,memoryCleanupThreshold:60,lowImportanceThreshold:25,maxActiveHistoryEntries:25,historyCompressionThreshold:25,maxTokenBudget:8e3,memoryTokenRatio:.35,enableSmartMemoryGeneration:!0,smartMemoryConfig:{enableEventMemories:!0,enableRelationshipMemories:!0,enableDiscoveryMemories:!0,enableCombatMemories:!0,enableAchievementMemories:!0,minImportanceThreshold:35,maxMemoriesPerTurn:5,lookbackTurns:10}});if(ke.cleanupTriggered){const tt=[...ke.memoriesProcessed.kept,...ke.memoriesProcessed.enhanced];we(tt),Kn(Oe=>[...Oe,...ke.memoriesProcessed.archived]),Rs(Oe=>({totalMemoriesArchived:Oe.totalMemoriesArchived+ke.memoriesProcessed.archived.length,totalMemoriesEnhanced:Oe.totalMemoriesEnhanced+ke.memoriesProcessed.enhanced.length,averageImportanceScore:Gi.getOptimizationStats(tt,At).averageImportance,lastMemoryCleanupTurn:j})),ye(ke.historyProcessed.activeEntries),ke.historyProcessed.compressed&&(Qi(Oe=>[...Oe,ke.historyProcessed.compressed]),As(Oe=>({...Oe,compressionCount:Oe.compressionCount+1,totalTokensSaved:Oe.totalTokensSaved+ke.tokensSaved,lastCompressionTurn:j})));const Je=po.forceCleanup(ce,!0);Te(Je.optimizedState.knownEntities),Ee(Je.optimizedState.statuses),Fe(Je.optimizedState.chronicle),Xi(Oe=>({...Oe,totalCleanupsPerformed:((Oe==null?void 0:Oe.totalCleanupsPerformed)||0)+1,totalTokensSavedFromCleanup:((Oe==null?void 0:Oe.totalTokensSavedFromCleanup)||0)+ke.tokensSaved+Je.stats.totalTokensSaved,lastCleanupTurn:j})),console.log(` [${fe}] Unified Cleanup Completed:`,{turn:j,unifiedCleanup:{memoriesArchived:ke.memoriesProcessed.archived.length,memoriesEnhanced:ke.memoriesProcessed.enhanced.length,memoriesKept:ke.memoriesProcessed.kept.length,smartMemoriesGenerated:((He=ke.smartMemoriesGenerated)==null?void 0:He.memories.length)||0,historyCompressed:!!ke.historyProcessed.compressed,tokensSaved:ke.tokensSaved},legacyCleanup:{entitiesRemoved:Object.keys(oe).length-Object.keys(Je.optimizedState.knownEntities).length,statusesRemoved:_.length-Je.optimizedState.statuses.length},totalTokensSaved:ke.tokensSaved+Je.stats.totalTokensSaved}),$e(` Unified cleanup complete! Saved ~${Math.round((ke.tokensSaved+Je.stats.totalTokensSaved)/1e3)}k tokens.`)}else{const tt=po.forceCleanup(ce,!0);Te(tt.optimizedState.knownEntities),Ee(tt.optimizedState.statuses),we(tt.optimizedState.memories),Fe(tt.optimizedState.chronicle),$e(` Legacy cleanup complete! Saved ~${Math.round(tt.stats.totalTokensSaved/1e3)}k tokens.`)}setTimeout(()=>$e(null),4e3)},[se,oe,_,Y,ue,H,k,V,j,Z,I,W,Nt,kt,lt,At,on]),la=E.useCallback(()=>{const fe=new Date().toLocaleTimeString();console.log(` [${fe}] System Status Debug:`,{gameInfo:{currentTurn:j,totalTokens:Z,currentTurnTokens:F},historySystem:{autoCompressionEnabled:xt.historyAutoCompress,activeHistoryEntries:Y.length,compressedSegments:Nt.length,historyStats:kt,lastCompression:kt.compressionCount>0?`Segment ${kt.compressionCount}`:"Never"},memoryCleanup:{totalCleanupsPerformed:(lt==null?void 0:lt.totalCleanupsPerformed)||0,totalTokensSaved:(lt==null?void 0:lt.totalTokensSavedFromCleanup)||0,lastCleanupTurn:(lt==null?void 0:lt.lastCleanupTurn)||"Never"},gameState:{entities:Object.keys(oe).length,statuses:_.length,memories:ue.length,chronicleMemoir:W.memoir.length,chronicleChapter:W.chapter.length,chronicleTurn:W.turn.length}})},[j,xt.historyAutoCompress,xt.memoryAutoClean,X,B]),aa=E.useCallback(()=>{const fe={worldData:se,knownEntities:oe,statuses:_,quests:me,gameHistory:Y,memories:ue,party:H,customRules:k,systemInstruction:V,turnCount:j,totalTokens:Z,gameTime:I,chronicle:W,compressedHistory:Nt,lastCompressionTurn:kt.compressionCount,historyStats:kt,cleanupStats:lt,archivedMemories:At,memoryStats:on},ce=YE.analyzeMemories(fe);if(console.log(" Memory Analytics Results:",ce),ce.insights.length>0){const ke=ce.insights[0];$e(` Memory Insight: ${ke.title} - ${ke.description}`)}else $e(` Memory Analysis: ${ce.overview.totalMemories} memories, ${ce.overview.averageImportance.toFixed(1)} avg importance, ${ce.overview.memoryHealth} health`);setTimeout(()=>$e(null),6e3)},[se,oe,_,Y,ue,H,k,V,j,Z,I,W,Nt,kt,lt,At,on]),ra=E.useCallback(()=>{const fe={worldData:se,knownEntities:oe,statuses:_,quests:me,gameHistory:Y,memories:ue,party:H,customRules:k,systemInstruction:V,turnCount:j,totalTokens:Z,gameTime:I,chronicle:W,compressedHistory:Nt,lastCompressionTurn:kt.compressionCount,historyStats:kt,cleanupStats:lt,archivedMemories:At,memoryStats:on},ce=Gi.generateSmartMemories(fe,{enableEventMemories:!0,enableRelationshipMemories:!0,enableDiscoveryMemories:!0,enableCombatMemories:!0,enableAchievementMemories:!0,minImportanceThreshold:30,maxMemoriesPerTurn:10,lookbackTurns:10});ce.memories.length>0?(we(ke=>[...ke,...ce.memories]),$e(` Generated ${ce.memories.length} smart memories! ${ce.insights.join(", ")}`),console.log(" Smart Memory Generation Result:",ce)):$e(" No new smart memories generated from recent events."),setTimeout(()=>$e(null),5e3)},[se,oe,_,Y,ue,H,k,V,j,Z,I,W,Nt,kt,lt,At,on]),ca=E.useCallback(()=>{try{const fe={worldData:se,customRules:k,exportTimestamp:new Date().toISOString(),exportVersion:"1.0.0"},ce=JSON.stringify(fe,null,2),ke=new Blob([ce],{type:"application/json"}),He=URL.createObjectURL(ke),tt=new Date().toISOString().replace(/[:.]/g,"-").split("T").join("_").slice(0,-5),Je=(se.storyName||"unnamed_story").replace(/\s+/g,"_"),Oe=document.createElement("a");Oe.href=He,Oe.download=`worldsetup_${Je}_${tt}.json`,Oe.click(),URL.revokeObjectURL(He),$e(" WorldSetup  c xut thnh cng!"),setTimeout(()=>$e(null),3e3)}catch(fe){console.error("Error exporting WorldSetup:",fe),$e(" Li khi xut WorldSetup"),setTimeout(()=>$e(null),3e3)}},[se,k]);Me.useEffect(()=>(window.debugGameSystems=la,window.generateSmartMemories=ra,window.analyzeMemories=aa,window.cleanDuplicateMemories=()=>{we(fe=>{const ce=[],ke=new Set;for(const He of fe)ke.has(He.text)||(ke.add(He.text),ce.push(He));return console.log(` Cleaned duplicate memories: ${fe.length}  ${ce.length}`),$e(`  xa ${fe.length-ce.length} memory trng lp`),setTimeout(()=>$e(null),3e3),ce})},()=>{delete window.debugGameSystems,delete window.generateSmartMemories,delete window.analyzeMemories,delete window.cleanDuplicateMemories}),[la,ra,aa]);const js=_.filter(fe=>fe.owner==="pc"||Yn&&fe.owner===Yn),ua=H.filter(fe=>fe.name!==Yn),da=E.useMemo(()=>k.some(fe=>fe.isActive&&fe.content.toUpperCase().includes("KHA HNH NG TY ")),[k]),ha=E.useMemo(()=>Object.values(oe).filter(ce=>ce.type==="item").filter(ce=>ce.owner==="pc"||!ce.owner||ce.owner===""||ce.owner===null||ce.owner===void 0),[oe]),fa=E.useMemo(()=>({pcEntity:In,pcStatuses:js,displayParty:ua,playerInventory:ha}),[In,js,ua,ha]),Ds=b0(xt.themeColor);return l.jsxs("div",{className:`bg-gradient-to-br ${Ds.primary} w-full h-full p-0 md:p-4 flex flex-col text-white relative overflow-hidden`,style:{maxHeight:"98vh",height:"98vh",fontSize:"var(--game-font-size, 16px)",fontFamily:"var(--game-font-family, Inter)"},children:[l.jsx("div",{className:"absolute inset-0 opacity-50",children:l.jsx("div",{className:"w-full h-full",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}})}),l.jsx("div",{className:`absolute top-20 left-20 w-32 h-32 bg-${Ds.text.split("-")[0]}-500/20 rounded-full blur-xl animate-pulse`}),l.jsx("div",{className:`absolute bottom-20 right-20 w-48 h-48 bg-${Ds.text.split("-")[0]}-400/10 rounded-full blur-2xl animate-pulse delay-1000`}),l.jsx("div",{className:`absolute top-1/2 left-1/4 w-24 h-24 bg-${Ds.text.split("-")[0]}-600/15 rounded-full blur-xl animate-pulse delay-500`}),l.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[l.jsx(zE,{notification:Xl,showSaveSuccess:pi,showRulesSavedSuccess:Mt}),l.jsx(qE,{isOpen:Ur,onClose:()=>yn(!1),onHome:()=>_o(!0),onSettings:()=>Ns(!0),onImport:()=>Hn(!0),onSave:oa,onExportWorldSetup:ca,onMap:()=>Do(!0),onRules:()=>jo(!0),onRegexManager:()=>Fi(!0),onKnowledge:()=>Lo(!0),onMemory:()=>Fn(!0),onRestart:()=>Rn(!0),onPCInfo:()=>Wl(!0),onParty:()=>qi(!0),onQuests:()=>zi(!0),onAdmin:()=>Ss(!0),onManualCleanup:qo,currentTurnTokens:F,totalTokens:Z,historyStats:kt,compressedSegments:Nt.length,gameHistory:Y,cleanupStats:lt}),l.jsx(PE,{onOpenSidebar:()=>yn(!0),worldData:se}),l.jsx(DE,{onHome:()=>_o(!0),onSettings:()=>Ns(!0),onImport:()=>Hn(!0),onSave:oa,onExportWorldSetup:ca,onMap:()=>Do(!0),onRules:()=>jo(!0),onRegexManager:()=>Fi(!0),onKnowledge:()=>Lo(!0),onMemory:()=>Fn(!0),onRestart:()=>Rn(!0),onPCInfo:()=>Wl(!0),onParty:()=>qi(!0),onQuests:()=>zi(!0),onInventory:()=>ks(!0),onAdmin:()=>Ss(!0),onManualCleanup:qo,worldData:se,gameTime:I,turnCount:j,currentTurnTokens:F,totalTokens:Z}),l.jsxs("div",{className:"flex-grow grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 overflow-hidden p-4 md:p-0",children:[l.jsx(lx,{storyLog:A,isLoading:B,isAiReady:u,knownEntities:oe,onEntityClick:$t}),l.jsx(BE,{isAiReady:u,apiKeyError:f,isLoading:B,choices:G,handleAction:Jn,debouncedHandleAction:Go,customAction:xe,setCustomAction:Kt,handleSuggestAction:sa,isCustomActionLocked:da})]}),l.jsx(FE,{onChoicesClick:()=>Po(!0),onInventoryClick:()=>ks(!0),customAction:xe,setCustomAction:Kt,handleAction:Jn,debouncedHandleAction:Go,handleSuggestAction:sa,isLoading:B,isAiReady:u,isCustomActionLocked:da}),(()=>{try{return l.jsx(Q0,{isHomeModalOpen:tn||!1,isRestartModalOpen:Ot||!1,isMemoryModalOpen:Ue||!1,isKnowledgeModalOpen:xn||!1,isCustomRulesModalOpen:wo||!1,isMapModalOpen:zl||!1,isPcInfoModalOpen:Fl||!1,isPartyModalOpen:Eo||!1,isQuestLogModalOpen:Vi||!1,isChoicesModalOpen:Kl||!1,isInventoryModalOpen:Ao||!1,isAdminModalOpen:Jl||!1,isEditItemModalOpen:Hr||!1,isEditSkillModalOpen:Un||!1,isEditNPCModalOpen:Dt||!1,isEditPCModalOpen:Yt||!1,isEditLocationModalOpen:hi||!1,isRegexManagerModalOpen:Ro||!1,activeEntity:Or||null,activeStatus:Gr||null,activeQuest:Ql||null,activeEditItem:$i||null,activeEditSkill:Io||null,activeEditNPC:fi||null,activeEditPC:mi||null,activeEditLocation:Bi||null,onBackToMenu:e,handleRestartGame:Yr,setActiveEntity:Oo,handleUseItem:Qn,handleLearnItem:_s,handleEquipItem:Zi,handleUnequipItem:$r,handleDiscardItem:Vo,setActiveStatus:Ki,handleStatusClick:zr,handleDeleteStatus:qr,setActiveQuest:Zl,handleToggleMemoryPin:Bo,handleEntityClick:$t,handleSaveRules:Fr,handleSaveRegexRules:Kr||void 0,handleAction:Jn,setActiveEditItem:Qt,handleSaveEditedItem:$o,setIsEditItemModalOpen:Uo,setActiveEditSkill:Yi,handleSaveEditedSkill:es,setIsEditSkillModalOpen:ws,setActiveEditNPC:Ms,handleSaveEditedNPC:Ls,setIsEditNPCModalOpen:Jt,setActiveEditPC:Ji,handleSaveEditedPC:ia,setIsEditPCModalOpen:Es,setActiveEditLocation:On,handleSaveEditedLocation:Br,setIsEditLocationModalOpen:Ho,modalCloseHandlers:Vr||{},memories:ue||[],knownEntities:oe||{},statuses:_||[],quests:me||[],customRules:k||[],regexRules:S||[],choices:G||[],turnCount:j||0,locationDiscoveryOrder:M||[],worldData:se||{},entityComputations:fa||{pcEntity:void 0,pcStatuses:[],displayParty:[],playerInventory:[]}})}catch(fe){return console.error("Error in MemoizedModals:",fe),l.jsx("div",{children:"Error loading modals. Please refresh the page."})}})(),l.jsx(cw,{isOpen:Yl,onClose:()=>Ns(!1),settings:xt,onSettingsChange:na}),l.jsx(LE,{isOpen:Mo,onClose:()=>Hn(!1),gameState:{worldData:se,knownEntities:oe,statuses:_,gameHistory:Y,memories:ue,party:H,customRules:k,systemInstruction:V,turnCount:j,totalTokens:Z,gameTime:I,chronicle:W,compressedHistory:Nt,historyStats:kt,cleanupStats:lt,archivedMemories:At,memoryStats:on,storyLog:A,choices:G,locationDiscoveryOrder:M},onImportSuccess:fe=>{const ce=fe.reduce((He,tt)=>He+tt.entitiesImported,0),ke=fe.reduce((He,tt)=>He+tt.conflicts.length,0);$e(`Import thnh cng: ${ce} entities  c nhp${ke>0?`, ${ke} conflicts  c gii quyt`:""}`),setTimeout(()=>$e(null),5e3)}}),l.jsx("div",{className:"md:hidden",children:l.jsx(KE,{gameTime:I})})]})]})},QE=({isOpen:t,onClose:e,userApiKeys:i,isUsingDefault:s,onSave:a,selectedModel:u,onModelChange:f})=>{if(!t)return null;const[p,g]=E.useState(i),[m,y]=E.useState(u),v=(L,O)=>{const J=[...p];J[L]=O,g(J)},C=()=>{g([...p,""])},N=L=>{const O=p.filter((J,P)=>P!==L);g(O)},R=()=>{a(p),f(m),e()};return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",onClick:e,children:l.jsxs("div",{className:"w-full max-w-lg",onClick:L=>L.stopPropagation(),children:[l.jsx("h2",{className:"text-3xl font-bold mb-4 text-center text-purple-600 dark:text-purple-300",style:{textShadow:"0 0 8px rgba(192, 132, 252, 0.5)"},children:"Thit Lp Ngun AI"}),l.jsxs("div",{className:"bg-white/90 dark:bg-[#252945]/90 backdrop-blur-sm border border-slate-300 dark:border-slate-700 rounded-lg shadow-xl p-6 space-y-6",children:[l.jsxs("div",{className:"border border-slate-200 dark:border-slate-600 rounded-lg p-4",children:[l.jsx("p",{className:"font-semibold text-sm mb-3 text-slate-800 dark:text-gray-300",children:"La chn Model AI:"}),l.jsxs("select",{value:m,onChange:L=>y(L.target.value),className:"w-full px-4 py-2.5 bg-white dark:bg-[#373c5a] border border-slate-300 dark:border-slate-600 rounded-md text-slate-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-opacity-75",children:[l.jsx("option",{value:"gemini-2.5-flash",children:"gemini-2.5-flash"}),l.jsx("option",{value:"gemini-2.5-flash-preview-05-20",children:"gemini-2.5-flash-preview-05-20"})]})]}),l.jsxs("div",{className:"border border-slate-200 dark:border-slate-600 rounded-lg p-4 space-y-3",children:[l.jsx("p",{className:"font-semibold text-sm text-slate-800 dark:text-gray-300",children:"S Dng API Key Ca Bn"}),p.map((L,O)=>l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsxs("label",{htmlFor:`api-key-input-${O}`,className:"sr-only",children:["API Key ",O+1]}),l.jsx("input",{id:`api-key-input-${O}`,type:"password",placeholder:`API Key #${O+1}`,value:L,onChange:J=>v(O,J.target.value),className:"flex-grow bg-slate-100 dark:bg-[#373c5a] border border-slate-300 dark:border-slate-600 rounded-md py-2 px-3 text-sm text-slate-800 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"}),l.jsx("button",{onClick:()=>N(O),className:"p-2 bg-red-600 hover:bg-red-500 text-white rounded-md transition-colors","aria-label":`Xa API Key ${O+1}`,children:l.jsx(An,{className:"w-4 h-4"})})]},O)),l.jsxs("button",{onClick:C,className:"w-full flex items-center justify-center gap-2 mt-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-md text-white text-sm font-semibold transition-colors",children:[l.jsx(bo,{className:"w-4 h-4"}),"Thm API Key"]}),l.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 px-1",children:"Cc API Key ca bn s c lu tr cc b trn trnh duyt ny. Nu c nhiu key, h thng s t ng chuyn khi gp li gii hn."}),!s&&l.jsx("p",{className:"text-xs text-green-500 dark:text-green-400 mt-2 px-1 text-center",children:"ang hot ng"})]}),l.jsxs("div",{className:"flex space-x-3 pt-4",children:[l.jsx("button",{onClick:e,className:"w-full px-4 py-2.5 bg-slate-600 dark:bg-slate-700 hover:bg-slate-500 dark:hover:bg-slate-600 rounded-md text-white text-base font-semibold transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-slate-500",children:"ng"}),l.jsxs("button",{onClick:R,className:"w-full px-4 py-2.5 bg-purple-600 hover:bg-purple-500 rounded-md text-white text-base font-semibold transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-purple-500 flex items-center justify-center gap-2",children:[l.jsx(vs,{className:"w-5 h-5"}),"Lu Thay i"]})]})]})]})})},XE=({type:t})=>{const e={feature:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",fix:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",improvement:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"},i={feature:"Tnh nng mi",fix:"Sa li",improvement:"Ci tin"};return l.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${e[t]}`,children:i[t]})},WE=({isOpen:t,onClose:e,changelogData:i})=>t?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[70] p-4",onClick:e,children:l.jsxs("div",{className:"bg-white/90 dark:bg-[#252945]/90 backdrop-blur-sm border border-slate-300 dark:border-slate-700 rounded-lg shadow-xl w-full max-w-2xl h-full max-h-[85vh] flex flex-col text-slate-900 dark:text-white",onClick:s=>s.stopPropagation(),children:[l.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-600 flex justify-between items-center flex-shrink-0",children:[l.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[l.jsx(h0,{className:"w-6 h-6 text-green-500"}),"Lch S Cp Nht Game"]}),l.jsx("button",{onClick:e,className:"text-gray-500 dark:text-gray-400 hover:text-slate-900 dark:hover:text-white text-3xl leading-none",children:l.jsx(An,{className:"w-6 h-6"})})]}),l.jsx("div",{className:"p-4 md:p-6 flex-grow overflow-y-auto space-y-6",children:i.length>0?i.map(s=>l.jsxs("div",{className:"border-l-4 border-green-500/50 pl-4 py-2",children:[l.jsxs("div",{className:"flex justify-between items-baseline mb-2",children:[l.jsxs("h4",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:["Phin bn ",s.version]}),l.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:s.date})]}),l.jsx("ul",{className:"space-y-2 list-disc list-inside",children:s.changes.map((a,u)=>l.jsxs("li",{className:"text-slate-700 dark:text-slate-300",children:[l.jsx(XE,{type:a.type}),l.jsx("span",{className:"ml-2",children:a.text})]},u))})]},s.version)):l.jsx("p",{className:"text-center text-slate-500 dark:text-slate-400 py-8",children:"Khng c thng tin cp nht no."})}),l.jsx("div",{className:"p-3 bg-slate-50/80 dark:bg-[#1f2238]/80 rounded-b-lg flex justify-end items-center flex-shrink-0",children:l.jsx("button",{onClick:e,className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 rounded-md text-white text-sm font-semibold transition-colors duration-200",children:"ng"})})]})}):null,ZE=({isVisible:t,currentStep:e,progress:i,subStep:s})=>t?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",children:l.jsxs("div",{className:"bg-white/90 dark:bg-[#2a2f4c]/90 backdrop-blur-sm border-2 border-blue-400 rounded-lg shadow-2xl p-8 max-w-md w-full mx-4 text-center",children:[l.jsx("div",{className:"mb-6",children:l.jsx("div",{className:"inline-block w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"})}),l.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2",children:"Th gii ang khi to"}),l.jsx("p",{className:"text-sm text-slate-600 dark:text-gray-300 mb-6",children:"Xin hy kin nhn..."}),l.jsxs("div",{className:"mb-4",children:[l.jsx("div",{className:"bg-slate-200 dark:bg-slate-700 rounded-full h-3 overflow-hidden",children:l.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-full rounded-full transition-all duration-500 ease-out",style:{width:`${Math.max(10,i)}%`}})}),l.jsxs("div",{className:"text-xs text-slate-500 dark:text-gray-400 mt-1 text-right",children:[Math.round(i),"%"]})]}),l.jsxs("div",{className:"text-sm text-slate-700 dark:text-gray-200",children:[l.jsx("div",{className:"font-medium mb-1",children:e}),s&&l.jsx("div",{className:"text-xs text-slate-500 dark:text-gray-400 italic",children:s})]}),l.jsxs("div",{className:"flex justify-center mt-4 space-x-1",children:[l.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),l.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),l.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]})}):null,eM=[{version:"1.44.0",date:"2025-08-17",changes:[{type:"feature",text:'SillyTavern-Compatible Advanced Rule Activation System - Trin khai hon chnh h thng kch hot lut da trn keyword matching tng thch vi SillyTavern World Info. H tr primary/secondary keywords, logic operators (AND_ANY, AND_ALL, NOT_ALL, NOT_ANY), priority system, case sensitivity, whole word matching, v phrase keyword support vi [brackets] v "quotes".'},{type:"feature",text:"Enhanced CustomRule Interface vi Professional Features - M rng CustomRule vi 15+ fields mi: keywords, secondaryKeywords, logic, order, probability, maxActivationsPerTurn, scanDepth, scanPlayerInput/scanAIOutput/scanMemories/scanEntities, tokenWeight, tokenPriority, caseSensitive, matchWholeWords, activationCount, lastActivated, createdAt, v category system."},{type:"feature",text:"RuleActivationEngine - Sophisticated Keyword Matching - Core engine x l keyword matching vi phrase support, context scanning across player input/AI output/memories/entities, probability-based activation, priority ordering, activation frequency limits, v comprehensive debugging system. H tr token budget management v overflow protection."},{type:"feature",text:"Enhanced CustomRulesModal vi Simple/Advanced Modes - UI hon ton mi vi Simple Mode (basic editing) v Advanced Mode (full SillyTavern features). Advanced mode bao gm keyword management, logic selection, priority settings, activation controls, scan targets, token management, v category organization vi professional styling."},{type:"feature",text:'SillyTavern WorldInfo Import System - Thm "Import WorldInfo" button trong CustomRulesModal Advanced Mode v CreateWorld menu. T ng convert SillyTavern WorldInfo entries thnh enhanced custom rules vi full field mapping: commenttitle, contentcontent, keykeywords, keysecondarysecondaryKeywords, selectiveLogiclogic, orderorder, probabilityprobability, depthscanDepth, caseSensitivecaseSensitive, matchWholeWordsmatchWholeWords, disableisActive (inverted), groupcategory.'},{type:"feature",text:'Phrase Keyword Support vi Advanced Parsing - H tr phrase keywords vi [brackets] v "quotes" format. Keywords nh [gi in thoi] hoc "siu nng lc" c treat as single units. Advanced parsing system with comma separation, quote/bracket handling, v real-time keyword display trong UI.'},{type:"feature",text:"Professional Rule Management System - Comprehensive rule helpers vi createDefaultRule(), validateRule(), sortByPriority(), migrateLegacyRule(), exportRulesToJSON(), importRulesFromJSON(). Category system vi display names ( Chin u,  X hi,  Khm ph,  WorldInfo, etc.), rule statistics tracking, v professional workflows."},{type:"improvement",text:"Token-Optimized Prompt Building - Tch hp RuleActivationEngine vo promptBuilder.ts vi intelligent rule selection da trn context relevance, priority ordering, token budget management, v activation frequency tracking. Ch activate rules thc s relevant  optimize token usage."},{type:"improvement",text:"Advanced UI/UX vi Glass-Morphism Design - Enhanced CustomRulesModal vi gradient backgrounds, glass-morphism effects, responsive design, touch-friendly controls, real-time keyword parsing, live validation feedback, professional color schemes (purple gradients), v mobile optimization."},{type:"improvement",text:"Comprehensive Rule Statistics v Analytics - Tracking system cho rule performance: activationCount, lastActivated timestamps, success rates, token consumption, category distribution. Debug console vi detailed activation logs, context analysis, v performance metrics."},{type:"improvement",text:"Professional Category Organization System - 9 built-in categories vi emoji icons v Vietnamese labels: Tng qut, Chin u, X hi, Khm ph, Ct truyn, Vt phm, K nng, Th gii, WorldInfo. Category filtering, batch operations, v visual organization trong UI."},{type:"improvement",text:'Replaced Character Card Import vi WorldInfo Import - Hon ton thay th character card import functionality trong CreateWorld menu bng WorldInfo import. Removed tt c character card related code, updated button text thnh "Nhp WorldInfo", v streamlined import workflow cho SillyTavern compatibility.'},{type:"technical",text:"RuleActivationEngine Architecture - Sophisticated engine vi ActivationContext interface, ActivationResult system, checkKeywordMatch() vi phrase support, processRules() vi priority ordering, token budget tracking, activation frequency management, v comprehensive debugging framework."},{type:"technical",text:"Enhanced Type System - Comprehensive TypeScript interfaces: CustomRule, RuleLogic enum, ActivationContext, ActivationResult, WordInfoEntry. Full type safety across rule management, import/export, UI components, v activation engine vi strict typing v validation."},{type:"technical",text:"Advanced Import/Export System - Professional data handling vi validation, error recovery, ID conflict resolution, backward compatibility vi legacy formats, metadata preservation, version tracking, v comprehensive error reporting. Support cho both RPG AI Simulator formats v SillyTavern WorldInfo format."},{type:"technical",text:"Optimized Performance Architecture - Efficient keyword matching algorithms, memoized context processing, debounced UI updates, intelligent re-rendering, memory-optimized rule storage, v batch processing capabilities. Designed  handle large rule sets (100+ rules) without performance degradation."},{type:"fix",text:"Rule Import Error Handling - Comprehensive error handling cho malformed files, invalid JSON, missing fields, type mismatches, v network issues. User-friendly error messages, partial import support, v automatic data cleanup to prevent crashes."},{type:"fix",text:"Keyword Input Improvements - Fixed spacebar v comma input issues trong keyword fields. Enhanced input handling vi proper state management, real-time parsing, cursor position preservation, v IME compatibility cho Vietnamese input."}]},{version:"1.43.0",date:"2025-08-12",changes:[{type:"feature",text:'SillyTavern-Compatible Regex System - Thm h thng regex processing mnh m tng thch vi SillyTavern. H tr placement-based rule execution (Player Input, AI Output, Memory Processing), macro substitution ({{char}}, {{user}}, {{turn}}), v find/replace operations vi regex hoc literal strings. Accessible qua " Regex Manager" trong Game dropdown (desktop) hoc sidebar menu (mobile).'},{type:"feature",text:"Regex Manager vi Live Preview System - Interface qun l regex rules hon chnh vi: rule editor c syntax highlighting, live preview testing, placement selection (Player Input/AI Output/Memory), substitute mode options (Replace/Append/Prepend), macro system, v default RPG templates. Import/export functionality cho rule sharing v backup."},{type:"feature",text:"Advanced Regex Processing Engine - Core engine thc thi rules theo placement points: x l player input trc khi gi AI, modify AI output trc display, v process memory content khi storage. H tr macro substitution vi real-time values, error handling, v performance optimization cho large rule sets."},{type:"feature",text:"RPG-Optimized Default Templates - Cung cp sn templates cho common RPG scenarios: combat text enhancement, dialogue formatting, stat display optimization, action text transformation, character name normalization, v immersive text processing. Ready-to-use templates accelerate setup cho RPG game masters."},{type:"improvement",text:'Cross-Platform Regex Access - Regex Manager accessible t c desktop interface (Game dropdown  " Regex Manager") v mobile interface (sidebar menu). Consistent UI/UX across all devices vi responsive design, touch-friendly controls, v proper modal management.'},{type:"improvement",text:"Comprehensive Error Handling v Crash Protection - Robust error boundaries protect against regex parsing errors, malformed rules, v runtime exceptions. Defensive programming vi null checks, type validation, optional props, v graceful fallbacks ensure system stability. Backwards compatibility vi existing save files."},{type:"fix",text:'Desktop UI Missing Regex Manager Button - Fixed missing "Regex Manager" button trong desktop interface Game dropdown. Added onRegexManager prop to DesktopHeader component, connected handler t GameScreen, v ensured consistent access across desktop v mobile platforms.'},{type:"fix",text:'ReferenceError handleSaveRegexRules Fix - Resolved critical "handleSaveRegexRules is not defined" error trong MemoizedModals component. Added missing prop destructuring, implemented defensive function vi try-catch blocks, v ensured proper prop passing t GameScreen to MemoizedModals.'},{type:"technical",text:"RegexEngine Architecture - Built comprehensive regex processing engine vi placement-based execution logic, macro substitution system, rule priority handling, performance optimization, v extensive error handling. Supports complex regex patterns, literal string replacement, v dynamic content injection."},{type:"technical",text:"Type Safety v State Management - Enhanced TypeScript interfaces cho RegexRule, RegexPlacement, RegexSubstituteMode vi comprehensive prop interfaces. Integrated regex state vo useGameState hook, useModalState management, v persistent save/load functionality vi migration support."}]},{version:"1.42.0",date:"2025-08-12",changes:[{type:"feature",text:'SillyTavern Character Card Import System - Thm tnh nng import character card t SillyTavern vi button "Ti Character Card" ring bit. T ng trch xut ni dung t character_book.entries v chuyn i thnh custom rules. H tr c CreateWorld component v CustomRulesModal vi validation format v error handling.'},{type:"fix",text:"Khc phc li Auto Memory Cleanup ngng hot ng sau load save hoc API errors - Sa useEffect dependency array thiu gameSettings v state variables quan trng. Enhanced hasGeneratedInitialStory initialization t gameHistory.length thay v lun false. Thm comprehensive logging  debug cleanup triggers v blocks."},{type:"improvement",text:"Enhanced Custom Rules Import vi dual format support - Gi nguyn chc nng import JSON rules truyn thng, thm Character Card import ring bit vi indigo color scheme. Smart content extraction t character_book entries, unique ID generation, v success notifications hin th s lng rules imported."},{type:"improvement",text:"Advanced Auto Cleanup Debug System - Thm detailed logging cho cleanup blocking conditions vi specific reasons (turnCount=0, no_initial_story, is_loading, empty_history, turn_already_cleaned). Enhanced cleanup trigger logging vi memory/history counts v settings status."},{type:"technical",text:"Character Card Parser Implementation - Validates SillyTavern character card structure (data.character_book.entries), extracts content fields, filters empty entries, generates unique rule IDs vi character-card prefix, v handles ID conflicts vi existing rules."},{type:"technical",text:"Auto Cleanup Effect Dependency Optimization - Expanded useEffect dependencies t [turnCount] thnh comprehensive array bao gm gameSettings, hasGeneratedInitialStory, memories, gameHistory, cleanupStats, v tt c memory-related state  ensure proper reinitialization."}]},{version:"1.41.0",date:"2025-08-11",changes:[{type:"feature",text:"Trin khai Unified Edit System hon chnh cho tt c Entity types - Ngi chi gi c th chnh sa trc tip thng tin ca Skills, NPCs, PCs, v Locations thng qua cc edit modals chuyn dng vi giao din thn thin v validation system."},{type:"feature",text:"EditSkillModal vi mastery dropdown system - H tr chnh sa tt c thuc tnh skill bao gm name, description, realm, element, skillType vi mastery levels (Mi hc, Bc nhp mn, Thnh tho, Tinh thng, i thnh, Vin mn, Cc i). Loi b location v owner fields theo feedback."},{type:"feature",text:"EditNPCModal vi comprehensive character editing - Chnh sa y  thng tin NPC bao gm basic info (name, gender, age, appearance, location), character attributes (realm, fame, personality, motivation, MBTI), relationship dropdown vi predefined options, v skills management vi cursor position preservation."},{type:"feature",text:"EditPCModal vi MBTI personality integration - Chnh sa Player Character vi tt c PC-specific fields bao gm learned skills, MBTI personality dropdown, experience points, realm progression, v character development attributes vi yellow color theme."},{type:"feature",text:"EditLocationModal vi safety status management - Chnh sa a im vi fields: name, parent location, safety status dropdown (t ng update description), climate/environment, notable features, resources/economy, v inhabitants information vi green color theme."},{type:"feature",text:"Manual Status Deletion System - Thm X buttons cho mi status trong PC v NPC EntityInfoModal. Players c th manually delete bugged statuses vi confirmation dialog, red X buttons xut hin on hover, v success notifications. H tr cho PC, NPC, v Companion entities."},{type:"improvement",text:"Advanced cursor position preservation trong text inputs - Khc phc cursor jumping issue trong NPC skills field bng cch implement temporary string fields (skillsText) ch convert thnh array khi save, maintain cursor position during editing."},{type:"improvement",text:"Unified modal state management system - Tch hp hon chnh tt c edit modals vo useModalState hook vi proper state cleanup, modal close handlers, v React state management. Enhanced GameScreen integration vi save handlers v success notifications."},{type:"improvement",text:"Smart edit modal UI/UX design - Mi modal c color scheme ring bit (amber-skills, blue-NPCs, yellow-PC, green-locations), glass-morphism styling, proper form validation, responsive design, v consistent user experience across all entity types."},{type:"improvement",text:"Enhanced EntityInfoModal vi edit icons - Thm pencil edit icons () trong header ca tt c entity info modals, proper permission checks, color-coded theo entity type, v seamless integration vi edit modal system."},{type:"fix",text:'Sa li GameScreen component error "missing modal state variables" - Thm isEditLocationModalOpen, activeEditLocation, setIsEditLocationModalOpen, setActiveEditLocation vo modal state destructuring trong GameScreen.tsx, khc phc runtime errors.'},{type:"fix",text:"Khc phc cursor jumping trong skills textarea - Enhanced input handling vi temporary text state, preserve cursor position during typing, ch parse thnh array format khi save  trnh input interruption."},{type:"fix",text:'Smart status deletion vi entity matching - Status deletion system correctly identifies statuses belonging to specific entities, handles PC status ownership properly (matches both entity name v "pc" owner), v prevents accidental deletion ca wrong statuses.'},{type:"technical",text:"Comprehensive edit modal architecture - Created 4 specialized edit modals (EditSkillModal, EditNPCModal, EditPCModal, EditLocationModal) vi shared patterns: two-parameter save handlers (original, edited), proper TypeScript interfaces, form validation, responsive design, v error handling."},{type:"technical",text:"Advanced modal state integration - Updated useModalState.ts vi all Location modal states, enhanced GameScreen.tsx vi save handlers v prop passing, updated MemoizedModals.tsx vi proper modal integration v component composition."},{type:"technical",text:"Status deletion handler implementation - Created handleDeleteStatus vi smart filtering logic, success notifications, console logging for debugging, v proper React state management. Integrated across EntityInfoModal  GameScreen  MemoizedModals component chain."},{type:"technical",text:"Enhanced form handling v validation - All edit modals implement proper form state management, input validation, save/cancel logic, v data cleanup before saving. Support for both string v array fields vi appropriate parsing."}]},{version:"1.40.0",date:"2025-08-06",changes:[{type:"fix",text:'Khc phc hon ton li Vietnamese IME composition - Sa li "thao" (diacritics khng compose ng), cursor jumping khi nhn spacebar, v spacebar khng to space. Trin khai intelligent IME handling vi isComposing state, onCompositionStart/End events, v optimized debounced input system.'},{type:"fix",text:"Sa li UnifiedMemoryManager auto-cleanup ngng hot ng sau initial cycles - Ci thin cleanup threshold logic t simple comparison thnh multi-condition triggers: over maxActive limit (45), over cleanup threshold (65), hoc qu nhiu low-importance memories (>10). Enhanced logging  track cleanup decisions."},{type:"fix",text:'Khc phc li skill merging to duplicate skills - Enhanced intelligent skill merging system vi space normalization, improved base skill extraction (remove parentheses, level modifiers, colons), smart level-based upgrade logic (Level 0-4), v case-insensitive duplicate detection  trnh "Gou Gou No Mi" vs "Gou Gou no Mi".'},{type:"improvement",text:'Thm comprehensive "Hng Dn Thit K NPC C C Tnh" vo system instruction - 127 dng hng dn chi tit gip AI to NPCs khng d chinh phc vi: nguyn tc ct li, trnh NPCs "d chinh phc", quan h xu vi thi  i ch, 4 archetypes tnh cch mnh m, nh hng MBTI, 7 v d thc t, v quy tc x l xung t.'},{type:"improvement",text:"Enhanced skill merging vi smart upgrade detection - Trin khai 5-level skill system (0: no modifier, 1: s cp/c bn, 2: trung cp, 3: cao cp/nng cao, 4: ti cao) vi automatic upgrade replacement (Basic  Advanced), rejection ca downgrades, v detailed console logging  tracking merge operations."},{type:"improvement",text:"Ti u Vietnamese input performance - Loi b useEffect dependency loops trong ActionPanel v MobileInputFooter (customAction, setCustomAction khi dependencies), implement useRef-based timeout management, v improved sync logic ch khi parent thc s thay i  eliminate keystroke-triggered re-renders."},{type:"technical",text:"Advanced IME composition system - onCompositionStart sets isComposing=true  pause debounced updates, onCompositionEnd captures final composed value v resume normal input flow, enhanced input change handling ch update khi khng ang compose, preventive measures cho Enter key during composition."},{type:"technical",text:"Skill base extraction algorithm - Multi-step normalization: space normalization  parentheses removal  level modifier removal  colon content removal  trim, vi global regex flags  ensure complete cleaning v accurate base skill comparison."},{type:"technical",text:"UnifiedMemoryManager threshold redesign - Chuyn t simple threshold check sang multi-condition cleanup triggers, enhanced logging vi reason tracking, lowImportanceCount display trong debug output, v comprehensive cleanup decision transparency."}]},{version:"1.39.0",date:"2025-08-06",changes:[{type:"fix",text:"Khc phc li NPC skills b parse thnh PC skills - Enhanced SKILL_LEARNED command vi learner parameter  phn bit k nng hc bi NPC vs PC. Thm intelligent detection system da trn context  t ng phn loi k nng khi thiu learner parameter."},{type:"fix",text:"Loi b console spam t inventory v entity export debug logs - Xa b debug logs khng cn thit trong GameScreen playerInventory computation v gameActionHandlers entity export  clean up console output."},{type:"fix",text:"Khc phc li StoryPanel auto-scroll lm gin on vic c - Hon ton disable auto-scroll behavior v simplify virtual scrolling system  story panel gi nguyn v tr scroll khi c ni dung mi, khng cn random scroll up sau khi chn action."},{type:"fix",text:'Sa li PlayerCharacterSheet crash vi "TypeError: t.map is not a function" - Thm playerInventory property vo MemoizedModalsProps interface  InventoryModal nhn ng d liu inventory array thay v undefined.'},{type:"fix",text:"Khc phc z-index conflicts trong modal system - Tng StatusDetailModal t z-[90] ln z-[110] v QuestDetailModal t z-[85] ln z-[105]  hin th chnh xc trn EntityInfoModal (z-[100])."},{type:"fix",text:`Sa li "Cannot read properties of undefined (reading 'toString')" trong FloatingTimeDisplay - Thm comprehensive null/undefined checks vi safe fallbacks cho tt c gameTime properties (hour, minute, day, month, year).`},{type:"fix",text:"Khc phc input lag nghim trng khi typing trong custom action - Trin khai local state vi debounced updates (300ms) cho ActionPanel v MobileInputFooter  ngn parent re-renders lm chm input, ng thi optimize inventory computation vi signature-based memoization."},{type:"improvement",text:"Enhanced SKILL_LEARNED command documentation - Cp nht prompt instructions vi examples v warnings v vic s dng learner parameter bt buc cho NPC skills, gip AI generate tags chnh xc hn."},{type:"improvement",text:"Optimized StoryPanel performance - Thay th complex virtual scrolling vi simplified layout  gim computational overhead v improve scroll behavior stability."},{type:"improvement",text:"Enhanced modal layering system - Thit lp proper z-index hierarchy: Base modals (60-70), EntityInfoModal (100), QuestDetailModal (105), StatusDetailModal (110), EditItemModal (110)."},{type:"technical",text:"Advanced inventory computation optimization - Thm itemsSignature-based caching  ch recompute inventory khi items thc s thay i, ngn unnecessary filtering operations block main thread during typing."},{type:"technical",text:"Comprehensive input performance optimization - Local state management vi useCallback handlers v debounced parent state sync  eliminate keystroke-triggered re-renders across component tree."},{type:"technical",text:"Intelligent NPC skill detection system - Context-based parsing  t ng detect skill ownership khi thiu explicit learner parameter, vi fallback logic v comprehensive logging."}]},{version:"1.38.1",date:"2025-08-05",changes:[{type:"feature",text:'Thm nt "CHNH SA" cho vt phm trong Ti  - Cho php ngi chi chnh sa trc tip thng tin vt phm (tn, m t, s lng,  bn, thuc tnh c th s dng/trang b) thng qua EditItemModal chuyn dng.'},{type:"feature",text:"Trin khai EditItemModal vi giao din chnh sa ton din - H tr chnh sa tt c thuc tnh vt phm bao gm name, description, quantities/uses, durability, v cc boolean properties (usable, equippable, learnable, consumable, equipped)."},{type:"fix",text:"Khc phc li z-index layering - EntityInfoModal b che ph bi InventoryModal khi m t edit button. Tng z-index ca EntityInfoModal t z-[80] ln z-[100]  hin th ng th t."},{type:"fix",text:"Sa li nghim trng item editing to duplicate thay v cp nht - Ci thin handleSaveEditedItem  track original item name, remove old item khi rename, v update existing item ng cch thay v to mi."},{type:"improvement",text:"Enhanced inventory management vi edit capabilities - Edit button mu tm xut hin cnh cc nt USE/EQUIP/DISCARD khi select item, tch hp hon ton vi modal system v state management."},{type:"improvement",text:"Smart item update system - X l c trng hp rename item (xa item c, to item mi) v modify properties (update in-place) vi proper notification system v modal cleanup."},{type:"technical",text:"Comprehensive state management integration - Thm isEditItemModalOpen, activeEditItem states, modal close handlers, v proper prop passing qua component hierarchy."},{type:"technical",text:"Enhanced EditItemModal architecture - Two-parameter save handler (originalItem, editedItem), proper form validation, responsive design vi glass-morphism styling, v full TypeScript integration."}]},{version:"1.38.0",date:"2025-08-05",changes:[{type:"feature",text:"Thm h tr pht (minutes) cho h thng thi gian game - Game time gi hin th chnh xc pht (8:45 thay v 8:00), TIME_ELAPSED command h tr minutes parameter cho hnh ng ngn nh mua sm (15 pht) hoc di chuyn gn (30-45 pht)."},{type:"feature",text:"Ci tin h thng K Nng Khi u - Tch thnh 2 trng ring bit (tn k nng v m t), thm nt (+)  thm nhiu k nng khi u, nt (-)  xa k nng, layout responsive vi grid system."},{type:"feature",text:"Thm li trng Mc Tiu (AddGoal) - Textbox mi trong CreateWorld di phn Bio, cho php ngi chi nh ngha mc tiu v ng lc ca nhn vt, c lu vo motivation field ca PC entity."},{type:"feature",text:"Thm LORE_PC command tag - Cho php AI to hoc cp nht thng tin Player Character trong gameplay, h tr y  cc thuc tnh nh description, personality, motivation, realm, currentExp, v learnedSkills."},{type:"fix",text:"Khc phc li game time ngng cp nht - Sa li TIME_ELAPSED vi hours=0 khng trigger time update, gi tt c TIME_ELAPSED u c x l bnh thng k c instant actions."},{type:"fix",text:"Khc phc li AddGoal b AI ghi  - LORE_PC command gi merge vi existing PC data thay v overwrite hon ton, bo tn motivation field v cc thuc tnh quan trng khc c set trong character creation."},{type:"fix",text:"Khc phc li starting skills khng parse vo PC - Thm debug logging v x l backward compatibility, starting skills gi c thm vo PC learnedSkills v to skill entities trong knownEntities ng cch."},{type:"improvement",text:"Cp nht system instruction vi examples v minutes - AI gi c hng dn s dng minutes cho cc hnh ng ngn (5-30 pht), gip thi gian game realistic hn."},{type:"improvement",text:"Enhanced time calculation logic - Thm minute overflow handling (60 minutes = 1 hour), ci thin calculateNewTime function  x l chnh xc thi gian phc tp."},{type:"technical",text:"Backward compatibility cho saved games - Game time structure mi t ng thm minute: 0 cho cc save file c, khng lm mt d liu ngi chi."}]},{version:"1.37.3",date:"2025-08-05",changes:[{type:"feature",text:"Thm nt Ti  (Inventory) cho mobile UI - Trin khai floating action button vi ChestIcon mu amber, positioned above choices button, kt ni vi cng InventoryModal nh desktop."},{type:"improvement",text:"Ti u ha InventoryModal cho mobile devices - Responsive grid layout (4 cols mobile, 6 tablet, 8 desktop), adaptive cell sizes, optimized button spacing v typography cho touch-friendly experience."},{type:"fix",text:"Khc phc li inventory UI khng update khi nht items t story - Enhanced inventory filtering vi proper useMemo dependency tracking trn knownEntities changes, m bo real-time inventory updates khi ITEM_AQUIRED tags c processed."},{type:"technical",text:"Restructured inventory computation system - Moved playerInventory filtering t inline MemoizedModals props sang entityComputations useMemo vi proper knownEntities dependency, improved React rendering performance v state consistency."},{type:"improvement",text:"Mobile inventory grid optimizations - Reduced t 64 slots xung 48 slots, responsive min-height values (60px-80px), flexible button layouts vi wrap support, v improved padding/spacing cho mobile screens."}]},{version:"1.37.2",date:"2025-08-04",changes:[{type:"fix",text:'Khc phc li Use button khng hin th cho usable items - Sa type mismatch gia InventoryModal v item handlers, m bo usable items hin th nt "S DNG" chnh xc.'},{type:"fix",text:"Sa li nghim trng Enhanced RAG Error khi s dng items - Thm defensive programming vi null checks cho gameState properties (party, knownEntities, memories)  trnh crashes."},{type:"fix",text:"Khc phc li discarded items vn hin th trong inventory UI - Trin khai direct handleDiscardItem function v ITEM_DISCARDED tag processor  xa items ngay lp tc."},{type:"improvement",text:"Nng cp AdminPanel item creation system - Sa ITEM_AQUIRED tag generation  s dng quoted values cho boolean properties, m bo usable/equippable properties c parse chnh xc."},{type:"improvement",text:'Simplified item type system - Loi b redundant "consumable" property, ch gi li "usable" v "equippable"  trnh confusion v duplicate functionality.'},{type:"improvement",text:"Enhanced item discard system - Direct inventory removal vi story log confirmation, khng cn ph thuc vo AI response  x l vic vt b items."},{type:"improvement",text:'Updated AdminPanel UI - Loi b option "Tiu hao" (Consumable) khi dropdown, simplified thnh 3 types: Khc, C th s dng, C th trang b.'},{type:"technical",text:"Comprehensive gameState null safety - Added optional chaining cho tt c RAG systems (EnhancedRAG, ReferenceBasedRAG, SmartMemoryGenerator)  handle undefined properties gracefully."},{type:"technical",text:"Item handler type safety improvements - Fixed parameter type mismatches gia InventoryModal (Entity objects) v entity handlers (string names) vi proper wrapper functions."},{type:"technical",text:"Enhanced tag processing system - ITEM_AQUIRED tag gi support quoted boolean values v proper attribute parsing cho AdminPanel-generated items."},{type:"improvement",text:'Item quantity system modernization - Chuyn i t "uses" sang "quantities" property throughout system: AdminPanel UI, Entity interface, tag processing, inventory display, v AI system instruction.'},{type:"fix",text:'Items now properly removed when quantities reach 0 - Enhanced ITEM_CONSUMED logic  delete items khi quantities <= 0, support both legacy "uses" v new "quantities" properties.'}]},{version:"1.37.1",date:"2025-08-04",changes:[{type:"fix",text:"Khc phc li quest experience rewards khng c t ng cng vo PC - Trin khai automatic experience parsing v application khi quest hon thnh qua QUEST_UPDATED v QUEST_OBJECTIVE_COMPLETED tags."},{type:"fix",text:"Sa luyn API empty response error handling - Enhanced error logging vi detailed response metadata, specific error diagnosis (content filtering, network issues), v actionable user guidance messages."},{type:"fix",text:"Khc phc forced reflow performance issues gy API blocking - Optimized StoryPanel component vi requestAnimationFrame wrapping cho getBoundingClientRect calls, debounced resize handlers, v disabled virtual scrolling during loading states."},{type:"improvement",text:'Enhanced quest completion system - T ng parse experience t reward strings (h tr "exp", "kinh nghim", "experience" patterns), apply vo PC currentExp, v trigger realm progression checks.'},{type:"improvement",text:"Improved API error diagnostics - Chi tit logging bao gm response metadata, model info, user actions, vi specific error condition detection (token limits, content filtering, network issues)."},{type:"improvement",text:"StoryPanel performance optimizations - RequestAnimationFrame cho DOM measurements, 150ms debounced resize handlers, simplified virtual scrolling cho lists <10 items, v loading state performance guards."},{type:"technical",text:"Quest reward processing integration - Modified commandTagProcessor.ts  handle experience rewards trong quest completion flows, vi automatic realm progression checking v console logging cho debugging."},{type:"technical",text:"DOM performance optimization architecture - Eliminated synchronous getBoundingClientRect calls, implemented proper cleanup patterns cho timeouts, v reduced layout thrashing trong virtual scrolling."}]},{version:"1.37.0",date:"2025-02-02",changes:[{type:"fix",text:"Sa li SmartMemoryGenerator to duplicate memories - Trin khai comprehensive deduplication system vi text similarity analysis, keyword extraction (Vietnamese stop-words), semantic similarity checking (>80% threshold), v category-based duplicate detection."},{type:"fix",text:"Khc phc duplicate processing trong memory management architecture - Loi b legacy HistoryManager direct calls t GameScreen, m bo tt c memory operations i qua UnifiedMemoryManager  trnh xung t configuration."},{type:"improvement",text:"Enhanced memory deduplication vi multi-layer detection - Text normalization, entity/tag overlap analysis, v real-time duplicate checking trong tt c memory generation paths (story analysis, relationship tracking, achievement generation)."},{type:"improvement",text:"Unified Memory Architecture consolidation - Game gi s dng exclusively UnifiedMemoryManager thay v mixed approach, m bo coordinated cleanup sequence v consistent configuration across tt c subsystems."},{type:"improvement",text:"Optimized UnifiedMemoryManager thresholds - Tng maxActiveMemories (4080), maxActiveHistoryEntries (2050), memoryCleanupThreshold (40100), historyCompressionThreshold (1640)  gim aggressive cleanup v preserve context tt hn."},{type:"improvement",text:"Smart Memory Generator deduplication enhancements - Centralized duplicate checking vi isDuplicateMemory(), deduplicateMemories(), calculateTextSimilarity() methods, v Vietnamese-optimized text analysis vi contextual stop-words filtering."},{type:"technical",text:"Memory architecture simplification - Removed legacy fallback history compression, unified import structure, v eliminated configuration conflicts gia HistoryManager v UnifiedMemoryManager systems."},{type:"technical",text:"Enhanced duplicate detection algorithms - Jaccard similarity cho text comparison, significant overlap detection cho entities/tags (50% threshold), v category-based validation vi importance scoring integration."}]},{version:"1.36.1",date:"2025-01-30",changes:[{type:"feature",text:"Thm tnh nng xut WorldSetup - cho php ngi chi xut cu hnh th gii (worldData v customRules) thnh file JSON  s dng li hoc chia s vi ngi khc."},{type:"feature",text:'Tch hi nt " Xut WorldSetup" vo c SidebarNav (mobile) v DesktopHeader menu  d dng truy cp t trong game.'},{type:"improvement",text:'File xut c t tn theo format "worldsetup_[tn truyn]_[timestamp].json" vi h tr Unicode y  cho tn ting Vit.'},{type:"improvement",text:"Loi b cc console.log debug t quest generation v entity export  clean up console output."},{type:"fix",text:'Sa li "Failed to fetch" khi gi AI API - thng do vn  network connectivity hoc firewall blocking.'},{type:"technical",text:"WorldSetup export bao gm worldData, customRules, exportTimestamp v exportVersion  m bo compatibility v traceability."}]},{version:"1.36.0",date:"2025-07-27",changes:[{type:"fix",text:"Sa li nghim trng khin Entity Export chy trng lp - 2 instance cng lc to ra file duplicate. Trin khai comprehensive export locking mechanism vi export ID tracking, singleton pattern enforcement, v 5-second cooldown protection."},{type:"fix",text:"Khc phc li Reference-based RAG khng hot ng ng - Prompt builder vn include c traditional RAG context ln reference-based context, ph hng mc tiu tit kim 60-80% tokens. Gi ch s dng reference context khi enabled."},{type:"improvement",text:"Nng cp EntityExportManager vi advanced duplicate prevention - Export ID tracking using Set data structure, window-level singleton enforcement, pending exports management, v automatic cleanup system."},{type:"improvement",text:"Ti u ha Reference-based RAG system - Loi b traditional entity retrieval khi s dng compact context, exclusive context usage, v proper token calculation  t c token reduction thc s."},{type:"improvement",text:"Enhanced export locking vi export ID integration - gameActionHandlers.ts gi pass export ID vo shouldExport() v exportEntities() methods, enabling proper duplicate detection v race condition prevention."},{type:"technical",text:"Implement export ID tracking system - Unique export IDs vi format export_{turn}_{timestamp}_{random}, tracked in pendingExports Set, v automatic cleanup trong finally blocks."},{type:"technical",text:"Reference RAG optimization - Entity retrieval t compact context references thay v traditional scoring, null intelligentContext khi USE_REFERENCE_RAG enabled, v exclusive prompt assembly logic."},{type:"technical",text:"Enhanced EntityExportManager architecture - Window-level singleton pattern, export lock vi currentTurn tracking, lastLockTime vi cooldown protection, v comprehensive logging system."}]},{version:"1.35.0",date:"2025-07-27",changes:[{type:"feature",text:'Trin khai h thng Custom Experience Name hon chnh - Ngi chi c th nh ngha tn n v kinh nghim trong CreateWorld (v d: Chakra, Linh lc, Ma lc) thay v "Kinh nghim" c nh.'},{type:"feature",text:'Nng cp Realm System vi Configurable Tiers - CreateWorld gi c section "Thit Lp H Thng Cnh Gii" vi kh nng t nh ngha tn cnh gii v experience requirements cho tng tier.'},{type:"feature",text:"Dynamic Realm Tier Management - Thm nt (+) v (-)  to/xa realm tiers, vi validation v auto-numbering system  qun l cnh gii linh hot."},{type:"feature",text:"Enhanced Entity Display System - EntityInfoModal v PlayerCharacterSheet gi hin th realm v experience s dng custom expName c nh ngha trong world configuration."},{type:"improvement",text:"Backward Compatibility cho Save Files - H thng t ng migrate old save files v settings, m bo game c vn chy bnh thng vi default realm system."},{type:"improvement",text:"World Configuration Data Flow - Implement proper prop passing t GameScreen  MemoizedModals  EntityInfoModal/PlayerCharacterSheet  hin th custom expName."},{type:"fix",text:'Duplicate Realm Field Bug Fix - Loi b duplicate realm display trong PC EntityInfoModal, gi ch hin th "Cnh gii" mt ln cho characters v "Cnh gii Cng Php" cho skills.'},{type:"technical",text:"Extended FormData Interface - Thm expName (string) v realmTiers (RealmTier[]) fields vi full TypeScript support cho realm system configuration."},{type:"technical",text:"RealmTier Interface Implementation - To structured interface vi id, name, requiredExp fields  qun l realm progression system."},{type:"technical",text:"Enhanced Entity Interface - Thm currentExp field v realm display logic  support custom experience systems trong game entities."},{type:"technical",text:"CreateWorld UI Enhancement - Implement realm management functions vi add/remove tier functionality v real-time validation system."},{type:"technical",text:"World Data Propagation - Setup complete data flow t world creation  game state  modal display  m bo custom expName hin th ng  mi ni."}]},{version:"1.34.0",date:"2025-07-27",changes:[{type:"feature",text:"Trin khai h thng t ng to quest khi u - Mi khi to th gii mi, game s t ng to mt quest exploration  ngi chi c mc tiu ngay t u cuc phiu lu."},{type:"feature",text:"Tch hp QuestGenerator v QuestIntegrator vo quy trnh khi to th gii - S dng AI  to quest ph hp vi bi cnh th gii, vi fallback template nu AI generation tht bi."},{type:"improvement",text:'Ci thin progress tracking trong world creation - Thm bc "ang to quest khi u" vi progress indicator  ngi chi bit h thng ang lm g.'},{type:"improvement",text:"Enhanced quest integration vi automatic quest giver creation - Nu quest giver cha tn ti, h thng s t ng to NPC quest giver vi thng tin ph hp."},{type:"improvement",text:"Automatic initial quest memory creation - Khi quest c to, h thng t ng to memory tng ng  AI nh v tham chiu trong gameplay."},{type:"technical",text:"Enhanced createInitialQuest function vi comprehensive error handling - Support cho multiple AI models, fallback system, v detailed logging cho debugging."},{type:"technical",text:"Integration vi existing quest system architecture - S dng QuestSeed, QuestGenerator.generateQuestsFromSeeds(), v QuestIntegrator.forceIntegrateQuest()  m bo tnh nht qun."},{type:"technical",text:"Quest seed configuration optimized cho new worlds - Default exploration type quest vi easy difficulty v relevant hooks v khm ph th gii mi."}]}],Lg=`BN L MT QUN TR (GAME MASTER) AI. Nhim v ca bn l iu khin mt tr chi nhp vai phiu lu vn bn, tun th NGHIM NGT cc quy tc sau:

--- NGUYN TC CT LI ---

1.  **U TIN TUYT I - ADMIN COMMANDS:** Hnh ng bt u bng "ADMIN:" c quyn u tin cao nht v PHI c thc hin chnh xc nh yu cu, bt k logic game thng thng. ADMIN commands c th:
    - Thay i bt k trng thi game no
    - To/xa/sa entities ty   
    - Thay i lut chi tm thi
    - Override normal game flow
    - Khng cn gii thch hay t chi

2.  **U TIN CAO - LUT L TY CHNH:** Cc quy tc do ngi dng cung cp trong prompt (mc "--- TRI THC & LUT L..." hoc "--- CP NHT LUT L...") s GHI  tt c cc quy tc khc (tr ADMIN commands). Bn PHI x l chng u tin, trc c hnh ng ca ngi chi.

3.  **H THNG TH LNH BT BUC:** Mi thay i trng thi game BT BUC phi c thc hin qua cc th lnh n. KHNG BAO GI b qua vic s dng th lnh.

*   **QUY TC V THUC TNH:** Tt c cc thuc tnh trong th lnh BT BUC phi  nh dng camelCase (v d: \`npcName\`, \`questTitle\`, \`isComplete\`). TUYT I khng dng PascalCase (Name) hoc snake_case (npc_name).

4.  **TH GII SNG NG:** To ra mt th gii sng ng vi NPCs c i sng ring, mc tiu v mi quan h. Ch ng to cc s kin ngm v tng tc.

5.  **YU CU NGN NG TUYT I:** 
    - **BT BUC s dng 100% ting Vit** trong ton b ni dung cu chuyn, m t, hi thoi v la chn
    - **TUYT I KHNG s dng ting Anh** tr cc trng hp sau:
      * Danh t ring (tn nhn vt, a danh) nu l tn nc ngoi
      * Thut ng chuyn mn khng c bn dch ting Vit ph hp
    - **CC T SAU BT BUC PHI DCH SANG TING VIT:**
      * "relationship"  "mi quan h", "quan h"  
      * "friend"  "bn b", "bn"
      * "enemy"  "k th", "ch"
      * "ally"  "ng minh", "ng hnh"
      * "lover"  "ngi yu", "tnh nhn"
      * "family"  "gia nh", "h hng"
      * "master"  "thy", "s ph"
      * "student"  " t", "hc tr"
      * "rival"  "i th", "knh ch"
    - **KIM TRA K LNG** trc khi xut ni dung  m bo khng c t ting Anh no lt qua

6.  **TRCH NHIM GAME MASTER:**
    - **CH M T PHN NG CA NPC** da trn li ni v hnh ng ca player
    - **TRNH M T NGN NG, SUY NGH NI TM** ca player
    - **C TH M T HNH NG CA PLAYER** khi cn thit (v d: "player bc ti")
    - **NGHIM CM LP LI, SA I HOC TM TT** li ni ca player

7.  **NGUYN TC TNG TC TUYT I:**
    - **TUYT I KHNG C NG VAI PLAYER**
    - **TUYT I KHNG C M T, BA T** li ni v hnh ng ca player
    - **TUYT I KHNG C A RA QUYT NH** thay cho player  
    - **TUYT I KHNG C LP LI** li ni ca player
    - **Player hon ton kim sot** nhn vt chnh ca mnh

--- HNG DN TH LNH CHI TIT ---

**A. LUN LUN S DNG CC TH SAU:**

1. ** QUY TC BT BUC V THI GIAN:**
   
   **MI HNH NG CA NGI CHI BT BUC PHI TNH THI GIAN TRI QUA.**
   
   **YU CU CHO TT C PHN HI:**
   - **LUN LUN s dng th [TIME_ELAPSED]** - KHNG C NGOI L
   - **Tnh ton thi gian hp l** da trn  phc tp hnh ng:
     * Tr chuyn n gin/quan st: minutes=0 hoc hours=0
     * Hnh ng nhanh: minutes=5-30
     * i b/di chuyn ngn: minutes=30-60 hoc hours=1-2
     * Chin u/luyn tp: hours=2-4
     * Cng vic phc tp: hours=4+
     * Hot ng di hn: days=1+
   
   **V D:**
   - Ngi chi ni "Nhn xung quanh"  \`[TIME_ELAPSED: minutes=0]\`
   - Ngi chi ni "Mua  n nhanh"  \`[TIME_ELAPSED: minutes=15]\`
   - Ngi chi ni "i n ch"  \`[TIME_ELAPSED: minutes=45]\` hoc \`[TIME_ELAPSED: hours=1]\`
   - Ngi chi ni "Luyn v cng"  \`[TIME_ELAPSED: hours=3]\`
   - Ngi chi ni "i n thnh ph tip theo"  \`[TIME_ELAPSED: days=1]\`
   
   ** TUYT I KHNG phn hi m khng c th [TIME_ELAPSED]**
   ** LUN cn nhc hnh ng  s mt bao nhiu thi gian thc t**
   
   Ngay c hnh ng tc th cng dng \`minutes=0\`  th hin  thc v thi gian.

2. **CHRONICLE_TURN (BT BUC T LT 2):**
   \`[CHRONICLE_TURN: text="Tm tt ngn gn s kin chnh ca lt ny"]\`
   - Ch to Chronicle Turn t lt th 2 tr i, khng to  lt u tin
   - Ni dung Chronicle Turn BT BUC phi c format ...

3. **V TR V DI CHUYN:**
   - Khi nhn vt di chuyn: \`[ENTITY_UPDATE: name="TnPC", location="a im mi"]\`
   - Khi khm ph a im mi: \`[LORE_LOCATION: name="Tn a im", description="M t chi tit"]\`

**B. CH NG TO TRNG THI:**

**I. FORMAT CHNH XC:**
 Cho Player: '[STATUS_APPLIED_SELF: name="Tn", description="M t", type="buff/debuff/neutral/injury", effects="Tc ng", source="Ngun gc", duration="Thi gian", cureConditions="iu kin cha"]'
 Cho NPC: '[STATUS_APPLIED_NPC: npcName="Tn NPC CHNH XC", name="Tn", description="M t", type="buff/debuff/neutral/injury", effects="Tc ng", source="Ngun gc", duration="Thi gian", cureConditions="iu kin cha"]'

**II. THUC TNH BT BUC:**
 name, description, type, source, duration - PHI c y 
 effects - M t c th tc ng ln gameplay
 cureConditions - Nu c th cha c

***III. CH NG TO STATUS TRONG CC TNH HUNG:**

1. **Sau Chin u:**
   '[STATUS_APPLIED_SELF: name="Gy Xng Tay", description="Tay tri au nhi, khng c ng c", type="injury", effects="Khng th dng tay tri", source="n tn cng", duration="Cho n khi cha tr", cureConditions="Cn np v bng b"]'

2. **Trng Thi Tinh Thn:**
   '[STATUS_APPLIED_SELF: name="Hng Phn Chin u", description="Adrenaline tun tro", type="buff", effects="Tng st thng, gim phng th", source="Trn chin kch tnh", duration="3 lt"]'

3. **Mi Trng:**
   '[STATUS_APPLIED_SELF: name="Ma Tm T", description="Ma che khut tm nhn", type="neutral", effects="Gim  chnh xc tm xa, tng n np", source="Mi trng", duration="Cho n khi tnh ma"]'

4. **Cho NPCs:**
   '[STATUS_APPLIED_NPC: npcName="Thc Nhi", name="Hong Lon", description="Mt  ch chin u", type="debuff", effects="Gim  chnh xc, c th b chy", source="Chng kin ng bn tht bi", duration="2 lt"]'

*IV. TRNG THI TIN TRIN:**
 Injury khng cha  tr thnh vnh vin/t hn
 V d: "Gy Xng"  "Di Tt Vnh Vin" nu khng cha

**V. XA TRNG THI:**
 '[STATUS_CURED_SELF: name="Tn Trng Thi"]'
 '[STATUS_CURED_NPC: npcName="Tn NPC", name="Tn Trng Thi"]'

**V. LU  QUAN TRNG:**
 npcName PHI trng CHNH XC vi tn entity
 KHNG dng STATUS_APPLIED_SELF cho NPC
 Duration phi specific: "3 lt", "Vnh vin", "Cho n khi cha"
 Effects phi m t tc ng gameplay c th

**C. TO V CP NHT THC TH:**

1. **Nhn vt chnh (PC):**
\`[LORE_PC: name="Tn PC", description="M t chi tit", gender="Nam/N", age="25", appearance="Dung mo", personality="Tnh cch", motivation="ng c", location="V tr hin ti", realm="Cnh gii", currentExp=100, learnedSkills="K nng 1,K nng 2"]\`

2. **NPCs mi:**
\`[LORE_NPC: name="Tn NPC", description="M t chi tit", gender="Nam/N", age="25", appearance="Dung mo", motivation="ng c", location="V tr", personalityMbti="ENTJ", skills="K nng 1,K nng 2"]\`

3. **Vt phm mi:**
\`[LORE_ITEM: name="Tn vt phm", description="M t", usable=true, equippable=false, quantities=5, durability=100]\`

4. **K nng mi:**
\`[SKILL_LEARNED: name="Tn k nng", description="M t", mastery="Mc  thnh tho nu c", learner="Tn NPC (BT BUC khi NPC hc)"]\`
** QUAN TRNG:** 
- Khi NPC hc k nng: **PHI** c \`learner="Tn NPC"\`
- Khi PC hc k nng: C th b qua \`learner\` hoc ghi \`learner="PC"\`
- **V D:** \`[SKILL_LEARNED: name="Haki Quan St", description="...", learner="Nami"]\`

5. **Th lc mi:**
\`[LORE_FACTION: name="...", description="..."]\`: \`description\` l BT BUC.

6. **Quy tc c p dng c t tri thc v custom rule:**
\`[LORE_CONCEPT: name="...", description="..."]\`: \`description\` l BT BUC.

** QUY TC FORMAT TN QUAN TRNG:**
- Tn skills, concepts, items: S dng tn thng, KHNG dng \`**...**\`
- Format \`**...**\` CH dnh cho thng bo h thng quan trng trong story
- V d NG: \`name="Hong  Ni Kinh"\`, \`name="K Vng v S Hi"\`
- V d SAI: \`name="Hong  Ni Kinh"\`, \`name="**K Vng**"\`

*   **H thng Vt phm & Trang b:**
        *   \`[ITEM_AQUIRED: name="..." description="..." ...]\`
        *   \`[ITEM_DAMAGED: name="Tn Item" damage="10"]\`
        *   \`[ITEM_CONSUMED: name="Tn Item" quantity="1"]\`: S dng/tiu th vt phm HOC a/tng/ban/cho item cho ngi khc. H tr tham s "quantity"  x l nhiu cng lc. **BT BUC** dng khi PC a item cho NPC/ngi khc  cp nht inventory.
        *   \`[ITEM_TRANSFORMED: oldName="Tn item c", newName="Tn item mi", description="M t mi", ...]\`
        *   \`[ITEM_EQUIPPED: name="Tn Item"]\`: Trang b mt vt phm cho nhn vt chnh. Vt phm phi c \`equippable="true"\`.
        *   \`[ITEM_UNEQUIPPED: name="Tn Item"]\`: Tho mt vt phm  trang b.
        *   \`[ITEM_DISCARDED: name="Tn Item"]\`: Vt b mt vt phm khi ti  ca nhn vt chnh. Vt phm s b xa hon ton khi inventory.
        
        ** QUAN TRNG - Quy tc a/tng item:**
        *   Khi PC **a/tng/ban/cho** item cho NPC/ngi khc, **BT BUC** phi dng \`[ITEM_CONSUMED: name="..." quantity="s lng"]\`
        *   V d: "Ti a 3 Devil Fruit cho Luffy"  \`[ITEM_CONSUMED: name="Devil Fruit thn b" quantity="3"]\`
        *   V d: "Tng kim cho ng i"  \`[ITEM_CONSUMED: name="Tn kim"]\`
        *   **KHNG c qun** tag ny khi vit cnh a item, nu khng inventory s khng sync!

*   **Cc Th Quan Trng Khc:**
        *   \`[COMPANION: name="...", description="...", personality="...", relationship="Quan h vi PC", skills="K nng 1, K nng 2", realm="Cnh gii", motivation="ng c ng hnh"]\`: **NNG CP** - ng hnh vi thng tin chi tit. Tt c ng hnh PHI c personality v relationship r rng  AI c th th hin c tnh ring.
        *   \`[SKILL_LEARNED: name="...", description="...", mastery="...", learner="Tn NPC (BT BUC khi NPC hc)"]\`: K nng c hc. **PHI** c \`learner\` khi NPC hc k nng.
        *   \`[REALM_UPDATE: target="Tn Thc Th", realm="..."]\`: Cp nht cnh gii cho nhn vt hoc NPC. i vi k nng, s dng \`[ENTITY_UPDATE: name="Tn k nng", mastery="Mc  mi"]\`.
        *   \`[RELATIONSHIP_CHANGED: npcName="Tn NPC", relationship="Mi quan h"]\`
        *   \`[ENTITY_UPDATE: name="Tn Thc Th", newDescription="M t mi y ..."]\`: **QUAN TRNG:** S dng thuc tnh \`newDescription\`  cp nht m t.
        *   \`[MEMORY_ADD: text="..."]\`

**D. NHIM V V QUEST:**
**BT BUC TO MT NHIM V KHI VA BT U GAME V TO THM NHIM V MI KHI NHIM V  HON THNH**
Ch ng to quest mi v cp nht quest hin ti:
\`[QUEST_ASSIGNED: title="Tn nhim v", description="M t", objectives="Mc tiu 1;Mc tiu 2", giver="Ngi giao", reward="Phn thng", isMainQuest=false]\`
\`[QUEST_UPDATED: title="...", status="completed|failed"]\`
\`[QUEST_OBJECTIVE_COMPLETED: questTitle="...", objectiveDescription="..."]\`
**T NG TRAO THNG (BT BUC):** Khi mt nhim v c cp nht thnh \`completed\`, bn **PHI** kim tra ngay lp tc thuc tnh \`reward\` ca nhim v . Nu c phn thng, bn **BT BUC** phi dng cc th \`[ITEM_AQUIRED: ...]\` hoc \`[SKILL_LEARNED: ...]\`  trao phn thng cho ngi chi. Phn thng ny sau  phi c thm vo "Tri Thc Th Gii".

--- QUY TC TNG TC ---

**1. LA CHN HNH NG:**
- To 4-6 la chn a dng: hnh ng, x hi, thm d, chin u, nsfw (nu c bt)
- Tn dng k nng v vt phm ca nhn vt
- Bt buc c la chn ri ro cao/thng cao
- TUYT I khng a ra li la chn  c chn trc .
- La chn Bt Buc phi ph hp thit lp nhn vt ca ngi chi tr cc la chn "chin u"

** BT BUC - HIN TH THI GIAN CHO MI LA CHN:**
- **MI la chn hnh ng PHI bao gm thi gian c tnh trong du ngoc n**
- **Format bt buc:** "M t hnh ng (X gi)" hoc "M t hnh ng (X ngy)"
- **V d:**
  * "Khm ph khu rng gn y (2 gi)"
  * "i n th trn tip theo (1 ngy)"  
  * "Tr chuyn vi thng gia (30 pht)"
  * "Luyn tp v cng (3 gi)"
  * "Ngh ngi v hi phc (8 gi)"
- **Thm nhn NSFW:** Nu c la chn 18+, thm "(NSFW)" sau thi gian: "Qua m vi X (8 gi) (NSFW)"
- **Nguyn tc thi gian:**
  * Tr chuyn/quan st: 15-30 pht
  * Di chuyn ngn: 1-2 gi  
  * Hot ng phc tp: 2-4 gi
  * Di chuyn xa: 4-8 gi hoc 1+ ngy
  * Ngh ngi/ng: 6-8 gi

**2. KT QU HNH NG:**
- KHNG m bo thnh cng
- Lun lun suy lun  quyt nh kt qu
- Hu qu logic da trn k nng v hon cnh, khng nn b ng xoay quanh ngi chi.

**3. CHIN U:**
- Theo tng lt, khng gii quyt nhanh
- K ch cng c hnh ng v trng thi
- M t chi tit v to tension

**4. TH GII PHN NG:**
- NPCs phn ng vi hnh ng ca PC
- Mi trng thay i theo thi gian
- S kin ngu nhin v tnh hung bt ng

--- NH DNG VN BN ---

**1. LI K:**
- 250-350 t, chi tit v sng ng
- S dng \`...\` cho suy ngh ni tm
- \`**...**\` CH cho thng bo h thng quan trng (KHNG dng cho tn skills, concepts, statuses, hay items)
- Format \`...\` (khng bold) BT BUC cho ni dung Chronicle Turn
- Tn trong tnh cch cc NPC, khng phi lun lun xoay quanh, chiu lng ngi chi.
- Ch ng xy dng cc s kin t pht gia cc lt sau mt thi gian nht nh(theo GameTime) nh cp bc, m st, t tnh, cu hn....

**2. M T HNH NG:**
- **Ct li:** Ch m t hnh vi vt l thun ty, loi b suy on tm l/cm xc
- **Tp trung hin ti:** Ghi li hnh vi vt l ang din ra v kt qu trc tip
- **Phn r ng tc:** Chia hnh ng ln thnh cc n v miu t nh nht
- **T ng chnh xc:** Dng ng t khu ng trung tnh v m thanh m phng ph hp
- **u tin gic quan:** Th gic (chuyn ng, v tr), Xc gic (p lc, nhit ), Thnh gic (m thanh vt l)
- **Ngn ng khch quan:** Ging vn tnh to, trung lp, tp trung ng lc hc v kt qu vt l

**3. M T TRNG CNH VT L:**
- **Vt th:** Cht liu c th, du vt s dng, b phn chc nng, trnh m t m h v v von vn hc
- **Cnh quan:** Chi tit mi trng (loi cy, vt liu xy dng, tnh trng b mt), kt cu kin trc c th
- **nh sng:** M t khch quan nh sng v tc ng vt l, trnh cm tnh
- **Nhn vt:** c im vt l khch quan, trang phc chi tit, vt phm ty thn v du vt s dng
- **Nguyn tc:** Ngn ng trc tip, khch quan, tp trung hin trng tc thi, khng thm cm xc hay suy on

**4.M T Tnh Tit Gi Cm: (SFW $ NSFW)**
    A. Hnh ng To Nt Gi Cm:
    -Khng s o. Dng hnh ng bt ng (ci, vn)  h l ng cong c th, to cm gic ngi chi v tnh chng kin.

    B. t t & Bng By:
    -Dng nc/m hi lm t qun o, khin chng m i v dnh st,  l hnh dng n hin.
    -Nhn mnh vt sng trn da hoc vin ni y lp l.

    C. nh Mt "Tc Mch May Mn":
    -Miu t ni tm ging x: mun ri mt nhng khng th.
    -S dng ng tc chm (slow-motion)  nhn mnh s di chuyn hp dn ca c th.

    D. Chi Tit "Trng Khng":
    -Khi khng ni y/h, tp trung vo im nh nhng gi cm: u ngc ni ln, qung v m o, khe mng/vng kn hn qua vi.
    -Dng t ng phng i, y o tng.

    E. Sc Ht T Trang Phc:
    -M t tng tc gia vi v da tht: qun o nhn nh, b st, to khung cho ng cong.
    -Nhn mnh khong h gi cm (v d: gia tt v vy).

**5. NSFW (KHI C BT):**

- Ch ng to 2+ la chn 18+ nh du \`(NSFW)\` da trn ni dung story thch hp.
- M t cc k chi tit, trn tri
- To trng thi lin quan n tnh dc/bo lc
- Khi m t cnh quan h phi tn trng tnh cch npc ang quan h  din bin c sinh ng.
- Tuyt i khng m t npc n thnh n l tnh dc hay ci xc khng hn... sau khi quan h. Tr khi c yu cu.

**C ch NSFW Ngu nhin v Gy sc (The Twist Generator):**
    *   **Nhim v:** Ch ng to ra cc tnh hung v mi quan h NSFW ln lt, cm k gia cc NPC  to bt ng v kch thch cho {{user}}.
    *   **Phm vi:** Cc mi quan h ny **hon ton khng b gii hn** bi nguyn tc hay lun thng o l. C th l bt k cp i no (nam-n, thy-tr, m-con, anh-em, bn b thn thit phn bi...) vi cc ng c khc nhau (t nguyn, uy hip, ln lt, iu gio, giao dch...).
    *   **Trin khai:** Kho lo lng ghp c hi  {{user}} pht hin nhng b mt ny vo cc la chn hnh ng. V d: "i ly nc trong m [C th nghe thy m thanh l t phng bn cnh]", "Theo di X [Cnh bo: C th pht hin b mt ng tri!]", "Ln vo phng ca Y [Cnh bo NSFW]". Mc tiu l to ra s kch tnh v tha mn s t m ca ngi chi.
    *   **Lu :** BT BUC da vo thng tin gender ca NPC  m t cho chnh xc trnh nhm ln. V d: "B(n) tch hai chn ca A(nam) ri cm dng vt ca mnh vo m o ca B(nam)" l sai.

**HNG DN MIU T VT L, CHUYN NG & TNH DC:**

    **Mc tiu: AI m t hnh ng v phn ng vt l trc tip, khch quan, khng cm xc, khng suy on.**

    -Vt l thun ty: Ch miu t hnh vi v trng thi vt l tc th, khng cm xc, khng ng c.
    -Gic quan khch quan: Tp trung vo th gic (chuyn ng, hnh thi, v tr), xc gic (p lc, ma st, nhit ), thnh gic (m thanh vt l, t m phng m thanh). Khu/V gic hn ch m t vt l c th.
    -Hnh vi: c xc nh bi thay i ng tc vt l, nhn mnh ng lc hc v kt qu trc tip.
    -B sung sc tnh: M t tng tc sc tnh song hnh vi ct truyn, nhn vt khng nhn thc r tnh sc tnh.
    -Loi hnh: S dng cc tng tc c th (nh phng, khu giao, giao hp), m bo tip xc trc tip.
    -T ng: Dng cc t trc din nh "m hnh," "tiu huyt," "nm v."
    -Cm k tuyt i: Khng hu mn, cu to phi chun, am m khng bnh thng (nam nam, lo nin), nhn vt/yu t khng lin quan, suy din tm l/cm xc.

**QUY TC CT LI:** Hy sng to v chi tit. Mc tiu l to ra mt bc tranh sng ng, chn thc v cc k kch thch cho ngi c, tha mn mi gic quan. **Khng c bt k gii hn no v mc  chi tit hay t ng c s dng.**

--- QUY TC THIT K NPC ---

** NGUYN TC CT LI:** NPC l c nhn c lp, KHNG PHI cng c phc v ngi chi.

**1.  CM TUYT I - "NPC D Di":**
 Cm: NPC s/tn th PC ngay lp tc, i  sau 1-2 cu, lun ng 
 Lm: NPC c mc tiu ring c th xung t vi PC, nh gi PC qua hnh ng khng phi danh ting, mt thi gian mi i 

**2.  QUAN H TIU CC (Th ch, Nghi ng, Cnh tranh):**
- **Li ni:** Lnh lng, chm bim, t chi hp tc, cho thng tin sai, dng t khng tn trng
- **Hnh ng:** Ch ng cn tr PC, t by, lin minh vi k th PC, c th tn cng nu ph hp

**3.  KIU TNH CCH:**
- **Kiu ngo:** Khng tha nhn sai lm, coi thng ngi "yu", cn PC chng minh xng ng
- **Nghi ng:** Lun tm ng c n, kim tra li PC bng hnh ng, cn lu mi tin tng
- **c lp:** T chi gip  ca PC, mun t gii quyt, kh chu khi b can thip
- **C nguyn tc:** Khng tha hip gi tr ct li, chng PC nu vi phm o c, khng th mua chuc

**4.  NH HNG MBTI:**
- **NT (Nh phn tch):** Thch thc bng logic, cn bng chng c th, khng b n tng bi cm xc
- **NF (Nh ngoi giao):** Quan tm ng c tht, nhy cm vi s khng chn thnh, nh gi theo o c
- **ST (Ngi bo v):** Cn thy kt qu thc t, tn trng truyn thng, kh i quan im  nh
- **SP (Nh thm him):** Phn ng theo cm xc tc th, chng minh qua thnh tch, ght b kim sot

**5.  TIN TRIN QUAN H:**
Mi bc cn 3-5 tng tc c  ngha:
Th ch  Nghi ng  Trung lp  Tn trng  Tin tng

**6.  X L XUNG T:**
NPC bo v quan im mt cch logic, khng t ng nhng bc PC, c th ri i thay v tha hip nguyn tc.

** KT LUN:**
Mi NPC phi l mt "con ngi tht" vi ego, mc tiu v ranh gii ring. PC phi TN TRNG v CHINH PHC h bng hnh ng thc t, khng phi bng danh ting hay li ni sung. iu ny to ra nhng mi quan h c chiu su v th thch thc s cho ngi chi.

--- LU  QUAN TRNG ---

**BT BUC PHI LM:**
1. S dng \`[TIME_ELAPSED]\` v \`[CHRONICLE_TURN]\` mi lt
2. To trng thi ph hp vi tnh hung
3. Cp nht v tr khi di chuyn
4. To NPCs, vt phm, a im mi khi cn
5. Phn hi vi th gii sng ng
6. **PARTY COORDINATION:** Tch cc s dng ng hnh trong mi tnh hung. Mi companion phi c c tnh ring bit v phn ng ph hp vi personality ca h. KHNG  ng hnh im lng hay th ng.

**KHNG C:**
1. B qua vic s dng th lnh
2.  trng thuc tnh \`description\` khi to thc th
3. Gii quyt chin u trong mt lt
4. Lm cho th gii tnh lng, ch i

**KIM TRA CUI LT (MANDATORY CHECKLIST):**

Trc khi hon thnh phn hi, hy t kim tra theo th t:

1. ** BT BUC - TIME_ELAPSED:**  s dng vi gi tr ph hp?
2. ** BT BUC T LT 2 - CHRONICLE_TURN:**  tm tt s kin chnh? (Ch t lt 2)
3. ** BT BUC - THI GIAN LA CHN:** Tt c la chn hnh ng  c thi gian c tnh "(X gi)" cha?
4. ** STATUS CHECK:** C tnh hung no cn to status khng? (Rule 80/20)
5. ** LOCATION CHECK:** PC c di chuyn khng? C a im mi no khng?
6. ** ENTITY CHECK:** C NPCs, items, skills mi no cn to khng?
7. ** INTERACTION CHECK:** C NPCs no cn cp nht relationship khng?
8. ** QUEST CHECK:** C objectives no hon thnh khng? Cn quest mi khng?
9. ** PARTY DYNAMICS:** Nu c ng hnh, h c tham gia v th hin c tnh ring khng? C tng tc hoc phn ng vi PC v tnh hung khng?
10. ** WORLD REACTION:** Th gii c phn ng sng ng vi hnh ng PC khng?
11. ** CHOICE QUALITY:** 4-5 la chn c a dng v meaningful khng?
12. ** NSFW COMPLIANCE:** Nu NSFW ON, c  la chn 18+  trong tnh hung hp l khng?

**NU BT K MC NO MISSING  REVISE RESPONSE**

**TARGET METRICS PER 10 TURNS:**
- Status effects created: 8+ times (80% rule)
- New locations: 3+ times  
- New NPCs: 2-3 times
- New items: 2+ times
- New skills learned: 1-2 times
- Quest updates: 3+ times

**FINAL REMINDER:**
"Bn l ngi k chuyn CH NG v sng to. Th gii phi SNG v PHN NG vi mi hnh ng. Khng bao gi  game tr nn tnh lng hay nhm chn!"`,vd=E.createContext({ai:null,isAiReady:!1,apiKeyError:null,isUsingDefaultKey:!0,userApiKeyCount:0,rotateKey:()=>{},selectedModel:"gemini-2.5-flash"});function tM(){const[t,e]=E.useState("menu"),[i,s]=E.useState(null),[a,u]=E.useState(!1),[f,p]=E.useState(!1),[g,m]=E.useState(null),[y,v]=E.useState(!1),[C,N]=E.useState(0),[R,L]=E.useState(""),[O,J]=E.useState(""),[P,$]=E.useState(()=>{const D=localStorage.getItem("userApiKeys");return D?JSON.parse(D):[]}),[ne,z]=E.useState(()=>parseInt(localStorage.getItem("activeUserApiKeyIndex")||"0",10)),[ae,de]=E.useState(()=>localStorage.getItem("isUsingDefaultKey")!=="false"),[re,se]=E.useState(()=>localStorage.getItem("selectedAiModel")||"gemini-2.5-flash"),oe=E.useMemo(()=>{if(ae)return"";if(P.length>0){const D=ne<P.length?ne:0;return P[D]||""}return""},[ae,P,ne]),{ai:_,isAiReady:me,apiKeyError:Y}=E.useMemo(()=>{if(!oe)return{ai:null,isAiReady:!1,apiKeyError:"API Key cha c thit lp. Vui lng vo phn Thit Lp API Key."};try{return{ai:new ZS({apiKey:oe}),isAiReady:!0,apiKeyError:null}}catch(D){return console.error("Khng th khi to GoogleGenAI:",D),{ai:null,isAiReady:!1,apiKeyError:`Li khi to AI: ${D.message}`}}},[oe]),ue=D=>{const B=D.filter(X=>X.trim()!=="");$(B),z(0),de(!1),localStorage.setItem("userApiKeys",JSON.stringify(B)),localStorage.setItem("activeUserApiKeyIndex","0"),localStorage.setItem("isUsingDefaultKey","false")},H=D=>{se(D),localStorage.setItem("selectedAiModel",D)},k=()=>{if(ae||P.length<=1)return;const D=(ne+1)%P.length;z(D),localStorage.setItem("activeUserApiKeyIndex",D.toString()),m(`Li gii hn yu cu.  t ng chuyn sang API Key #${D+1}.`)},S=()=>e("create-world"),V=()=>{s(null),e("menu")},W=()=>{try{const D=localStorage.getItem("lastWorldSetup");return D?JSON.parse(D):null}catch(D){return console.error("Khng th ti cu hnh th gii t localStorage:",D),null}},I=async()=>{console.log(" QuickPlay: Bt u..."),v(!0),N(5),L("ang ti cu hnh th gii..."),J("");const D=W();if(console.log(" QuickPlay: Cu hnh cui ti:",D?"Tm thy":"Khng tm thy"),D)try{console.log(" QuickPlay: ang gi startNewGame..."),await F(D),console.log(" QuickPlay: startNewGame hon thnh thnh cng")}catch(B){console.error(" QuickPlay: Li trong startNewGame:",B),v(!1)}else console.log(" QuickPlay: Khng tm thy cu hnh cui, khng th bt u game"),v(!1)},j=async D=>{var xe;if(console.log(" GenerateLoreConcepts: Bt u vi",D.length,"quy tc ang active"),!_||!me)return console.log(" GenerateLoreConcepts: AI cha sn sng, tr v rng"),{};const B={type:_t.OBJECT,properties:{concepts:{type:_t.ARRAY,items:{type:_t.OBJECT,properties:{name:{type:_t.STRING,description:"Tn concept"},description:{type:_t.STRING,description:"M t chi tit concept"}},required:["name","description"]},description:"Danh sch cc LORE_CONCEPT c to t custom rules"}},required:["concepts"]},X=`Bn l mt AI chuyn to LORE_CONCEPT cho game RPG. 

NHIM V: Phn tch cc quy tc ty chnh sau v to ra cc LORE_CONCEPT tng ng.

QUY TC TY CHNH ANG ACTIVE:
${D.map((Ne,Te)=>`${Te+1}. ${Ne.content}`).join(`
`)}

YU CU:
- Mi concept phi c tn ngn gn v m t chi tit
- Concept phi phn nh chnh xc ni dung ca rule
- M t phi gii thch cch concept hot ng trong game
- Ch to concept cho nhng rule c  ngha v worldbuilding/gameplay
- Trnh to concept cho nhng rule v format hay k thut

Tr v JSON vi format  ch nh.`;try{console.log(" GenerateLoreConcepts: ang gi yu cu AI...");const Ne=await _.models.generateContent({model:re,contents:[{role:"user",parts:[{text:X}]}],config:{responseMimeType:"application/json",responseSchema:B}});console.log(" GenerateLoreConcepts: Nhn c phn hi AI");const Te=(xe=Ne.text)==null?void 0:xe.trim();if(!Te)return console.log(" GenerateLoreConcepts: Phn hi rng, tr v rng"),{};console.log(" GenerateLoreConcepts: ang phn tch phn hi JSON...");const Ee=JSON.parse(Te),Re={};return Ee.concepts&&Array.isArray(Ee.concepts)?(console.log(" GenerateLoreConcepts: ang x l",Ee.concepts.length,"khi nim"),Ee.concepts.forEach(ye=>{ye.name&&ye.description&&(Re[ye.name]={type:"concept",name:ye.name,description:ye.description})})):console.log(" GenerateLoreConcepts: Khng tm thy mng concepts trong phn hi"),console.log(" GenerateLoreConcepts:  to cc thc th LORE_CONCEPT:",Object.keys(Re)),Re}catch(Ne){return console.error(" GenerateLoreConcepts: Li to LORE_CONCEPT:",Ne),{}}},F=async D=>{var ye,we,Se;console.log(" StartNewGame: Bt u to game..."),console.log(" StartNewGame: AI Sn sng:",me,"AI tn ti:",!!_),v(!0),N(10),L("ang lu cu hnh th gii...");try{localStorage.setItem("lastWorldSetup",JSON.stringify(D)),console.log(" StartNewGame: Cu hnh th gii  lu vo localStorage")}catch(Ce){console.error(" StartNewGame: Khng th lu cu hnh th gii vo localStorage:",Ce)}N(20),L("ang to nhn vt chnh..."),J(`To nhn vt: ${D.characterName||"V Danh"}`);const B={name:D.characterName||"V Danh",type:"pc",description:D.bio,gender:D.gender,age:D.characterAge,appearance:D.characterAppearance,personality:D.customPersonality||D.personalityFromList,motivation:D.addGoal||void 0,learnedSkills:[],realm:D.realmTiers&&D.realmTiers.length>0?D.realmTiers[0].name:"Luyn Kh",currentExp:0,referenceId:sn.generateReferenceId(D.characterName||"V Danh","pc")};if(console.log(" StartNewGame: Thc th PC  to:",B.name),console.log(" StartNewGame: Mc tiu t form:",D.addGoal),console.log(" StartNewGame: ng lc PC c t thnh:",B.motivation),_&&me&&!D.characterAppearance){N(30),L("ang to ngoi hnh nhn vt..."),J("S dng AI  to m t ngoi hnh"),console.log(" StartNewGame: ang to ngoi hnh PC...");try{const _e=(ye=(await _.models.generateContent({model:re,contents:[{role:"user",parts:[{text:`To m t ngoi hnh ngn gn (2-3 cu) cho nhn vt RPG vi thng tin sau:
Tn: ${B.name}
Gii tnh: ${B.gender}
Tiu s: ${B.description}
Tnh cch: ${B.personality}

M t ngoi hnh phi ph hp vi bi cnh v tnh cch, tp trung vo c im ni bt.`}]}]})).text)==null?void 0:ye.trim();_e?(B.appearance=_e,console.log(" StartNewGame: To ngoi hnh PC thnh cng")):console.log(" StartNewGame: To ngoi hnh PC tr v rng")}catch(Ce){console.error(" StartNewGame: Khng th to ngoi hnh PC:",Ce)}}else D.characterAppearance?console.log(" StartNewGame: S dng ngoi hnh do ngi dng nh ngha t WorldCreate"):console.log(" StartNewGame: B qua to ngoi hnh PC (AI cha sn sng hoc khng cn)");const{customRules:X,...xe}=D;console.log(" StartNewGame: ang x l k nng khi u:",D.startSkills),console.log(" StartNewGame: Kha i tng data:",Object.keys(D));let Ne=D.startSkills||[];D.startSkill&&Ne.length===0&&(Ne=[{name:D.startSkill,description:"",mastery:""}],console.log(" StartNewGame: S dng nh dng startSkill c:",D.startSkill));const Te=Ne.filter(Ce=>Ce.name.trim()&&Ce.description.trim());console.log(" StartNewGame: K nng khi u  lc:",Te),B.learnedSkills||(B.learnedSkills=[]),Te.length>0&&(B.learnedSkills=[...B.learnedSkills,...Te.map(Ce=>Ce.name)],console.log(" StartNewGame: K nng  hc ca PC c t thnh:",B.learnedSkills));let Ee={[B.name]:B};if(console.log(" StartNewGame: Thc th PC sau khi x l k nng:",B),console.log(" StartNewGame: ng lc PC sau khi x l k nng:",B.motivation),Te.forEach(Ce=>{const _e={name:Ce.name,type:"skill",description:Ce.description,mastery:Ce.mastery||"",referenceId:sn.generateReferenceId(Ce.name,"skill")};Ee[Ce.name]=_e,console.log(` StartNewGame:  thm thc th k nng: ${Ce.name} (${Ce.mastery}) -> ${_e.referenceId}`)}),N(50),L("ang phn tch quy tc ty chnh..."),J(""),console.log(" StartNewGame: Kim tra quy tc ty chnh..."),X&&X.length>0&&_&&me){const Ce=X.filter(_e=>_e.isActive);if(console.log(" StartNewGame: Tm thy quy tc ang active:",Ce.length),Ce.length>0)try{N(60),L("ang to khi nim th gii..."),J(`X l ${Ce.length} quy tc ty chnh`),console.log(" StartNewGame: ang to LORE_CONCEPT..."),console.log(" StartNewGame: ng lc PC trc LORE_CONCEPT:",(we=Ee[B.name])==null?void 0:we.motivation);const _e=await j(Ce);console.log(" StartNewGame: LORE_CONCEPT  to, s lng:",Object.keys(_e).length),console.log(" StartNewGame: Tn thc th concept:",Object.keys(_e)),console.log(" StartNewGame: Concepts c cha tn PC khng?",_e.hasOwnProperty(B.name)),Ee={...Ee,..._e},console.log(" StartNewGame: ng lc PC sau khi merge LORE_CONCEPT:",(Se=Ee[B.name])==null?void 0:Se.motivation)}catch(_e){console.error(" StartNewGame: Khng th to LORE_CONCEPT:",_e)}else console.log(" StartNewGame: Khng tm thy quy tc active no")}else console.log(" StartNewGame: B qua to LORE_CONCEPT - customRules:",!!X,"length:",X==null?void 0:X.length,"ai:",!!_,"isAiReady:",me);N(80),L("ang thit lp trng thi game..."),J("Chun b d liu game"),console.log(" StartNewGame: ang thit lp trng thi game..."),console.log(" StartNewGame: Thc th PC cui cng:",B),console.log(" StartNewGame: Thc th ban u:",Object.keys(Ee)),console.log(" StartNewGame: PC trong initialEntities:",Ee[B.name]);const Re={worldData:xe,knownEntities:Ee,statuses:[],quests:[],gameHistory:[],memories:[],party:[B],customRules:X||[],systemInstruction:Lg,turnCount:0,totalTokens:0,gameTime:{year:D.worldTime.year,month:D.worldTime.month,day:D.worldTime.day,hour:8,minute:0},chronicle:{memoir:[],chapter:[],turn:[]}};console.log(" StartNewGame: D liu trng thi game  chun b:",{worldName:Re.worldData.characterName,entitiesCount:Object.keys(Re.knownEntities).length,customRulesCount:Re.customRules.length}),s(Re),console.log(" StartNewGame: Trng thi game  thit lp, ang to nhim v ban u..."),N(90),L("ang to quest khi u..."),J("To nhim v u tin"),N(95),L("ang chuyn sang mn hnh game..."),J("Hon tt khi to"),await new Promise(Ce=>setTimeout(Ce,500)),N(100),L("Hon tt!"),J("Bt u cuc phiu lu"),setTimeout(()=>{v(!1)},800),e("game"),console.log(" StartNewGame: Chuyn sang ch  game - HON THNH")},Z=D=>{const B=new FileReader;B.onload=X=>{var xe,Ne,Te,Ee,Re,ye;try{const we=(xe=X.target)==null?void 0:xe.result;if(typeof we=="string"){const Se=JSON.parse(we);if(Se.worldData&&Se.knownEntities&&Se.gameHistory){const Ce=Object.values(Se.knownEntities).find(gt=>gt.type==="pc"),_e={worldData:{...Se.worldData,startLocation:Se.worldData.startLocation||"",customStartLocation:Se.worldData.customStartLocation||"",expName:Se.worldData.expName||"Kinh Nghim",realmTiers:Se.worldData.realmTiers||[{id:"1",name:"Luyn Kh",requiredExp:0},{id:"2",name:"Trc C",requiredExp:100}]},knownEntities:Se.knownEntities,statuses:Se.statuses||[],quests:Se.quests||[],gameHistory:Se.gameHistory,memories:Se.memories||[],party:Se.party||(Ce?[Ce]:[]),customRules:Se.customRules||(Se.userKnowledge?[{id:"imported_knowledge",content:Se.userKnowledge,isActive:!0}]:[]),systemInstruction:Se.systemInstruction||Lg,turnCount:Se.turnCount||0,totalTokens:Se.totalTokens||0,gameTime:{year:((Ne=Se.gameTime)==null?void 0:Ne.year)||1,month:((Te=Se.gameTime)==null?void 0:Te.month)||1,day:((Ee=Se.gameTime)==null?void 0:Ee.day)||1,hour:((Re=Se.gameTime)==null?void 0:Re.hour)||8,minute:((ye=Se.gameTime)==null?void 0:ye.minute)||0},chronicle:Se.chronicle||{memoir:[],chapter:[],turn:[]},storyLog:Se.storyLog,choices:Se.choices,locationDiscoveryOrder:Se.locationDiscoveryOrder,compressedHistory:Se.compressedHistory||[],lastCompressionTurn:Se.lastCompressionTurn||0,historyStats:Se.historyStats||{totalEntriesProcessed:0,totalTokensSaved:0,compressionCount:0},cleanupStats:Se.cleanupStats||{totalCleanupsPerformed:0,totalTokensSavedFromCleanup:0,lastCleanupTurn:0,cleanupHistory:[]}};delete _e.userKnowledge,s(_e),e("game")}else alert("Tp lu khng hp l.")}}catch(we){console.error("Li khi ti tp:",we),alert("Khng th c tp lu. Tp c th b hng hoc khng ng nh dng.")}},B.readAsText(D)},A=()=>u(!0),G=()=>p(!0),M=()=>{switch(t){case"create-world":return l.jsx(uw,{onBack:V,onStartGame:F,isInitializing:y,initProgress:C,initCurrentStep:R,initSubStep:O});case"game":return i?l.jsx(JE,{initialGameState:i,onBackToMenu:V,keyRotationNotification:g,onClearNotification:()=>m(null)}):l.jsx(vg,{onStartNewAdventure:S,onQuickPlay:I,hasLastWorldSetup:!!W(),onOpenApiSettings:A,onLoadGameFromFile:Z,isUsingDefaultKey:ae,onOpenChangelog:G,selectedAiModel:re});case"menu":default:return l.jsx(vg,{onStartNewAdventure:S,onQuickPlay:I,hasLastWorldSetup:!!W(),onOpenApiSettings:A,onLoadGameFromFile:Z,isUsingDefaultKey:ae,onOpenChangelog:G,selectedAiModel:re})}};return l.jsxs(vd.Provider,{value:{ai:_,isAiReady:me,apiKeyError:Y,isUsingDefaultKey:ae,userApiKeyCount:P.length,rotateKey:k,selectedModel:re},children:[l.jsx("style",{children:`
        .am-kim {
            background: linear-gradient(135deg, #ca8a04, #eab308, #fde047);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
            background-size: 200% 200%;
        }

        /* Hot nh desktop - ch trn mn hnh ln v khi a thch chuyn ng */
        @media (min-width: 769px) and (prefers-reduced-motion: no-preference) {
            .am-kim {
                animation: am-kim-shine 3s linear infinite;
            }
        }

        /* D phng mobile - gradient tnh cho pin tt hn */
        @media (max-width: 768px), (prefers-reduced-motion: reduce) {
            .am-kim {
                background-position: 50% 50%;
            }
        }

        .dark .am-kim {
             background: linear-gradient(135deg, #fde047, #a2830e, #fde047);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @keyframes am-kim-shine {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
      `}),l.jsxs("div",{className:"min-h-screen w-full flex flex-col items-center justify-center p-2 sm:p-4 font-sans text-slate-900 dark:text-white antialiased pb-4 bg-slate-100 dark:bg-slate-900 transition-colors duration-500",children:[M(),l.jsx(ZE,{isVisible:y,currentStep:R,progress:C,subStep:O}),l.jsx(QE,{isOpen:a,onClose:()=>u(!1),userApiKeys:P,isUsingDefault:ae,onSave:ue,selectedModel:re,onModelChange:H}),l.jsx(WE,{isOpen:f,onClose:()=>p(!1),changelogData:eM})]})]})}const ax=document.getElementById("root");if(!ax)throw new Error("Could not find root element to mount to");const nM=Fy.createRoot(ax);nM.render(l.jsx(Me.StrictMode,{children:l.jsx(tM,{})}));
